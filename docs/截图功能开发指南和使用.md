# 截图功能开发指南和使用文档

## 📋 目录
- [概述](#概述)
- [环境准备](#环境准备)
- [脚本功能](#脚本功能)
- [使用方法](#使用方法)
- [技术实现](#技术实现)
- [常见问题](#常见问题)
- [最佳实践](#最佳实践)
- [扩展功能](#扩展功能)

## 📖 概述

本项目提供了一个基于 Playwright 的自动化截图工具，用于生成移动端页面的高质量截图。该工具支持批量生成、自定义尺寸、错误处理等功能，特别适用于移动端应用的原型展示和文档制作。

### 🎯 主要特性
- ✅ 支持所有HTML页面的自动截图
- ✅ iPhone尺寸优化 (393×852px, 2x分辨率)
- ✅ 智能错误处理和文件检测
- ✅ 自动创建输出目录
- ✅ 详细的进度提示和文件信息
- ✅ 支持批量操作

## 🛠️ 环境准备

### 1. 安装依赖

确保已安装 Node.js 和 npm，然后安装 Playwright：

```bash
# 安装 Playwright
npm install playwright

# 安装浏览器（首次使用需要）
npx playwright install chromium
```

### 2. 项目结构

```
Friends/
├── html/                    # HTML页面目录
│   ├── png/                # 截图输出目录（自动创建）
│   │   ├── home.png
│   │   ├── login.png
│   │   └── ...
│   ├── home.html
│   ├── login.html
│   └── ...
├── generate_screenshot.js   # 截图脚本
└── package.json
```

## 🚀 脚本功能

### 核心功能
- **自动页面检测**: 扫描 `html/` 目录下的所有HTML文件
- **智能错误处理**: 文件不存在时给出友好提示
- **高质量截图**: 移动端优化的截图参数
- **进度反馈**: 实时显示操作状态和文件信息

### 技术参数
- **视口尺寸**: 393×852px (iPhone 12 Pro)
- **设备像素比**: 2x (高分辨率)
- **截图格式**: PNG
- **等待策略**: networkidle (网络空闲时截图)

## 📱 使用方法

### 基本用法

```bash
# 生成指定页面截图
node generate_screenshot.js <页面名称>

# 示例
node generate_screenshot.js home      # 生成首页截图
node generate_screenshot.js login     # 生成登录页截图
node generate_screenshot.js profile   # 生成个人资料页截图
```

### 查看帮助

```bash
# 不带参数运行，显示帮助信息
node generate_screenshot.js
```

输出示例：
```
📱 通用截图生成工具

使用方法:
  node generate_screenshot.js <页面名称>

示例:
  node generate_screenshot.js login     # 生成login.html的截图
  node generate_screenshot.js home      # 生成home.html的截图
  node generate_screenshot.js profile   # 生成profile.html的截图

可用的页面:
  - home
  - login
  - profile
  - splash
  - ...
```

### 批量生成

可以创建批处理脚本来生成多个页面：

```bash
#!/bin/bash
# batch_screenshot.sh

pages=("home" "login" "profile" "splash" "settings")

for page in "${pages[@]}"; do
    echo "正在生成 $page 页面截图..."
    node generate_screenshot.js $page
done

echo "所有截图生成完成！"
```

## 🔧 技术实现

### 核心代码结构

```javascript
const { chromium } = require('playwright');
const path = require('path');
const fs = require('fs');

async function generateScreenshot(pageName) {
    const browser = await chromium.launch();
    const page = await browser.newPage();
    
    // 设置移动端视口
    await page.setViewportSize({ width: 393, height: 852 });
    
    // 设置设备像素比
    await page.evaluate(() => {
        Object.defineProperty(window, 'devicePixelRatio', {
            get: () => 2
        });
    });
    
    // 加载页面并截图
    await page.goto(fileUrl, { waitUntil: 'networkidle' });
    await page.screenshot({ path: screenshotPath });
    
    await browser.close();
}
```

### 关键配置

| 参数 | 值 | 说明 |
|------|-----|------|
| `width` | 393px | iPhone 12 Pro 宽度 |
| `height` | 852px | iPhone 12 Pro 高度 |
| `devicePixelRatio` | 2 | 高分辨率支持 |
| `waitUntil` | networkidle | 等待网络空闲 |
| `type` | png | 输出格式 |

## ❓ 常见问题

### Q1: 截图模糊或尺寸不对
**A**: 检查设备像素比设置，确保为2x分辨率：
```javascript
await page.evaluate(() => {
    Object.defineProperty(window, 'devicePixelRatio', {
        get: () => 2
    });
});
```

### Q2: 页面加载不完整
**A**: 增加等待时间或使用更严格的等待策略：
```javascript
await page.goto(fileUrl, { waitUntil: 'networkidle' });
await page.waitForTimeout(2000); // 额外等待2秒
```

### Q3: 文件路径错误
**A**: 确保HTML文件存在于 `html/` 目录下，文件名与参数一致。

### Q4: 权限问题
**A**: 确保脚本有读写权限，可以手动创建 `html/png/` 目录。

## 💡 最佳实践

### 1. 页面优化
- 确保HTML页面在移动端显示正常
- 使用相对路径引用CSS和JS文件
- 避免使用绝对定位可能导致的布局问题

### 2. 截图质量
- 使用2x设备像素比获得高清截图
- 等待页面完全加载后再截图
- 考虑使用 `fullPage: false` 避免过长页面

### 3. 批量处理
- 创建页面列表，避免重复输入
- 使用错误处理确保单个页面失败不影响整体流程
- 记录生成日志便于问题排查

### 4. 文件管理
- 定期清理旧的截图文件
- 使用有意义的命名规范
- 考虑按日期或版本组织截图

## 🔄 扩展功能

### 1. 自定义尺寸
修改脚本中的视口设置：
```javascript
// 支持不同设备尺寸
const devices = {
    'iphone': { width: 393, height: 852 },
    'ipad': { width: 768, height: 1024 },
    'android': { width: 360, height: 640 }
};

await page.setViewportSize(devices[deviceType]);
```

### 2. 多格式支持
```javascript
// 支持多种输出格式
const formats = ['png', 'jpeg', 'webp'];
await page.screenshot({ 
    path: screenshotPath,
    type: format 
});
```

### 3. 水印功能
```javascript
// 添加水印
await page.evaluate(() => {
    const watermark = document.createElement('div');
    watermark.textContent = 'Friends App';
    watermark.style.cssText = `
        position: fixed; top: 10px; right: 10px;
        background: rgba(0,0,0,0.7); color: white;
        padding: 5px 10px; border-radius: 5px;
        font-size: 12px; z-index: 9999;
    `;
    document.body.appendChild(watermark);
});
```

### 4. 批量对比
```javascript
// 生成前后对比
const beforePath = path.join(pngDir, `${pageName}_before.png`);
const afterPath = path.join(pngDir, `${pageName}_after.png`);

// 生成修改前截图
await page.screenshot({ path: beforePath });

// 执行修改操作
// ...

// 生成修改后截图
await page.screenshot({ path: afterPath });
```

## 📊 性能优化

### 1. 浏览器复用
```javascript
// 批量处理时复用浏览器实例
const browser = await chromium.launch();
const pages = ['home', 'login', 'profile'];

for (const pageName of pages) {
    const page = await browser.newPage();
    // ... 截图逻辑
    await page.close();
}

await browser.close();
```

### 2. 并发处理
```javascript
// 使用Promise.all并发处理
const screenshots = pages.map(async (pageName) => {
    return generateScreenshot(pageName);
});

await Promise.all(screenshots);
```

## 📝 更新日志

### v1.0.0 (2024-10-28)
- ✅ 初始版本发布
- ✅ 支持基本截图功能
- ✅ 移动端尺寸优化
- ✅ 错误处理和帮助信息
- ✅ 自动目录创建

## 🤝 贡献指南

欢迎提交 Issue 和 Pull Request 来改进这个工具！

### 开发环境
1. Fork 项目
2. 创建功能分支
3. 提交更改
4. 创建 Pull Request

### 代码规范
- 使用 ESLint 检查代码
- 添加适当的注释
- 更新相关文档

---

**📞 联系方式**
如有问题或建议，请通过以下方式联系：
- 创建 GitHub Issue
- 发送邮件至项目维护者

**📄 许可证**
本项目采用 MIT 许可证，详见 LICENSE 文件。
