# ç¢°ç¢°äº¤å‹ç¤¾äº¤åº”ç”¨ - ç³»ç»Ÿè®¾è®¡æ–‡æ¡£

> **æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
> **ç¼–å†™æ—¥æœŸ**: 2024-01-XX  
> **æŠ€æœ¯æ ˆ**: Spring Boot 2.7.18 + MyBatis-Plus + MySQL + Redis + JWT  
> **é¡¹ç›®åŸºç¡€**: wxmini-friends

---

## ğŸ“‹ ç›®å½•

1. [ç³»ç»Ÿæ¦‚è¿°](#1-ç³»ç»Ÿæ¦‚è¿°)
2. [æ¶æ„è®¾è®¡](#2-æ¶æ„è®¾è®¡)
3. [æ•°æ®åº“è®¾è®¡](#3-æ•°æ®åº“è®¾è®¡)
4. [æ¨¡å—è¯¦ç»†è®¾è®¡](#4-æ¨¡å—è¯¦ç»†è®¾è®¡)
5. [æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å®ç°](#5-æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å®ç°)
6. [ä¼šå‘˜åŠŸèƒ½å¼€å…³è®¾è®¡](#6-ä¼šå‘˜åŠŸèƒ½å¼€å…³è®¾è®¡)
7. [APIæ¥å£è®¾è®¡](#7-apiæ¥å£è®¾è®¡)
8. [æ€§èƒ½ä¼˜åŒ–ä¸å®‰å…¨](#8-æ€§èƒ½ä¼˜åŒ–ä¸å®‰å…¨)
9. [éƒ¨ç½²ä¸è¿ç»´](#9-éƒ¨ç½²ä¸è¿ç»´)

---

## 1. ç³»ç»Ÿæ¦‚è¿°

### 1.1 äº§å“å®šä½
- **äº§å“åç§°**: ç¢°ç¢°ï¼ˆå¾®ä¿¡å°ç¨‹åºï¼‰
- **æ ¸å¿ƒç†å¿µ**: åšä¸€ä¸ªæ‡‚ä½ çš„æœ‹å‹
- **ç›®æ ‡ç”¨æˆ·**: 18-35å²å•èº«ç”¨æˆ·ï¼Œä¸€äºŒçº¿åŸå¸‚ä¸ºä¸»
- **åŒæ ¸å¿ƒåŠŸèƒ½**: æ‹çˆ±äº¤å‹åŒ¹é… + æ­å­å¹³å°

### 1.2 æŠ€æœ¯é€‰å‹
- **åç«¯æ¡†æ¶**: Spring Boot 2.7.18
- **ORMæ¡†æ¶**: MyBatis-Plus 3.5.3.1
- **æ•°æ®åº“**: MySQL 8.0+
- **ç¼“å­˜**: Redis
- **è®¤è¯**: JWT
- **APIæ–‡æ¡£**: Swagger 3.0
- **å·¥å…·ç±»**: Hutool 5.8.20

### 1.3 ç°æœ‰åŸºç¡€
é¡¹ç›®å·²å®ç°çš„åŸºç¡€åŠŸèƒ½ï¼š
- âœ… å¾®ä¿¡ç™»å½•è®¤è¯ï¼ˆWxAuthControllerï¼‰
- âœ… ç”¨æˆ·èµ„æ–™ç®¡ç†ï¼ˆUserProfileControllerï¼‰
- âœ… æ ‡ç­¾ç³»ç»Ÿï¼ˆTagLibraryï¼‰
- âœ… ç›¸å†Œç®¡ç†ï¼ˆUserAlbumï¼‰
- âœ… éšç§è®¾ç½®ï¼ˆUserPrivacyï¼‰
- âœ… JWTè®¤è¯æ‹¦æˆªå™¨
- âœ… ç»Ÿä¸€å¼‚å¸¸å¤„ç†
- âœ… Redisç¼“å­˜é…ç½®

---

## 2. æ¶æ„è®¾è®¡

### 2.1 æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          å¾®ä¿¡å°ç¨‹åºå‰ç«¯                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ HTTPS
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         API Gateway (Nginx)              â”‚
â”‚   - è´Ÿè½½å‡è¡¡                              â”‚
â”‚   - é™æµæ§åˆ¶                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Spring Boot åº”ç”¨å±‚                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ Controller å±‚                   â”‚     â”‚
â”‚  â”‚ - WxAuthController             â”‚     â”‚
â”‚  â”‚ - UserProfileController         â”‚     â”‚
â”‚  â”‚ - MatchingController (å¾…å¼€å‘)   â”‚     â”‚
â”‚  â”‚ - ChatController (å¾…å¼€å‘)        â”‚     â”‚
â”‚  â”‚ - MomentController (å¾…å¼€å‘)     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                 â”‚                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ Service å±‚                      â”‚     â”‚
â”‚  â”‚ - ä¸šåŠ¡é€»è¾‘å¤„ç†                   â”‚     â”‚
â”‚  â”‚ - äº‹åŠ¡ç®¡ç†                       â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                 â”‚                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ Mapper å±‚ (MyBatis-Plus)        â”‚     â”‚
â”‚  â”‚ - æ•°æ®åº“æ“ä½œ                     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MySQL     â”‚      â”‚     Redis       â”‚
â”‚  æ•°æ®åº“      â”‚      â”‚    ç¼“å­˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 åˆ†å±‚è®¾è®¡

#### 2.2.1 Controller å±‚
- **èŒè´£**: æ¥æ”¶HTTPè¯·æ±‚ï¼Œå‚æ•°æ ¡éªŒï¼Œè¿”å›å“åº”
- **è§„èŒƒ**: 
  - ç»Ÿä¸€ä½¿ç”¨ `Result<T>` åŒ…è£…è¿”å›å€¼
  - ä½¿ç”¨ `@Validated` è¿›è¡Œå‚æ•°æ ¡éªŒ
  - ç»Ÿä¸€å¼‚å¸¸å¤„ç†
  - æ—¥å¿—è®°å½•ï¼ˆå…³é”®æ“ä½œï¼‰

#### 2.2.2 Service å±‚
- **èŒè´£**: ä¸šåŠ¡é€»è¾‘å¤„ç†ï¼Œäº‹åŠ¡ç®¡ç†
- **è§„èŒƒ**:
  - æ¥å£ä¸å®ç°åˆ†ç¦»ï¼ˆServiceæ¥å£ + ServiceImplå®ç°ï¼‰
  - äº‹åŠ¡è¾¹ç•Œæ¸…æ™°ï¼ˆ`@Transactional`ï¼‰
  - ä¸šåŠ¡å¼‚å¸¸ç»Ÿä¸€æŠ›å‡º `BusinessException`

#### 2.2.3 Mapper å±‚
- **èŒè´£**: æ•°æ®åº“CRUDæ“ä½œ
- **è§„èŒƒ**: ä½¿ç”¨ MyBatis-Plusï¼Œå¤æ‚æŸ¥è¯¢ä½¿ç”¨ XML é…ç½®

#### 2.2.4 å·¥å…·å±‚
- **JwtUtil**: JWTç”Ÿæˆä¸è§£æ
- **WxUtil**: å¾®ä¿¡APIè°ƒç”¨
- **RedisUtil**: Redisæ“ä½œå°è£…
- **DesensitizationUtil**: æ•°æ®è„±æ•

---

## 3. æ•°æ®åº“è®¾è®¡

### 3.1 æ ¸å¿ƒè¡¨ç»“æ„è®¾è®¡

#### 3.1.1 ç”¨æˆ·åŸºç¡€è¡¨ï¼ˆå·²å­˜åœ¨ï¼‰
```sql
-- t_user: ç”¨æˆ·åŸºç¡€ä¿¡æ¯è¡¨ï¼ˆå·²æœ‰ï¼‰
-- t_wx_user: å¾®ä¿¡ç”¨æˆ·ä¿¡æ¯è¡¨ï¼ˆå·²æœ‰ï¼‰
-- t_user_profile: ç”¨æˆ·è¯¦ç»†èµ„æ–™è¡¨ï¼ˆå·²æœ‰ï¼‰
```

#### 3.1.2 æ–°å¢è¡¨è®¾è®¡

**1. ç”¨æˆ·åŒ¹é…åå¥½è¡¨ (t_matching_preference)**
```sql
CREATE TABLE `t_matching_preference` (
  `id` BIGINT PRIMARY KEY AUTO_INCREMENT,
  `user_id` BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
  `min_age` INT COMMENT 'æœŸæœ›æœ€å°å¹´é¾„',
  `max_age` INT COMMENT 'æœŸæœ›æœ€å¤§å¹´é¾„',
  `min_height` INT COMMENT 'æœŸæœ›æœ€å°èº«é«˜(cm)',
  `max_height` INT COMMENT 'æœŸæœ›æœ€å¤§èº«é«˜(cm)',
  `education` VARCHAR(50) COMMENT 'æœŸæœ›å­¦å†ï¼ˆå¤šä¸ªç”¨é€—å·åˆ†éš”ï¼‰',
  `income_range` VARCHAR(100) COMMENT 'æœŸæœ›æ”¶å…¥èŒƒå›´',
  `max_distance` INT DEFAULT 50 COMMENT 'æœ€å¤§è·ç¦»(km)',
  `location_latitude` DECIMAL(10,7) COMMENT 'ç”¨æˆ·çº¬åº¦',
  `location_longitude` DECIMAL(10,7) COMMENT 'ç”¨æˆ·ç»åº¦',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `deleted` TINYINT DEFAULT 0,
  UNIQUE KEY `uk_user_id` (`user_id`),
  KEY `idx_location` (`location_latitude`, `location_longitude`)
) COMMENT='ç”¨æˆ·åŒ¹é…åå¥½è¡¨';
```

**2. åŒ¹é…è®°å½•è¡¨ (t_match_record)**
```sql
CREATE TABLE `t_match_record` (
  `id` BIGINT PRIMARY KEY AUTO_INCREMENT,
  `from_user_id` BIGINT NOT NULL COMMENT 'å‘èµ·åŒ¹é…çš„ç”¨æˆ·ID',
  `to_user_id` BIGINT NOT NULL COMMENT 'è¢«åŒ¹é…çš„ç”¨æˆ·ID',
  `match_type` TINYINT NOT NULL COMMENT 'åŒ¹é…ç±»å‹ï¼š1-æ™®é€šå–œæ¬¢ï¼Œ2-è¶…çº§å–œæ¬¢',
  `match_result` TINYINT DEFAULT 0 COMMENT 'åŒ¹é…ç»“æœï¼š0-æœªåŒ¹é…ï¼Œ1-å•å‘å–œæ¬¢ï¼Œ2-åŒå‘åŒ¹é…æˆåŠŸ',
  `matched_at` DATETIME COMMENT 'åŒ¹é…æˆåŠŸæ—¶é—´',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `deleted` TINYINT DEFAULT 0,
  UNIQUE KEY `uk_user_match` (`from_user_id`, `to_user_id`),
  KEY `idx_from_user` (`from_user_id`),
  KEY `idx_to_user` (`to_user_id`),
  KEY `idx_match_result` (`match_result`)
) COMMENT='åŒ¹é…è®°å½•è¡¨';
```

**3. åŒ¹é…é™åˆ¶è¡¨ (t_match_limit)**
```sql
CREATE TABLE `t_match_limit` (
  `id` BIGINT PRIMARY KEY AUTO_INCREMENT,
  `user_id` BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
  `date` DATE NOT NULL COMMENT 'æ—¥æœŸ',
  `free_match_count` INT DEFAULT 0 COMMENT 'å…è´¹åŒ¹é…æ¬¡æ•°ï¼ˆå·²ä½¿ç”¨ï¼‰',
  `vip_match_count` INT DEFAULT 0 COMMENT 'VIPåŒ¹é…æ¬¡æ•°ï¼ˆå·²ä½¿ç”¨ï¼‰',
  `super_like_count` INT DEFAULT 0 COMMENT 'è¶…çº§å–œæ¬¢æ¬¡æ•°ï¼ˆå·²ä½¿ç”¨ï¼‰',
  `last_match_time` DATETIME COMMENT 'æœ€ååŒ¹é…æ—¶é—´',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY `uk_user_date` (`user_id`, `date`),
  KEY `idx_date` (`date`)
) COMMENT='ç”¨æˆ·æ¯æ—¥åŒ¹é…é™åˆ¶è¡¨';
```

**4. èŠå¤©æ¶ˆæ¯è¡¨ (t_chat_message)**
```sql
CREATE TABLE `t_chat_message` (
  `id` BIGINT PRIMARY KEY AUTO_INCREMENT,
  `chat_id` BIGINT NOT NULL COMMENT 'ä¼šè¯ID',
  `sender_id` BIGINT NOT NULL COMMENT 'å‘é€è€…ID',
  `receiver_id` BIGINT NOT NULL COMMENT 'æ¥æ”¶è€…ID',
  `message_type` TINYINT DEFAULT 1 COMMENT 'æ¶ˆæ¯ç±»å‹ï¼š1-æ–‡æœ¬ï¼Œ2-å›¾ç‰‡ï¼Œ3-ä½ç½®',
  `content` TEXT COMMENT 'æ¶ˆæ¯å†…å®¹',
  `image_url` VARCHAR(500) COMMENT 'å›¾ç‰‡URL',
  `is_read` TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦å·²è¯»ï¼š0-æœªè¯»ï¼Œ1-å·²è¯»',
  `read_at` DATETIME COMMENT 'é˜…è¯»æ—¶é—´',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP,
  `deleted` TINYINT DEFAULT 0,
  KEY `idx_chat_id` (`chat_id`),
  KEY `idx_sender` (`sender_id`),
  KEY `idx_receiver` (`receiver_id`),
  KEY `idx_created` (`created_at`)
) COMMENT='èŠå¤©æ¶ˆæ¯è¡¨';
```

**5. èŠå¤©ä¼šè¯è¡¨ (t_chat_session)**
```sql
CREATE TABLE `t_chat_session` (
  `id` BIGINT PRIMARY KEY AUTO_INCREMENT,
  `user1_id` BIGINT NOT NULL COMMENT 'ç”¨æˆ·1 ID',
  `user2_id` BIGINT NOT NULL COMMENT 'ç”¨æˆ·2 ID',
  `last_message_id` BIGINT COMMENT 'æœ€åä¸€æ¡æ¶ˆæ¯ID',
  `last_message_content` VARCHAR(500) COMMENT 'æœ€åä¸€æ¡æ¶ˆæ¯å†…å®¹é¢„è§ˆ',
  `last_message_time` DATETIME COMMENT 'æœ€åä¸€æ¡æ¶ˆæ¯æ—¶é—´',
  `unread_count_user1` INT DEFAULT 0 COMMENT 'ç”¨æˆ·1æœªè¯»æ•°é‡',
  `unread_count_user2` INT DEFAULT 0 COMMENT 'ç”¨æˆ·2æœªè¯»æ•°é‡',
  `is_blocked` TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦æ‹‰é»‘ï¼š0-å¦ï¼Œ1-ç”¨æˆ·1æ‹‰é»‘ç”¨æˆ·2ï¼Œ2-ç”¨æˆ·2æ‹‰é»‘ç”¨æˆ·1',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `deleted` TINYINT DEFAULT 0,
  UNIQUE KEY `uk_users` (`user1_id`, `user2_id`),
  KEY `idx_user1` (`user1_id`),
  KEY `idx_user2` (`user2_id`),
  KEY `idx_last_msg_time` (`last_message_time`)
) COMMENT='èŠå¤©ä¼šè¯è¡¨';
```

**6. åŠ¨æ€è¡¨ (t_moment)**
```sql
CREATE TABLE `t_moment` (
  `id` BIGINT PRIMARY KEY AUTO_INCREMENT,
  `user_id` BIGINT NOT NULL COMMENT 'å‘å¸ƒè€…ID',
  `content` VARCHAR(1000) COMMENT 'åŠ¨æ€å†…å®¹',
  `location` VARCHAR(200) COMMENT 'ä½ç½®ä¿¡æ¯',
  `latitude` DECIMAL(10,7) COMMENT 'çº¬åº¦',
  `longitude` DECIMAL(10,7) COMMENT 'ç»åº¦',
  `like_count` INT DEFAULT 0 COMMENT 'ç‚¹èµæ•°',
  `comment_count` INT DEFAULT 0 COMMENT 'è¯„è®ºæ•°',
  `view_count` INT DEFAULT 0 COMMENT 'æµè§ˆæ•°',
  `is_top` TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦ç½®é¡¶ï¼š0-å¦ï¼Œ1-æ˜¯',
  `top_expire_time` DATETIME COMMENT 'ç½®é¡¶è¿‡æœŸæ—¶é—´',
  `audit_status` TINYINT DEFAULT 0 COMMENT 'å®¡æ ¸çŠ¶æ€ï¼š0-å¾…å®¡æ ¸ï¼Œ1-é€šè¿‡ï¼Œ2-æ‹’ç»',
  `audit_remark` VARCHAR(500) COMMENT 'å®¡æ ¸å¤‡æ³¨',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `deleted` TINYINT DEFAULT 0,
  KEY `idx_user_id` (`user_id`),
  KEY `idx_location` (`latitude`, `longitude`),
  KEY `idx_created` (`created_at`),
  KEY `idx_audit` (`audit_status`)
) COMMENT='åŠ¨æ€è¡¨';
```

**7. åŠ¨æ€å›¾ç‰‡è¡¨ (t_moment_photo)**
```sql
CREATE TABLE `t_moment_photo` (
  `id` BIGINT PRIMARY KEY AUTO_INCREMENT,
  `moment_id` BIGINT NOT NULL COMMENT 'åŠ¨æ€ID',
  `photo_url` VARCHAR(500) NOT NULL COMMENT 'å›¾ç‰‡URL',
  `sort_order` INT DEFAULT 0 COMMENT 'æ’åº',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP,
  KEY `idx_moment_id` (`moment_id`)
) COMMENT='åŠ¨æ€å›¾ç‰‡è¡¨';
```

**8. åŠ¨æ€ç‚¹èµè¡¨ (t_moment_like)**
```sql
CREATE TABLE `t_moment_like` (
  `id` BIGINT PRIMARY KEY AUTO_INCREMENT,
  `moment_id` BIGINT NOT NULL COMMENT 'åŠ¨æ€ID',
  `user_id` BIGINT NOT NULL COMMENT 'ç‚¹èµç”¨æˆ·ID',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP,
  UNIQUE KEY `uk_moment_user` (`moment_id`, `user_id`),
  KEY `idx_user_id` (`user_id`)
) COMMENT='åŠ¨æ€ç‚¹èµè¡¨';
```

**9. ä¼šå‘˜ä¿¡æ¯è¡¨ (t_vip_member)**
```sql
CREATE TABLE `t_vip_member` (
  `id` BIGINT PRIMARY KEY AUTO_INCREMENT,
  `user_id` BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
  `vip_level` TINYINT DEFAULT 1 COMMENT 'ä¼šå‘˜ç­‰çº§ï¼š1-æœˆåº¦ï¼Œ2-å­£åº¦ï¼Œ3-å¹´åº¦',
  `start_time` DATETIME NOT NULL COMMENT 'å¼€å§‹æ—¶é—´',
  `expire_time` DATETIME NOT NULL COMMENT 'åˆ°æœŸæ—¶é—´',
  `auto_renew` TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦è‡ªåŠ¨ç»­è´¹ï¼š0-å¦ï¼Œ1-æ˜¯',
  `status` TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€ï¼š0-å·²è¿‡æœŸï¼Œ1-æœ‰æ•ˆ',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY `uk_user_id` (`user_id`),
  KEY `idx_expire_time` (`expire_time`)
) COMMENT='ä¼šå‘˜ä¿¡æ¯è¡¨';
```

**10. è®¢å•è¡¨ (t_order)**
```sql
CREATE TABLE `t_order` (
  `id` BIGINT PRIMARY KEY AUTO_INCREMENT,
  `order_no` VARCHAR(64) NOT NULL COMMENT 'è®¢å•å·',
  `user_id` BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
  `order_type` TINYINT NOT NULL COMMENT 'è®¢å•ç±»å‹ï¼š1-æœˆåº¦ä¼šå‘˜ï¼Œ2-å­£åº¦ä¼šå‘˜ï¼Œ3-å¹´åº¦ä¼šå‘˜ï¼Œ4-æŸ¥çœ‹å–œæ¬¢æˆ‘ï¼Œ5-è¶…çº§å–œæ¬¢ï¼Œ6-ç½®é¡¶åŠ¨æ€',
  `amount` DECIMAL(10,2) NOT NULL COMMENT 'é‡‘é¢',
  `pay_status` TINYINT DEFAULT 0 COMMENT 'æ”¯ä»˜çŠ¶æ€ï¼š0-å¾…æ”¯ä»˜ï¼Œ1-å·²æ”¯ä»˜ï¼Œ2-å·²é€€æ¬¾',
  `pay_method` VARCHAR(20) COMMENT 'æ”¯ä»˜æ–¹å¼ï¼šwxpay-å¾®ä¿¡æ”¯ä»˜ï¼Œalipay-æ”¯ä»˜å®',
  `transaction_id` VARCHAR(100) COMMENT 'ç¬¬ä¸‰æ–¹äº¤æ˜“å·',
  `paid_at` DATETIME COMMENT 'æ”¯ä»˜æ—¶é—´',
  `expire_at` DATETIME COMMENT 'è®¢å•è¿‡æœŸæ—¶é—´',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY `uk_order_no` (`order_no`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_pay_status` (`pay_status`)
) COMMENT='è®¢å•è¡¨';
```

**11. ç³»ç»Ÿé…ç½®è¡¨ (t_system_config)**
```sql
CREATE TABLE `t_system_config` (
  `id` BIGINT PRIMARY KEY AUTO_INCREMENT,
  `config_key` VARCHAR(100) NOT NULL COMMENT 'é…ç½®é”®',
  `config_value` VARCHAR(500) COMMENT 'é…ç½®å€¼',
  `config_desc` VARCHAR(200) COMMENT 'é…ç½®æè¿°',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY `uk_config_key` (`config_key`)
) COMMENT='ç³»ç»Ÿé…ç½®è¡¨';

-- åˆå§‹åŒ–é…ç½®æ•°æ®
INSERT INTO `t_system_config` (`config_key`, `config_value`, `config_desc`) VALUES
('vip.feature.enabled', 'false', 'ä¼šå‘˜åŠŸèƒ½å¼€å…³ï¼štrue-å¼€å¯ï¼Œfalse-å…³é—­ï¼ˆå‰æœŸå…³é—­ï¼Œå…¨åŠŸèƒ½å…è´¹ï¼‰'),
('vip.daily.free.match.count', '3', 'å…è´¹ç”¨æˆ·æ¯æ—¥åŒ¹é…æ¬¡æ•°'),
('vip.daily.free.super.like.count', '1', 'å…è´¹ç”¨æˆ·æ¯æ—¥è¶…çº§å–œæ¬¢æ¬¡æ•°'),
('match.algorithm.location.weight', '30', 'åŒ¹é…ç®—æ³•-åœ°ç†ä½ç½®æƒé‡'),
('match.algorithm.tag.weight', '25', 'åŒ¹é…ç®—æ³•-å…´è¶£æ ‡ç­¾æƒé‡'),
('match.algorithm.age.weight', '20', 'åŒ¹é…ç®—æ³•-å¹´é¾„æƒé‡'),
('match.algorithm.education.weight', '15', 'åŒ¹é…ç®—æ³•-å­¦å†æƒé‡'),
('match.algorithm.activity.weight', '10', 'åŒ¹é…ç®—æ³•-æ´»è·ƒåº¦æƒé‡');
```

---

## 4. æ¨¡å—è¯¦ç»†è®¾è®¡

### 4.1 ç”¨æˆ·è®¤è¯æ¨¡å—

#### 4.1.1 å¾®ä¿¡ç™»å½•æµç¨‹
```
1. å‰ç«¯è°ƒç”¨ wx.login() è·å– code
2. è°ƒç”¨ /api/auth/wx/loginï¼Œä¼ å…¥ code
3. åç«¯è°ƒç”¨å¾®ä¿¡æ¥å£è·å– openid å’Œ session_key
4. æ£€æŸ¥ t_wx_user è¡¨æ˜¯å¦å­˜åœ¨è¯¥ openid
   - ä¸å­˜åœ¨ï¼šåˆ›å»ºæ–°ç”¨æˆ·ï¼Œè¿”å›ç”¨æˆ·ä¿¡æ¯ + JWT token
   - å­˜åœ¨ï¼šæ›´æ–°æœ€åç™»å½•æ—¶é—´ï¼Œè¿”å›ç”¨æˆ·ä¿¡æ¯ + JWT token
5. å‰ç«¯ä¿å­˜ tokenï¼Œåç»­è¯·æ±‚æºå¸¦åœ¨ Header ä¸­
```

#### 4.1.2 å®ç°è¦ç‚¹
- **Service**: `WxAuthService`
- **å…³é”®æ–¹æ³•**:
  - `login(WxLoginRequest)`: å¾®ä¿¡ç™»å½•
  - `getUserInfo(Long userId)`: è·å–ç”¨æˆ·ä¿¡æ¯
  - `refreshToken(String refreshToken)`: åˆ·æ–°token
- **å®‰å…¨è€ƒè™‘**:
  - JWT token 7å¤©æœ‰æ•ˆæœŸ
  - refreshToken 30å¤©æœ‰æ•ˆæœŸ
  - æ•æ„Ÿä¿¡æ¯ï¼ˆæ‰‹æœºå·ï¼‰è„±æ•è¿”å›

### 4.2 ç”¨æˆ·èµ„æ–™æ¨¡å—

#### 4.2.1 èµ„æ–™å®Œå–„æµç¨‹
```
1. é¦–æ¬¡ç™»å½•æ£€æŸ¥æ˜¯å¦å®Œå–„èµ„æ–™ï¼ˆt_user_profile è¡¨ï¼‰
2. æœªå®Œå–„ï¼šå¼•å¯¼ç”¨æˆ·å¡«å†™å¿…å¡«é¡¹
   - æ˜µç§°ï¼ˆ2-10å­—ç¬¦ï¼‰
   - æ€§åˆ«
   - å‡ºç”Ÿæ—¥æœŸï¼ˆè®¡ç®—å¹´é¾„ï¼‰
   - ç°å±…åœ°ï¼ˆçœå¸‚åŒºä¸‰çº§è”åŠ¨ï¼‰
3. é€‰å¡«é¡¹ï¼š
   - èº«é«˜ã€ä½“é‡ã€å®¶ä¹¡ã€å­¦å†ã€èŒä¸šã€æ”¶å…¥ã€ç®€ä»‹
4. ä¸Šä¼ ç…§ç‰‡ï¼ˆæœ€å¤š9å¼ ï¼Œé¦–å¼ ä¸ºå¤´åƒï¼‰
5. é€‰æ‹©å…´è¶£æ ‡ç­¾ï¼ˆæœ€å¤š10ä¸ªï¼‰
6. è®¾ç½®åŒ¹é…åå¥½ï¼ˆå¹´é¾„ã€å­¦å†ã€è·ç¦»ç­‰ï¼‰
```

#### 4.2.2 å®ç°è¦ç‚¹
- **Service**: `UserProfileService`ï¼ˆå·²å­˜åœ¨ï¼‰
- **æ–°å¢æ–¹æ³•**:
  - `checkProfileComplete(Long userId)`: æ£€æŸ¥èµ„æ–™æ˜¯å¦å®Œå–„
  - `saveMatchingPreference(Long userId, MatchingPreferenceRequest)`: ä¿å­˜åŒ¹é…åå¥½
- **æ•°æ®éªŒè¯**:
  - ä½¿ç”¨ `@Valid` è¿›è¡Œå‚æ•°æ ¡éªŒ
  - è‡ªå®šä¹‰æ ¡éªŒå™¨ï¼šæ˜µç§°é•¿åº¦ã€å¹´é¾„èŒƒå›´ã€èº«é«˜èŒƒå›´ç­‰

### 4.3 æ™ºèƒ½åŒ¹é…æ¨¡å—

#### 4.3.1 åŒ¹é…ç®—æ³•å®ç°

**æ ¸å¿ƒç®—æ³•ä¼ªä»£ç **:
```java
public List<UserCardDTO> recommendUsers(Long userId, int page, int size) {
    // 1. è·å–ç”¨æˆ·åŒ¹é…åå¥½
    MatchingPreference preference = getMatchingPreference(userId);
    
    // 2. æ„å»ºæŸ¥è¯¢æ¡ä»¶
    QueryWrapper<User> wrapper = buildQueryWrapper(preference);
    
    // 3. æ’é™¤å·²åŒ¹é…çš„ç”¨æˆ·
    List<Long> excludedUserIds = getExcludedUserIds(userId);
    wrapper.notIn("id", excludedUserIds);
    
    // 4. åˆ†é¡µæŸ¥è¯¢
    Page<User> userPage = userMapper.selectPage(new Page(page, size), wrapper);
    
    // 5. è®¡ç®—åŒ¹é…åº¦å¹¶æ’åº
    List<UserCardDTO> cards = userPage.getRecords().stream()
        .map(user -> {
            UserCardDTO card = convertToCard(user);
            card.setMatchScore(calculateMatchScore(userId, user.getId(), preference));
            return card;
        })
        .sorted((a, b) -> Double.compare(b.getMatchScore(), a.getMatchScore()))
        .collect(Collectors.toList());
    
    return cards;
}

private double calculateMatchScore(Long userId, Long targetUserId, 
                                   MatchingPreference preference) {
    double score = 0.0;
    
    // åœ°ç†ä½ç½®åŒ¹é…ï¼ˆ30%ï¼‰
    double locationScore = calculateLocationScore(userId, targetUserId);
    score += locationScore * 0.30;
    
    // å…´è¶£æ ‡ç­¾ç›¸ä¼¼åº¦ï¼ˆ25%ï¼‰
    double tagScore = calculateTagSimilarity(userId, targetUserId);
    score += tagScore * 0.25;
    
    // å¹´é¾„åŒ¹é…ï¼ˆ20%ï¼‰
    double ageScore = calculateAgeScore(preference, targetUserId);
    score += ageScore * 0.20;
    
    // å­¦å†åŒ¹é…ï¼ˆ15%ï¼‰
    double educationScore = calculateEducationScore(preference, targetUserId);
    score += educationScore * 0.15;
    
    // æ´»è·ƒåº¦ï¼ˆ10%ï¼‰
    double activityScore = calculateActivityScore(targetUserId);
    score += activityScore * 0.10;
    
    return score;
}
```

#### 4.3.2 åŒ¹é…æ“ä½œå®ç°

**Service**: `MatchingService`

**æ ¸å¿ƒæ–¹æ³•**:
1. **`recommendUsers(Long userId, int page, int size)`**: æ¨èç”¨æˆ·åˆ—è¡¨
2. **`likeUser(Long fromUserId, Long toUserId, int matchType)`**: å–œæ¬¢æ“ä½œ
   - matchType: 1-æ™®é€šå–œæ¬¢ï¼Œ2-è¶…çº§å–œæ¬¢
   - æ£€æŸ¥åŒ¹é…æ¬¡æ•°é™åˆ¶
   - æ’å…¥åŒ¹é…è®°å½•
   - æ£€æŸ¥æ˜¯å¦åŒå‘åŒ¹é…
   - å¦‚æœåŒ¹é…æˆåŠŸï¼Œåˆ›å»ºèŠå¤©ä¼šè¯
3. **`passUser(Long fromUserId, Long toUserId)`**: è·³è¿‡æ“ä½œ
   - è®°å½•è·³è¿‡è¡Œä¸ºï¼ˆç”¨äºä¼˜åŒ–æ¨èï¼‰
   - ä¸æ¶ˆè€—åŒ¹é…æ¬¡æ•°
4. **`checkMatchLimit(Long userId)`**: æ£€æŸ¥åŒ¹é…é™åˆ¶
   - è¯»å–ç³»ç»Ÿé…ç½®ï¼ˆä¼šå‘˜åŠŸèƒ½å¼€å…³ï¼‰
   - å¦‚æœå…³é—­ï¼šä¸é™åˆ¶
   - å¦‚æœå¼€å¯ï¼šæ£€æŸ¥æ˜¯å¦VIPï¼ŒéVIPæ£€æŸ¥æ¯æ—¥æ¬¡æ•°

**åŒ¹é…é™åˆ¶é€»è¾‘**:
```java
public boolean checkMatchLimit(Long userId, int matchType) {
    // è¯»å–ä¼šå‘˜åŠŸèƒ½å¼€å…³
    boolean vipEnabled = systemConfigService.getConfigValue(
        "vip.feature.enabled", Boolean.class, false);
    
    // å¦‚æœä¼šå‘˜åŠŸèƒ½å…³é—­ï¼Œå…¨åŠŸèƒ½å…è´¹ï¼Œä¸é™åˆ¶
    if (!vipEnabled) {
        return true;
    }
    
    // ä¼šå‘˜åŠŸèƒ½å¼€å¯ï¼Œæ£€æŸ¥VIPçŠ¶æ€
    VipMember vip = vipService.getVipMember(userId);
    if (vip != null && vip.isValid()) {
        return true; // VIPç”¨æˆ·æ— é™åˆ¶
    }
    
    // å…è´¹ç”¨æˆ·æ£€æŸ¥æ¯æ—¥é™åˆ¶
    MatchLimit limit = getTodayLimit(userId);
    int freeMatchCount = systemConfigService.getConfigValue(
        "vip.daily.free.match.count", Integer.class, 3);
    
    if (matchType == 2) { // è¶…çº§å–œæ¬¢
        int freeSuperLikeCount = systemConfigService.getConfigValue(
            "vip.daily.free.super.like.count", Integer.class, 1);
        return limit.getSuperLikeCount() < freeSuperLikeCount;
    } else {
        return limit.getFreeMatchCount() < freeMatchCount;
    }
}
```

### 4.4 èŠå¤©æ¨¡å—

#### 4.4.1 èŠå¤©æƒé™æ§åˆ¶

**è§¦å‘èŠå¤©æ¡ä»¶**:
1. **åŒå‘åŒ¹é…æˆåŠŸ**: è‡ªåŠ¨åˆ›å»ºèŠå¤©ä¼šè¯
2. **è¶…çº§å–œæ¬¢**: å¯¹æ–¹å¯ä»¥çœ‹åˆ°å¹¶å›å¤ï¼ˆæœªåŒ¹é…å‰åªèƒ½å‘1æ¡ï¼‰
3. **åŠ¨æ€äº’åŠ¨**: ç‚¹èµ/è¯„è®ºåå¯å‘é€æ¶ˆæ¯

**é˜²éªšæ‰°æœºåˆ¶**:
```java
public void sendMessage(Long senderId, Long receiverId, String content) {
    // 1. æ£€æŸ¥æ˜¯å¦åŒ¹é…
    boolean isMatched = matchService.isMatched(senderId, receiverId);
    
    // 2. å¦‚æœæœªåŒ¹é…ï¼Œæ£€æŸ¥æ¶ˆæ¯é™åˆ¶
    if (!isMatched) {
        int sentCount = getUnreadMessageCount(senderId, receiverId);
        if (sentCount > 0) {
            throw new BusinessException("å¯¹æ–¹æœªå›å¤ï¼Œæ— æ³•ç»§ç»­å‘é€æ¶ˆæ¯");
        }
    }
    
    // 3. å‘é€æ¶ˆæ¯
    ChatMessage message = new ChatMessage();
    message.setSenderId(senderId);
    message.setReceiverId(receiverId);
    message.setContent(content);
    message.setMessageType(1); // æ–‡æœ¬æ¶ˆæ¯
    chatMessageMapper.insert(message);
    
    // 4. æ›´æ–°ä¼šè¯ä¿¡æ¯
    updateChatSession(senderId, receiverId, message);
    
    // 5. æ¨é€æ¶ˆæ¯ï¼ˆWebSocket æˆ– ç¬¬ä¸‰æ–¹æ¨é€ï¼‰
    pushMessage(receiverId, message);
}
```

#### 4.4.2 èŠå¤©ä¼šè¯ç®¡ç†

**Service**: `ChatService`

**æ ¸å¿ƒæ–¹æ³•**:
1. **`getChatList(Long userId)`**: è·å–èŠå¤©åˆ—è¡¨
   - æŸ¥è¯¢ç”¨æˆ·çš„æ‰€æœ‰ä¼šè¯
   - æŒ‰æœ€åæ¶ˆæ¯æ—¶é—´æ’åº
   - ç»Ÿè®¡æœªè¯»æ¶ˆæ¯æ•°

2. **`getChatMessages(Long chatId, Long userId, int page, int size)`**: è·å–èŠå¤©æ¶ˆæ¯
   - åˆ†é¡µæŸ¥è¯¢æ¶ˆæ¯
   - æ ‡è®°å·²è¯»
   - è¿”å›æ¶ˆæ¯åˆ—è¡¨

3. **`createChatSession(Long user1Id, Long user2Id)`**: åˆ›å»ºèŠå¤©ä¼šè¯
   - æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ä¼šè¯
   - ä¸å­˜åœ¨åˆ™åˆ›å»ºæ–°ä¼šè¯

### 4.5 åŠ¨æ€æ¨¡å—

#### 4.5.1 å‘å¸ƒåŠ¨æ€æµç¨‹

```
1. ç”¨æˆ·é€‰æ‹©åŠ¨æ€ç±»å‹ï¼ˆæ–‡å­—/å›¾ç‰‡/ä½ç½®ï¼‰
2. å¡«å†™å†…å®¹ï¼ˆæœ€å¤š1000å­—ï¼‰
3. ä¸Šä¼ å›¾ç‰‡ï¼ˆæœ€å¤š9å¼ ï¼‰
4. é€‰æ‹©ä½ç½®ï¼ˆå¯é€‰ï¼‰
5. æäº¤å®¡æ ¸
6. å®¡æ ¸é€šè¿‡åå‘å¸ƒ
```

#### 4.5.2 å®ç°è¦ç‚¹

**Service**: `MomentService`

**æ ¸å¿ƒæ–¹æ³•**:
1. **`publishMoment(Long userId, MomentRequest)`**: å‘å¸ƒåŠ¨æ€
   - æ£€æŸ¥æ¯æ—¥å‘å¸ƒé™åˆ¶ï¼ˆ3æ¡ï¼‰
   - å†…å®¹å®¡æ ¸ï¼ˆæ•æ„Ÿè¯è¿‡æ»¤ï¼‰
   - ä¿å­˜åŠ¨æ€å’Œå›¾ç‰‡
   - å¼‚æ­¥å®¡æ ¸ä»»åŠ¡

2. **`getMomentList(Long userId, double latitude, double longitude, int page, int size)`**: è·å–åŠ¨æ€åˆ—è¡¨
   - æŒ‰åœ°ç†ä½ç½®æ’åºï¼ˆé™„è¿‘ä¼˜å…ˆï¼‰
   - æŒ‰æ—¶é—´å€’åº
   - æ”¯æŒåˆ†é¡µ

3. **`likeMoment(Long userId, Long momentId)`**: ç‚¹èµåŠ¨æ€
   - æ£€æŸ¥æ˜¯å¦å·²ç‚¹èµ
   - æ’å…¥ç‚¹èµè®°å½•
   - æ›´æ–°åŠ¨æ€ç‚¹èµæ•°ï¼ˆRedisç¼“å­˜ï¼‰

4. **`commentMoment(Long userId, Long momentId, String content)`**: è¯„è®ºåŠ¨æ€
   - æ’å…¥è¯„è®ºè®°å½•
   - æ›´æ–°åŠ¨æ€è¯„è®ºæ•°

#### 4.5.3 å®¡æ ¸æœºåˆ¶

**å®¡æ ¸æµç¨‹**:
```
å‘å¸ƒåŠ¨æ€ â†’ å†…å®¹å®¡æ ¸ï¼ˆAIè‡ªåŠ¨å®¡æ ¸ï¼‰
â”œâ”€ é€šè¿‡ â†’ ç›´æ¥å‘å¸ƒ
â””â”€ ç–‘ä¼¼è¿è§„ â†’ äººå·¥å®¡æ ¸é˜Ÿåˆ— â†’ å®¡æ ¸ç»“æœ
```

**å®¡æ ¸è§„åˆ™**:
- æ•æ„Ÿè¯è¿‡æ»¤ï¼ˆç¬¬ä¸‰æ–¹æœåŠ¡ï¼‰
- å›¾ç‰‡å†…å®¹è¯†åˆ«ï¼ˆOCR + å›¾åƒè¯†åˆ«ï¼‰
- äººå·¥å®¡æ ¸ï¼ˆåå°ç®¡ç†ï¼‰

### 4.6 ä¼šå‘˜æ¨¡å—

#### 4.6.1 ä¼šå‘˜æƒç›Šç®¡ç†

**Service**: `VipService`

**æ ¸å¿ƒæ–¹æ³•**:
1. **`checkVipStatus(Long userId)`**: æ£€æŸ¥VIPçŠ¶æ€
   - æŸ¥è¯¢ä¼šå‘˜ä¿¡æ¯
   - æ£€æŸ¥æ˜¯å¦è¿‡æœŸ
   - è¿”å›æƒç›Šåˆ—è¡¨

2. **`purchaseVip(Long userId, int vipLevel)`**: è´­ä¹°ä¼šå‘˜
   - åˆ›å»ºè®¢å•
   - è°ƒç”¨æ”¯ä»˜æ¥å£
   - æ”¯ä»˜æˆåŠŸåæ¿€æ´»ä¼šå‘˜

3. **`getVipFeatures(Long userId)`**: è·å–ä¼šå‘˜åŠŸèƒ½æƒé™
   - è¯»å–ä¼šå‘˜åŠŸèƒ½å¼€å…³
   - å¦‚æœå…³é—­ï¼šè¿”å›æ‰€æœ‰åŠŸèƒ½å¯ç”¨
   - å¦‚æœå¼€å¯ï¼šæ ¹æ®VIPçŠ¶æ€è¿”å›æƒé™

#### 4.6.2 è®¢å•å¤„ç†

**æ”¯ä»˜æµç¨‹**:
```
é€‰æ‹©å¥—é¤ â†’ åˆ›å»ºè®¢å• â†’ è°ƒç”¨æ”¯ä»˜æ¥å£ â†’ æ”¯ä»˜æˆåŠŸå›è°ƒ
â†’ æ¿€æ´»ä¼šå‘˜ â†’ å‘é€é€šçŸ¥
```

**è®¢å•çŠ¶æ€**:
- 0: å¾…æ”¯ä»˜
- 1: å·²æ”¯ä»˜
- 2: å·²é€€æ¬¾

---

## 5. æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å®ç°

### 5.1 åŒ¹é…ç®—æ³•è¯¦ç»†å®ç°

#### 5.1.1 åœ°ç†ä½ç½®åŒ¹é…

```java
private double calculateLocationScore(Long userId, Long targetUserId) {
    // è·å–ç”¨æˆ·ä½ç½®
    UserLocation userLoc = getUserLocation(userId);
    UserLocation targetLoc = getUserLocation(targetUserId);
    
    if (userLoc == null || targetLoc == null) {
        return 0.5; // é»˜è®¤åˆ†æ•°
    }
    
    // è®¡ç®—è·ç¦»ï¼ˆHaversineå…¬å¼ï¼‰
    double distance = calculateDistance(
        userLoc.getLatitude(), userLoc.getLongitude(),
        targetLoc.getLatitude(), targetLoc.getLongitude()
    );
    
    // è·å–ç”¨æˆ·åå¥½æœ€å¤§è·ç¦»
    MatchingPreference preference = getMatchingPreference(userId);
    int maxDistance = preference.getMaxDistance();
    
    // è·ç¦»è¶Šè¿‘åˆ†æ•°è¶Šé«˜ï¼Œè¶…è¿‡æœ€å¤§è·ç¦»è¿”å›0
    if (distance > maxDistance) {
        return 0.0;
    }
    
    // çº¿æ€§å½’ä¸€åŒ–åˆ° 0-1
    return 1.0 - (distance / maxDistance);
}
```

#### 5.1.2 å…´è¶£æ ‡ç­¾ç›¸ä¼¼åº¦

```java
private double calculateTagSimilarity(Long userId, Long targetUserId) {
    // è·å–ç”¨æˆ·æ ‡ç­¾
    List<String> userTags = getUserTags(userId);
    List<String> targetTags = getUserTags(targetUserId);
    
    if (userTags.isEmpty() || targetTags.isEmpty()) {
        return 0.3; // é»˜è®¤åˆ†æ•°
    }
    
    // è®¡ç®—äº¤é›†
    Set<String> intersection = new HashSet<>(userTags);
    intersection.retainAll(targetTags);
    
    // è®¡ç®—å¹¶é›†
    Set<String> union = new HashSet<>(userTags);
    union.addAll(targetTags);
    
    // Jaccardç›¸ä¼¼åº¦
    return intersection.size() / (double) union.size();
}
```

#### 5.1.3 å¹´é¾„åŒ¹é…

```java
private double calculateAgeScore(MatchingPreference preference, Long targetUserId) {
    UserProfile targetProfile = getUserProfile(targetUserId);
    int targetAge = calculateAge(targetProfile.getBirthDate());
    
    int minAge = preference.getMinAge();
    int maxAge = preference.getMaxAge();
    
    if (targetAge < minAge || targetAge > maxAge) {
        return 0.0;
    }
    
    // å¹´é¾„è¶Šæ¥è¿‘æœŸæœ›å¹´é¾„èŒƒå›´ä¸­ç‚¹ï¼Œåˆ†æ•°è¶Šé«˜
    int midAge = (minAge + maxAge) / 2;
    int ageDiff = Math.abs(targetAge - midAge);
    int ageRange = maxAge - minAge;
    
    return 1.0 - (ageDiff / (double) ageRange);
}
```

### 5.2 åŒ¹é…è®°å½•å¤„ç†

#### 5.2.1 åŒå‘åŒ¹é…æ£€æµ‹

```java
public MatchResult likeUser(Long fromUserId, Long toUserId, int matchType) {
    // 1. æ£€æŸ¥åŒ¹é…é™åˆ¶
    if (!checkMatchLimit(fromUserId, matchType)) {
        throw new BusinessException("ä»Šæ—¥åŒ¹é…æ¬¡æ•°å·²ç”¨å®Œ");
    }
    
    // 2. æ£€æŸ¥æ˜¯å¦å·²åŒ¹é…è¿‡
    MatchRecord existing = getMatchRecord(fromUserId, toUserId);
    if (existing != null) {
        throw new BusinessException("å·²å¯¹è¯¥ç”¨æˆ·è¿›è¡Œè¿‡æ“ä½œ");
    }
    
    // 3. åˆ›å»ºåŒ¹é…è®°å½•
    MatchRecord record = new MatchRecord();
    record.setFromUserId(fromUserId);
    record.setToUserId(toUserId);
    record.setMatchType(matchType);
    record.setMatchResult(1); // å•å‘å–œæ¬¢
    matchRecordMapper.insert(record);
    
    // 4. æ£€æŸ¥æ˜¯å¦åŒå‘åŒ¹é…
    MatchRecord reverseRecord = getMatchRecord(toUserId, fromUserId);
    if (reverseRecord != null && reverseRecord.getMatchResult() == 1) {
        // åŒå‘åŒ¹é…æˆåŠŸ
        record.setMatchResult(2); // åŒå‘åŒ¹é…
        record.setMatchedAt(LocalDateTime.now());
        reverseRecord.setMatchResult(2);
        reverseRecord.setMatchedAt(LocalDateTime.now());
        
        matchRecordMapper.updateById(record);
        matchRecordMapper.updateById(reverseRecord);
        
        // åˆ›å»ºèŠå¤©ä¼šè¯
        chatService.createChatSession(fromUserId, toUserId);
        
        // æ¨é€åŒ¹é…æˆåŠŸé€šçŸ¥
        pushMatchSuccessNotification(fromUserId, toUserId);
        pushMatchSuccessNotification(toUserId, fromUserId);
        
        return MatchResult.builder()
            .isMatched(true)
            .matchedAt(LocalDateTime.now())
            .build();
    }
    
    // 5. æ›´æ–°åŒ¹é…æ¬¡æ•°
    updateMatchLimit(fromUserId, matchType);
    
    return MatchResult.builder()
        .isMatched(false)
        .build();
}
```

### 5.3 æ¶ˆæ¯å‘é€é™åˆ¶

#### 5.3.1 é˜²éªšæ‰°æœºåˆ¶

```java
public void sendMessage(Long senderId, Long receiverId, String content) {
    // 1. æ£€æŸ¥æ˜¯å¦åŒ¹é…
    boolean isMatched = matchService.isMatched(senderId, receiverId);
    
    if (!isMatched) {
        // 2. æ£€æŸ¥æ˜¯å¦å·²å‘é€è¿‡æœªè¯»æ¶ˆæ¯
        ChatSession session = getChatSession(senderId, receiverId);
        if (session == null) {
            // é¦–æ¬¡å‘é€ï¼Œåˆ›å»ºä¼šè¯
            session = createChatSession(senderId, receiverId);
        }
        
        // æ£€æŸ¥å¯¹æ–¹æ˜¯å¦æœ‰æœªè¯»æ¶ˆæ¯
        int unreadCount = getUnreadMessageCount(senderId, receiverId);
        if (unreadCount > 0) {
            throw new BusinessException("å¯¹æ–¹æœªå›å¤ï¼Œæ— æ³•ç»§ç»­å‘é€æ¶ˆæ¯");
        }
        
        // é¦–æ¬¡å‘é€ï¼Œå…è®¸
        sendMessageInternal(senderId, receiverId, content);
    } else {
        // å·²åŒ¹é…ï¼Œæ— é™åˆ¶
        sendMessageInternal(senderId, receiverId, content);
    }
}
```

---

## 6. ä¼šå‘˜åŠŸèƒ½å¼€å…³è®¾è®¡

### 6.1 å¼€å…³è®¾è®¡åŸåˆ™

**ç›®æ ‡**: å‰æœŸæ¨å¹¿é˜¶æ®µï¼Œå…¨åŠŸèƒ½å…è´¹ï¼Œæ— éœ€ä¼šå‘˜å³å¯ä½“éªŒæ‰€æœ‰åŠŸèƒ½ï¼›åæœŸè¿è¥ç¨³å®šåï¼Œé€šè¿‡é…ç½®å¼€å…³å¼€å¯ä¼šå‘˜é™åˆ¶ã€‚

### 6.2 å®ç°æ–¹æ¡ˆ

#### 6.2.1 ç³»ç»Ÿé…ç½®è¡¨è®¾è®¡

ä½¿ç”¨ `t_system_config` è¡¨å­˜å‚¨é…ç½®ï¼š

```sql
-- æ ¸å¿ƒé…ç½®
INSERT INTO `t_system_config` (`config_key`, `config_value`, `config_desc`) VALUES
('vip.feature.enabled', 'false', 'ä¼šå‘˜åŠŸèƒ½æ€»å¼€å…³ï¼štrue-å¼€å¯é™åˆ¶ï¼Œfalse-å…¨åŠŸèƒ½å…è´¹'),
('vip.daily.free.match.count', '3', 'å…è´¹ç”¨æˆ·æ¯æ—¥åŒ¹é…æ¬¡æ•°ï¼ˆä»…å¼€å…³å¼€å¯æ—¶ç”Ÿæ•ˆï¼‰'),
('vip.daily.free.super.like.count', '1', 'å…è´¹ç”¨æˆ·æ¯æ—¥è¶…çº§å–œæ¬¢æ¬¡æ•°ï¼ˆä»…å¼€å…³å¼€å¯æ—¶ç”Ÿæ•ˆï¼‰');
```

#### 6.2.2 Service å±‚å°è£…

**åˆ›å»º `SystemConfigService`**:

```java
@Service
public class SystemConfigService {
    
    @Autowired
    private RedisTemplate<String, String> redisTemplate;
    
    private static final String CONFIG_CACHE_KEY = "system:config:";
    private static final long CACHE_EXPIRE = 3600; // 1å°æ—¶
    
    /**
     * è·å–é…ç½®å€¼ï¼ˆå¸¦ç¼“å­˜ï¼‰
     */
    public <T> T getConfigValue(String key, Class<T> clazz, T defaultValue) {
        // 1. ä»Redisç¼“å­˜è¯»å–
        String cached = redisTemplate.opsForValue().get(CONFIG_CACHE_KEY + key);
        if (cached != null) {
            return convertValue(cached, clazz);
        }
        
        // 2. ä»æ•°æ®åº“è¯»å–
        SystemConfig config = systemConfigMapper.selectOne(
            new LambdaQueryWrapper<SystemConfig>()
                .eq(SystemConfig::getConfigKey, key)
        );
        
        if (config == null) {
            return defaultValue;
        }
        
        // 3. å†™å…¥ç¼“å­˜
        redisTemplate.opsForValue().set(
            CONFIG_CACHE_KEY + key, 
            config.getConfigValue(),
            CACHE_EXPIRE,
            TimeUnit.SECONDS
        );
        
        return convertValue(config.getConfigValue(), clazz);
    }
    
    /**
     * æ£€æŸ¥ä¼šå‘˜åŠŸèƒ½æ˜¯å¦å¼€å¯
     */
    public boolean isVipFeatureEnabled() {
        return getConfigValue("vip.feature.enabled", Boolean.class, false);
    }
    
    /**
     * æ›´æ–°é…ç½®ï¼ˆæ¸…é™¤ç¼“å­˜ï¼‰
     */
    public void updateConfig(String key, String value) {
        SystemConfig config = new SystemConfig();
        config.setConfigKey(key);
        config.setConfigValue(value);
        systemConfigMapper.updateById(config);
        
        // æ¸…é™¤ç¼“å­˜
        redisTemplate.delete(CONFIG_CACHE_KEY + key);
    }
}
```

#### 6.2.3 åŒ¹é…é™åˆ¶ç»Ÿä¸€å°è£…

**åœ¨ `MatchingService` ä¸­ä½¿ç”¨**:

```java
@Service
public class MatchingService {
    
    @Autowired
    private SystemConfigService systemConfigService;
    
    @Autowired
    private VipService vipService;
    
    /**
     * æ£€æŸ¥åŒ¹é…æ¬¡æ•°é™åˆ¶
     */
    public boolean checkMatchLimit(Long userId, int matchType) {
        // 1. è¯»å–ä¼šå‘˜åŠŸèƒ½å¼€å…³
        boolean vipEnabled = systemConfigService.isVipFeatureEnabled();
        
        // 2. å¦‚æœå…³é—­ï¼Œå…¨åŠŸèƒ½å…è´¹ï¼Œä¸é™åˆ¶
        if (!vipEnabled) {
            return true;
        }
        
        // 3. å¦‚æœå¼€å¯ï¼Œæ£€æŸ¥VIPçŠ¶æ€
        VipMember vip = vipService.getVipMember(userId);
        if (vip != null && vip.isValid()) {
            return true; // VIPç”¨æˆ·æ— é™åˆ¶
        }
        
        // 4. å…è´¹ç”¨æˆ·æ£€æŸ¥æ¯æ—¥é™åˆ¶
        MatchLimit limit = getTodayLimit(userId);
        if (matchType == 2) { // è¶…çº§å–œæ¬¢
            int maxCount = systemConfigService.getConfigValue(
                "vip.daily.free.super.like.count", Integer.class, 1);
            return limit.getSuperLikeCount() < maxCount;
        } else { // æ™®é€šå–œæ¬¢
            int maxCount = systemConfigService.getConfigValue(
                "vip.daily.free.match.count", Integer.class, 3);
            return limit.getFreeMatchCount() < maxCount;
        }
    }
    
    /**
     * è·å–å‰©ä½™åŒ¹é…æ¬¡æ•°ï¼ˆç”¨äºå‰ç«¯æ˜¾ç¤ºï¼‰
     */
    public MatchLimitInfo getMatchLimitInfo(Long userId) {
        boolean vipEnabled = systemConfigService.isVipFeatureEnabled();
        
        if (!vipEnabled) {
            // åŠŸèƒ½å…³é—­ï¼Œæ˜¾ç¤ºæ— é™
            return MatchLimitInfo.builder()
                .isVipFeatureEnabled(false)
                .dailyMatchRemaining(-1) // -1è¡¨ç¤ºæ— é™
                .dailySuperLikeRemaining(-1)
                .isVip(false)
                .build();
        }
        
        // åŠŸèƒ½å¼€å¯ï¼Œè¿”å›å®é™…å‰©ä½™æ¬¡æ•°
        VipMember vip = vipService.getVipMember(userId);
        if (vip != null && vip.isValid()) {
            return MatchLimitInfo.builder()
                .isVipFeatureEnabled(true)
                .dailyMatchRemaining(-1)
                .dailySuperLikeRemaining(-1)
                .isVip(true)
                .build();
        }
        
        MatchLimit limit = getTodayLimit(userId);
        int maxMatch = systemConfigService.getConfigValue(
            "vip.daily.free.match.count", Integer.class, 3);
        int maxSuperLike = systemConfigService.getConfigValue(
            "vip.daily.free.super.like.count", Integer.class, 1);
        
        return MatchLimitInfo.builder()
            .isVipFeatureEnabled(true)
            .dailyMatchRemaining(maxMatch - limit.getFreeMatchCount())
            .dailySuperLikeRemaining(maxSuperLike - limit.getSuperLikeCount())
            .isVip(false)
            .build();
    }
}
```

#### 6.2.4 å…¶ä»–åŠŸèƒ½ç‚¹çš„å¼€å…³åº”ç”¨

**æŸ¥çœ‹"å–œæ¬¢æˆ‘"åŠŸèƒ½**:

```java
public List<UserDTO> getLikedMeUsers(Long userId) {
    // æ£€æŸ¥ä¼šå‘˜åŠŸèƒ½å¼€å…³
    boolean vipEnabled = systemConfigService.isVipFeatureEnabled();
    
    if (vipEnabled) {
        // å¼€å…³å¼€å¯ï¼Œæ£€æŸ¥VIPæƒé™
        VipMember vip = vipService.getVipMember(userId);
        if (vip == null || !vip.isValid()) {
            throw new BusinessException("éœ€è¦VIPä¼šå‘˜æ‰èƒ½æŸ¥çœ‹å–œæ¬¢æˆ‘çš„äºº");
        }
    }
    
    // åŠŸèƒ½å…³é—­æˆ–VIPç”¨æˆ·ï¼Œè¿”å›æ•°æ®
    return getLikedMeUsersInternal(userId);
}
```

**é«˜çº§ç­›é€‰åŠŸèƒ½**:

```java
public List<UserCardDTO> advancedFilter(Long userId, FilterRequest request) {
    boolean vipEnabled = systemConfigService.isVipFeatureEnabled();
    
    if (vipEnabled) {
        VipMember vip = vipService.getVipMember(userId);
        if (vip == null || !vip.isValid()) {
            throw new BusinessException("é«˜çº§ç­›é€‰åŠŸèƒ½éœ€è¦VIPä¼šå‘˜");
        }
    }
    
    // æ‰§è¡Œé«˜çº§ç­›é€‰
    return performAdvancedFilter(userId, request);
}
```

### 6.3 å¼€å…³åˆ‡æ¢æµç¨‹

#### 6.3.1 å‰æœŸæ¨å¹¿é˜¶æ®µ

```
é…ç½®: vip.feature.enabled = false
ç»“æœ: 
- æ‰€æœ‰ç”¨æˆ·æ— é™åˆ¶åŒ¹é…
- æ— é™åˆ¶æŸ¥çœ‹"å–œæ¬¢æˆ‘"
- æ— é™åˆ¶é«˜çº§ç­›é€‰
- æ— é™åˆ¶è¶…çº§å–œæ¬¢
```

#### 6.3.2 åæœŸè¿è¥é˜¶æ®µ

```
1. åå°ç®¡ç†ç³»ç»Ÿæ›´æ–°é…ç½®: vip.feature.enabled = true
2. ç³»ç»Ÿè‡ªåŠ¨æ¸…é™¤Redisç¼“å­˜
3. ä¸‹æ¬¡è¯·æ±‚è‡ªåŠ¨è¯»å–æ–°é…ç½®
4. åŠŸèƒ½é™åˆ¶ç«‹å³ç”Ÿæ•ˆ
```

**æ³¨æ„äº‹é¡¹**:
- åˆ‡æ¢å‰æå‰é€šçŸ¥ç”¨æˆ·
- è€ƒè™‘è€ç”¨æˆ·è¿‡æ¸¡æ–¹æ¡ˆï¼ˆèµ é€VIPä½“éªŒï¼‰
- ç›‘æ§åˆ‡æ¢åçš„ç”¨æˆ·è¡Œä¸ºæ•°æ®

---

## 7. APIæ¥å£è®¾è®¡

### 7.1 æ¥å£è§„èŒƒ

#### 7.1.1 ç»Ÿä¸€å“åº”æ ¼å¼

```java
public class Result<T> {
    private Integer code;      // 200-æˆåŠŸï¼Œå…¶ä»–-é”™è¯¯ç 
    private String message;     // æç¤ºä¿¡æ¯
    private T data;             // æ•°æ®
    private Long timestamp;    // æ—¶é—´æˆ³
    private String traceId;    // è¿½è¸ªID
}
```

#### 7.1.2 ç»Ÿä¸€é”™è¯¯ç 

| é”™è¯¯ç  | è¯´æ˜ |
|--------|------|
| 200 | æˆåŠŸ |
| 400 | å‚æ•°é”™è¯¯ |
| 401 | æœªç™»å½• |
| 403 | æ— æƒé™ |
| 404 | èµ„æºä¸å­˜åœ¨ |
| 500 | æœåŠ¡å™¨é”™è¯¯ |
| 1001 | ä¸šåŠ¡å¼‚å¸¸ |
| 1002 | åŒ¹é…æ¬¡æ•°ä¸è¶³ |
| 1003 | éœ€è¦VIPæƒé™ |

### 7.2 æ ¸å¿ƒæ¥å£åˆ—è¡¨

#### 7.2.1 ç”¨æˆ·è®¤è¯æ¨¡å—

| æ¥å£ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/api/auth/wx/login` | POST | å¾®ä¿¡ç™»å½• |
| `/api/auth/user/info` | GET | è·å–ç”¨æˆ·ä¿¡æ¯ |
| `/api/auth/token/refresh` | POST | åˆ·æ–°token |

#### 7.2.2 ç”¨æˆ·èµ„æ–™æ¨¡å—

| æ¥å£ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/api/profile/complete` | POST | å®Œå–„èµ„æ–™ |
| `/api/profile/update` | PUT | æ›´æ–°èµ„æ–™ |
| `/api/profile/detail` | GET | è·å–èµ„æ–™è¯¦æƒ… |
| `/api/profile/matching-preference` | POST | è®¾ç½®åŒ¹é…åå¥½ |
| `/api/profile/photos/upload` | POST | ä¸Šä¼ ç…§ç‰‡ |

#### 7.2.3 åŒ¹é…æ¨¡å—

| æ¥å£ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/api/matching/recommend` | GET | è·å–æ¨èç”¨æˆ· |
| `/api/matching/like` | POST | å–œæ¬¢ç”¨æˆ· |
| `/api/matching/super-like` | POST | è¶…çº§å–œæ¬¢ |
| `/api/matching/pass` | POST | è·³è¿‡ç”¨æˆ· |
| `/api/matching/limit-info` | GET | è·å–åŒ¹é…é™åˆ¶ä¿¡æ¯ |
| `/api/matching/liked-me` | GET | æŸ¥çœ‹å–œæ¬¢æˆ‘çš„äººï¼ˆéœ€è¦VIPï¼‰ |

#### 7.2.4 èŠå¤©æ¨¡å—

| æ¥å£ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/api/chat/list` | GET | è·å–èŠå¤©åˆ—è¡¨ |
| `/api/chat/messages` | GET | è·å–èŠå¤©æ¶ˆæ¯ |
| `/api/chat/send` | POST | å‘é€æ¶ˆæ¯ |
| `/api/chat/read` | POST | æ ‡è®°å·²è¯» |

#### 7.2.5 åŠ¨æ€æ¨¡å—

| æ¥å£ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/api/moment/publish` | POST | å‘å¸ƒåŠ¨æ€ |
| `/api/moment/list` | GET | è·å–åŠ¨æ€åˆ—è¡¨ |
| `/api/moment/detail` | GET | è·å–åŠ¨æ€è¯¦æƒ… |
| `/api/moment/like` | POST | ç‚¹èµåŠ¨æ€ |
| `/api/moment/comment` | POST | è¯„è®ºåŠ¨æ€ |

#### 7.2.6 ä¼šå‘˜æ¨¡å—

| æ¥å£ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/api/vip/status` | GET | è·å–VIPçŠ¶æ€ |
| `/api/vip/purchase` | POST | è´­ä¹°VIP |
| `/api/vip/packages` | GET | è·å–å¥—é¤åˆ—è¡¨ |
| `/api/order/create` | POST | åˆ›å»ºè®¢å• |
| `/api/order/pay` | POST | æ”¯ä»˜è®¢å• |

---

## 8. æ€§èƒ½ä¼˜åŒ–ä¸å®‰å…¨

### 8.1 æ€§èƒ½ä¼˜åŒ–

#### 8.1.1 ç¼“å­˜ç­–ç•¥

**Redisç¼“å­˜è®¾è®¡**:
- **ç”¨æˆ·ä¿¡æ¯ç¼“å­˜**: `user:info:{userId}` - TTL: 30åˆ†é’Ÿ
- **åŒ¹é…æ¨èç¼“å­˜**: `matching:recommend:{userId}:{page}` - TTL: 5åˆ†é’Ÿ
- **ç³»ç»Ÿé…ç½®ç¼“å­˜**: `system:config:{key}` - TTL: 1å°æ—¶
- **åŠ¨æ€ç‚¹èµæ•°**: `moment:like:{momentId}` - TTL: 1å°æ—¶ï¼ˆå®šæ—¶åŒæ­¥æ•°æ®åº“ï¼‰

**ç¼“å­˜æ›´æ–°ç­–ç•¥**:
- ç”¨æˆ·ä¿¡æ¯æ›´æ–°ï¼šåˆ é™¤ç¼“å­˜
- åŒ¹é…æ¨èï¼šå®šæ—¶åˆ·æ–°ï¼Œç”¨æˆ·æ“ä½œååˆ·æ–°
- é…ç½®æ›´æ–°ï¼šåˆ é™¤ç¼“å­˜ï¼Œä¸‹æ¬¡è‡ªåŠ¨åŠ è½½

#### 8.1.2 æ•°æ®åº“ä¼˜åŒ–

**ç´¢å¼•è®¾è®¡**:
- åŒ¹é…è®°å½•è¡¨ï¼š`(from_user_id, to_user_id)` å”¯ä¸€ç´¢å¼•
- èŠå¤©æ¶ˆæ¯è¡¨ï¼š`(chat_id, created_at)` è”åˆç´¢å¼•
- åŠ¨æ€è¡¨ï¼š`(user_id, created_at)` è”åˆç´¢å¼•
- åœ°ç†ä½ç½®ç´¢å¼•ï¼š`(latitude, longitude)` ç”¨äºé™„è¿‘æŸ¥è¯¢

**åˆ†åº“åˆ†è¡¨ç­–ç•¥**:
- èŠå¤©æ¶ˆæ¯è¡¨ï¼šæŒ‰ `chat_id` åˆ†è¡¨ï¼ˆå•è¡¨1000ä¸‡æ¡ï¼‰
- åŒ¹é…è®°å½•è¡¨ï¼šæŒ‰ `from_user_id` åˆ†è¡¨
- åŠ¨æ€è¡¨ï¼šæŒ‰ `user_id` åˆ†è¡¨

#### 8.1.3 å¼‚æ­¥å¤„ç†

**ä½¿ç”¨åœºæ™¯**:
- å†…å®¹å®¡æ ¸ï¼šå¼‚æ­¥å®¡æ ¸ï¼Œå®¡æ ¸é€šè¿‡åå‘å¸ƒ
- æ¶ˆæ¯æ¨é€ï¼šå¼‚æ­¥æ¨é€ï¼Œä¸é˜»å¡ä¸»æµç¨‹
- ç»Ÿè®¡è®¡ç®—ï¼šå¼‚æ­¥è®¡ç®—åŒ¹é…åº¦ï¼Œæ‰¹é‡æ›´æ–°

### 8.2 å®‰å…¨è®¾è®¡

#### 8.2.1 æ•°æ®å®‰å…¨

**æ•æ„Ÿæ•°æ®åŠ å¯†**:
- æ‰‹æœºå·ï¼šæ•°æ®åº“å­˜å‚¨åŠ å¯†ï¼Œè¿”å›æ—¶è„±æ•
- èº«ä»½è¯å·ï¼šåŠ å¯†å­˜å‚¨
- æ”¯ä»˜ä¿¡æ¯ï¼šä¸å­˜å‚¨ï¼Œä»…å­˜å‚¨è®¢å•è®°å½•

**SQLæ³¨å…¥é˜²æŠ¤**:
- ä½¿ç”¨ MyBatis-Plusï¼Œå‚æ•°åŒ–æŸ¥è¯¢
- ç¦æ­¢æ‹¼æ¥SQL

**XSSé˜²æŠ¤**:
- ç”¨æˆ·è¾“å…¥å†…å®¹è½¬ä¹‰
- å¯Œæ–‡æœ¬å†…å®¹ç™½åå•è¿‡æ»¤

#### 8.2.2 æ¥å£å®‰å…¨

**è®¤è¯æˆæƒ**:
- JWT Token è®¤è¯
- Token 7å¤©è¿‡æœŸ
- RefreshToken 30å¤©è¿‡æœŸ
- æ•æ„Ÿæ“ä½œéœ€è¦äºŒæ¬¡éªŒè¯

**é™æµç­–ç•¥**:
- æ¥å£çº§åˆ«é™æµï¼ˆNginx + Redisï¼‰
- ç”¨æˆ·çº§åˆ«é™æµï¼ˆé˜²æ­¢æ¶æ„è¯·æ±‚ï¼‰
- IPçº§åˆ«é™æµï¼ˆé˜²æ­¢çˆ¬è™«ï¼‰

**å‚æ•°æ ¡éªŒ**:
- ä½¿ç”¨ `@Valid` æ³¨è§£
- è‡ªå®šä¹‰æ ¡éªŒå™¨
- å‚æ•°èŒƒå›´æ ¡éªŒ

#### 8.2.3 ä¸šåŠ¡å®‰å…¨

**é˜²åˆ·æœºåˆ¶**:
- åŒ¹é…æ“ä½œï¼šæ¯æ—¥é™åˆ¶ + IPé™åˆ¶
- æ¶ˆæ¯å‘é€ï¼šæœªåŒ¹é…ç”¨æˆ·åªèƒ½å‘1æ¡
- åŠ¨æ€å‘å¸ƒï¼šæ¯æ—¥æœ€å¤š3æ¡

**å†…å®¹å®¡æ ¸**:
- AIè‡ªåŠ¨å®¡æ ¸ï¼ˆæ•æ„Ÿè¯ã€å›¾ç‰‡è¯†åˆ«ï¼‰
- äººå·¥å®¡æ ¸ï¼ˆç–‘ä¼¼è¿è§„ï¼‰
- ç”¨æˆ·ä¸¾æŠ¥æœºåˆ¶

---

## 9. éƒ¨ç½²ä¸è¿ç»´

### 9.1 ç¯å¢ƒé…ç½®

#### 9.1.1 å¼€å‘ç¯å¢ƒ
- JDK 1.8
- MySQL 8.0+
- Redis 6.0+
- Maven 3.6+

#### 9.1.2 ç”Ÿäº§ç¯å¢ƒ

**æœåŠ¡å™¨é…ç½®å»ºè®®**:
- åº”ç”¨æœåŠ¡å™¨ï¼š4æ ¸8G Ã— 2å°ï¼ˆè´Ÿè½½å‡è¡¡ï¼‰
- æ•°æ®åº“æœåŠ¡å™¨ï¼š8æ ¸16G Ã— 1å°ï¼ˆä¸»ä»ï¼‰
- RedisæœåŠ¡å™¨ï¼š4æ ¸8G Ã— 1å°ï¼ˆä¸»ä»ï¼‰

**é…ç½®æ–‡ä»¶ç®¡ç†**:
- ä½¿ç”¨ Spring Profileï¼š`dev`, `uat`, `prod`
- æ•æ„Ÿä¿¡æ¯ä½¿ç”¨é…ç½®ä¸­å¿ƒï¼ˆå¦‚ Nacosï¼‰
- æ•°æ®åº“è¿æ¥æ± é…ç½®

### 9.2 ç›‘æ§ä¸æ—¥å¿—

#### 9.2.1 æ—¥å¿—ç®¡ç†

**æ—¥å¿—çº§åˆ«**:
- ERROR: ç³»ç»Ÿé”™è¯¯ã€å¼‚å¸¸
- WARN: è­¦å‘Šä¿¡æ¯
- INFO: å…³é”®ä¸šåŠ¡æ“ä½œ
- DEBUG: å¼€å‘è°ƒè¯•

**æ—¥å¿—å†…å®¹**:
- è¯·æ±‚æ—¥å¿—ï¼šè¯·æ±‚å‚æ•°ã€å“åº”ç»“æœã€è€—æ—¶
- ä¸šåŠ¡æ—¥å¿—ï¼šåŒ¹é…æ“ä½œã€æ”¯ä»˜æ“ä½œã€ç”¨æˆ·è¡Œä¸º
- å¼‚å¸¸æ—¥å¿—ï¼šå¼‚å¸¸å †æ ˆã€ä¸Šä¸‹æ–‡ä¿¡æ¯

**æ—¥å¿—é‡‡é›†**:
- ä½¿ç”¨ ELK æˆ– Loki æ”¶é›†æ—¥å¿—
- å…³é”®æ“ä½œæ—¥å¿—æŒä¹…åŒ–åˆ°æ•°æ®åº“

#### 9.2.2 ç›‘æ§æŒ‡æ ‡

**ä¸šåŠ¡ç›‘æ§**:
- æ¯æ—¥æ–°å¢ç”¨æˆ·æ•°
- åŒ¹é…æˆåŠŸç‡
- æ¶ˆæ¯å‘é€é‡
- åŠ¨æ€å‘å¸ƒé‡
- VIPè½¬åŒ–ç‡

**æŠ€æœ¯ç›‘æ§**:
- æ¥å£å“åº”æ—¶é—´
- æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½
- Rediså‘½ä¸­ç‡
- æœåŠ¡å™¨CPU/å†…å­˜ä½¿ç”¨ç‡
- é”™è¯¯ç‡ç»Ÿè®¡

### 9.3 å®¹ç¾ä¸å¤‡ä»½

#### 9.3.1 æ•°æ®åº“å¤‡ä»½

**å¤‡ä»½ç­–ç•¥**:
- æ¯æ—¥å…¨é‡å¤‡ä»½ï¼ˆå‡Œæ™¨2ç‚¹ï¼‰
- æ¯å°æ—¶å¢é‡å¤‡ä»½
- ä¿ç•™30å¤©å¤‡ä»½æ–‡ä»¶

#### 9.3.2 é«˜å¯ç”¨è®¾è®¡

**åº”ç”¨å±‚**:
- å¤šå®ä¾‹éƒ¨ç½²ï¼ˆ2å°ä»¥ä¸Šï¼‰
- Nginxè´Ÿè½½å‡è¡¡
- å¥åº·æ£€æŸ¥

**æ•°æ®å±‚**:
- MySQLä¸»ä»å¤åˆ¶
- Redisä¸»ä»å¤åˆ¶
- è¯»å†™åˆ†ç¦»

### 9.4 ç‰ˆæœ¬å‘å¸ƒ

#### 9.4.1 å‘å¸ƒæµç¨‹

```
å¼€å‘å®Œæˆ â†’ ä»£ç å®¡æŸ¥ â†’ å•å…ƒæµ‹è¯• â†’ 
é›†æˆæµ‹è¯• â†’ é¢„å‘å¸ƒç¯å¢ƒéªŒè¯ â†’ 
ç”Ÿäº§ç¯å¢ƒå‘å¸ƒ â†’ ç›‘æ§éªŒè¯
```

#### 9.4.2 å›æ»šæœºåˆ¶

**ç°åº¦å‘å¸ƒ**:
- å…ˆå‘å¸ƒ1å°æœåŠ¡å™¨
- éªŒè¯æ— é—®é¢˜åå…¨é‡å‘å¸ƒ
- å¦‚æœ‰é—®é¢˜ç«‹å³å›æ»š

**æ•°æ®åº“å˜æ›´**:
- ä½¿ç”¨ Flyway æˆ– Liquibase ç®¡ç†
- ç‰ˆæœ¬åŒ–è„šæœ¬
- æ”¯æŒå›æ»šè„šæœ¬

---

## 10. å¼€å‘è®¡åˆ’ä¸ä¼˜å…ˆçº§

### 10.1 å¼€å‘é˜¶æ®µè§„åˆ’

#### é˜¶æ®µä¸€ï¼šæ ¸å¿ƒåŠŸèƒ½ï¼ˆMVPï¼‰
1. âœ… å¾®ä¿¡ç™»å½•è®¤è¯ï¼ˆå·²å®Œæˆï¼‰
2. âœ… ç”¨æˆ·èµ„æ–™ç®¡ç†ï¼ˆå·²å®Œæˆï¼‰
3. ğŸ”² åŒ¹é…æ¨èç®—æ³•
4. ğŸ”² åŒ¹é…æ“ä½œï¼ˆå–œæ¬¢/è·³è¿‡/è¶…çº§å–œæ¬¢ï¼‰
5. ğŸ”² åŒ¹é…è®°å½•ç®¡ç†
6. ğŸ”² èŠå¤©åŸºç¡€åŠŸèƒ½ï¼ˆæ–‡æœ¬æ¶ˆæ¯ï¼‰
7. ğŸ”² èŠå¤©ä¼šè¯ç®¡ç†

#### é˜¶æ®µäºŒï¼šå†…å®¹ä¸äº’åŠ¨
1. ğŸ”² åŠ¨æ€å‘å¸ƒåŠŸèƒ½
2. ğŸ”² åŠ¨æ€æµè§ˆä¸ç‚¹èµ
3. ğŸ”² åŠ¨æ€è¯„è®ºåŠŸèƒ½
4. ğŸ”² å›¾ç‰‡ä¸Šä¼ ä¸å­˜å‚¨
5. ğŸ”² å†…å®¹å®¡æ ¸æœºåˆ¶

#### é˜¶æ®µä¸‰ï¼šä¼šå‘˜ä¸å•†ä¸šåŒ–
1. ğŸ”² ä¼šå‘˜åŠŸèƒ½å¼€å…³ï¼ˆå‰æœŸå…³é—­ï¼Œå…¨åŠŸèƒ½å…è´¹ï¼‰
2. ğŸ”² ä¼šå‘˜æƒç›Šç®¡ç†
3. ğŸ”² è®¢å•ä¸æ”¯ä»˜é›†æˆ
4. ğŸ”² VIPç”¨æˆ·æ ‡è¯†ä¸æƒé™

#### é˜¶æ®µå››ï¼šä¼˜åŒ–ä¸æ‰©å±•
1. ğŸ”² æ¨èç®—æ³•ä¼˜åŒ–
2. ğŸ”² æ€§èƒ½ä¼˜åŒ–ï¼ˆç¼“å­˜ã€ç´¢å¼•ï¼‰
3. ğŸ”² æ¶ˆæ¯æ¨é€ï¼ˆWebSocket/ç¬¬ä¸‰æ–¹ï¼‰
4. ğŸ”² çº¿ä¸‹æ´»åŠ¨åŠŸèƒ½
5. ğŸ”² æ­å­å¹³å°åŠŸèƒ½

### 10.2 å¼€å‘ä¼˜å…ˆçº§

**P0ï¼ˆå¿…é¡»ï¼‰**:
- åŒ¹é…æ¨èç®—æ³•
- åŒ¹é…æ“ä½œåŠŸèƒ½
- èŠå¤©åŸºç¡€åŠŸèƒ½
- ä¼šå‘˜åŠŸèƒ½å¼€å…³

**P1ï¼ˆé‡è¦ï¼‰**:
- åŠ¨æ€å‘å¸ƒä¸æµè§ˆ
- å†…å®¹å®¡æ ¸
- è®¢å•æ”¯ä»˜

**P2ï¼ˆä¼˜åŒ–ï¼‰**:
- æ¨èç®—æ³•ä¼˜åŒ–
- æ€§èƒ½ä¼˜åŒ–
- æ‰©å±•åŠŸèƒ½

---

## 11. æŠ€æœ¯éš¾ç‚¹ä¸è§£å†³æ–¹æ¡ˆ

### 11.1 åŒ¹é…ç®—æ³•æ€§èƒ½ä¼˜åŒ–

**é—®é¢˜**: ç”¨æˆ·é‡å¤§æ—¶ï¼ŒåŒ¹é…è®¡ç®—è€—æ—¶é•¿

**è§£å†³æ–¹æ¡ˆ**:
1. **é¢„è®¡ç®—ç­–ç•¥**
   - æ¯æ—¥å‡Œæ™¨é¢„è®¡ç®—æ¯ä¸ªç”¨æˆ·çš„æ¨èåˆ—è¡¨
   - ç»“æœç¼“å­˜åˆ°Redisï¼Œæœ‰æ•ˆæœŸ24å°æ—¶
   - ç”¨æˆ·è¯·æ±‚æ—¶ç›´æ¥è¿”å›ç¼“å­˜ç»“æœ

2. **åˆ†æ­¥åŠ è½½**
   - é¦–æ¬¡è¿”å›å‰20ä¸ªç”¨æˆ·
   - ç”¨æˆ·æ»‘åŠ¨åˆ°åº•éƒ¨æ—¶å†åŠ è½½ä¸‹ä¸€æ‰¹
   - å‡å°‘å•æ¬¡æŸ¥è¯¢å‹åŠ›

3. **ç´¢å¼•ä¼˜åŒ–**
   - åœ°ç†ä½ç½®ç´¢å¼•ï¼ˆçº¬åº¦+ç»åº¦ï¼‰
   - ç”¨æˆ·æ ‡ç­¾ç´¢å¼•
   - åŒ¹é…åå¥½ç´¢å¼•

### 11.2 å®æ—¶æ¶ˆæ¯æ¨é€

**é—®é¢˜**: èŠå¤©æ¶ˆæ¯éœ€è¦å®æ—¶æ¨é€åˆ°å®¢æˆ·ç«¯

**è§£å†³æ–¹æ¡ˆ**:
1. **WebSocketæ–¹æ¡ˆ**
   - æœåŠ¡å™¨ç»´æŠ¤WebSocketè¿æ¥æ± 
   - ç”¨æˆ·ä¸Šçº¿æ—¶å»ºç«‹è¿æ¥
   - æ”¶åˆ°æ¶ˆæ¯æ—¶æ¨é€åˆ°å¯¹åº”ç”¨æˆ·è¿æ¥

2. **ç¬¬ä¸‰æ–¹æ¨é€æ–¹æ¡ˆ**ï¼ˆæ¨èï¼‰
   - ä½¿ç”¨å¾®ä¿¡å°ç¨‹åºæ¶ˆæ¯æ¨é€èƒ½åŠ›
   - ç¦»çº¿æ¶ˆæ¯é€šè¿‡å¾®ä¿¡æœåŠ¡æ¨é€
   - åœ¨çº¿æ¶ˆæ¯é€šè¿‡WebSocketå®æ—¶æ¨é€

### 11.3 å›¾ç‰‡å­˜å‚¨ä¸CDN

**é—®é¢˜**: ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡éœ€è¦å¿«é€ŸåŠ è½½

**è§£å†³æ–¹æ¡ˆ**:
1. **å¯¹è±¡å­˜å‚¨**
   - ä½¿ç”¨OSSï¼ˆé˜¿é‡Œäº‘ï¼‰æˆ–COSï¼ˆè…¾è®¯äº‘ï¼‰
   - è‡ªåŠ¨å‹ç¼©å’Œç¼©ç•¥å›¾ç”Ÿæˆ
   - CDNåŠ é€Ÿè®¿é—®

2. **å›¾ç‰‡å¤„ç†**
   - ä¸Šä¼ æ—¶å‹ç¼©ï¼ˆé™åˆ¶å¤§å°ï¼‰
   - ç”Ÿæˆå¤šç§å°ºå¯¸ç¼©ç•¥å›¾
   - æ°´å°å¤„ç†ï¼ˆé˜²ç›—ç”¨ï¼‰

### 11.4 é«˜å¹¶å‘åŒ¹é…é™åˆ¶æ£€æŸ¥

**é—®é¢˜**: å¤§é‡ç”¨æˆ·åŒæ—¶æ“ä½œæ—¶ï¼ŒåŒ¹é…æ¬¡æ•°æ£€æŸ¥æ€§èƒ½ç“¶é¢ˆ

**è§£å†³æ–¹æ¡ˆ**:
1. **Redisè®¡æ•°**
   - ä½¿ç”¨Redisè®°å½•æ¯æ—¥åŒ¹é…æ¬¡æ•°
   - Keyæ ¼å¼: `match:limit:{userId}:{date}`
   - åŸå­æ“ä½œï¼ˆINCRï¼‰ä¿è¯å¹¶å‘å®‰å…¨

2. **å¼‚æ­¥æ›´æ–°**
   - Redisè®¡æ•°åå¼‚æ­¥åŒæ­¥åˆ°æ•°æ®åº“
   - é™ä½æ•°æ®åº“å‹åŠ›

---

## 12. æ•°æ®ç»Ÿè®¡ä¸åˆ†æ

### 12.1 å…³é”®æŒ‡æ ‡

#### 12.1.1 ç”¨æˆ·æŒ‡æ ‡
- **DAUï¼ˆæ—¥æ´»ï¼‰**: æ¯æ—¥æ´»è·ƒç”¨æˆ·æ•°
- **MAUï¼ˆæœˆæ´»ï¼‰**: æ¯æœˆæ´»è·ƒç”¨æˆ·æ•°
- **æ–°ç”¨æˆ·æ³¨å†Œæ•°**: æ¯æ—¥æ–°å¢ç”¨æˆ·
- **ç”¨æˆ·ç•™å­˜ç‡**: æ¬¡æ—¥ç•™å­˜ã€7æ—¥ç•™å­˜ã€30æ—¥ç•™å­˜

#### 12.1.2 åŒ¹é…æŒ‡æ ‡
- **åŒ¹é…æˆåŠŸç‡**: åŒå‘åŒ¹é…æˆåŠŸæ•° / æ€»åŒ¹é…æ•°
- **å¹³å‡åŒ¹é…æ¬¡æ•°**: ç”¨æˆ·æ¯æ—¥å¹³å‡åŒ¹é…æ¬¡æ•°
- **åŒ¹é…è½¬åŒ–ç‡**: åŒ¹é…æˆåŠŸ â†’ å¼€å§‹èŠå¤©çš„è½¬åŒ–ç‡

#### 12.1.3 å•†ä¸šåŒ–æŒ‡æ ‡
- **VIPè½¬åŒ–ç‡**: VIPç”¨æˆ·æ•° / æ€»ç”¨æˆ·æ•°
- **ARPU**: å¹³å‡æ¯ç”¨æˆ·æ”¶å…¥
- **è®¢å•å®Œæˆç‡**: å·²æ”¯ä»˜è®¢å•æ•° / æ€»è®¢å•æ•°

### 12.2 æ•°æ®åŸ‹ç‚¹

**å…³é”®äº‹ä»¶**:
- ç”¨æˆ·æ³¨å†Œ
- å®Œå–„èµ„æ–™
- åŒ¹é…æ“ä½œï¼ˆå–œæ¬¢/è·³è¿‡/è¶…çº§å–œæ¬¢ï¼‰
- åŒ¹é…æˆåŠŸ
- å‘é€æ¶ˆæ¯
- å‘å¸ƒåŠ¨æ€
- è´­ä¹°VIP

**åŸ‹ç‚¹å­—æ®µ**:
- ç”¨æˆ·ID
- äº‹ä»¶ç±»å‹
- äº‹ä»¶æ—¶é—´
- é™„åŠ å‚æ•°ï¼ˆJSONæ ¼å¼ï¼‰

### 12.3 æ•°æ®åˆ†ææŠ¥è¡¨

**æ—¥æŠ¥**:
- æ–°å¢ç”¨æˆ·æ•°
- æ´»è·ƒç”¨æˆ·æ•°
- åŒ¹é…æˆåŠŸæ•°
- æ¶ˆæ¯å‘é€é‡
- VIPè´­ä¹°æ•°

**å‘¨æŠ¥**:
- ç”¨æˆ·å¢é•¿è¶‹åŠ¿
- åŒ¹é…æˆåŠŸç‡è¶‹åŠ¿
- åŠŸèƒ½ä½¿ç”¨ç‡åˆ†æ
- ç”¨æˆ·æµå¤±åˆ†æ

---

## 13. å®‰å…¨ä¸åˆè§„

### 13.1 æ•°æ®å®‰å…¨

#### 13.1.1 æ•°æ®åŠ å¯†
- **æ•æ„Ÿä¿¡æ¯åŠ å¯†**: æ‰‹æœºå·ã€èº«ä»½è¯å·ç­‰AESåŠ å¯†å­˜å‚¨
- **ä¼ è¾“åŠ å¯†**: å…¨éƒ¨ä½¿ç”¨HTTPS
- **å¯†ç åŠ å¯†**: å¦‚åç»­æ”¯æŒå¯†ç ç™»å½•ï¼Œä½¿ç”¨BCryptåŠ å¯†

#### 13.1.2 æ•°æ®è„±æ•
- æ¥å£è¿”å›æ—¶è„±æ•æ˜¾ç¤ºï¼ˆæ‰‹æœºå·ã€é‚®ç®±ï¼‰
- æ—¥å¿—è®°å½•æ—¶è„±æ•ï¼ˆé¿å…æ•æ„Ÿä¿¡æ¯æ³„éœ²ï¼‰

### 13.2 æ¥å£å®‰å…¨

#### 13.2.1 é˜²åˆ·æœºåˆ¶
- **é™æµ**: æ¥å£è¯·æ±‚é¢‘ç‡é™åˆ¶
  - ç™»å½•æ¥å£: æ¯IP 5æ¬¡/åˆ†é’Ÿ
  - åŒ¹é…æ¥å£: æ¯ç”¨æˆ· 10æ¬¡/åˆ†é’Ÿ
  - æ¶ˆæ¯æ¥å£: æ¯ç”¨æˆ· 30æ¬¡/åˆ†é’Ÿ

#### 13.2.2 å‚æ•°æ ¡éªŒ
- ä½¿ç”¨ `@Valid` è¿›è¡Œå‚æ•°æ ¡éªŒ
- è‡ªå®šä¹‰æ ¡éªŒå™¨ï¼ˆå¦‚æ‰‹æœºå·æ ¼å¼ï¼‰
- SQLæ³¨å…¥é˜²æŠ¤ï¼ˆMyBatis-Plusé¢„ç¼–è¯‘ï¼‰

### 13.3 å†…å®¹å®‰å…¨

#### 13.3.1 æ•æ„Ÿè¯è¿‡æ»¤
- ä½¿ç”¨ç¬¬ä¸‰æ–¹æ•æ„Ÿè¯åº“ï¼ˆå¦‚æ•°ç¾ã€ç½‘æ˜“æ˜“ç›¾ï¼‰
- å›¾ç‰‡å†…å®¹è¯†åˆ«ï¼ˆOCR + å›¾åƒè¯†åˆ«ï¼‰
- è¿è§„å†…å®¹è‡ªåŠ¨æ‹¦æˆª

#### 13.3.2 ç”¨æˆ·ä¸¾æŠ¥
- æ”¯æŒç”¨æˆ·ä¸¾æŠ¥ä¸å½“å†…å®¹
- äººå·¥å®¡æ ¸æœºåˆ¶
- è¿è§„ç”¨æˆ·å°ç¦

### 13.4 éšç§ä¿æŠ¤

#### 13.4.1 éšç§è®¾ç½®
- ä½ç½®ä¿¡æ¯å¯è§æ€§æ§åˆ¶
- ä¸ªäººèµ„æ–™å¯è§æ€§æ§åˆ¶
- åŒ¹é…æ—¶ä¿¡æ¯è„±æ•ï¼ˆæ ¹æ®éšç§è®¾ç½®ï¼‰

#### 13.4.2 æ•°æ®åˆè§„
- éµå¾ªã€Šä¸ªäººä¿¡æ¯ä¿æŠ¤æ³•ã€‹
- ç”¨æˆ·æ•°æ®åˆ é™¤æƒ
- æ•°æ®ä½¿ç”¨å‘ŠçŸ¥

---

## 14. æµ‹è¯•ç­–ç•¥

### 14.1 å•å…ƒæµ‹è¯•

**è¦†ç›–ç‡ç›®æ ‡**: æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ > 80%

**æµ‹è¯•é‡ç‚¹**:
- Serviceå±‚ä¸šåŠ¡é€»è¾‘
- å·¥å…·ç±»æ–¹æ³•
- åŒ¹é…ç®—æ³•è®¡ç®—

### 14.2 é›†æˆæµ‹è¯•

**æµ‹è¯•åœºæ™¯**:
- å®Œæ•´åŒ¹é…æµç¨‹
- èŠå¤©æ¶ˆæ¯å‘é€ä¸æ¥æ”¶
- æ”¯ä»˜æµç¨‹

### 14.3 å‹åŠ›æµ‹è¯•

**æµ‹è¯•æŒ‡æ ‡**:
- å¹¶å‘ç”¨æˆ·æ•°: 1000+
- æ¥å£å“åº”æ—¶é—´: < 200ms (95åˆ†ä½)
- æ•°æ®åº“è¿æ¥æ± : æ— æ³„æ¼
- å†…å­˜ä½¿ç”¨: æ— æ³„æ¼

### 14.4 å®‰å…¨æµ‹è¯•

**æµ‹è¯•å†…å®¹**:
- SQLæ³¨å…¥æµ‹è¯•
- XSSæ”»å‡»æµ‹è¯•
- CSRFé˜²æŠ¤æµ‹è¯•
- æ¥å£æƒé™æµ‹è¯•

---

## 15. é™„å½•

### 15.1 æ•°æ®åº“ç´¢å¼•å»ºè®®

```sql
-- åŒ¹é…æ¨èç›¸å…³ç´¢å¼•
CREATE INDEX idx_user_location ON t_user_profile(latitude, longitude);
CREATE INDEX idx_match_preference ON t_matching_preference(user_id);
CREATE INDEX idx_match_record_users ON t_match_record(from_user_id, to_user_id);

-- èŠå¤©ç›¸å…³ç´¢å¼•
CREATE INDEX idx_chat_session_users ON t_chat_session(user1_id, user2_id);
CREATE INDEX idx_chat_message_time ON t_chat_message(chat_id, created_at);

-- åŠ¨æ€ç›¸å…³ç´¢å¼•
CREATE INDEX idx_moment_time ON t_moment(created_at);
CREATE INDEX idx_moment_location ON t_moment(latitude, longitude);
```

### 15.2 Redis Keyè§„èŒƒ

```
ç”¨æˆ·ä¿¡æ¯: user:info:{userId}
åŒ¹é…é™åˆ¶: match:limit:{userId}:{date}
èŠå¤©ä¼šè¯: chat:session:{chatId}
åŠ¨æ€ç¼“å­˜: moment:detail:{momentId}
ç³»ç»Ÿé…ç½®: config:{configKey}
```

### 15.3 é”™è¯¯ç å®šä¹‰

| é”™è¯¯ç  | è¯´æ˜ |
|--------|------|
| 1001 | å‚æ•°é”™è¯¯ |
| 1002 | æœªç™»å½• |
| 1003 | æ— æƒé™ |
| 2001 | åŒ¹é…æ¬¡æ•°ä¸è¶³ |
| 2002 | å¯¹æ–¹æœªå›å¤ï¼Œæ— æ³•å‘é€æ¶ˆæ¯ |
| 3001 | è®¢å•ä¸å­˜åœ¨ |
| 3002 | è®¢å•å·²æ”¯ä»˜ |
| 4001 | å†…å®¹è¿è§„ï¼Œå®¡æ ¸ä¸é€šè¿‡ |

### 15.4 å¸¸ç”¨å·¥å…·ç±»

**JwtUtil**: JWTç”Ÿæˆä¸è§£æ
**RedisUtil**: Redisæ“ä½œå°è£…
**WxUtil**: å¾®ä¿¡APIè°ƒç”¨
**DistanceUtil**: åœ°ç†ä½ç½®è·ç¦»è®¡ç®—
**MatchScoreUtil**: åŒ¹é…åº¦è®¡ç®—
**DesensitizationUtil**: æ•°æ®è„±æ•

---

## 16. æ€»ç»“

æœ¬æ–‡æ¡£è¯¦ç»†æè¿°äº†"ç¢°ç¢°"äº¤å‹ç¤¾äº¤åº”ç”¨çš„ç³»ç»Ÿè®¾è®¡ï¼ŒåŒ…æ‹¬ï¼š

1. **æ¶æ„è®¾è®¡**: åˆ†å±‚æ¶æ„ã€æŠ€æœ¯é€‰å‹
2. **æ•°æ®åº“è®¾è®¡**: æ ¸å¿ƒè¡¨ç»“æ„ã€ç´¢å¼•è®¾è®¡
3. **ä¸šåŠ¡æ¨¡å—**: è®¤è¯ã€åŒ¹é…ã€èŠå¤©ã€åŠ¨æ€ã€ä¼šå‘˜ç­‰
4. **ä¼šå‘˜åŠŸèƒ½å¼€å…³**: æ”¯æŒå‰æœŸå…¨åŠŸèƒ½å…è´¹ï¼ŒåæœŸå¼€å¯ä¼šå‘˜
5. **APIè®¾è®¡**: æ¥å£è§„èŒƒã€å‚æ•°å®šä¹‰
6. **æ€§èƒ½ä¼˜åŒ–**: ç¼“å­˜ç­–ç•¥ã€æŸ¥è¯¢ä¼˜åŒ–
7. **å®‰å…¨ä¸åˆè§„**: æ•°æ®å®‰å…¨ã€æ¥å£å®‰å…¨ã€å†…å®¹å®‰å…¨
8. **éƒ¨ç½²è¿ç»´**: éƒ¨ç½²æ–¹æ¡ˆã€ç›‘æ§å‘Šè­¦

### å…³é”®è®¾è®¡äº®ç‚¹

1. **ä¼šå‘˜åŠŸèƒ½å¼€å…³**: é€šè¿‡ `t_system_config` è¡¨æ§åˆ¶ä¼šå‘˜åŠŸèƒ½å¼€å¯/å…³é—­ï¼Œå‰æœŸå…¨åŠŸèƒ½å…è´¹ä½“éªŒï¼Œä¾¿äºæ¨å¹¿
2. **åŒ¹é…ç®—æ³•**: å¤šç»´åº¦æƒé‡åŒ¹é…ï¼Œæ”¯æŒåŠ¨æ€è°ƒæ•´
3. **é˜²éªšæ‰°æœºåˆ¶**: æœªåŒ¹é…ç”¨æˆ·é™åˆ¶æ¶ˆæ¯å‘é€ï¼Œæå‡ç”¨æˆ·ä½“éªŒ
4. **ç¼“å­˜ç­–ç•¥**: Redisç¼“å­˜çƒ­ç‚¹æ•°æ®ï¼Œæå‡æ€§èƒ½
5. **å®‰å…¨æœºåˆ¶**: å¤šå±‚æ¬¡å®‰å…¨é˜²æŠ¤ï¼Œä¿éšœæ•°æ®å®‰å…¨

### ä¸‹ä¸€æ­¥å·¥ä½œ

1. æ ¹æ®æœ¬æ–‡æ¡£è¿›è¡Œè¯¦ç»†è®¾è®¡è¯„å®¡
2. å®Œå–„æ•°æ®åº“è¡¨ç»“æ„è„šæœ¬
3. ç¼–å†™è¯¦ç»†æ¥å£æ–‡æ¡£ï¼ˆSwaggerï¼‰
4. åˆ¶å®šå¼€å‘æ’æœŸè®¡åˆ’
5. æ­å»ºå¼€å‘ç¯å¢ƒ

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2024-01-XX  
**ç»´æŠ¤è€…**: å¼€å‘å›¢é˜Ÿ

---

> **æ³¨æ„**: 
> - æœ¬æ–‡æ¡£ä¸ºç³»ç»Ÿè®¾è®¡é˜¶æ®µæ–‡æ¡£ï¼Œå…·ä½“å®ç°ç»†èŠ‚éœ€åœ¨ç¼–ç é˜¶æ®µç»†åŒ–
> - ä¼šå‘˜åŠŸèƒ½å¼€å…³é»˜è®¤å…³é—­ï¼ˆ`vip.feature.enabled=false`ï¼‰ï¼Œå‰æœŸå…¨åŠŸèƒ½å…è´¹
> - æ‰€æœ‰æ¶‰åŠç”¨æˆ·éšç§çš„æ“ä½œéœ€éµå¾ªç›¸å…³æ³•å¾‹æ³•è§„