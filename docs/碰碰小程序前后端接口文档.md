# ç¢°ç¢°å°ç¨‹åºå‰åç«¯æ¥å£æ–‡æ¡£

## æ–‡æ¡£ä¿¡æ¯
- **ç”Ÿæˆæ—¶é—´**ï¼š2025-11-02 21:30
- **æ›´æ–°æ—¶é—´**ï¼š2025-11-07ï¼ˆæ–°å¢åŠ¨æ€å¹¿åœºã€ä¼šå‘˜ç³»ç»Ÿã€æ”¯ä»˜æ¨¡å—ï¼‰
- **æ¥å£æ•°é‡**ï¼š50ä¸ª
- **ä½œè€…**ï¼š[tang]
- **Base URL**ï¼š`http://localhost:8080`
- **è®¤è¯æ–¹å¼**ï¼šBearer Tokenï¼ˆJWTï¼‰
- **âš ï¸ é‡è¦**ï¼šå›¾ç‰‡ä¸Šä¼ é‡‡ç”¨ä¸¤æ­¥æœºåˆ¶ï¼Œè¯¦è§ [å›¾ç‰‡ä¸Šä¼ å®Œæ•´æµç¨‹è¯´æ˜](#-å›¾ç‰‡ä¸Šä¼ å®Œæ•´æµç¨‹è¯´æ˜)

---

## ğŸ“‘ æ¥å£ç›®å½•

### ç”¨æˆ·è®¤è¯æ¨¡å—ï¼ˆ3ä¸ªï¼‰
- [1. å¾®ä¿¡ç™»å½•](#1-å¾®ä¿¡ç™»å½•)
- [2. ç”Ÿæˆæµ‹è¯•Tokenï¼ˆä»…å¼€å‘ç¯å¢ƒï¼‰](#2-ç”Ÿæˆæµ‹è¯•tokenä»…å¼€å‘ç¯å¢ƒ)
- [3. æ ¡éªŒToken](#3-æ ¡éªŒtoken)

### ç”¨æˆ·èµ„æ–™æ¨¡å—ï¼ˆ7ä¸ªï¼‰
- [4. å®Œå–„èµ„æ–™](#4-å®Œå–„èµ„æ–™)
- [5. æ›´æ–°èµ„æ–™](#5-æ›´æ–°èµ„æ–™)
- [6. æŸ¥çœ‹æˆ‘çš„èµ„æ–™](#6-æŸ¥çœ‹æˆ‘çš„èµ„æ–™)
- [7. æŸ¥çœ‹ä»–äººèµ„æ–™](#7-æŸ¥çœ‹ä»–äººèµ„æ–™)
- [8. æŸ¥çœ‹èµ„æ–™å®Œå–„çŠ¶æ€](#8-æŸ¥çœ‹èµ„æ–™å®Œå–„çŠ¶æ€)
- [9. è·å–ç”¨æˆ·ç»Ÿè®¡æ•°æ®](#9-è·å–ç”¨æˆ·ç»Ÿè®¡æ•°æ®)
- [10. æäº¤å®åè®¤è¯](#10-æäº¤å®åè®¤è¯)
- [11. æŸ¥è¯¢å®åè®¤è¯çŠ¶æ€](#11-æŸ¥è¯¢å®åè®¤è¯çŠ¶æ€)

### å›¾ç‰‡ç®¡ç†æ¨¡å—ï¼ˆ5ä¸ªï¼‰
- [12. ä¿å­˜å›¾ç‰‡åˆ°ä¸šåŠ¡æ¨¡å—](#12-ä¿å­˜å›¾ç‰‡åˆ°ä¸šåŠ¡æ¨¡å—)
- [13. è·å–å›¾ç‰‡åˆ—è¡¨](#13-è·å–å›¾ç‰‡åˆ—è¡¨)
- [14. åˆ é™¤å›¾ç‰‡](#14-åˆ é™¤å›¾ç‰‡)
- [15. è®¾ç½®ä¸»å›¾ç‰‡](#15-è®¾ç½®ä¸»å›¾ç‰‡)
- [16. æ›´æ–°å›¾ç‰‡](#16-æ›´æ–°å›¾ç‰‡)

### æ ‡ç­¾ä¸éšç§æ¨¡å—ï¼ˆ6ä¸ªï¼‰
- [17. è·å–æ ‡ç­¾åº“](#17-è·å–æ ‡ç­¾åº“)
- [18. è®¾ç½®æˆ‘çš„æ ‡ç­¾](#18-è®¾ç½®æˆ‘çš„æ ‡ç­¾)
- [19. æ›´æ–°éšç§è®¾ç½®](#19-æ›´æ–°éšç§è®¾ç½®)
- [20. è·å–éšç§è®¾ç½®](#20-è·å–éšç§è®¾ç½®)
- [21. æ‹‰é»‘ç”¨æˆ·](#21-æ‹‰é»‘ç”¨æˆ·)
- [22. ç§»é™¤é»‘åå•](#22-ç§»é™¤é»‘åå•)

### æ™ºèƒ½åŒ¹é…æ¨¡å—ï¼ˆ8ä¸ªï¼‰
- [23. è®¾ç½®åŒ¹é…åå¥½](#23-è®¾ç½®åŒ¹é…åå¥½)
- [24. è·å–åŒ¹é…åå¥½](#24-è·å–åŒ¹é…åå¥½)
- [25. è·å–æ¨èç”¨æˆ·åˆ—è¡¨](#25-è·å–æ¨èç”¨æˆ·åˆ—è¡¨)
- [26. å–œæ¬¢æ“ä½œ](#26-å–œæ¬¢æ“ä½œ)
- [27. è¶…çº§å–œæ¬¢æ“ä½œ](#27-è¶…çº§å–œæ¬¢æ“ä½œ)
- [28. è·³è¿‡æ“ä½œ](#28-è·³è¿‡æ“ä½œ)
- [29. æŸ¥çœ‹è°å–œæ¬¢æˆ‘](#29-æŸ¥çœ‹è°å–œæ¬¢æˆ‘)
- [30. è·å–åŒ¹é…é™åˆ¶ä¿¡æ¯](#30-è·å–åŒ¹é…é™åˆ¶ä¿¡æ¯)

### OSSå­˜å‚¨æ¨¡å—ï¼ˆ5ä¸ªï¼‰
- [31. ä¸Šä¼ å›¾ç‰‡ï¼ˆæ–‡ä»¶æ–¹å¼ï¼‰](#31-ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶æ–¹å¼)
- [32. ä¸Šä¼ å›¾ç‰‡ï¼ˆBase64æ–¹å¼ï¼‰](#32-ä¸Šä¼ å›¾ç‰‡base64æ–¹å¼)
- [33. æ‰¹é‡ä¸Šä¼ å›¾ç‰‡](#33-æ‰¹é‡ä¸Šä¼ å›¾ç‰‡)
- [34. åˆ é™¤OSSå›¾ç‰‡](#34-åˆ é™¤osså›¾ç‰‡)
- [35. è·å–å›¾ç‰‡ç­¾åURL](#35-è·å–å›¾ç‰‡ç­¾åurl)

### åŠ¨æ€å¹¿åœºæ¨¡å—ï¼ˆ9ä¸ªï¼‰
- [36. å‘å¸ƒåŠ¨æ€](#36-å‘å¸ƒåŠ¨æ€)
- [37. è·å–åŠ¨æ€åˆ—è¡¨](#37-è·å–åŠ¨æ€åˆ—è¡¨)
- [38. è·å–åŠ¨æ€è¯¦æƒ…](#38-è·å–åŠ¨æ€è¯¦æƒ…)
- [39. ç‚¹èµåŠ¨æ€](#39-ç‚¹èµåŠ¨æ€)
- [40. å–æ¶ˆç‚¹èµ](#40-å–æ¶ˆç‚¹èµ)
- [41. åˆ é™¤åŠ¨æ€](#41-åˆ é™¤åŠ¨æ€)
- [42. æŠ¥åæ´»åŠ¨](#42-æŠ¥åæ´»åŠ¨)
- [43. å–æ¶ˆæŠ¥å](#43-å–æ¶ˆæŠ¥å)
- [44. æ£€æŸ¥å‘å¸ƒé™åˆ¶](#44-æ£€æŸ¥å‘å¸ƒé™åˆ¶)

### VIPä¼šå‘˜æ¨¡å—ï¼ˆ3ä¸ªï¼‰
- [45. è·å–VIPä¿¡æ¯](#45-è·å–vipä¿¡æ¯)
- [46. æ£€æŸ¥VIPçŠ¶æ€](#46-æ£€æŸ¥vipçŠ¶æ€)
- [47. æ£€æŸ¥VIPåŠŸèƒ½æƒé™](#47-æ£€æŸ¥vipåŠŸèƒ½æƒé™)

### æ”¯ä»˜æ¨¡å—ï¼ˆ3ä¸ªï¼‰
- [48. åˆ›å»ºè®¢å•](#48-åˆ›å»ºè®¢å•)
- [49. æŸ¥è¯¢è®¢å•](#49-æŸ¥è¯¢è®¢å•)
- [50. å–æ¶ˆè®¢å•](#50-å–æ¶ˆè®¢å•)

---

## ğŸ“Š æ¨¡å—ç»Ÿè®¡

| æ¨¡å— | æ¥å£æ•°é‡ |
|------|---------|
| ç”¨æˆ·è®¤è¯ | 3ä¸ª |
| ç”¨æˆ·èµ„æ–™ | 7ä¸ª |
| å›¾ç‰‡ç®¡ç† | 5ä¸ª |
| æ ‡ç­¾ä¸éšç§ | 6ä¸ª |
| æ™ºèƒ½åŒ¹é… | 8ä¸ª |
| OSSå­˜å‚¨ | 5ä¸ª |
| åŠ¨æ€å¹¿åœº | 9ä¸ª |
| VIPä¼šå‘˜ | 3ä¸ª |
| æ”¯ä»˜æ¨¡å— | 3ä¸ª |
| **æ€»è®¡** | **50ä¸ª** |

## âš ï¸ é‡è¦å˜æ›´è¯´æ˜

### BUGä¿®å¤ï¼šèµ„æ–™å®Œå–„çŠ¶æ€æ£€æŸ¥é—®é¢˜ï¼ˆ2025-11-05ï¼‰

**é—®é¢˜æè¿°**ï¼š
- ç”¨æˆ·è®¾ç½®äº†æ˜µç§°ã€å¤´åƒã€æ€§åˆ«ã€ç”Ÿæ—¥ã€å¹´é¾„ã€å…´è¶£æ ‡ç­¾ç­‰æ‰€æœ‰å¿…å¡«ä¿¡æ¯åï¼Œ`profileComplete` ä»ç„¶æ˜¾ç¤ºä¸º 0
- è°ƒç”¨ `/api/user/profile/status` æ¥å£æ˜¾ç¤ºç¼ºå°‘"å…´è¶£æ ‡ç­¾"å­—æ®µ

**é—®é¢˜åŸå› **ï¼š
- `checkProfileStatus` æ–¹æ³•åœ¨æŸ¥è¯¢ç”¨æˆ·æ ‡ç­¾æ—¶ï¼Œä½¿ç”¨äº†æ•°æ®åº“è‡ªå¢IDï¼ˆLongç±»å‹ï¼‰
- è€Œä¿å­˜æ ‡ç­¾æ—¶ä½¿ç”¨çš„æ˜¯ä¸šåŠ¡ç”¨æˆ·IDï¼ˆStringç±»å‹ï¼‰
- å¯¼è‡´æŸ¥è¯¢ä¸åˆ°å·²è®¾ç½®çš„æ ‡ç­¾æ•°æ®ï¼Œè¯¯åˆ¤ä¸ºæœªè®¾ç½®æ ‡ç­¾

**ä¿®å¤å†…å®¹**ï¼š
1. ä¿®æ”¹ `checkProfileStatus` æ–¹æ³•ï¼Œç»Ÿä¸€ä½¿ç”¨ä¸šåŠ¡ç”¨æˆ·IDï¼ˆStringç±»å‹ï¼‰æŸ¥è¯¢æ ‡ç­¾
2. ä¿®æ”¹ `getUserTags` æ–¹æ³•å‚æ•°ç±»å‹ä» `Long` æ”¹ä¸º `String`
3. ä¿®æ”¹ `getProfile` æ–¹æ³•ä¸­è°ƒç”¨ `getUserTags` æ—¶ä¼ å…¥ä¸šåŠ¡ç”¨æˆ·ID

**å½±å“èŒƒå›´**ï¼š
- å·²è®¾ç½®æ ‡ç­¾çš„ç”¨æˆ·ï¼Œä¿®å¤å `profileComplete` å°†æ­£ç¡®æ˜¾ç¤ºä¸º 1
- èµ„æ–™å®Œå–„åº¦è®¡ç®—æ›´åŠ å‡†ç¡®

**å‰ç«¯é€‚é…**ï¼š
- æ— éœ€ä¿®æ”¹ï¼Œæ¥å£è¿”å›æ ¼å¼æœªå˜åŒ–

### userId å­—æ®µç±»å‹å˜æ›´ï¼ˆ2025-11-04ï¼‰

**å˜æ›´å†…å®¹**ï¼š
- æ‰€æœ‰æ¥å£è¿”å›çš„ `userId` å­—æ®µç±»å‹ä» `Long`ï¼ˆæ•°å­—ï¼‰ å˜æ›´ä¸º `String`ï¼ˆå­—ç¬¦ä¸²ï¼‰
- `userId` ç°åœ¨ä¸ºä¸šåŠ¡ç”¨æˆ·IDï¼Œæ ¼å¼ä¸ºï¼š`U` + 13ä½æ—¶é—´æˆ³ + 6ä½éšæœºå­—ç¬¦ï¼ˆå…±20ä½ï¼‰
- ç¤ºä¾‹ï¼š`U1699123456789AB12CD`

**å½±å“èŒƒå›´**ï¼š
1. **å¾®ä¿¡ç™»å½•æ¥å£**ï¼šè¿”å›çš„ `userId` ä¸º String ç±»å‹
2. **è·å–ç”¨æˆ·ä¿¡æ¯æ¥å£**ï¼šè¿”å›çš„ `userId` ä¸º String ç±»å‹
3. **ç”¨æˆ·èµ„æ–™æ¥å£**ï¼šè¿”å›çš„ `userId` ä¸º String ç±»å‹
4. **æŸ¥çœ‹ä»–äººèµ„æ–™æ¥å£**ï¼šè·¯å¾„å‚æ•° `userId` éœ€ä¼  String ç±»å‹çš„ä¸šåŠ¡ç”¨æˆ·ID
5. **åŒ¹é…åå¥½æ¥å£**ï¼šè¿”å›çš„ `userId` ä¸º String ç±»å‹

**å‰ç«¯é€‚é…è¦ç‚¹**ï¼š
```typescript
// ä¿®æ”¹å‰
interface User {
  userId: number;  // Longç±»å‹
}

// ä¿®æ”¹å
interface User {
  userId: string;  // Stringç±»å‹ï¼Œä¸šåŠ¡ç”¨æˆ·ID
}
```

**å†…éƒ¨å®ç°**ï¼š
- JWT Token å†…éƒ¨ä»ä½¿ç”¨æ•°æ®åº“è‡ªå¢IDï¼ˆLongç±»å‹ï¼‰è¿›è¡Œè®¤è¯
- å¯¹å¤–æ¥å£ç»Ÿä¸€è¿”å›ä¸šåŠ¡ç”¨æˆ·IDï¼ˆStringç±»å‹ï¼‰
- æ•°æ®åº“ä¸­åŒæ—¶å­˜å‚¨æ•°æ®åº“IDï¼ˆ`id`å­—æ®µï¼‰å’Œä¸šåŠ¡ç”¨æˆ·IDï¼ˆ`user_id`å­—æ®µï¼‰

---

## ğŸ“¸ å›¾ç‰‡ä¸Šä¼ å®Œæ•´æµç¨‹è¯´æ˜

### æ ¸å¿ƒæ¦‚å¿µ

æœ¬ç³»ç»Ÿé‡‡ç”¨**ä¸¤æ­¥ä¸Šä¼ **æœºåˆ¶ï¼š

```
æ­¥éª¤1ï¼šOSSä¸Šä¼  â†’ è·å¾—å›¾ç‰‡URL
æ­¥éª¤2ï¼šä¸šåŠ¡ä¿å­˜ â†’ å…³è”åˆ°å…·ä½“ä¸šåŠ¡ï¼ˆå¤´åƒã€ç›¸å†Œã€åŠ¨æ€ç­‰ï¼‰
```

### ä¸ºä»€ä¹ˆè¦ä¸¤æ­¥ï¼Ÿ

1. **è§£è€¦å­˜å‚¨å’Œä¸šåŠ¡**ï¼šOSSè´Ÿè´£å­˜å‚¨ï¼Œä¸šåŠ¡ç³»ç»Ÿè´Ÿè´£é€»è¾‘
2. **çµæ´»æ€§**ï¼šä¸Šä¼ åå¯ä»¥é€‰æ‹©ä¸ä¿å­˜ï¼ˆé¢„è§ˆã€ç¼–è¾‘ç­‰åœºæ™¯ï¼‰
3. **å¤ç”¨æ€§**ï¼šä¸€å¼ å›¾ç‰‡å¯ä»¥ç”¨äºå¤šä¸ªåœ°æ–¹
4. **æ€§èƒ½ä¼˜åŒ–**ï¼šOSSç›´ä¼ ï¼Œä¸å ç”¨ä¸šåŠ¡æœåŠ¡å™¨å¸¦å®½

---

### å®Œæ•´è°ƒç”¨æµç¨‹

#### åœºæ™¯1ï¼šç”¨æˆ·ä¸Šä¼ å¤´åƒ

```javascript
// æ­¥éª¤1ï¼šä¸Šä¼ å›¾ç‰‡åˆ°OSS
const formData = new FormData();
formData.append('file', avatarFile);
formData.append('category', 'avatar');

const ossResponse = await fetch('/api/oss/upload', {
  method: 'POST',
  headers: { 'Authorization': `Bearer ${token}` },
  body: formData
});

const { data } = await ossResponse.json();
const imageUrl = data.imageUrl;
// å¾—åˆ°ï¼šhttps://your-bucket.oss-cn-hangzhou.aliyuncs.com/uploads/avatar/U123.../avatar.jpg

// æ­¥éª¤2ï¼šä¿å­˜åˆ°ä¸šåŠ¡ç³»ç»Ÿï¼ˆå¤´åƒä¼šè‡ªåŠ¨æ›¿æ¢ï¼‰
const saveResponse = await fetch('/api/media/save', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${token}`,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    imageUrl: imageUrl,      // æ­¥éª¤1è·å¾—çš„URL
    mediaType: 'avatar',     // å›¾ç‰‡ç±»å‹
    isPrimary: true          // è®¾ä¸ºä¸»å›¾ç‰‡
  })
});

// å®Œæˆï¼å¤´åƒå·²æ›´æ–°
```

#### åœºæ™¯2ï¼šç”¨æˆ·ä¸Šä¼ ç›¸å†Œç…§ç‰‡ï¼ˆæ‰¹é‡ï¼‰

```javascript
// æ­¥éª¤1ï¼šæ‰¹é‡ä¸Šä¼ åˆ°OSS
const files = [photo1, photo2, photo3]; // ç”¨æˆ·é€‰æ‹©çš„3å¼ ç…§ç‰‡
const formData = new FormData();
files.forEach(file => formData.append('files', file));
formData.append('category', 'album');

const ossResponse = await fetch('/api/oss/upload/batch', {
  method: 'POST',
  headers: { 'Authorization': `Bearer ${token}` },
  body: formData
});

const { data } = await ossResponse.json();
const urls = data.urls;
// å¾—åˆ°ï¼š["url1", "url2", "url3"]

// æ­¥éª¤2ï¼šé€ä¸ªä¿å­˜åˆ°ä¸šåŠ¡ç³»ç»Ÿ
for (const url of urls) {
  await fetch('/api/media/save', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${token}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      imageUrl: url,
      mediaType: 'album',
      isPrimary: false  // ç›¸å†Œç…§ç‰‡ä¸è®¾ä¸»å›¾
    })
  });
}

// å®Œæˆï¼ç›¸å†Œå·²æ·»åŠ 3å¼ æ–°ç…§ç‰‡
```

#### åœºæ™¯3ï¼šç¼–è¾‘ç›¸å†Œç…§ç‰‡ï¼ˆæ›¿æ¢ï¼‰

```javascript
// åœºæ™¯ï¼šç”¨æˆ·æƒ³æ›¿æ¢ç›¸å†Œä¸­çš„ç¬¬2å¼ ç…§ç‰‡

// æ­¥éª¤1ï¼šè·å–å½“å‰ç›¸å†Œåˆ—è¡¨ï¼Œæ‰¾åˆ°è¦æ›¿æ¢çš„ç…§ç‰‡ID
const listResponse = await fetch('/api/media/list?mediaType=album', {
  headers: { 'Authorization': `Bearer ${token}` }
});
const { data } = await listResponse.json();
const photoToReplace = data[1]; // ç¬¬2å¼ ç…§ç‰‡
const mediaId = photoToReplace.id; // ä¾‹å¦‚ï¼š12345

// æ­¥éª¤2ï¼šä¸Šä¼ æ–°å›¾ç‰‡åˆ°OSS
const formData = new FormData();
formData.append('file', newPhotoFile);
formData.append('category', 'album');

const ossResponse = await fetch('/api/oss/upload', {
  method: 'POST',
  headers: { 'Authorization': `Bearer ${token}` },
  body: formData
});

const { data: ossData } = await ossResponse.json();
const imageUrl = ossData.imageUrl;

// æ­¥éª¤3ï¼šæ›´æ–°ä¸šåŠ¡ç³»ç»Ÿä¸­çš„ç…§ç‰‡
await fetch(`/api/media/${mediaId}/update`, {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${token}`,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    imageUrl: imageUrl  // æ–°çš„URL
  })
});

// å®Œæˆï¼ç›¸å†Œç¬¬2å¼ ç…§ç‰‡å·²æ›¿æ¢
```

---

### æ¥å£å¯¹åº”å…³ç³»

| æ­¥éª¤ | æ¥å£ç±»å‹ | æ¥å£è·¯å¾„ | è¯´æ˜ |
|------|---------|---------|------|
| 1ï¸âƒ£ OSSä¸Šä¼  | POST | `/api/oss/upload` | ä¸Šä¼ å•å¼ å›¾ç‰‡åˆ°OSS |
| 1ï¸âƒ£ OSSä¸Šä¼  | POST | `/api/oss/upload/base64` | Base64æ–¹å¼ä¸Šä¼ åˆ°OSS |
| 1ï¸âƒ£ OSSä¸Šä¼  | POST | `/api/oss/upload/batch` | æ‰¹é‡ä¸Šä¼ åˆ°OSS |
| 2ï¸âƒ£ ä¸šåŠ¡ä¿å­˜ | POST | `/api/media/save` | ä¿å­˜å›¾ç‰‡åˆ°ä¸šåŠ¡ï¼ˆæ–°å¢/æ›¿æ¢ï¼‰ |
| 2ï¸âƒ£ ä¸šåŠ¡æ›´æ–° | POST | `/api/media/{id}/update` | æ›´æ–°å·²æœ‰å›¾ç‰‡ |
| 2ï¸âƒ£ ä¸šåŠ¡åˆ é™¤ | DELETE | `/api/media/{id}` | åˆ é™¤å›¾ç‰‡ |
| 2ï¸âƒ£ ä¸šåŠ¡æŸ¥è¯¢ | GET | `/api/media/list` | è·å–å›¾ç‰‡åˆ—è¡¨ |

---

### å¸¸è§é—®é¢˜ FAQ

**Q1ï¼šèƒ½ä¸èƒ½ç›´æ¥ä¸Šä¼ åˆ°ä¸šåŠ¡ç³»ç»Ÿï¼Œä¸ç”¨OSSï¼Ÿ**  
Aï¼šä¸å¯ä»¥ã€‚æ‰€æœ‰å›¾ç‰‡å¿…é¡»å…ˆä¸Šä¼ åˆ°OSSï¼Œä¸šåŠ¡ç³»ç»Ÿåªä¿å­˜URLå¼•ç”¨ã€‚

**Q2ï¼šä¸Šä¼ åˆ°OSSåï¼Œå¯ä»¥ä¸è°ƒç”¨ä¸šåŠ¡ä¿å­˜æ¥å£å—ï¼Ÿ**  
Aï¼šå¯ä»¥ã€‚æ¯”å¦‚ç”¨æˆ·åœ¨ç¼–è¾‘æ—¶é¢„è§ˆå›¾ç‰‡ï¼Œä½†æœ€ç»ˆå–æ¶ˆäº†ï¼Œæ­¤æ—¶åªä¼šåœ¨OSSç•™ä¸‹ä¸€å¼ æœªä½¿ç”¨çš„å›¾ç‰‡ã€‚

**Q3ï¼šå¤´åƒ/èƒŒæ™¯å¢™ä¸ºä»€ä¹ˆä¸éœ€è¦å…ˆåˆ é™¤ï¼Ÿ**  
Aï¼šç³»ç»Ÿä¼šè‡ªåŠ¨åˆ¤æ–­ã€‚é¦–æ¬¡ä¸Šä¼ åˆ›å»ºæ–°è®°å½•ï¼Œå†æ¬¡ä¸Šä¼ è‡ªåŠ¨æ›´æ–°ç°æœ‰è®°å½•ï¼ŒmediaIdä¸å˜ã€‚

**Q4ï¼šç›¸å†Œç…§ç‰‡èƒ½ç›´æ¥æ›¿æ¢å—ï¼Ÿ**  
Aï¼šä¸èƒ½é€šè¿‡ä¿å­˜æ¥å£ç›´æ¥æ›¿æ¢ã€‚éœ€è¦ï¼š
- æ–¹æ¡ˆ1ï¼šè·å–åˆ—è¡¨æ‰¾åˆ°mediaIdï¼Œè°ƒç”¨æ›´æ–°æ¥å£
- æ–¹æ¡ˆ2ï¼šåˆ é™¤æ—§çš„ï¼Œä¸Šä¼ æ–°çš„

**Q5ï¼šä¸Šä¼ å¤±è´¥äº†æ€ä¹ˆåŠï¼Ÿ**  
Aï¼š
- OSSä¸Šä¼ å¤±è´¥ï¼šæ£€æŸ¥æ–‡ä»¶å¤§å°ï¼ˆâ‰¤10MBï¼‰ã€æ ¼å¼ï¼ˆjpg/png/gifï¼‰ã€ç½‘ç»œ
- ä¸šåŠ¡ä¿å­˜å¤±è´¥ï¼šæ£€æŸ¥æ˜¯å¦è¶…è¿‡æ•°é‡é™åˆ¶ã€å®¡æ ¸çŠ¶æ€ã€Tokenæ˜¯å¦æœ‰æ•ˆ

**Q6ï¼šå›¾ç‰‡URLä¼šè¿‡æœŸå—ï¼Ÿ**  
Aï¼šä¸ä¼šã€‚OSS bucketè®¾ç½®ä¸ºå…¬å…±è¯»ï¼ŒURLæ°¸ä¹…æœ‰æ•ˆã€‚

**Q7ï¼šä¸ºä»€ä¹ˆå¤´åƒ/ç›¸å†Œè¦åˆ†ä¸¤æ¬¡è°ƒç”¨ï¼Ÿ**  
Aï¼šèŒè´£åˆ†ç¦»ã€‚OSSè´Ÿè´£æ–‡ä»¶å­˜å‚¨ï¼Œä¸šåŠ¡ç³»ç»Ÿè´Ÿè´£æƒé™ã€é™åˆ¶ã€å®¡æ ¸ç­‰é€»è¾‘ã€‚

---

## æ¥å£ç›®å½•

### è®¤è¯ç›¸å…³
1. [å¾®ä¿¡ç™»å½•](#1-å¾®ä¿¡ç™»å½•)
2. [ç”Ÿæˆæµ‹è¯•Token](#2-ç”Ÿæˆæµ‹è¯•tokenä»…å¼€å‘ç¯å¢ƒ)
3. [æ ¡éªŒToken](#3-æ ¡éªŒtoken)

### ç”¨æˆ·èµ„æ–™
4. [å®Œå–„èµ„æ–™](#4-å®Œå–„èµ„æ–™)
5. [æ›´æ–°èµ„æ–™](#5-æ›´æ–°èµ„æ–™)
6. [æŸ¥çœ‹æˆ‘çš„èµ„æ–™](#6-æŸ¥çœ‹æˆ‘çš„èµ„æ–™)
7. [æŸ¥çœ‹ä»–äººèµ„æ–™](#7-æŸ¥çœ‹ä»–äººèµ„æ–™)
8. [æŸ¥çœ‹èµ„æ–™å®Œå–„çŠ¶æ€](#8-æŸ¥çœ‹èµ„æ–™å®Œå–„çŠ¶æ€)
9. [è·å–ç”¨æˆ·ç»Ÿè®¡æ•°æ®](#9-è·å–ç”¨æˆ·ç»Ÿè®¡æ•°æ®)

### å®åè®¤è¯
10. [æäº¤å®åè®¤è¯](#10-æäº¤å®åè®¤è¯)
11. [æŸ¥è¯¢å®åè®¤è¯çŠ¶æ€](#11-æŸ¥è¯¢å®åè®¤è¯çŠ¶æ€)

### ~~ç›¸å†Œç®¡ç†~~ âŒ å·²åºŸå¼ƒ
~~12. [ä¸Šä¼ ç…§ç‰‡](#12-ä¸Šä¼ ç…§ç‰‡)~~ - å·²åºŸå¼ƒï¼Œè¯·ä½¿ç”¨ç»Ÿä¸€å›¾ç‰‡ç®¡ç†æ¥å£  
~~13. [åˆ é™¤ç…§ç‰‡](#13-åˆ é™¤ç…§ç‰‡)~~ - å·²åºŸå¼ƒï¼Œè¯·ä½¿ç”¨ç»Ÿä¸€å›¾ç‰‡ç®¡ç†æ¥å£  
~~14. [è®¾ç½®å°é¢ç…§ç‰‡](#14-è®¾ç½®å°é¢ç…§ç‰‡)~~ - å·²åºŸå¼ƒï¼Œè¯·ä½¿ç”¨ç»Ÿä¸€å›¾ç‰‡ç®¡ç†æ¥å£

### å›¾ç‰‡ç®¡ç†ï¼ˆç»Ÿä¸€ï¼‰âœ¨ æ–°æ¥å£
12. [ä¿å­˜å›¾ç‰‡åˆ°ä¸šåŠ¡æ¨¡å—](#12-ä¿å­˜å›¾ç‰‡åˆ°ä¸šåŠ¡æ¨¡å—)
13. [è·å–å›¾ç‰‡åˆ—è¡¨](#13-è·å–å›¾ç‰‡åˆ—è¡¨)
14. [åˆ é™¤å›¾ç‰‡](#14-åˆ é™¤å›¾ç‰‡)
15. [è®¾ç½®ä¸»å›¾ç‰‡](#15-è®¾ç½®ä¸»å›¾ç‰‡)
16. [æ›´æ–°å›¾ç‰‡](#16-æ›´æ–°å›¾ç‰‡) âœ¨ æ–°å¢

### æ ‡ç­¾ç®¡ç†
17. [è·å–æ ‡ç­¾åº“](#17-è·å–æ ‡ç­¾åº“)
18. [è®¾ç½®æˆ‘çš„æ ‡ç­¾](#18-è®¾ç½®æˆ‘çš„æ ‡ç­¾)

### éšç§è®¾ç½®
19. [æ›´æ–°éšç§è®¾ç½®](#19-æ›´æ–°éšç§è®¾ç½®)
20. [è·å–éšç§è®¾ç½®](#20-è·å–éšç§è®¾ç½®)

### é»‘åå•ç®¡ç†
21. [æ‹‰é»‘ç”¨æˆ·](#21-æ‹‰é»‘ç”¨æˆ·)
22. [ç§»é™¤é»‘åå•](#22-ç§»é™¤é»‘åå•)

### åŒ¹é…åå¥½
23. [è®¾ç½®åŒ¹é…åå¥½](#23-è®¾ç½®åŒ¹é…åå¥½)
24. [è·å–åŒ¹é…åå¥½](#24-è·å–åŒ¹é…åå¥½)

### æ™ºèƒ½åŒ¹é…ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰
25. [è·å–æ¨èç”¨æˆ·åˆ—è¡¨](#25-è·å–æ¨èç”¨æˆ·åˆ—è¡¨)
26. [å–œæ¬¢æ“ä½œ](#26-å–œæ¬¢æ“ä½œ)
27. [è¶…çº§å–œæ¬¢æ“ä½œ](#27-è¶…çº§å–œæ¬¢æ“ä½œ)
28. [è·³è¿‡æ“ä½œ](#28-è·³è¿‡æ“ä½œ)
29. [æŸ¥çœ‹è°å–œæ¬¢æˆ‘](#29-æŸ¥çœ‹è°å–œæ¬¢æˆ‘)
30. [è·å–åŒ¹é…é™åˆ¶ä¿¡æ¯](#30-è·å–åŒ¹é…é™åˆ¶ä¿¡æ¯)

### OSSå›¾ç‰‡ä¸Šä¼ 
31. [ä¸Šä¼ å›¾ç‰‡ï¼ˆæ–‡ä»¶æ–¹å¼ï¼‰](#31-ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶æ–¹å¼)
32. [ä¸Šä¼ å›¾ç‰‡ï¼ˆBase64æ–¹å¼ï¼‰](#32-ä¸Šä¼ å›¾ç‰‡base64æ–¹å¼)
33. [æ‰¹é‡ä¸Šä¼ å›¾ç‰‡](#33-æ‰¹é‡ä¸Šä¼ å›¾ç‰‡)
34. [åˆ é™¤OSSå›¾ç‰‡](#34-åˆ é™¤osså›¾ç‰‡)
35. [è·å–å›¾ç‰‡ç­¾åURL](#35-è·å–å›¾ç‰‡ç­¾åurl)

---

## 1. å¾®ä¿¡ç™»å½•

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`POST /api/auth/wx/login`
- **æ¥å£è¯´æ˜**ï¼šå¾®ä¿¡å°ç¨‹åºç™»å½•ï¼Œè¿”å›ç”¨æˆ·ä¿¡æ¯å’ŒçŠ¶æ€æ ‡è¯†
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šå¦

### è¯·æ±‚å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| code | String | æ˜¯ | å¾®ä¿¡ç™»å½•code |

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X POST http://localhost:8080/api/auth/wx/login \
  -H "Content-Type: application/json" \
  -d "{\"code\": \"test_code_12345\"}"
```

**è¯·æ±‚Body**ï¼š
```json
{
  "code": "test_code_12345"
}
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiJ9.eyJ1c2VySWQiOjEwMDF9...",
    "userId": "U1699123456789AB12CD",
    "isNewUser": false,
    "nickname": "æµ‹è¯•ç”¨æˆ·",
    "avatar": "https://example.com/avatar.jpg",
    "vipLevel": 0,
    "profileComplete": 0,
    "matchPreferenceSet": 0
  }
}
```

### å“åº”å­—æ®µè¯´æ˜

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| token | String | JWTè®¿é—®ä»¤ç‰Œï¼ˆå†…éƒ¨åŒ…å«æ•°æ®åº“IDç”¨äºè®¤è¯ï¼‰ |
| userId | String | ä¸šåŠ¡ç”¨æˆ·IDï¼ˆç”¨äºå¯¹å¤–å±•ç¤ºï¼Œæ ¼å¼ï¼šU + æ—¶é—´æˆ³ + éšæœºæ•°ï¼‰ |
| isNewUser | Boolean | æ˜¯å¦æ–°ç”¨æˆ· |
| nickname | String | ç”¨æˆ·æ˜µç§° |
| avatar | String | ç”¨æˆ·å¤´åƒ |
| vipLevel | Integer | ä¼šå‘˜ç­‰çº§ï¼ˆ0-æ™®é€šï¼Œ1-VIPï¼Œ2-SVIPï¼‰ |
| **profileComplete** | **Integer** | **èµ„æ–™æ˜¯å¦å®Œå–„ï¼ˆ0-å¦ï¼Œ1-æ˜¯ï¼‰** |
| **matchPreferenceSet** | **Integer** | **åŒ¹é…åå¥½æ˜¯å¦è®¾ç½®ï¼ˆ0-æœªè®¾ç½®ï¼Œ1-å·²è®¾ç½®ï¼‰** |

### ä¸šåŠ¡è¯´æ˜

ç™»å½•åæ ¹æ®ä¸¤ä¸ªæ ‡å¿—ä½å¼•å¯¼ç”¨æˆ·ï¼š

1. **profileComplete = 0**ï¼šå¼•å¯¼ç”¨æˆ·å®Œå–„èµ„æ–™
2. **profileComplete = 1 ä¸” matchPreferenceSet = 0**ï¼šå¼•å¯¼ç”¨æˆ·è®¾ç½®åŒ¹é…åå¥½
3. **ä¸¤è€…éƒ½ä¸º1**ï¼šè¿›å…¥ä¸»é¡µï¼Œå¼€å§‹åŒ¹é…

---

## 2. ç”Ÿæˆæµ‹è¯•Tokenï¼ˆä»…å¼€å‘ç¯å¢ƒï¼‰

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`POST /api/test/generate-token`
- **æ¥å£è¯´æ˜**ï¼šç”Ÿæˆæµ‹è¯•ç”¨çš„JWT Tokenï¼Œæ— éœ€å¾®ä¿¡ç™»å½•ï¼ˆä»…åœ¨devå’Œuatç¯å¢ƒå¯ç”¨ï¼‰
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šå¦

### è¯·æ±‚å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| businessUserId | String | å¦ | ä¸šåŠ¡ç”¨æˆ·IDï¼ˆé»˜è®¤U1234567890123TESTï¼‰ |
| vipLevel | Integer | å¦ | ä¼šå‘˜ç­‰çº§ï¼ˆé»˜è®¤0ï¼‰ |

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X POST "http://localhost:8080/api/test/generate-token?businessUserId=U1699123456789AB12CD&vipLevel=0"
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "æµ‹è¯•Tokenç”ŸæˆæˆåŠŸ",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiJ9...",
    "userId": "U1699123456789AB12CD",
    "openid": "test_openid_U1699123456789AB12CD",
    "vipLevel": 0,
    "expiresIn": 604800,
    "authHeader": "Bearer eyJhbGciOiJIUzI1NiJ9..."
  }
}
```

### ä¸šåŠ¡è¯´æ˜

1. **ä»…ç”¨äºå¼€å‘æµ‹è¯•**ï¼šç”Ÿäº§ç¯å¢ƒä¸å¯ç”¨
2. **Tokenæœ‰æ•ˆæœŸ**ï¼š7å¤©
3. **è‡ªåŠ¨å­˜å…¥Redis**ï¼šæ¨¡æ‹Ÿç™»å½•çŠ¶æ€

---

## 3. æ ¡éªŒToken

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`POST /api/auth/token/validate`
- **æ¥å£è¯´æ˜**ï¼šæ ¡éªŒJWT Tokençš„æœ‰æ•ˆæ€§ï¼Œè¿”å›Tokenç›¸å…³ä¿¡æ¯
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šå¦ï¼ˆä½†éœ€è¦æä¾›Tokenï¼‰

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
```

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X POST http://localhost:8080/api/auth/token/validate \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### å“åº”ç¤ºä¾‹

**Tokenæœ‰æ•ˆ**ï¼š
```json
{
  "code": 200,
  "message": "Tokenæœ‰æ•ˆ",
  "data": {
    "valid": true,
    "userId": "U1699123456789AB12CD",
    "openid": "oAB***xyz",
    "vipLevel": 0,
    "expireTime": 1730000000000
  }
}
```

**Tokenæ— æ•ˆ**ï¼š
```json
{
  "code": 401,
  "message": "Tokenå·²å¤±æ•ˆæˆ–ç”¨æˆ·å·²ç™»å‡º",
  "data": {
    "valid": false,
    "userId": null,
    "openid": null,
    "vipLevel": null,
    "expireTime": null,
    "reason": "Tokenå·²å¤±æ•ˆæˆ–ç”¨æˆ·å·²ç™»å‡º"
  }
}
```

### å“åº”å­—æ®µè¯´æ˜

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| valid | Boolean | Tokenæ˜¯å¦æœ‰æ•ˆ |
| userId | String | ç”¨æˆ·IDï¼ˆä¸šåŠ¡ç”¨æˆ·IDï¼‰ |
| openid | String | å¾®ä¿¡OpenIDï¼ˆè„±æ•æ˜¾ç¤ºï¼‰ |
| vipLevel | Integer | ä¼šå‘˜ç­‰çº§ï¼ˆ0-æ™®é€šï¼Œ1-VIPï¼Œ2-SVIPï¼‰ |
| expireTime | Long | Tokenè¿‡æœŸæ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰ |
| reason | String | å¤±è´¥åŸå› ï¼ˆä»…åœ¨valid=falseæ—¶æœ‰å€¼ï¼‰ |

### ä¸šåŠ¡è¯´æ˜

1. **å¤šé‡éªŒè¯**ï¼š
   - JWTç­¾åéªŒè¯
   - Tokenè¿‡æœŸæ—¶é—´éªŒè¯
   - Redisç¼“å­˜éªŒè¯ï¼ˆé˜²æ­¢tokenè¢«ç™»å‡ºåä»ç„¶ä½¿ç”¨ï¼‰
   - ç”¨æˆ·çŠ¶æ€éªŒè¯ï¼ˆç”¨æˆ·æ˜¯å¦å­˜åœ¨ã€æ˜¯å¦è¢«å°ç¦ï¼‰

2. **å¤±è´¥åŸå› **ï¼š
   - "Tokenæ— æ•ˆæˆ–å·²è¿‡æœŸ"ï¼šJWTç­¾åé”™è¯¯æˆ–å·²è¿‡æœŸ
   - "Tokenå·²å¤±æ•ˆæˆ–ç”¨æˆ·å·²ç™»å‡º"ï¼šç”¨æˆ·å·²ä¸»åŠ¨ç™»å‡º
   - "ç”¨æˆ·ä¸å­˜åœ¨"ï¼šç”¨æˆ·å·²è¢«åˆ é™¤
   - "ç”¨æˆ·å·²è¢«å°ç¦"ï¼šç”¨æˆ·è´¦å·è¢«å°ç¦

3. **å®‰å…¨æ€§**ï¼š
   - openidè¿›è¡Œè„±æ•æ˜¾ç¤º
   - ä¸ä¼šæš´éœ²æ•æ„Ÿä¿¡æ¯

---

## 4. å®Œå–„èµ„æ–™

**è¯´æ˜**ï¼šæ­¤æ¥å£ç”¨äº**é¦–æ¬¡å®Œå–„èµ„æ–™**æˆ–åç»­æ›´æ–°èµ„æ–™ï¼Œæ”¯æŒä¸€æ¬¡æ€§æäº¤æ‰€æœ‰å­—æ®µã€‚

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`POST /api/user/profile`
- **æ¥å£è¯´æ˜**ï¼šå®Œå–„æˆ–æ›´æ–°ç”¨æˆ·èµ„æ–™ï¼ˆæ”¯æŒä¸€æ¬¡æ€§æäº¤æ‰€æœ‰å¿…å¡«å­—æ®µï¼‰
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
Content-Type: application/json
```

### è¯·æ±‚å‚æ•°

#### å¿…å¡«å­—æ®µï¼ˆå®Œå–„èµ„æ–™æ—¶å¿…é¡»æä¾›ï¼‰

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| nickname | String | æ˜¯ | æ˜µç§°ï¼ˆæœ€å¤š50å­—ï¼‰ |
| avatar | String | æ˜¯ | å¤´åƒURLï¼ˆæœ€å¤š255å­—ï¼‰ |
| gender | Integer | æ˜¯ | æ€§åˆ«ï¼ˆ0-æœªçŸ¥ï¼Œ1-ç”·ï¼Œ2-å¥³ï¼‰ |
| age | Integer | æ˜¯ | å¹´é¾„ï¼ˆèŒƒå›´0-100ï¼Œç”¨æˆ·åªèƒ½è®¾ç½®ä¸€æ¬¡ï¼‰ |
| tagIds | Array | æ˜¯ | å…´è¶£æ ‡ç­¾IDåˆ—è¡¨ï¼ˆæœ€å¤š10ä¸ªï¼‰ |

#### å¯é€‰å­—æ®µï¼ˆç¼–è¾‘èµ„æ–™æ—¶å¯è¡¥å……ï¼‰

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| birthday | String | å¦ | ç”Ÿæ—¥ï¼ˆæ ¼å¼ï¼šYYYY-MM-DDï¼‰ |
| height | Integer | å¦ | èº«é«˜ï¼ˆcmï¼ŒèŒƒå›´100-250ï¼‰ |
| weight | Integer | å¦ | ä½“é‡ï¼ˆkgï¼ŒèŒƒå›´30-200ï¼‰ |
| occupation | String | å¦ | èŒä¸šï¼ˆæœ€å¤š50å­—ï¼‰ |
| education | String | å¦ | å­¦å†ï¼ˆæœ€å¤š20å­—ï¼‰ |
| income | String | å¦ | æ”¶å…¥ï¼ˆæœ€å¤š20å­—ï¼‰ |
| hometown | String | å¦ | å®¶ä¹¡ï¼ˆæœ€å¤š50å­—ï¼‰ |
| currentCity | String | å¦ | ç°å±…åŸå¸‚ï¼ˆæœ€å¤š50å­—ï¼‰ |
| bio | String | å¦ | ä¸ªäººç®€ä»‹ï¼ˆæœ€å¤š200å­—ï¼‰ |
| maritalStatus | String | å¦ | å©šå§»çŠ¶å†µï¼ˆæœ€å¤š20å­—ï¼‰ |

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X POST http://localhost:8080/api/user/profile \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "nickname": "æµ‹è¯•ç”¨æˆ·å°é›¨",
    "avatar": "https://example.com/avatar.jpg",
    "gender": 2,
    "birthday": "1998-05-20",
    "age": 25,
    "tagIds": [1, 5, 8],
    "height": 165,
    "occupation": "UIè®¾è®¡å¸ˆ",
    "education": "æœ¬ç§‘",
    "currentCity": "åŒ—äº¬å¸‚æœé˜³åŒº",
    "bio": "çƒ­çˆ±ç”Ÿæ´»ï¼Œå–œæ¬¢æ‘„å½±å’Œæ—…è¡Œã€‚"
  }'
```

**è¯·æ±‚Body**ï¼š
```json
{
  "nickname": "æµ‹è¯•ç”¨æˆ·å°é›¨",
  "avatar": "https://example.com/avatar.jpg",
  "gender": 2,
  "birthday": "1998-05-20",
  "age": 25,
  "tagIds": [1, 5, 8],
  "height": 165,
  "occupation": "UIè®¾è®¡å¸ˆ",
  "education": "æœ¬ç§‘",
  "currentCity": "åŒ—äº¬å¸‚æœé˜³åŒº",
  "bio": "çƒ­çˆ±ç”Ÿæ´»ï¼Œå–œæ¬¢æ‘„å½±å’Œæ—…è¡Œã€‚å¸Œæœ›èƒ½æ‰¾åˆ°å¿—åŒé“åˆçš„æœ‹å‹ã€‚"
}
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "èµ„æ–™ä¿å­˜æˆåŠŸ",
  "data": true
}
```

### ä¸šåŠ¡è¯´æ˜

1. **è‡ªåŠ¨æ›´æ–°WxUserè¡¨**ï¼šæ˜µç§°ã€å¤´åƒã€æ€§åˆ«ã€å¹´é¾„ã€ç”Ÿæ—¥ï¼ˆå¯é€‰ï¼‰
2. **è‡ªåŠ¨è®¾ç½®æ ‡ç­¾**ï¼šä¿å­˜åˆ°`t_user_tag`è¡¨
3. **è‡ªåŠ¨æ£€æŸ¥å®Œå–„çŠ¶æ€**ï¼šå¦‚æœ5ä¸ªå¿…å¡«å­—æ®µï¼ˆæ˜µç§°ã€å¤´åƒã€æ€§åˆ«ã€å¹´é¾„ã€æ ‡ç­¾ï¼‰éƒ½å¡«å†™ï¼Œè‡ªåŠ¨æ›´æ–°`profile_complete=1`
4. **æ€§åˆ«ä¸º0ï¼ˆæœªçŸ¥ï¼‰ä¸ç®—å®Œå–„**ï¼šå¿…é¡»é€‰æ‹©1æˆ–2

---

## 5. æ›´æ–°èµ„æ–™

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`POST /api/user/profile/update`
- **æ¥å£è¯´æ˜**ï¼šæ›´æ–°ç”¨æˆ·èµ„æ–™ï¼ˆä¸å®Œå–„èµ„æ–™ä½¿ç”¨åŒä¸€ä¸ªserviceæ–¹æ³•ï¼Œå‚æ•°ç›¸åŒï¼‰
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
Content-Type: application/json
```

### è¯·æ±‚å‚æ•°

å‚æ•°ä¸"å®Œå–„èµ„æ–™"æ¥å£å®Œå…¨ç›¸åŒï¼Œæ”¯æŒéƒ¨åˆ†æ›´æ–°ã€‚

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X POST http://localhost:8080/api/user/profile/update \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "bio": "æ›´æ–°åçš„ä¸ªäººç®€ä»‹",
    "currentCity": "æ·±åœ³å¸‚å—å±±åŒº"
  }'
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "èµ„æ–™æ›´æ–°æˆåŠŸ",
  "data": true
}
```

---

## 6. æŸ¥çœ‹æˆ‘çš„èµ„æ–™

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`GET /api/user/profile`
- **æ¥å£è¯´æ˜**ï¼šæŸ¥çœ‹å½“å‰ç™»å½•ç”¨æˆ·çš„å®Œæ•´èµ„æ–™
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
```

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X GET http://localhost:8080/api/user/profile \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "userId": "U1699123456789AB12CD",
    "nickname": "æµ‹è¯•ç”¨æˆ·å°é›¨",
    "avatar": "https://example.com/avatar.jpg",
    "gender": 2,
    "age": 27,
    "height": 165,
    "occupation": "UIè®¾è®¡å¸ˆ",
    "education": "æœ¬ç§‘",
    "income": null,
    "hometown": null,
    "currentCity": "åŒ—äº¬å¸‚æœé˜³åŒº",
    "bio": "çƒ­çˆ±ç”Ÿæ´»ï¼Œå–œæ¬¢æ‘„å½±å’Œæ—…è¡Œã€‚",
    "voiceIntroUrl": null,
    "isVerified": 0,
    "verifyStatus": 0,
    "photos": [],
    "tags": [
      {
        "tagId": 1,
        "tagName": "æ—…æ¸¸",
        "icon": "ğŸ–ï¸"
      },
      {
        "tagId": 5,
        "tagName": "ç”µå½±",
        "icon": "ğŸ¬"
      },
      {
        "tagId": 8,
        "tagName": "è¯»ä¹¦",
        "icon": "ğŸ“š"
      }
    ],
    "profileComplete": 1,
    "onlineStatus": 1,
    "lastLoginTime": "2025-11-01T21:15:00",
    "createdAt": "2025-10-28T10:00:00",
    "updatedAt": "2025-11-01T21:15:30"
  }
}
```

---

## 7. æŸ¥çœ‹ä»–äººèµ„æ–™

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`GET /api/user/profile/{userId}`
- **æ¥å£è¯´æ˜**ï¼šæŸ¥çœ‹å…¶ä»–ç”¨æˆ·çš„èµ„æ–™ï¼ˆä¼šæ ¹æ®éšç§è®¾ç½®è¿‡æ»¤éƒ¨åˆ†ä¿¡æ¯ï¼‰
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
```

### è·¯å¾„å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| userId | String | æ˜¯ | è¦æŸ¥çœ‹çš„ç”¨æˆ·IDï¼ˆä¸šåŠ¡ç”¨æˆ·IDï¼Œå¦‚ï¼šU1699123456789AB12CDï¼‰ |

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X GET http://localhost:8080/api/user/profile/U1699234567890CD34EF \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "userId": "U1699234567890CD34EF",
    "nickname": "æå››",
    "avatar": "https://example.com/avatar2.jpg",
    "gender": 1,
    "age": 28,
    "height": 180,
    "occupation": "äº§å“ç»ç†",
    "education": "ç¡•å£«",
    "currentCity": "åŒ—äº¬å¸‚æµ·æ·€åŒº",
    "bio": "å–œæ¬¢è¿åŠ¨å’Œè¯»ä¹¦",
    "isVerified": 1,
    "vipLevel": 1,
    "photos": [
      {
        "id": 1,
        "photoUrl": "https://example.com/photo1.jpg",
        "isCover": 1,
        "auditStatus": 1,
        "sortOrder": 0
      }
    ],
    "tags": [
      {
        "id": 2,
        "tagName": "å¥èº«",
        "category": "è¿åŠ¨",
        "icon": "icon-fitness"
      }
    ],
    "onlineStatus": 1,
    "lastLoginTime": "2025-11-01T20:00:00"
  }
}
```

### ä¸šåŠ¡è¯´æ˜

1. **éšç§è¿‡æ»¤**ï¼šæ ¹æ®è¢«æŸ¥çœ‹ç”¨æˆ·çš„éšç§è®¾ç½®ï¼ŒæŸäº›ä¿¡æ¯å¯èƒ½ä¸å¯è§
2. **é»‘åå•åˆ¤æ–­**ï¼šå¦‚æœåœ¨å¯¹æ–¹é»‘åå•ä¸­ï¼Œå¯èƒ½è¿”å›å—é™ä¿¡æ¯
3. **è·ç¦»æ˜¾ç¤º**ï¼šæ ¹æ®å¯¹æ–¹çš„éšç§è®¾ç½®å†³å®šæ˜¯å¦æ˜¾ç¤ºè·ç¦»

---

## 8. æŸ¥çœ‹èµ„æ–™å®Œå–„çŠ¶æ€

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`GET /api/user/profile/status`
- **æ¥å£è¯´æ˜**ï¼šæŸ¥çœ‹å½“å‰ç”¨æˆ·çš„èµ„æ–™å®Œå–„çŠ¶æ€å’Œç¼ºå¤±å­—æ®µ
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
```

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X GET http://localhost:8080/api/user/profile/status \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### å“åº”ç¤ºä¾‹

**èµ„æ–™æœªå®Œå–„æ—¶**ï¼š
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "profileComplete": false,
    "completionRate": 60,
    "completedFields": 3,
    "totalFields": 5,
    "missingFields": [
      "æ€§åˆ«",
      "å…´è¶£æ ‡ç­¾"
    ],
    "suggestions": [
      "è®¾ç½®æ‚¨çš„æ€§åˆ«ä¿¡æ¯",
      "é€‰æ‹©è‡³å°‘1ä¸ªå…´è¶£æ ‡ç­¾ï¼Œè®©åˆ«äººæ›´äº†è§£ä½ ",
      "ğŸ’¡ å»ºè®®ï¼šç»‘å®šæ‰‹æœºå·æé«˜ä¿¡ä»»åº¦",
      "ğŸ’¡ å»ºè®®ï¼šå¡«å†™èº«é«˜ä¿¡æ¯"
    ]
  }
}
```

**èµ„æ–™å·²å®Œå–„æ—¶**ï¼š
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "profileComplete": true,
    "completionRate": 100,
    "completedFields": 5,
    "totalFields": 5,
    "missingFields": [],
    "suggestions": [
      "ğŸ’¡ å»ºè®®ï¼šç»‘å®šæ‰‹æœºå·æé«˜ä¿¡ä»»åº¦",
      "ğŸ’¡ å»ºè®®ï¼šå¡«å†™èº«é«˜ä¿¡æ¯",
      "ğŸ’¡ å»ºè®®ï¼šå¡«å†™å­¦å†ä¿¡æ¯"
    ]
  }
}
```

### å“åº”å­—æ®µè¯´æ˜

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| profileComplete | Boolean | èµ„æ–™æ˜¯å¦å®Œå–„ |
| completionRate | Integer | å®Œå–„åº¦ç™¾åˆ†æ¯”ï¼ˆ0-100ï¼‰ |
| completedFields | Integer | å·²å®Œå–„çš„å¿…å¡«å­—æ®µæ•°é‡ |
| totalFields | Integer | æ€»å¿…å¡«å­—æ®µæ•°é‡ï¼ˆå›ºå®šä¸º5ï¼‰ |
| missingFields | Array | ç¼ºå¤±çš„å¿…å¡«å­—æ®µåˆ—è¡¨ |
| suggestions | Array | æ”¹è¿›å»ºè®®ï¼ˆåŒ…æ‹¬å¿…å¡«å’Œå¯é€‰å­—æ®µæç¤ºï¼‰ |

### å¿…å¡«å­—æ®µè¯´æ˜

1. æ˜µç§°
2. å¤´åƒ
3. æ€§åˆ«ï¼ˆ1æˆ–2ï¼Œ0ä¸ç®—å®Œå–„ï¼‰
4. å¹´é¾„
5. å…´è¶£æ ‡ç­¾ï¼ˆè‡³å°‘1ä¸ªï¼‰

---

## 9. è·å–ç”¨æˆ·ç»Ÿè®¡æ•°æ®

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`GET /api/user/stats`
- **æ¥å£è¯´æ˜**ï¼šè·å–ç”¨æˆ·çš„ç»Ÿè®¡æ•°æ®ï¼ˆå…³æ³¨ã€ç²‰ä¸ã€åŒ¹é…ç­‰ï¼‰
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
```

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X GET http://localhost:8080/api/user/stats \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "followingCount": 0,
    "followersCount": 0,
    "buddyMatchCount": 0,
    "activityJoinCount": 0,
    "momentCount": 0,
    "likedMeCount": 0,
    "myFavoritesCount": 0
  }
}
```

### å“åº”å­—æ®µè¯´æ˜

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| followingCount | Integer | å…³æ³¨æ•°é‡ |
| followersCount | Integer | ç²‰ä¸æ•°é‡ |
| buddyMatchCount | Integer | æ­å­åŒ¹é…æ•°é‡ |
| activityJoinCount | Integer | æ´»åŠ¨å‚ä¸æ•°é‡ |
| momentCount | Integer | åŠ¨æ€æ•°é‡ |
| likedMeCount | Integer | å–œæ¬¢æˆ‘çš„äººæ•° |
| myFavoritesCount | Integer | æˆ‘æ”¶è—çš„äººæ•° |

**æ³¨æ„**ï¼šå½“å‰ç‰ˆæœ¬æš‚æ—¶è¿”å›0ï¼Œç­‰ç›¸å…³æ¨¡å—å¼€å‘å®Œæˆåä¼šè¿”å›çœŸå®æ•°æ®ã€‚

---

## 10. æäº¤å®åè®¤è¯

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`POST /api/user/real-name-verify`
- **æ¥å£è¯´æ˜**ï¼šæäº¤å®åè®¤è¯ï¼Œç³»ç»Ÿè‡ªåŠ¨ä»èº«ä»½è¯å·æå–ç”Ÿæ—¥å¹¶æ›´æ–°çœŸå®å¹´é¾„
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
Content-Type: application/json
```

### è¯·æ±‚å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| realName | String | æ˜¯ | çœŸå®å§“åï¼ˆ2-50ä¸ªå­—ç¬¦ï¼‰ |
| idCard | String | æ˜¯ | èº«ä»½è¯å·ï¼ˆ18ä½ï¼Œç¬¦åˆæ ¼å¼è§„åˆ™ï¼‰ |

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X POST http://localhost:8080/api/user/real-name-verify \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "realName": "å¼ ä¸‰",
    "idCard": "110101199001011234"
  }'
```

**è¯·æ±‚Body**ï¼š
```json
{
  "realName": "å¼ ä¸‰",
  "idCard": "110101199001011234"
}
```

### å“åº”ç¤ºä¾‹

**æˆåŠŸå“åº”**ï¼š
```json
{
  "code": 200,
  "message": "å®åè®¤è¯æäº¤æˆåŠŸï¼Œå¹´é¾„å·²æ ¹æ®ç”Ÿæ—¥è‡ªåŠ¨æ›´æ–°",
  "data": true
}
```

**å¤±è´¥å“åº”**ï¼š
```json
{
  "code": 40001,
  "message": "æ‚¨å·²å®Œæˆå®åè®¤è¯ï¼Œæ— éœ€é‡å¤æäº¤",
  "data": null
}
```

### ä¸šåŠ¡è¯´æ˜

1. **è‡ªåŠ¨æå–ç”Ÿæ—¥**ï¼šä»èº«ä»½è¯å·ç¬¬7-14ä½æå–å‡ºç”Ÿæ—¥æœŸ
2. **è‡ªåŠ¨è®¡ç®—å¹´é¾„**ï¼šæ ¹æ®ç”Ÿæ—¥è®¡ç®—çœŸå®å¹´é¾„å¹¶æ›´æ–°
3. **é”å®šå¹´é¾„**ï¼šå®åè®¤è¯åï¼Œç”¨æˆ·æ— æ³•å†ä¿®æ”¹å¹´é¾„
4. **å¹´é¾„é™åˆ¶**ï¼šå¿…é¡»â‰¥18å²æ‰èƒ½ä½¿ç”¨æœåŠ¡
5. **é˜²é‡å¤è®¤è¯**ï¼šå·²è®¤è¯ç”¨æˆ·æ— æ³•é‡å¤æäº¤

### é”™è¯¯ç è¯´æ˜

| é”™è¯¯ç  | é”™è¯¯ä¿¡æ¯ |
|--------|---------|
| 40001 | æ‚¨å·²å®Œæˆå®åè®¤è¯ï¼Œæ— éœ€é‡å¤æäº¤ |
| 40002 | èº«ä»½è¯å·æ ¼å¼ä¸æ­£ç¡® |
| 40002 | æœªæ»¡18å²ä¸èƒ½ä½¿ç”¨æœ¬æœåŠ¡ |
| 40002 | èº«ä»½è¯å‡ºç”Ÿæ—¥æœŸå¼‚å¸¸ |
| 40401 | ç”¨æˆ·ä¸å­˜åœ¨ |

---

## 11. æŸ¥è¯¢å®åè®¤è¯çŠ¶æ€

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`GET /api/user/real-name-verify/status`
- **æ¥å£è¯´æ˜**ï¼šæŸ¥è¯¢ç”¨æˆ·æ˜¯å¦å·²å®Œæˆå®åè®¤è¯
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
```

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X GET http://localhost:8080/api/user/real-name-verify/status \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "success",
  "data": true
}
```

### å“åº”å­—æ®µè¯´æ˜

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| data | Boolean | true-å·²è®¤è¯ï¼Œfalse-æœªè®¤è¯ |

---

## 12. ä¿å­˜å›¾ç‰‡åˆ°ä¸šåŠ¡æ¨¡å—

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`POST /api/media/save`
- **æ¥å£è¯´æ˜**ï¼šç»Ÿä¸€çš„å›¾ç‰‡ä¿å­˜æ¥å£ï¼Œæ”¯æŒå¤´åƒã€ç›¸å†Œã€èƒŒæ™¯å¢™ã€åŠ¨æ€ã€æ´»åŠ¨ç­‰å¤šç§ä¸šåŠ¡ç±»å‹ã€‚**å¤´åƒå’ŒèƒŒæ™¯å¢™æ”¯æŒæ™ºèƒ½æ›¿æ¢ï¼ˆè‡ªåŠ¨è¦†ç›–æ—§å›¾ç‰‡ï¼‰**
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
Content-Type: application/json
```

### è¯·æ±‚å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| imageUrl | String | æ˜¯ | å›¾ç‰‡URLï¼ˆé€šè¿‡OSSä¸Šä¼ æ¥å£è·å–ï¼Œæœ€å¤š500å­—ï¼‰ |
| mediaType | String | æ˜¯ | å›¾ç‰‡ç±»å‹ï¼šavatar-å¤´åƒã€album-ç›¸å†Œã€background-èƒŒæ™¯å¢™ã€moment-åŠ¨æ€ã€activity-æ´»åŠ¨ |
| isPrimary | Boolean | å¦ | æ˜¯å¦è®¾ä¸ºä¸»å›¾ç‰‡ï¼ˆå¤´åƒ/å°é¢/èƒŒæ™¯ï¼‰ï¼Œé»˜è®¤false |
| width | Integer | å¦ | å›¾ç‰‡å®½åº¦ï¼ˆåƒç´ ï¼‰ |
| height | Integer | å¦ | å›¾ç‰‡é«˜åº¦ï¼ˆåƒç´ ï¼‰ |
| fileSize | Long | å¦ | æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰ |

### è¯·æ±‚ç¤ºä¾‹

**ç¤ºä¾‹1ï¼šä¿å­˜ç›¸å†Œç…§ç‰‡**
```bash
curl -X POST http://localhost:8080/api/media/save \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "imageUrl": "https://your-bucket.oss-cn-hangzhou.aliyuncs.com/uploads/album/U1234.../20251106/abc123.jpg",
    "mediaType": "album",
    "isPrimary": false,
    "width": 1080,
    "height": 1920,
    "fileSize": 2048576
  }'
```

**ç¤ºä¾‹2ï¼šæ›´æ¢å¤´åƒï¼ˆæ™ºèƒ½æ›¿æ¢ï¼‰**
```bash
# åœºæ™¯ï¼šç”¨æˆ·é¦–æ¬¡ä¸Šä¼ å¤´åƒ æˆ– æ›´æ¢å¤´åƒ
# æ— è®ºæ˜¯ç¬¬1æ¬¡è¿˜æ˜¯ç¬¬Næ¬¡ä¸Šä¼ ï¼Œè°ƒç”¨æ–¹å¼å®Œå…¨ç›¸åŒ
curl -X POST http://localhost:8080/api/media/save \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "imageUrl": "https://your-bucket.oss-cn-hangzhou.aliyuncs.com/uploads/avatar/U1234.../new-avatar.jpg",
    "mediaType": "avatar",
    "isPrimary": true
  }'

# æ™ºèƒ½åˆ¤æ–­é€»è¾‘ï¼š
# - å¦‚æœç”¨æˆ·æ²¡æœ‰å¤´åƒ â†’ åˆ›å»ºæ–°è®°å½•ï¼ˆmediaId: 101ï¼‰
# - å¦‚æœç”¨æˆ·å·²æœ‰å¤´åƒ â†’ æ›´æ–°ç°æœ‰è®°å½•ï¼ˆmediaIdä»ä¸º101ï¼Œåªæ˜¯imageUrlæ”¹å˜ï¼‰
```

**ç¤ºä¾‹3ï¼šè®¾ç½®èƒŒæ™¯å¢™ï¼ˆæ™ºèƒ½æ›¿æ¢ï¼‰**
```bash
# ä¸å¤´åƒç›¸åŒï¼ŒèƒŒæ™¯å¢™ä¹Ÿæ”¯æŒæ™ºèƒ½æ›¿æ¢
curl -X POST http://localhost:8080/api/media/save \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "imageUrl": "https://your-bucket.oss-cn-hangzhou.aliyuncs.com/uploads/background/U1234.../new-bg.jpg",
    "mediaType": "background",
    "isPrimary": true
  }'
```

**ç¤ºä¾‹4ï¼šä¸Šä¼ ç›¸å†Œç…§ç‰‡ï¼ˆæ•°é‡é™åˆ¶ï¼‰**
```bash
# ç›¸å†Œç…§ç‰‡ä¼šæ£€æŸ¥æ•°é‡é™åˆ¶
curl -X POST http://localhost:8080/api/media/save \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "imageUrl": "https://your-bucket.oss-cn-hangzhou.aliyuncs.com/uploads/album/U1234.../photo1.jpg",
    "mediaType": "album",
    "isPrimary": false
  }'

# å¦‚æœè¶…è¿‡é™åˆ¶ä¼šè¿”å›ï¼š
# {"code": 40002, "message": "ç›¸å†Œæœ€å¤šä¸Šä¼ 9å¼ ï¼Œå½“å‰å·²æœ‰9å¼ ï¼Œå‡çº§VIPå¯ä¸Šä¼ 15å¼ "}
```

### å“åº”ç¤ºä¾‹

**ç¤ºä¾‹1ï¼šé¦–æ¬¡ä¸Šä¼ å¤´åƒï¼ˆåˆ›å»ºï¼‰**
```json
{
  "code": 200,
  "message": "å›¾ç‰‡ä¿å­˜æˆåŠŸ",
  "data": {
    "mediaId": 101,
    "imageUrl": "https://your-bucket.oss.../avatar.jpg",
    "mediaType": "avatar",
    "isPrimary": true,
    "currentCount": 1,
    "maxCount": 1
  },
  "traceId": "a1b2c3d4..."
}
```

**ç¤ºä¾‹2ï¼šå†æ¬¡ä¸Šä¼ å¤´åƒï¼ˆæ›´æ–°ï¼‰**
```json
{
  "code": 200,
  "message": "å›¾ç‰‡ä¿å­˜æˆåŠŸ",
  "data": {
    "mediaId": 101,  // âš ï¸ æ³¨æ„ï¼šmediaIdä¸å˜
    "imageUrl": "https://your-bucket.oss.../new-avatar.jpg",  // URLå·²æ›´æ–°
    "mediaType": "avatar",
    "isPrimary": true,
    "currentCount": 1,
    "maxCount": 1
  },
  "traceId": "a1b2c3d4..."
}
```

**ç¤ºä¾‹3ï¼šä¸Šä¼ ç›¸å†Œç…§ç‰‡ï¼ˆæ–°å¢ï¼‰**
```json
{
  "code": 200,
  "message": "å›¾ç‰‡ä¿å­˜æˆåŠŸ",
  "data": {
    "mediaId": 12345,  // æ¯æ¬¡ä¸Šä¼ éƒ½æ˜¯æ–°çš„ID
    "imageUrl": "https://your-bucket.oss.../album/photo3.jpg",
    "mediaType": "album",
    "isPrimary": false,
    "currentCount": 3,  // å½“å‰æœ‰3å¼ 
    "maxCount": 9       // æœ€å¤š9å¼ 
  },
  "traceId": "a1b2c3d4..."
}
```

### å“åº”å­—æ®µè¯´æ˜

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| mediaId | Long | å›¾ç‰‡ID |
| imageUrl | String | å›¾ç‰‡URL |
| mediaType | String | å›¾ç‰‡ç±»å‹ |
| isPrimary | Boolean | æ˜¯å¦ä¸ºä¸»å›¾ç‰‡ |
| currentCount | Integer | å½“å‰è¯¥ç±»å‹å›¾ç‰‡æ•°é‡ |
| maxCount | Integer | è¯¥ç±»å‹æœ€å¤§å…è®¸æ•°é‡ |

### ä¸šåŠ¡è¯´æ˜

#### å›¾ç‰‡ç±»å‹å’Œæ•°é‡é™åˆ¶

| ç±»å‹ | ä»£ç  | æ™®é€šç”¨æˆ· | VIPç”¨æˆ· | ä¸»å›¾ç‰‡ | å®¡æ ¸ |
|------|------|---------|---------|--------|------|
| å¤´åƒ | `avatar` | 1å¼  | 1å¼  | âœ… å§‹ç»ˆä¸ºä¸» | âœ… |
| ç›¸å†Œ | `album` | 9å¼  | 15å¼  | âœ… å¯è®¾å°é¢ | âœ… |
| èƒŒæ™¯å¢™ | `background` | 1å¼  | 1å¼  | âœ… å§‹ç»ˆä¸ºä¸» | âœ… |
| åŠ¨æ€ | `moment` | 9å¼ /æ¡ | 9å¼ /æ¡ | âŒ | âœ… |
| æ´»åŠ¨ | `activity` | 20å¼  | 20å¼  | âŒ | âœ… |

#### ç‰¹æ®Šè§„åˆ™

1. **æ™ºèƒ½æ›¿æ¢ï¼ˆå¤´åƒ/èƒŒæ™¯å¢™ï¼‰**ï¼š
   - é¦–æ¬¡ä¸Šä¼ ï¼šåˆ›å»ºæ–°è®°å½•
   - å†æ¬¡ä¸Šä¼ ï¼šè‡ªåŠ¨æ›´æ–°ç°æœ‰è®°å½•ï¼ˆ**æ— éœ€å…ˆåˆ é™¤**ï¼‰
   - mediaId ä¿æŒä¸å˜
   - ç”¨æˆ·æ— æ„ŸçŸ¥è‡ªåŠ¨æ›¿æ¢
   
2. **ç›¸å†Œ/åŠ¨æ€/æ´»åŠ¨**ï¼š
   - æ£€æŸ¥æ•°é‡é™åˆ¶ï¼ˆè¶…è¿‡é™åˆ¶ä¼šæŠ¥é”™ï¼‰
   - æ¯æ¬¡ä¸Šä¼ éƒ½æ˜¯æ–°å¢è®°å½•
   - å¦‚éœ€æ›¿æ¢è¯·ä½¿ç”¨æ›´æ–°æ¥å£

3. **ç›¸å†Œå°é¢**ï¼šè®¾ç½® `isPrimary=true` ä¼šè‡ªåŠ¨å–æ¶ˆå…¶ä»–ç…§ç‰‡çš„å°é¢çŠ¶æ€

4. **å®¡æ ¸çŠ¶æ€**ï¼šä¸Šä¼ åé»˜è®¤ä¸ºå¾…å®¡æ ¸ï¼ˆ`auditStatus=0`ï¼‰ï¼Œå®¡æ ¸é€šè¿‡åæ‰ä¼šæ˜¾ç¤º

5. **å®Œæ•´æµç¨‹**ï¼š
   ```
   ç”¨æˆ·é€‰æ‹©å›¾ç‰‡ â†’ OSSä¸Šä¼ æ¥å£ â†’ è·å¾—imageUrl â†’ æœ¬æ¥å£ä¿å­˜ â†’ å®Œæˆ
   è¯¦è§æ–‡æ¡£é¡¶éƒ¨"å›¾ç‰‡ä¸Šä¼ å®Œæ•´æµç¨‹è¯´æ˜"
   ```

---

## 13. è·å–å›¾ç‰‡åˆ—è¡¨

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`GET /api/media/list`
- **æ¥å£è¯´æ˜**ï¼šè·å–æŒ‡å®šç±»å‹çš„å›¾ç‰‡åˆ—è¡¨
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
```

### æŸ¥è¯¢å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| mediaType | String | æ˜¯ | å›¾ç‰‡ç±»å‹ï¼šavatarã€albumã€backgroundã€momentã€activity |

### è¯·æ±‚ç¤ºä¾‹

**ç¤ºä¾‹1ï¼šè·å–ç›¸å†Œç…§ç‰‡**
```bash
curl -X GET "http://localhost:8080/api/media/list?mediaType=album" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

**ç¤ºä¾‹2ï¼šè·å–å¤´åƒ**
```bash
curl -X GET "http://localhost:8080/api/media/list?mediaType=avatar" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 12345,
      "userId": "U1699123456789AB12CD",
      "imageUrl": "https://your-bucket.oss-cn-hangzhou.aliyuncs.com/uploads/album/U1234.../photo1.jpg",
      "mediaType": "album",
      "isPrimary": true,
      "sortOrder": 0,
      "auditStatus": 1,
      "width": 1080,
      "height": 1920,
      "fileSize": 2048576,
      "createdAt": "2025-11-06T10:30:00",
      "updatedAt": "2025-11-06T10:30:00"
    }
  ],
  "traceId": "a1b2c3d4..."
}
```

### å“åº”å­—æ®µè¯´æ˜

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| id | Long | å›¾ç‰‡ID |
| userId | String | ä¸šåŠ¡ç”¨æˆ·ID |
| imageUrl | String | å›¾ç‰‡URL |
| mediaType | String | å›¾ç‰‡ç±»å‹ |
| isPrimary | Boolean | æ˜¯å¦ä¸ºä¸»å›¾ç‰‡ï¼ˆå°é¢/å¤´åƒ/èƒŒæ™¯ï¼‰ |
| sortOrder | Integer | æ’åºï¼ˆç›¸å†Œä½¿ç”¨ï¼‰ |
| auditStatus | Integer | å®¡æ ¸çŠ¶æ€ï¼š0-å¾…å®¡æ ¸ 1-é€šè¿‡ 2-æ‹’ç» |
| width | Integer | å›¾ç‰‡å®½åº¦ï¼ˆåƒç´ ï¼‰ |
| height | Integer | å›¾ç‰‡é«˜åº¦ï¼ˆåƒç´ ï¼‰ |
| fileSize | Long | æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰ |

### ä¸šåŠ¡è¯´æ˜

1. **æ’åºè§„åˆ™**ï¼šä¸»å›¾ç‰‡ï¼ˆ`isPrimary=true`ï¼‰ä¼˜å…ˆï¼Œç„¶åæŒ‰ `sortOrder` å‡åº
2. **å®¡æ ¸è¿‡æ»¤**ï¼šåªè¿”å›å®¡æ ¸é€šè¿‡ï¼ˆ`auditStatus=1`ï¼‰çš„å›¾ç‰‡
3. **ç©ºåˆ—è¡¨**ï¼šå¦‚æœæ²¡æœ‰å›¾ç‰‡ï¼Œè¿”å›ç©ºæ•°ç»„ `[]`

---

## 14. åˆ é™¤å›¾ç‰‡

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`DELETE /api/media/{mediaId}`
- **æ¥å£è¯´æ˜**ï¼šåˆ é™¤æŒ‡å®šçš„å›¾ç‰‡
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
```

### è·¯å¾„å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| mediaId | Long | æ˜¯ | å›¾ç‰‡ID |

### è¯·æ±‚ç¤ºä¾‹

```bash
curl -X DELETE http://localhost:8080/api/media/12345 \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "å›¾ç‰‡åˆ é™¤æˆåŠŸ",
  "data": true,
  "traceId": "a1b2c3d4..."
}
```

### ä¸šåŠ¡è¯´æ˜

1. **æƒé™æ£€æŸ¥**ï¼šåªèƒ½åˆ é™¤è‡ªå·±çš„å›¾ç‰‡
2. **å¤´åƒå’ŒèƒŒæ™¯å¢™**ï¼šä¸èƒ½åˆ é™¤ï¼Œåªèƒ½ä¸Šä¼ æ–°çš„æ›¿æ¢
3. **é€»è¾‘åˆ é™¤**ï¼šæ•°æ®ä¸ä¼šçœŸæ­£åˆ é™¤ï¼Œåªæ˜¯æ ‡è®°ä¸ºå·²åˆ é™¤

---

## 15. è®¾ç½®ä¸»å›¾ç‰‡

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`POST /api/media/{mediaId}/set-primary`
- **æ¥å£è¯´æ˜**ï¼šè®¾ç½®æŒ‡å®šå›¾ç‰‡ä¸ºä¸»å›¾ç‰‡ï¼ˆå¤´åƒ/å°é¢/èƒŒæ™¯ï¼‰
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
```

### è·¯å¾„å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| mediaId | Long | æ˜¯ | å›¾ç‰‡ID |

### è¯·æ±‚ç¤ºä¾‹

```bash
curl -X POST http://localhost:8080/api/media/12345/set-primary \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "ä¸»å›¾ç‰‡è®¾ç½®æˆåŠŸ",
  "data": true,
  "traceId": "a1b2c3d4..."
}
```

### ä¸šåŠ¡è¯´æ˜

1. **å”¯ä¸€ä¸»å›¾ç‰‡**ï¼šåŒä¸€ç±»å‹åªèƒ½æœ‰ä¸€ä¸ªä¸»å›¾ç‰‡ï¼Œè®¾ç½®æ–°çš„ä¼šè‡ªåŠ¨å–æ¶ˆæ—§çš„
2. **é€‚ç”¨ç±»å‹**ï¼šä¸»è¦ç”¨äºç›¸å†Œè®¾ç½®å°é¢ï¼Œå¤´åƒå’ŒèƒŒæ™¯å¢™é»˜è®¤å°±æ˜¯ä¸»å›¾ç‰‡
3. **æƒé™æ£€æŸ¥**ï¼šåªèƒ½è®¾ç½®è‡ªå·±çš„å›¾ç‰‡

---

## 16. æ›´æ–°å›¾ç‰‡

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`POST /api/media/{mediaId}/update`
- **æ¥å£è¯´æ˜**ï¼šæ›´æ–°æŒ‡å®šå›¾ç‰‡çš„URLå’Œå…ƒæ•°æ®ï¼ˆç”¨äºç›¸å†Œã€åŠ¨æ€ã€æ´»åŠ¨ç­‰å›¾ç‰‡çš„æ›¿æ¢ï¼‰
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
Content-Type: application/json
```

### è·¯å¾„å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| mediaId | Long | æ˜¯ | å›¾ç‰‡ID |

### è¯·æ±‚å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| imageUrl | String | æ˜¯ | æ–°çš„å›¾ç‰‡URL |
| width | Integer | å¦ | å›¾ç‰‡å®½åº¦ï¼ˆåƒç´ ï¼‰ |
| height | Integer | å¦ | å›¾ç‰‡é«˜åº¦ï¼ˆåƒç´ ï¼‰ |
| fileSize | Long | å¦ | æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰ |

### è¯·æ±‚ç¤ºä¾‹

**ç¤ºä¾‹1ï¼šæ›´æ–°ç›¸å†Œç…§ç‰‡**
```bash
curl -X POST http://localhost:8080/api/media/12345/update \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "imageUrl": "https://your-bucket.oss.../new-photo.jpg",
    "width": 1080,
    "height": 1920,
    "fileSize": 2048576
  }'
```

**ç¤ºä¾‹2ï¼šç¼–è¾‘åŠ¨æ€å›¾ç‰‡**
```bash
# åœºæ™¯ï¼šç”¨æˆ·æƒ³æ›¿æ¢åŠ¨æ€ä¸­çš„ç¬¬2å¼ å›¾ç‰‡
# æ­¥éª¤1ï¼šå…ˆè·å–åŠ¨æ€å›¾ç‰‡åˆ—è¡¨ï¼Œæ‰¾åˆ°mediaId
curl -X GET "http://localhost:8080/api/media/list?mediaType=moment" \
  -H "Authorization: Bearer YOUR_TOKEN"

# æ­¥éª¤2ï¼šæ›´æ–°æŒ‡å®šå›¾ç‰‡
curl -X POST http://localhost:8080/api/media/78901/update \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "imageUrl": "https://your-bucket.oss.../new-moment-pic.jpg"
  }'
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "å›¾ç‰‡æ›´æ–°æˆåŠŸ",
  "data": {
    "mediaId": 12345,
    "imageUrl": "https://your-bucket.oss.../new-photo.jpg",
    "mediaType": "album",
    "isPrimary": false,
    "currentCount": null,
    "maxCount": null
  },
  "traceId": "a1b2c3d4..."
}
```

### å“åº”å­—æ®µè¯´æ˜

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| mediaId | Long | å›¾ç‰‡ID |
| imageUrl | String | æ–°çš„å›¾ç‰‡URL |
| mediaType | String | å›¾ç‰‡ç±»å‹ |
| isPrimary | Boolean | æ˜¯å¦ä¸ºä¸»å›¾ç‰‡ |
| currentCount | Integer | nullï¼ˆæ›´æ–°æ“ä½œä¸è¿”å›è®¡æ•°ï¼‰ |
| maxCount | Integer | nullï¼ˆæ›´æ–°æ“ä½œä¸è¿”å›è®¡æ•°ï¼‰ |

### ä¸šåŠ¡è¯´æ˜

1. **æƒé™æ£€æŸ¥**ï¼šåªèƒ½æ›´æ–°è‡ªå·±çš„å›¾ç‰‡
2. **é‡æ–°å®¡æ ¸**ï¼šæ›´æ–°åå›¾ç‰‡éœ€è¦é‡æ–°å®¡æ ¸ï¼ˆ`auditStatus=0`ï¼‰
3. **ä¿ç•™å±æ€§**ï¼š`mediaType`ã€`isPrimary`ã€`sortOrder` ç­‰å±æ€§ä¸ä¼šæ”¹å˜
4. **å®Œæ•´æµç¨‹**ï¼šå…ˆè°ƒç”¨OSSä¸Šä¼ æ¥å£è·å–æ–°URLï¼Œå†è°ƒç”¨æ­¤æ¥å£æ›´æ–°
5. **é€‚ç”¨åœºæ™¯**ï¼š
   - ç›¸å†Œç…§ç‰‡æ›¿æ¢
   - åŠ¨æ€å›¾ç‰‡ç¼–è¾‘
   - æ´»åŠ¨å›¾ç‰‡æ›´æ–°
6. **æ³¨æ„**ï¼š
   - å¤´åƒå’ŒèƒŒæ™¯å¢™æ— éœ€è°ƒç”¨æ­¤æ¥å£ï¼Œç›´æ¥è°ƒç”¨ `POST /api/media/save` å³å¯è‡ªåŠ¨æ›¿æ¢
   - è¯·æ±‚æ–¹æ³•ä¸º POSTï¼ˆä¾¿äºå‰ç«¯ç»Ÿä¸€å¤„ç†ï¼‰

---

## 17. è·å–æ ‡ç­¾åº“

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`GET /api/user/tags`
- **æ¥å£è¯´æ˜**ï¼šè·å–ç³»ç»Ÿæ ‡ç­¾åº“ï¼ˆæ‰€æœ‰å¯é€‰æ ‡ç­¾ï¼‰
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šå¦

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X GET http://localhost:8080/api/user/tags
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1,
      "tagName": "æ—…è¡Œ",
      "category": "å…´è¶£çˆ±å¥½",
      "icon": "icon-travel"
    },
    {
      "id": 2,
      "tagName": "å¥èº«",
      "category": "è¿åŠ¨",
      "icon": "icon-fitness"
    },
    {
      "id": 3,
      "tagName": "ç¾é£Ÿ",
      "category": "ç”Ÿæ´»",
      "icon": "icon-food"
    },
    {
      "id": 4,
      "tagName": "éŸ³ä¹",
      "category": "è‰ºæœ¯",
      "icon": "icon-music"
    },
    {
      "id": 5,
      "tagName": "ç”µå½±",
      "category": "å¨±ä¹",
      "icon": "icon-movie"
    }
  ]
}
```

### å“åº”å­—æ®µè¯´æ˜

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| id | Long | æ ‡ç­¾ID |
| tagName | String | æ ‡ç­¾åç§° |
| category | String | æ ‡ç­¾åˆ†ç±» |
| icon | String | æ ‡ç­¾å›¾æ ‡ |

---

## 18. è®¾ç½®æˆ‘çš„æ ‡ç­¾

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`POST /api/user/tags`
- **æ¥å£è¯´æ˜**ï¼šè®¾ç½®/æ›´æ–°å½“å‰ç”¨æˆ·çš„å…´è¶£æ ‡ç­¾
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
Content-Type: application/json
```

### è¯·æ±‚å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| tagIds | Array | æ˜¯ | æ ‡ç­¾IDåˆ—è¡¨ï¼ˆæœ€å¤š10ä¸ªï¼‰ |

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X POST http://localhost:8080/api/user/tags \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "tagIds": [1, 2, 3, 5, 8]
  }'
```

**è¯·æ±‚Body**ï¼š
```json
{
  "tagIds": [1, 2, 3, 5, 8]
}
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "æ ‡ç­¾è®¾ç½®æˆåŠŸ",
  "data": true
}
```

### ä¸šåŠ¡è¯´æ˜

1. **è¦†ç›–å¼æ›´æ–°**ï¼šæ–°æ ‡ç­¾ä¼šè¦†ç›–æ—§æ ‡ç­¾
2. **æ•°é‡é™åˆ¶**ï¼šæœ€å¤šé€‰æ‹©10ä¸ªæ ‡ç­¾
3. **å¿…å¡«é¡¹æ£€æŸ¥**ï¼šè‡³å°‘éœ€è¦1ä¸ªæ ‡ç­¾
4. **è‡ªåŠ¨æ›´æ–°å®Œå–„åº¦**ï¼šè®¾ç½®æ ‡ç­¾åä¼šå½±å“èµ„æ–™å®Œå–„çŠ¶æ€

---

## 19. æ›´æ–°éšç§è®¾ç½®

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`POST /api/user/privacy`
- **æ¥å£è¯´æ˜**ï¼šæ›´æ–°ç”¨æˆ·çš„éšç§è®¾ç½®
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
Content-Type: application/json
```

### è¯·æ±‚å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| whoCanSeeMe | Integer | å¦ | è°å¯ä»¥çœ‹æˆ‘ï¼ˆ1-æ‰€æœ‰äººï¼Œ2-ä»…åŒ¹é…çš„äººï¼Œ3-å…³é—­ï¼‰ |
| showDistance | Integer | å¦ | æ˜¾ç¤ºè·ç¦»ï¼ˆ0-å¦ï¼Œ1-æ˜¯ï¼‰ |
| showOnlineStatus | Integer | å¦ | æ˜¾ç¤ºåœ¨çº¿çŠ¶æ€ï¼ˆ0-å¦ï¼Œ1-æ˜¯ï¼‰ |

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X POST http://localhost:8080/api/user/privacy \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "whoCanSeeMe": 2,
    "showDistance": 1,
    "showOnlineStatus": 0
  }'
```

**è¯·æ±‚Body**ï¼š
```json
{
  "whoCanSeeMe": 2,
  "showDistance": 1,
  "showOnlineStatus": 0
}
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "éšç§è®¾ç½®æˆåŠŸ",
  "data": true
}
```

### ä¸šåŠ¡è¯´æ˜

1. **éƒ¨åˆ†æ›´æ–°**ï¼šåªæ›´æ–°æä¾›çš„å­—æ®µ
2. **é»˜è®¤å€¼**ï¼šé¦–æ¬¡è®¾ç½®æ—¶ï¼Œæœªæä¾›çš„å­—æ®µä½¿ç”¨é»˜è®¤å€¼ï¼ˆwhoCanSeeMe=1, showDistance=1, showOnlineStatus=1ï¼‰
3. **ç«‹å³ç”Ÿæ•ˆ**ï¼šè®¾ç½®åç«‹å³å½±å“å…¶ä»–ç”¨æˆ·æŸ¥çœ‹ä½ çš„èµ„æ–™

---

## 20. è·å–éšç§è®¾ç½®

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`GET /api/user/privacy`
- **æ¥å£è¯´æ˜**ï¼šè·å–å½“å‰ç”¨æˆ·çš„éšç§è®¾ç½®
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
```

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X GET http://localhost:8080/api/user/privacy \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "whoCanSeeMe": 2,
    "showDistance": 1,
    "showOnlineStatus": 0
  }
}
```

### å“åº”å­—æ®µè¯´æ˜

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| whoCanSeeMe | Integer | è°å¯ä»¥çœ‹æˆ‘ï¼ˆ1-æ‰€æœ‰äººï¼Œ2-ä»…åŒ¹é…çš„äººï¼Œ3-å…³é—­ï¼‰ |
| showDistance | Integer | æ˜¾ç¤ºè·ç¦»ï¼ˆ0-å¦ï¼Œ1-æ˜¯ï¼‰ |
| showOnlineStatus | Integer | æ˜¾ç¤ºåœ¨çº¿çŠ¶æ€ï¼ˆ0-å¦ï¼Œ1-æ˜¯ï¼‰ |

---

## 21. æ‹‰é»‘ç”¨æˆ·

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`POST /api/user/blacklist/{blockedUserId}`
- **æ¥å£è¯´æ˜**ï¼šå°†æŒ‡å®šç”¨æˆ·åŠ å…¥é»‘åå•
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
```

### è·¯å¾„å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| blockedUserId | String | æ˜¯ | è¦æ‹‰é»‘çš„ç”¨æˆ·IDï¼ˆä¸šåŠ¡ç”¨æˆ·IDï¼Œå¦‚ï¼šU1699123456789AB12CDï¼‰ |

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X POST http://localhost:8080/api/user/blacklist/U1699234567890CD34EF \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "æ‹‰é»‘æˆåŠŸ",
  "data": true
}
```

### ä¸šåŠ¡è¯´æ˜

1. **åŒå‘éš”ç¦»**ï¼šæ‹‰é»‘åï¼ŒåŒæ–¹éƒ½æ— æ³•çœ‹åˆ°å¯¹æ–¹çš„åŠ¨æ€å’Œèµ„æ–™
2. **è‡ªåŠ¨å–æ¶ˆå…³æ³¨**ï¼šæ‹‰é»‘åè‡ªåŠ¨å–æ¶ˆå…³æ³¨å’Œç²‰ä¸å…³ç³»
3. **èŠå¤©é™åˆ¶**ï¼šæ‹‰é»‘åæ— æ³•äº’ç›¸å‘é€æ¶ˆæ¯
4. **é‡å¤æ‹‰é»‘**ï¼šé‡å¤æ‹‰é»‘åŒä¸€ç”¨æˆ·ä¼šè¿”å›æˆåŠŸï¼ˆå¹‚ç­‰æ“ä½œï¼‰

---

## 22. ç§»é™¤é»‘åå•

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`DELETE /api/user/blacklist/{blockedUserId}`
- **æ¥å£è¯´æ˜**ï¼šå°†æŒ‡å®šç”¨æˆ·ä»é»‘åå•ç§»é™¤
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
```

### è·¯å¾„å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| blockedUserId | String | æ˜¯ | è¦ç§»é™¤çš„ç”¨æˆ·IDï¼ˆä¸šåŠ¡ç”¨æˆ·IDï¼Œå¦‚ï¼šU1699123456789AB12CDï¼‰ |

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X DELETE http://localhost:8080/api/user/blacklist/U1699234567890CD34EF \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "ç§»é™¤æˆåŠŸ",
  "data": true
}
```

### ä¸šåŠ¡è¯´æ˜

1. **æ¢å¤å¯è§**ï¼šç§»é™¤åï¼ŒåŒæ–¹å¯ä»¥é‡æ–°çœ‹åˆ°å¯¹æ–¹çš„èµ„æ–™
2. **ä¸æ¢å¤å…³æ³¨**ï¼šç§»é™¤é»‘åå•ä¸ä¼šè‡ªåŠ¨æ¢å¤ä¹‹å‰çš„å…³æ³¨å…³ç³»
3. **é‡å¤ç§»é™¤**ï¼šé‡å¤ç§»é™¤åŒä¸€ç”¨æˆ·ä¼šè¿”å›æˆåŠŸï¼ˆå¹‚ç­‰æ“ä½œï¼‰

---

## 23. è®¾ç½®åŒ¹é…åå¥½

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`POST /api/matching/preference`
- **æ¥å£è¯´æ˜**ï¼šè®¾ç½®ç”¨æˆ·çš„åŒ¹é…åå¥½æ¡ä»¶
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
Content-Type: application/json
```

### è¯·æ±‚å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| minAge | Integer | å¦ | æœŸæœ›æœ€å°å¹´é¾„ï¼ˆèŒƒå›´18-100ï¼‰ |
| maxAge | Integer | å¦ | æœŸæœ›æœ€å¤§å¹´é¾„ï¼ˆèŒƒå›´18-100ï¼‰ |
| minHeight | Integer | å¦ | æœŸæœ›æœ€å°èº«é«˜ï¼ˆèŒƒå›´100-250ï¼‰ |
| maxHeight | Integer | å¦ | æœŸæœ›æœ€å¤§èº«é«˜ï¼ˆèŒƒå›´100-250ï¼‰ |
| education | String | å¦ | æœŸæœ›å­¦å†ï¼ˆå¤šä¸ªç”¨é€—å·åˆ†éš”ï¼‰ |
| incomeRange | String | å¦ | æœŸæœ›æ”¶å…¥èŒƒå›´ |
| maxDistance | Integer | å¦ | æœ€å¤§è·ç¦»ï¼ˆkmï¼ŒèŒƒå›´1-1000ï¼‰ |
| locationLatitude | BigDecimal | å¦ | ç”¨æˆ·çº¬åº¦ |
| locationLongitude | BigDecimal | å¦ | ç”¨æˆ·ç»åº¦ |

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X POST http://localhost:8080/api/matching/preference \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "minAge": 20,
    "maxAge": 35,
    "minHeight": 160,
    "maxHeight": 180,
    "education": "æœ¬ç§‘,ç¡•å£«",
    "incomeRange": "10-20ä¸‡",
    "maxDistance": 10,
    "locationLatitude": 39.908823,
    "locationLongitude": 116.397470
  }'
```

**è¯·æ±‚Body**ï¼š
```json
{
  "minAge": 20,
  "maxAge": 35,
  "minHeight": 160,
  "maxHeight": 180,
  "education": "æœ¬ç§‘,ç¡•å£«",
  "incomeRange": "10-20ä¸‡",
  "maxDistance": 10,
  "locationLatitude": 39.908823,
  "locationLongitude": 116.397470
}
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "åŒ¹é…åå¥½è®¾ç½®æˆåŠŸ",
  "data": true
}
```

### ä¸šåŠ¡è¯´æ˜

1. **è‡ªåŠ¨æ›´æ–°æ ‡å¿—ä½**ï¼šè®¾ç½®æˆåŠŸåï¼Œè‡ªåŠ¨å°†`match_preference_set=1`
2. **æ”¯æŒéƒ¨åˆ†æ›´æ–°**ï¼šæ‰€æœ‰å‚æ•°éƒ½æ˜¯å¯é€‰çš„ï¼Œåªæ›´æ–°æä¾›çš„å­—æ®µ
3. **è¦†ç›–å¼æ›´æ–°**ï¼šæ–°çš„è®¾ç½®ä¼šè¦†ç›–æ—§çš„è®¾ç½®

---

## 24. è·å–åŒ¹é…åå¥½

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`GET /api/matching/preference`
- **æ¥å£è¯´æ˜**ï¼šè·å–å½“å‰ç”¨æˆ·çš„åŒ¹é…åå¥½è®¾ç½®
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
```

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X GET http://localhost:8080/api/matching/preference \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### å“åº”ç¤ºä¾‹

**å·²è®¾ç½®åå¥½æ—¶**ï¼š
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "userId": "U1699123456789AB12CD",
    "minAge": 20,
    "maxAge": 35,
    "minHeight": 160,
    "maxHeight": 180,
    "education": "æœ¬ç§‘,ç¡•å£«",
    "incomeRange": "10-20ä¸‡",
    "maxDistance": 10,
    "locationLatitude": 39.908823,
    "locationLongitude": 116.397470
  }
}
```

**æœªè®¾ç½®åå¥½æ—¶**ï¼š
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "userId": "U1699123456789AB12CD",
    "minAge": null,
    "maxAge": null,
    "minHeight": null,
    "maxHeight": null,
    "education": null,
    "incomeRange": null,
    "maxDistance": null,
    "locationLatitude": null,
    "locationLongitude": null
  }
}
```

---

## 25. è·å–æ¨èç”¨æˆ·åˆ—è¡¨

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`GET /api/matching/recommend`
- **æ¥å£è¯´æ˜**ï¼šåŸºäºæ™ºèƒ½ç®—æ³•è·å–åŒ¹é…æ¨èåˆ—è¡¨
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
```

### è¯·æ±‚å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| page | Integer | å¦ | é¡µç ï¼Œé»˜è®¤1 |
| size | Integer | å¦ | æ¯é¡µæ•°é‡ï¼Œé»˜è®¤10 |

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X GET "http://localhost:8080/api/matching/recommend?page=1&size=10" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### å“åº”ç¤ºä¾‹

**æˆåŠŸå“åº”**ï¼š
```json
{
  "code": 200,
  "message": "æ¨èåˆ—è¡¨è·å–æˆåŠŸ",
  "data": {
    "records": [
      {
        "userId": "U1699123456789AB12CD",
        "nickname": "å°çº¢",
        "avatar": "https://example.com/avatar.jpg",
        "age": 25,
        "gender": 2,
        "height": 165,
        "occupation": "äº§å“ç»ç†",
        "education": "æœ¬ç§‘",
        "incomeRange": "10-20ä¸‡",
        "city": "åŒ—äº¬",
        "distance": 1500,
        "distanceText": "1.5km",
        "bio": "çƒ­çˆ±ç”Ÿæ´»ï¼Œå–œæ¬¢æ—…è¡Œå’Œç¾é£Ÿ",
        "interestTags": ["æ—…è¡Œ", "ç¾é£Ÿ", "å¥èº«"],
        "photos": [
          "https://example.com/photo1.jpg",
          "https://example.com/photo2.jpg"
        ],
        "matchScore": 85.5,
        "onlineStatus": 1,
        "isRealNameVerified": 1,
        "isLiked": 0,
        "likedMe": 0
      }
    ],
    "total": 100,
    "size": 10,
    "current": 1,
    "pages": 10
  }
}
```

**é”™è¯¯å“åº”**ï¼š
```json
{
  "code": 40404,
  "message": "ç”¨æˆ·èµ„æ–™æœªå®Œå–„",
  "data": null
}
```

### åŒ¹é…ç®—æ³•è¯´æ˜

ç³»ç»Ÿé‡‡ç”¨å¤šç»´åº¦è¯„åˆ†ç®—æ³•è®¡ç®—åŒ¹é…åˆ†æ•°ï¼š

| ç»´åº¦ | æƒé‡ | è¯´æ˜ |
|------|------|------|
| åœ°ç†ä½ç½® | 30% | è·ç¦»è¶Šè¿‘åˆ†æ•°è¶Šé«˜ |
| å…´è¶£æ ‡ç­¾ | 25% | Jaccardç›¸ä¼¼åº¦ç®—æ³• |
| å¹´é¾„åŒ¹é… | 20% | ç¬¦åˆåå¥½èŒƒå›´ä¸”å¹´é¾„å·®è·å° |
| åŸºæœ¬ä¿¡æ¯ | 15% | èº«é«˜ã€å­¦å†ã€æ”¶å…¥ç­‰ |
| æ´»è·ƒåº¦ | 10% | åœ¨çº¿çŠ¶æ€å’Œæœ€åç™»å½•æ—¶é—´ |

---

## 26. å–œæ¬¢æ“ä½œ

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`POST /api/matching/like`
- **æ¥å£è¯´æ˜**ï¼šå¯¹æ¨èç”¨æˆ·è¿›è¡Œå–œæ¬¢æ“ä½œï¼Œå¦‚æœå¯¹æ–¹ä¹Ÿå–œæ¬¢åˆ™åŒ¹é…æˆåŠŸ
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
Content-Type: application/json
```

### è¯·æ±‚ä½“

```json
{
  "toUserId": "U1699123456789AB12CD"
}
```

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| toUserId | String | æ˜¯ | ç›®æ ‡ç”¨æˆ·IDï¼ˆä¸šåŠ¡ç”¨æˆ·IDï¼‰ |

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X POST http://localhost:8080/api/matching/like \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"toUserId": "U1699123456789AB12CD"}'
```

### å“åº”ç¤ºä¾‹

**åŒå‘åŒ¹é…æˆåŠŸ**ï¼š
```json
{
  "code": 200,
  "message": "åŒ¹é…æˆåŠŸï¼ä½ ä»¬å¯ä»¥å¼€å§‹èŠå¤©äº†",
  "data": {
    "matched": true,
    "matchType": 1,
    "toUserId": "U1699123456789AB12CD",
    "toUserNickname": "å°çº¢",
    "toUserAvatar": "https://example.com/avatar.jpg",
    "message": "åŒ¹é…æˆåŠŸï¼ä½ ä»¬å¯ä»¥å¼€å§‹èŠå¤©äº†",
    "remainingLikes": 4,
    "remainingSuperLikes": 1
  }
}
```

**å•å‘å–œæ¬¢ï¼ˆæœªåŒ¹é…ï¼‰**ï¼š
```json
{
  "code": 200,
  "message": "å·²å‘é€å–œæ¬¢",
  "data": {
    "matched": false,
    "matchType": 1,
    "toUserId": "U1699123456789AB12CD",
    "toUserNickname": "å°çº¢",
    "toUserAvatar": "https://example.com/avatar.jpg",
    "message": "å·²å‘é€å–œæ¬¢",
    "remainingLikes": 4,
    "remainingSuperLikes": 1
  }
}
```

**é”™è¯¯å“åº”**ï¼š
```json
{
  "code": 40501,
  "message": "ä»Šæ—¥å…è´¹å–œæ¬¢æ¬¡æ•°å·²ç”¨å®Œï¼Œå‡çº§VIPäº«å—æ— é™æ¬¡æ•°",
  "data": null
}
```

---

## 27. è¶…çº§å–œæ¬¢æ“ä½œ

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`POST /api/matching/super-like`
- **æ¥å£è¯´æ˜**ï¼šå¯¹æ¨èç”¨æˆ·è¿›è¡Œè¶…çº§å–œæ¬¢æ“ä½œï¼Œè®©å¯¹æ–¹ä¼˜å…ˆçœ‹åˆ°ä½ 
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
Content-Type: application/json
```

### è¯·æ±‚ä½“

```json
{
  "toUserId": "U1699123456789AB12CD"
}
```

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| toUserId | String | æ˜¯ | ç›®æ ‡ç”¨æˆ·IDï¼ˆä¸šåŠ¡ç”¨æˆ·IDï¼‰ |

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X POST http://localhost:8080/api/matching/super-like \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"toUserId": "U1699123456789AB12CD"}'
```

### å“åº”ç¤ºä¾‹

**åŒ¹é…æˆåŠŸ**ï¼š
```json
{
  "code": 200,
  "message": "è¶…çº§åŒ¹é…æˆåŠŸï¼ä½ ä»¬å¯ä»¥å¼€å§‹èŠå¤©äº†",
  "data": {
    "matched": true,
    "matchType": 2,
    "toUserId": "U1699123456789AB12CD",
    "toUserNickname": "å°çº¢",
    "toUserAvatar": "https://example.com/avatar.jpg",
    "message": "è¶…çº§åŒ¹é…æˆåŠŸï¼ä½ ä»¬å¯ä»¥å¼€å§‹èŠå¤©äº†",
    "remainingLikes": 5,
    "remainingSuperLikes": 0
  }
}
```

**æœªåŒ¹é…**ï¼š
```json
{
  "code": 200,
  "message": "å·²å‘é€è¶…çº§å–œæ¬¢ï¼Œå¯¹æ–¹ä¼šä¼˜å…ˆçœ‹åˆ°ä½ ",
  "data": {
    "matched": false,
    "matchType": 2,
    "toUserId": "U1699123456789AB12CD",
    "toUserNickname": "å°çº¢",
    "toUserAvatar": "https://example.com/avatar.jpg",
    "message": "å·²å‘é€è¶…çº§å–œæ¬¢ï¼Œå¯¹æ–¹ä¼šä¼˜å…ˆçœ‹åˆ°ä½ ",
    "remainingLikes": 5,
    "remainingSuperLikes": 0
  }
}
```

**é”™è¯¯å“åº”**ï¼š
```json
{
  "code": 40502,
  "message": "ä»Šæ—¥è¶…çº§å–œæ¬¢æ¬¡æ•°å·²ç”¨å®Œï¼Œå‡çº§VIPè·å–æ›´å¤šæ¬¡æ•°",
  "data": null
}
```

---

## 28. è·³è¿‡æ“ä½œ

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`POST /api/matching/pass`
- **æ¥å£è¯´æ˜**ï¼šè·³è¿‡å½“å‰æ¨èç”¨æˆ·
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
Content-Type: application/json
```

### è¯·æ±‚ä½“

```json
{
  "toUserId": "U1699123456789AB12CD"
}
```

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| toUserId | String | æ˜¯ | ç›®æ ‡ç”¨æˆ·IDï¼ˆä¸šåŠ¡ç”¨æˆ·IDï¼‰ |

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X POST http://localhost:8080/api/matching/pass \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"toUserId": "U1699123456789AB12CD"}'
```

### å“åº”ç¤ºä¾‹

**æˆåŠŸå“åº”**ï¼š
```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": "æ“ä½œæˆåŠŸ"
}
```

---

## 29. æŸ¥çœ‹è°å–œæ¬¢æˆ‘

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`GET /api/matching/liked-me`
- **æ¥å£è¯´æ˜**ï¼šæŸ¥çœ‹å–œæ¬¢æˆ‘çš„ç”¨æˆ·åˆ—è¡¨
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
```

### è¯·æ±‚å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| page | Integer | å¦ | é¡µç ï¼Œé»˜è®¤1 |
| size | Integer | å¦ | æ¯é¡µæ•°é‡ï¼Œé»˜è®¤10 |

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X GET "http://localhost:8080/api/matching/liked-me?page=1&size=10" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### å“åº”ç¤ºä¾‹

**æˆåŠŸå“åº”**ï¼š
```json
{
  "code": 200,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "records": [
      {
        "userId": "U1699123456789AB12CD",
        "nickname": "å°æ˜",
        "avatar": "https://example.com/avatar.jpg",
        "age": 28,
        "gender": 1,
        "height": 178,
        "occupation": "è½¯ä»¶å·¥ç¨‹å¸ˆ",
        "education": "æœ¬ç§‘",
        "incomeRange": "20-30ä¸‡",
        "city": "åŒ—äº¬",
        "distance": 2500,
        "distanceText": "2.5km",
        "bio": "çƒ­çˆ±ç¼–ç¨‹å’Œè¿åŠ¨",
        "interestTags": ["ç¼–ç¨‹", "è¿åŠ¨", "æ—…è¡Œ"],
        "photos": ["https://example.com/photo1.jpg"],
        "matchScore": 88.0,
        "onlineStatus": 1,
        "isRealNameVerified": 1,
        "isLiked": 0,
        "likedMe": 1
      }
    ],
    "total": 15,
    "size": 10,
    "current": 1,
    "pages": 2
  }
}
```

---

## 30. è·å–åŒ¹é…é™åˆ¶ä¿¡æ¯

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`GET /api/matching/limit-info`
- **æ¥å£è¯´æ˜**ï¼šè·å–å½“å‰ç”¨æˆ·çš„åŒ¹é…é™åˆ¶ä¿¡æ¯
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
```

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X GET http://localhost:8080/api/matching/limit-info \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### å“åº”ç¤ºä¾‹

**éVIPç”¨æˆ·**ï¼š
```json
{
  "code": 200,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "isVip": false,
    "remainingLikes": 3,
    "remainingSuperLikes": 1,
    "dailyFreeLikesLimit": 5,
    "dailySuperLikesLimit": 1,
    "reachedLimit": false
  }
}
```

**VIPç”¨æˆ·**ï¼š
```json
{
  "code": 200,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "isVip": true,
    "remainingLikes": 999,
    "remainingSuperLikes": 1,
    "dailyFreeLikesLimit": 999,
    "dailySuperLikesLimit": 1,
    "reachedLimit": false
  }
}
```

---

## æ¥å£é€ŸæŸ¥è¡¨

| åºå· | æ¥å£è·¯å¾„ | æ–¹æ³• | è¯´æ˜ | è®¤è¯ |
|------|---------|------|------|------|
| 1 | `/api/auth/wx/login` | POST | å¾®ä¿¡ç™»å½• | âŒ |
| 2 | `/api/auth/test/token` | POST | ç”Ÿæˆæµ‹è¯•Token | âŒ |
| 3 | `/api/auth/token/validate` | GET | æ ¡éªŒToken | âœ… |
| 4 | `/api/user/profile` | POST | å®Œå–„èµ„æ–™ | âœ… |
| 5 | `/api/user/profile/update` | POST | æ›´æ–°èµ„æ–™ | âœ… |
| 6 | `/api/user/profile` | GET | æŸ¥çœ‹æˆ‘çš„èµ„æ–™ | âœ… |
| 7 | `/api/user/profile/{userId}` | GET | æŸ¥çœ‹ä»–äººèµ„æ–™ | âœ… |
| 8 | `/api/user/profile/status` | GET | æŸ¥çœ‹èµ„æ–™å®Œå–„çŠ¶æ€ | âœ… |
| 9 | `/api/user/stats` | GET | è·å–ç”¨æˆ·ç»Ÿè®¡æ•°æ® | âœ… |
| 10 | `/api/verification/submit` | POST | æäº¤å®åè®¤è¯ | âœ… |
| 11 | `/api/verification/status` | GET | æŸ¥è¯¢å®åè®¤è¯çŠ¶æ€ | âœ… |
| 12 | `/api/user/album/upload` | POST | ä¸Šä¼ ç…§ç‰‡ | âœ… |
| 13 | `/api/user/album/{photoId}` | DELETE | åˆ é™¤ç…§ç‰‡ | âœ… |
| 14 | `/api/user/album/cover/{photoId}` | POST | è®¾ç½®å°é¢ç…§ç‰‡ | âœ… |
| 15 | `/api/user/tags` | GET | è·å–æ ‡ç­¾åº“ | âŒ |
| 16 | `/api/user/tags` | POST | è®¾ç½®æˆ‘çš„æ ‡ç­¾ | âœ… |
| 17 | `/api/user/privacy` | POST | æ›´æ–°éšç§è®¾ç½® | âœ… |
| 18 | `/api/user/privacy` | GET | è·å–éšç§è®¾ç½® | âœ… |
| 19 | `/api/user/blacklist/{blockedUserId}` | POST | æ‹‰é»‘ç”¨æˆ· | âœ… |
| 20 | `/api/user/blacklist/{blockedUserId}` | DELETE | ç§»é™¤é»‘åå• | âœ… |
| 21 | `/api/matching/preference` | POST | è®¾ç½®åŒ¹é…åå¥½ | âœ… |
| 22 | `/api/matching/preference` | GET | è·å–åŒ¹é…åå¥½ | âœ… |
| 23 | `/api/matching/recommend` | GET | è·å–æ¨èç”¨æˆ·åˆ—è¡¨ | âœ… |
| 24 | `/api/matching/like` | POST | å–œæ¬¢æ“ä½œ | âœ… |
| 25 | `/api/matching/super-like` | POST | è¶…çº§å–œæ¬¢æ“ä½œ | âœ… |
| 26 | `/api/matching/pass` | POST | è·³è¿‡æ“ä½œ | âœ… |
| 27 | `/api/matching/liked-me` | GET | æŸ¥çœ‹è°å–œæ¬¢æˆ‘ | âœ… |
| 28 | `/api/matching/limit-info` | GET | è·å–åŒ¹é…é™åˆ¶ä¿¡æ¯ | âœ… |
| 29 | `/api/oss/upload` | POST | ä¸Šä¼ å›¾ç‰‡ï¼ˆæ–‡ä»¶ï¼‰ | âœ… |
| 30 | `/api/oss/upload/base64` | POST | ä¸Šä¼ å›¾ç‰‡ï¼ˆBase64ï¼‰ | âœ… |
| 31 | `/api/oss/batch-upload` | POST | æ‰¹é‡ä¸Šä¼ å›¾ç‰‡ | âœ… |
| 32 | `/api/oss/delete` | DELETE | åˆ é™¤OSSå›¾ç‰‡ | âœ… |
| 33 | `/api/oss/sign-url` | GET | è·å–å›¾ç‰‡ç­¾åURL | âœ… |

---

## å®Œæ•´æµ‹è¯•æµç¨‹

### Step 1: å¾®ä¿¡ç™»å½•
```bash
curl -X POST http://localhost:8080/api/auth/wx/login \
  -H "Content-Type: application/json" \
  -d '{"code": "test_code_12345"}'
```

**è·å–token**ï¼šä»å“åº”ä¸­æå–`data.token`

### Step 2: å®Œå–„èµ„æ–™
```bash
TOKEN="ä»ä¸Šä¸€æ­¥è·å–çš„token"

curl -X POST http://localhost:8080/api/user/profile \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TOKEN" \
  -d '{
    "nickname": "æµ‹è¯•ç”¨æˆ·",
    "avatar": "https://example.com/avatar.jpg",
    "gender": 2,
    "birthday": "1998-05-20",
    "tagIds": [1, 5, 8]
  }'
```

### Step 3: æ£€æŸ¥èµ„æ–™çŠ¶æ€
```bash
curl -X GET http://localhost:8080/api/user/profile/status \
  -H "Authorization: Bearer $TOKEN"
```

### Step 4: è®¾ç½®åŒ¹é…åå¥½
```bash
curl -X POST http://localhost:8080/api/matching/preference \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TOKEN" \
  -d '{
    "minAge": 20,
    "maxAge": 35,
    "maxDistance": 10
  }'
```

### Step 5: ä¸Šä¼ ç…§ç‰‡
```bash
curl -X POST http://localhost:8080/api/user/album/upload \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TOKEN" \
  -d '{
    "photoUrl": "https://example.com/photo1.jpg",
    "isCover": true
  }'
```

### Step 6: è·å–æ ‡ç­¾åº“å¹¶è®¾ç½®æ ‡ç­¾
```bash
# è·å–æ ‡ç­¾åº“
curl -X GET http://localhost:8080/api/user/tags

# è®¾ç½®æˆ‘çš„æ ‡ç­¾
curl -X POST http://localhost:8080/api/user/tags \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TOKEN" \
  -d '{
    "tagIds": [1, 2, 3, 5]
  }'
```

### Step 7: è®¾ç½®éšç§
```bash
curl -X POST http://localhost:8080/api/user/privacy \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TOKEN" \
  -d '{
    "whoCanSeeMe": 2,
    "showDistance": 1,
    "showOnlineStatus": 0
  }'
```

### Step 8: æŸ¥çœ‹ä»–äººèµ„æ–™
```bash
curl -X GET http://localhost:8080/api/user/profile/1002 \
  -H "Authorization: Bearer $TOKEN"
```

### Step 9: éªŒè¯çŠ¶æ€
```bash
# å†æ¬¡ç™»å½•ï¼ŒæŸ¥çœ‹æ ‡å¿—ä½
curl -X POST http://localhost:8080/api/auth/wx/login \
  -H "Content-Type: application/json" \
  -d '{"code": "test_code_12345"}'
```

**é¢„æœŸç»“æœ**ï¼š
```json
{
  "profileComplete": 1,
  "matchPreferenceSet": 1
}
```

---

## é”™è¯¯ç è¯´æ˜

| é”™è¯¯ç  | è¯´æ˜ |
|--------|------|
| 200 | æˆåŠŸ |
| 400 | è¯·æ±‚å‚æ•°é”™è¯¯ |
| 401 | æœªç™»å½•æˆ–tokenæ— æ•ˆ |
| 404 | ç”¨æˆ·ä¸å­˜åœ¨ |
| 40001 | ç…§ç‰‡æ•°é‡è¶…é™ |
| 40002 | æ ‡ç­¾æ•°é‡è¶…é™ï¼ˆæœ€å¤š10ä¸ªï¼‰ |
| 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ |

---

## å¸¸è§é—®é¢˜

### 1. ä¸ºä»€ä¹ˆæˆ‘è®¾ç½®äº†èµ„æ–™ï¼ŒprofileCompleteè¿˜æ˜¯0ï¼Ÿ

**å¯èƒ½åŸå› **ï¼š
- æ€§åˆ«ä¸º0ï¼ˆæœªçŸ¥ï¼‰
- ç¼ºå°‘å…´è¶£æ ‡ç­¾
- æ˜µç§°ã€å¤´åƒã€ç”Ÿæ—¥æœªå¡«å†™

**è§£å†³æ–¹æ¡ˆ**ï¼šè°ƒç”¨`/api/user/profile/status`æŸ¥çœ‹ç¼ºå¤±å­—æ®µ

### 2. å¯ä»¥åªæ›´æ–°éƒ¨åˆ†å­—æ®µå—ï¼Ÿ

**å¯ä»¥ï¼** æ‰€æœ‰å­—æ®µéƒ½æ˜¯å¯é€‰çš„ï¼Œåªæ›´æ–°æä¾›çš„å­—æ®µã€‚

### 3. æ ‡ç­¾æœ€å¤šå¯ä»¥é€‰å‡ ä¸ªï¼Ÿ

**æœ€å¤š10ä¸ª**ã€‚å®Œå–„èµ„æ–™æ—¶è‡³å°‘é€‰1ä¸ªï¼Œå¦åˆ™profileCompleteä¸ä¼šå˜ä¸º1ã€‚

### 4. æ€§åˆ«å¯ä»¥è®¾ç½®ä¸º0ï¼ˆæœªçŸ¥ï¼‰å—ï¼Ÿ

**å¯ä»¥è®¾ç½®ï¼Œä½†ä¸ç®—å®Œå–„ã€‚** èµ„æ–™å®Œå–„åˆ¤æ–­æ—¶ï¼Œæ€§åˆ«å¿…é¡»æ˜¯1æˆ–2ã€‚

### 5. å®Œå–„èµ„æ–™å’Œæ›´æ–°èµ„æ–™æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**æ²¡æœ‰æœ¬è´¨åŒºåˆ«**ã€‚ä¸¤ä¸ªæ¥å£éƒ½è°ƒç”¨åŒä¸€ä¸ªserviceæ–¹æ³•ï¼Œåªæ˜¯è·¯å¾„å’Œè¿”å›æ¶ˆæ¯ä¸åŒï¼š
- `/api/user/profile` - è¿”å›"èµ„æ–™ä¿å­˜æˆåŠŸ"
- `/api/user/profile/update` - è¿”å›"èµ„æ–™æ›´æ–°æˆåŠŸ"

### 6. ç…§ç‰‡æœ€å¤šå¯ä»¥ä¸Šä¼ å‡ å¼ ï¼Ÿ

**æœ€å¤š9å¼ **ã€‚è¶…è¿‡é™åˆ¶ä¼šè¿”å›é”™è¯¯ç 40001ã€‚

### 7. å¦‚ä½•æŸ¥çœ‹ä»–äººèµ„æ–™ï¼Ÿ

ä½¿ç”¨ `GET /api/user/profile/{userId}`ï¼Œä¼šæ ¹æ®å¯¹æ–¹çš„éšç§è®¾ç½®è¿”å›ç›¸åº”ä¿¡æ¯ã€‚

### 8. æ‹‰é»‘ç”¨æˆ·åä¼šæœ‰ä»€ä¹ˆå½±å“ï¼Ÿ

- åŒæ–¹æ— æ³•çœ‹åˆ°å¯¹æ–¹çš„åŠ¨æ€å’Œèµ„æ–™
- è‡ªåŠ¨å–æ¶ˆå…³æ³¨å’Œç²‰ä¸å…³ç³»
- æ— æ³•äº’ç›¸å‘é€æ¶ˆæ¯

### 9. éšç§è®¾ç½®ä¸­"è°å¯ä»¥çœ‹æˆ‘"çš„é€‰é¡¹è¯´æ˜ï¼Ÿ

- **1-æ‰€æœ‰äºº**ï¼šä»»ä½•ç”¨æˆ·éƒ½å¯ä»¥æŸ¥çœ‹ä½ çš„èµ„æ–™
- **2-ä»…åŒ¹é…çš„äºº**ï¼šåªæœ‰åŒ¹é…æˆåŠŸçš„ç”¨æˆ·å¯ä»¥æŸ¥çœ‹
- **3-å…³é—­**ï¼šå…³é—­èµ„æ–™å±•ç¤ºï¼Œå…¶ä»–äººæ— æ³•æŸ¥çœ‹

---

## é™„å½•ï¼šå‰ç«¯é›†æˆç¤ºä¾‹

### å°ç¨‹åºç™»å½•å¼•å¯¼é€»è¾‘

```javascript
// ç™»å½•
wx.request({
  url: 'http://localhost:8080/api/auth/wx/login',
  method: 'POST',
  data: { code: wxCode },
  success: (res) => {
    const { profileComplete, matchPreferenceSet, token } = res.data.data;
    
    // ä¿å­˜token
    wx.setStorageSync('token', token);
    
    // æ ¹æ®çŠ¶æ€å¼•å¯¼
    if (profileComplete === 0) {
      // å¼•å¯¼å®Œå–„èµ„æ–™
      wx.navigateTo({ url: '/pages/profile-setup/index' });
    } else if (matchPreferenceSet === 0) {
      // å¼•å¯¼è®¾ç½®åŒ¹é…åå¥½
      wx.navigateTo({ url: '/pages/matching-preference/index' });
    } else {
      // è¿›å…¥ä¸»é¡µ
      wx.switchTab({ url: '/pages/home/index' });
    }
  }
});
```

### æäº¤å®Œå–„èµ„æ–™

```javascript
wx.request({
  url: 'http://localhost:8080/api/user/profile',
  method: 'POST',
  header: {
    'Authorization': `Bearer ${wx.getStorageSync('token')}`
  },
  data: {
    nickname: 'å°é›¨',
    avatar: 'https://...',
    gender: 2,
    birthday: '1998-05-20',
    tagIds: [1, 5, 8]
  },
  success: (res) => {
    wx.showToast({ title: 'èµ„æ–™ä¿å­˜æˆåŠŸ' });
    // å¼•å¯¼è®¾ç½®åŒ¹é…åå¥½
    wx.navigateTo({ url: '/pages/matching-preference/index' });
  }
});
```

### ä¸Šä¼ ç…§ç‰‡

```javascript
// 1. é€‰æ‹©å›¾ç‰‡
wx.chooseImage({
  count: 1,
  success: (res) => {
    const tempFilePath = res.tempFilePaths[0];
    
    // 2. ä¸Šä¼ åˆ°äº‘å­˜å‚¨ï¼ˆæˆ–è‡ªå·±çš„æœåŠ¡å™¨ï¼‰
    wx.cloud.uploadFile({
      cloudPath: `photos/${Date.now()}.jpg`,
      filePath: tempFilePath,
      success: (uploadRes) => {
        const photoUrl = uploadRes.fileID;
        
        // 3. è°ƒç”¨æ¥å£ä¿å­˜ç…§ç‰‡è®°å½•
        wx.request({
          url: 'http://localhost:8080/api/user/album/upload',
          method: 'POST',
          header: {
            'Authorization': `Bearer ${wx.getStorageSync('token')}`
          },
          data: {
            photoUrl: photoUrl,
            isCover: false
          },
          success: (res) => {
            wx.showToast({ title: 'ä¸Šä¼ æˆåŠŸ' });
          }
        });
      }
    });
  }
});
```

### æŸ¥çœ‹ä»–äººèµ„æ–™

```javascript
// ç‚¹å‡»ç”¨æˆ·å¤´åƒæ—¶
onUserClick(userId) {
  wx.request({
    url: `http://localhost:8080/api/user/profile/${userId}`,
    method: 'GET',
    header: {
      'Authorization': `Bearer ${wx.getStorageSync('token')}`
    },
    success: (res) => {
      const userProfile = res.data.data;
      // è·³è½¬åˆ°ç”¨æˆ·è¯¦æƒ…é¡µ
      wx.navigateTo({
        url: `/pages/user-detail/index?userId=${userId}`,
        success: (res) => {
          // é€šè¿‡eventChannelä¼ é€’æ•°æ®
          res.eventChannel.emit('userProfile', userProfile);
        }
      });
    }
  });
}
```

### è®¾ç½®éšç§

```javascript
wx.request({
  url: 'http://localhost:8080/api/user/privacy',
  method: 'POST',
  header: {
    'Authorization': `Bearer ${wx.getStorageSync('token')}`
  },
  data: {
    whoCanSeeMe: 2,        // ä»…åŒ¹é…çš„äºº
    showDistance: 1,       // æ˜¾ç¤ºè·ç¦»
    showOnlineStatus: 0    // ä¸æ˜¾ç¤ºåœ¨çº¿çŠ¶æ€
  },
  success: (res) => {
    wx.showToast({ title: 'è®¾ç½®æˆåŠŸ' });
  }
});
```

### æ‹‰é»‘ç”¨æˆ·

```javascript
onBlockUser(userId) {
  wx.showModal({
    title: 'ç¡®è®¤æ‹‰é»‘',
    content: 'æ‹‰é»‘åå°†æ— æ³•çœ‹åˆ°å¯¹æ–¹çš„åŠ¨æ€',
    success: (res) => {
      if (res.confirm) {
        wx.request({
          url: `http://localhost:8080/api/user/blacklist/${userId}`,
          method: 'POST',
          header: {
            'Authorization': `Bearer ${wx.getStorageSync('token')}`
          },
          success: (res) => {
            wx.showToast({ title: 'æ‹‰é»‘æˆåŠŸ' });
            // è¿”å›ä¸Šä¸€é¡µæˆ–åˆ·æ–°åˆ—è¡¨
            wx.navigateBack();
          }
        });
      }
    }
  });
}
```

### è·å–å¹¶è®¾ç½®æ ‡ç­¾

```javascript
// 1. è·å–æ ‡ç­¾åº“
wx.request({
  url: 'http://localhost:8080/api/user/tags',
  method: 'GET',
  success: (res) => {
    const tagLibrary = res.data.data;
    this.setData({ tagLibrary });
  }
});

// 2. ç”¨æˆ·é€‰æ‹©æ ‡ç­¾åä¿å­˜
onTagsConfirm(selectedTagIds) {
  wx.request({
    url: 'http://localhost:8080/api/user/tags',
    method: 'POST',
    header: {
      'Authorization': `Bearer ${wx.getStorageSync('token')}`
    },
    data: {
      tagIds: selectedTagIds
    },
    success: (res) => {
      wx.showToast({ title: 'æ ‡ç­¾è®¾ç½®æˆåŠŸ' });
    }
  });
}
```

---

## 31. ä¸Šä¼ å›¾ç‰‡ï¼ˆæ–‡ä»¶æ–¹å¼ï¼‰

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`POST /api/oss/upload`
- **æ¥å£è¯´æ˜**ï¼š**[ç¬¬1æ­¥]** ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶åˆ°é˜¿é‡Œäº‘OSSï¼Œè·å¾—å›¾ç‰‡URLåï¼Œéœ€è°ƒç”¨ `/api/media/save` ä¿å­˜åˆ°ä¸šåŠ¡ç³»ç»Ÿ
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
Content-Type: multipart/form-data
```

### è¯·æ±‚å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| file | File | æ˜¯ | å›¾ç‰‡æ–‡ä»¶ |
| category | String | æ˜¯ | å›¾ç‰‡åˆ†ç±»ï¼Œå¯é€‰å€¼ï¼š<br/>â€¢ `avatar` - ç”¨æˆ·å¤´åƒ<br/>â€¢ `album` - ç›¸å†Œç…§ç‰‡<br/>â€¢ `moment` - åŠ¨æ€å›¾ç‰‡<br/>â€¢ `activity` - æ´»åŠ¨å›¾ç‰‡<br/>â€¢ `background` - ä¸ªäººä¸»é¡µèƒŒæ™¯å¢™ |

### categoryå‚æ•°è¯´æ˜

| å€¼ | è¯´æ˜ | ç”¨é€” |
|-------|------|------|
| avatar | ç”¨æˆ·å¤´åƒ | ä¸ªäººèµ„æ–™é¡µçš„å¤´åƒå›¾ç‰‡ |
| album | ç›¸å†Œç…§ç‰‡ | ç”¨æˆ·ç›¸å†Œä¸­çš„ç…§ç‰‡ |
| moment | åŠ¨æ€å›¾ç‰‡ | å‘å¸ƒåŠ¨æ€/æœ‹å‹åœˆæ—¶çš„é…å›¾ |
| activity | æ´»åŠ¨å›¾ç‰‡ | æ­å­æ´»åŠ¨çš„å°é¢æˆ–è¯¦æƒ…å›¾ |
| background | èƒŒæ™¯å¢™å›¾ç‰‡ | ä¸ªäººä¸»é¡µçš„èƒŒæ™¯å¢™å›¾ç‰‡ |

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X POST http://localhost:8080/api/oss/upload \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -F "file=@/path/to/image.jpg" \
  -F "category=avatar"
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "å›¾ç‰‡ä¸Šä¼ æˆåŠŸ",
  "data": {
    "imageUrl": "https://friend-mini.oss-cn-beijing.aliyuncs.com/uploads/avatar/7/20251102/xxx.jpg",
    "category": "avatar",
    "uploadTime": 1699000000000
  }
}
```

### å“åº”å­—æ®µè¯´æ˜

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| imageUrl | String | å›¾ç‰‡è®¿é—®URLï¼ˆæ°¸ä¹…æœ‰æ•ˆï¼‰ï¼Œå¯ç›´æ¥åœ¨æµè§ˆå™¨é¢„è§ˆ |
| category | String | å›¾ç‰‡åˆ†ç±» |
| uploadTime | Long | ä¸Šä¼ æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰ |

### ä¸šåŠ¡è¯´æ˜

1. **æ”¯æŒæ ¼å¼**ï¼šjpgã€pngã€gifã€webp
2. **æ–‡ä»¶å¤§å°é™åˆ¶**ï¼š10MB
3. **å­˜å‚¨è·¯å¾„**ï¼šuploads/{category}/{userId}/{yyyyMMdd}/{uuid}.{ext}
4. **è‡ªåŠ¨è®¾ç½®å…ƒæ•°æ®**ï¼šContent-Typeå’ŒContent-Dispositionï¼Œæµè§ˆå™¨å¯ç›´æ¥é¢„è§ˆ
5. **URLæ°¸ä¹…æœ‰æ•ˆ**ï¼šè¿”å›çš„URLæ— è¿‡æœŸæ—¶é—´ï¼Œå¯æ°¸ä¹…è®¿é—®ï¼ˆéœ€ç¡®ä¿OSS bucketè®¾ç½®ä¸ºå…¬å…±è¯»ï¼‰
6. **âš ï¸ é‡è¦**ï¼šæ­¤æ¥å£ä»…ä¸Šä¼ åˆ°OSSï¼Œ**å¿…é¡»**å†è°ƒç”¨ `POST /api/media/save` æ‰èƒ½å…³è”åˆ°ä¸šåŠ¡ï¼ˆå¤´åƒã€ç›¸å†Œç­‰ï¼‰

### å®Œæ•´ç¤ºä¾‹ï¼ˆä¸¤æ­¥ä¸Šä¼ ï¼‰

```bash
# æ­¥éª¤1ï¼šä¸Šä¼ åˆ°OSS
curl -X POST http://localhost:8080/api/oss/upload \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -F "file=@/path/to/avatar.jpg" \
  -F "category=avatar"

# è¿”å›ï¼š
# {
#   "code": 200,
#   "data": {
#     "imageUrl": "https://your-bucket.oss.../avatar.jpg"
#   }
# }

# æ­¥éª¤2ï¼šä¿å­˜åˆ°ä¸šåŠ¡ç³»ç»Ÿï¼ˆå¤´åƒï¼‰
curl -X POST http://localhost:8080/api/media/save \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "imageUrl": "https://your-bucket.oss.../avatar.jpg",
    "mediaType": "avatar",
    "isPrimary": true
  }'

# å®Œæˆï¼å¤´åƒå·²ä¿å­˜
```

---

## 32. ä¸Šä¼ å›¾ç‰‡ï¼ˆBase64æ–¹å¼ï¼‰

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`POST /api/oss/upload/base64`
- **æ¥å£è¯´æ˜**ï¼š**[ç¬¬1æ­¥]** ä¸Šä¼ Base64ç¼–ç çš„å›¾ç‰‡åˆ°OSSï¼Œè·å¾—URLåéœ€è°ƒç”¨ `/api/media/save`
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
Content-Type: application/json
```

### è¯·æ±‚å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| imageData | String | æ˜¯ | Base64ç¼–ç çš„å›¾ç‰‡æ•°æ® |
| category | String | æ˜¯ | å›¾ç‰‡åˆ†ç±»ï¼Œå¯é€‰å€¼ï¼š<br/>â€¢ `avatar` - ç”¨æˆ·å¤´åƒ<br/>â€¢ `album` - ç›¸å†Œç…§ç‰‡<br/>â€¢ `moment` - åŠ¨æ€å›¾ç‰‡<br/>â€¢ `activity` - æ´»åŠ¨å›¾ç‰‡<br/>â€¢ `background` - ä¸ªäººä¸»é¡µèƒŒæ™¯å¢™ |
| fileExtension | String | å¦ | æ–‡ä»¶æ‰©å±•åï¼ˆé»˜è®¤jpgï¼‰ |

### categoryå‚æ•°è¯´æ˜

| å€¼ | è¯´æ˜ | ç”¨é€” |
|-------|------|------|
| avatar | ç”¨æˆ·å¤´åƒ | ä¸ªäººèµ„æ–™é¡µçš„å¤´åƒå›¾ç‰‡ |
| album | ç›¸å†Œç…§ç‰‡ | ç”¨æˆ·ç›¸å†Œä¸­çš„ç…§ç‰‡ |
| moment | åŠ¨æ€å›¾ç‰‡ | å‘å¸ƒåŠ¨æ€/æœ‹å‹åœˆæ—¶çš„é…å›¾ |
| activity | æ´»åŠ¨å›¾ç‰‡ | æ­å­æ´»åŠ¨çš„å°é¢æˆ–è¯¦æƒ…å›¾ |
| background | èƒŒæ™¯å¢™å›¾ç‰‡ | ä¸ªäººä¸»é¡µçš„èƒŒæ™¯å¢™å›¾ç‰‡ |

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X POST http://localhost:8080/api/oss/upload/base64 \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "imageData": "data:image/png;base64,iVBORw0KGgo...",
    "category": "album",
    "fileExtension": "png"
  }'
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "å›¾ç‰‡ä¸Šä¼ æˆåŠŸ",
  "data": {
    "imageUrl": "https://friend-mini.oss-cn-beijing.aliyuncs.com/uploads/album/7/20251102/xxx.png",
    "category": "album",
    "uploadTime": 1699000000000
  }
}
```

### å“åº”å­—æ®µè¯´æ˜

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| imageUrl | String | å›¾ç‰‡è®¿é—®URLï¼ˆæ°¸ä¹…æœ‰æ•ˆï¼‰ï¼Œå¯ç›´æ¥åœ¨æµè§ˆå™¨é¢„è§ˆ |
| category | String | å›¾ç‰‡åˆ†ç±» |
| uploadTime | Long | ä¸Šä¼ æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰ |

### ä¸šåŠ¡è¯´æ˜

1. **æ”¯æŒBase64æ ¼å¼**ï¼šæ”¯æŒ `data:image/png;base64,xxx` æˆ–çº¯Base64æ•°æ®
2. **æ–‡ä»¶å¤§å°é™åˆ¶**ï¼š10MB
3. **å­˜å‚¨è·¯å¾„**ï¼šuploads/{category}/{userId}/{yyyyMMdd}/{uuid}.{ext}
4. **URLæ°¸ä¹…æœ‰æ•ˆ**ï¼šè¿”å›çš„URLæ— è¿‡æœŸæ—¶é—´ï¼Œå¯æ°¸ä¹…è®¿é—®ï¼ˆéœ€ç¡®ä¿OSS bucketè®¾ç½®ä¸ºå…¬å…±è¯»ï¼‰
5. **âš ï¸ é‡è¦**ï¼šæ­¤æ¥å£ä»…ä¸Šä¼ åˆ°OSSï¼Œ**å¿…é¡»**å†è°ƒç”¨ `POST /api/media/save` æ‰èƒ½å…³è”åˆ°ä¸šåŠ¡

### å®Œæ•´ç¤ºä¾‹ï¼ˆBase64ä¸¤æ­¥ä¸Šä¼ ï¼‰

```bash
# æ­¥éª¤1ï¼šBase64ä¸Šä¼ åˆ°OSS
curl -X POST http://localhost:8080/api/oss/upload/base64 \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "imageData": "data:image/jpeg;base64,/9j/4AAQSkZJRg...",
    "category": "avatar"
  }'

# è¿”å›å›¾ç‰‡URL

# æ­¥éª¤2ï¼šä¿å­˜åˆ°ä¸šåŠ¡ç³»ç»Ÿ
curl -X POST http://localhost:8080/api/media/save \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "imageUrl": "è¿”å›çš„URL",
    "mediaType": "avatar",
    "isPrimary": true
  }'
```

---

## 33. æ‰¹é‡ä¸Šä¼ å›¾ç‰‡

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`POST /api/oss/upload/batch`
- **æ¥å£è¯´æ˜**ï¼š**[ç¬¬1æ­¥]** æ‰¹é‡ä¸Šä¼ å¤šå¼ å›¾ç‰‡åˆ°OSSï¼Œè·å¾—URLsåéœ€é€ä¸ªè°ƒç”¨ `/api/media/save`
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
Content-Type: multipart/form-data
```

### è¯·æ±‚å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| files | File[] | æ˜¯ | å›¾ç‰‡æ–‡ä»¶æ•°ç»„ |
| category | String | æ˜¯ | å›¾ç‰‡åˆ†ç±»ï¼Œå¯é€‰å€¼ï¼š<br/>â€¢ `avatar` - ç”¨æˆ·å¤´åƒ<br/>â€¢ `album` - ç›¸å†Œç…§ç‰‡<br/>â€¢ `moment` - åŠ¨æ€å›¾ç‰‡<br/>â€¢ `activity` - æ´»åŠ¨å›¾ç‰‡<br/>â€¢ `background` - ä¸ªäººä¸»é¡µèƒŒæ™¯å¢™ |

### categoryå‚æ•°è¯´æ˜

| å€¼ | è¯´æ˜ | ç”¨é€” |
|-------|------|------|
| avatar | ç”¨æˆ·å¤´åƒ | ä¸ªäººèµ„æ–™é¡µçš„å¤´åƒå›¾ç‰‡ |
| album | ç›¸å†Œç…§ç‰‡ | ç”¨æˆ·ç›¸å†Œä¸­çš„ç…§ç‰‡ |
| moment | åŠ¨æ€å›¾ç‰‡ | å‘å¸ƒåŠ¨æ€/æœ‹å‹åœˆæ—¶çš„é…å›¾ |
| activity | æ´»åŠ¨å›¾ç‰‡ | æ­å­æ´»åŠ¨çš„å°é¢æˆ–è¯¦æƒ…å›¾ |
| background | èƒŒæ™¯å¢™å›¾ç‰‡ | ä¸ªäººä¸»é¡µçš„èƒŒæ™¯å¢™å›¾ç‰‡ |

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X POST http://localhost:8080/api/oss/upload/batch \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -F "files=@image1.jpg" \
  -F "files=@image2.jpg" \
  -F "category=moment"
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "æ‰¹é‡ä¸Šä¼ æˆåŠŸ",
  "data": [
    {
      "imageUrl": "https://friend-mini.oss-cn-beijing.aliyuncs.com/uploads/moment/7/20251102/xxx1.jpg",
      "category": "moment",
      "uploadTime": 1699000000000
    },
    {
      "imageUrl": "https://friend-mini.oss-cn-beijing.aliyuncs.com/uploads/moment/7/20251102/xxx2.jpg",
      "category": "moment",
      "uploadTime": 1699000000001
    }
  ]
}
```

### å“åº”å­—æ®µè¯´æ˜

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| data | Array | ä¸Šä¼ ç»“æœæ•°ç»„ |
| imageUrl | String | å›¾ç‰‡è®¿é—®URLï¼ˆæ°¸ä¹…æœ‰æ•ˆï¼‰ï¼Œå¯ç›´æ¥åœ¨æµè§ˆå™¨é¢„è§ˆ |
| category | String | å›¾ç‰‡åˆ†ç±» |
| uploadTime | Long | ä¸Šä¼ æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰ |

### ä¸šåŠ¡è¯´æ˜

1. **æ‰¹é‡é™åˆ¶**ï¼šä¸€æ¬¡æœ€å¤šä¸Šä¼ 10å¼ å›¾ç‰‡
2. **åŸå­æ€§**ï¼šå¦‚æœæŸå¼ å›¾ç‰‡ä¸Šä¼ å¤±è´¥ï¼Œä¸å½±å“å…¶ä»–å›¾ç‰‡
3. **URLæ°¸ä¹…æœ‰æ•ˆ**ï¼šè¿”å›çš„URLæ— è¿‡æœŸæ—¶é—´ï¼Œå¯æ°¸ä¹…è®¿é—®ï¼ˆéœ€ç¡®ä¿OSS bucketè®¾ç½®ä¸ºå…¬å…±è¯»ï¼‰
4. **âš ï¸ é‡è¦**ï¼šæ­¤æ¥å£ä»…æ‰¹é‡ä¸Šä¼ åˆ°OSSï¼Œ**å¿…é¡»**é€ä¸ªè°ƒç”¨ `POST /api/media/save` æ‰èƒ½ä¿å­˜åˆ°ä¸šåŠ¡

### å®Œæ•´ç¤ºä¾‹ï¼ˆæ‰¹é‡ä¸¤æ­¥ä¸Šä¼ ï¼‰

```bash
# æ­¥éª¤1ï¼šæ‰¹é‡ä¸Šä¼ åˆ°OSS
curl -X POST http://localhost:8080/api/oss/upload/batch \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -F "files=@photo1.jpg" \
  -F "files=@photo2.jpg" \
  -F "files=@photo3.jpg" \
  -F "category=album"

# è¿”å›ï¼š
# {
#   "code": 200,
#   "data": [
#     {"imageUrl": "https://your-bucket.oss.../photo1.jpg", ...},
#     {"imageUrl": "https://your-bucket.oss.../photo2.jpg", ...},
#     {"imageUrl": "https://your-bucket.oss.../photo3.jpg", ...}
#   ]
# }

# æ­¥éª¤2ï¼šé€ä¸ªä¿å­˜åˆ°ä¸šåŠ¡ç³»ç»Ÿï¼ˆå¯ä»¥ä½¿ç”¨å¾ªç¯æˆ–å¹¶å‘è¯·æ±‚ï¼‰
# å¯¹äºæ¯ä¸ª imageUrlï¼š
curl -X POST http://localhost:8080/api/media/save \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "imageUrl": "https://your-bucket.oss.../photo1.jpg",
    "mediaType": "album",
    "isPrimary": false
  }'

# é‡å¤è°ƒç”¨ï¼Œç›´åˆ°æ‰€æœ‰å›¾ç‰‡éƒ½ä¿å­˜å®Œæˆ
```

---

## 34. åˆ é™¤OSSå›¾ç‰‡

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`DELETE /api/oss/delete`
- **æ¥å£è¯´æ˜**ï¼šåˆ é™¤OSSä¸Šçš„å›¾ç‰‡æ–‡ä»¶
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
```

### è¯·æ±‚å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| imageUrl | String | æ˜¯ | å›¾ç‰‡å®Œæ•´URL |

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X DELETE "http://localhost:8080/api/oss/delete?imageUrl=https://friend-mini.oss-cn-beijing.aliyuncs.com/uploads/avatar/7/20251102/xxx.jpg" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "å›¾ç‰‡åˆ é™¤æˆåŠŸ",
  "data": true
}
```

---

## 35. è·å–å›¾ç‰‡ç­¾åURL

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`GET /api/oss/signed-url`
- **æ¥å£è¯´æ˜**ï¼šè·å–OSSå›¾ç‰‡çš„ä¸´æ—¶è®¿é—®ç­¾åURLï¼ˆâš ï¸ å¦‚æœbucketè®¾ç½®ä¸ºå…¬å…±è¯»ï¼Œæ— éœ€è°ƒç”¨æ­¤æ¥å£ï¼‰
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
```

### è¯·æ±‚å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| objectKey | String | æ˜¯ | å¯¹è±¡é”®ï¼ˆæ–‡ä»¶è·¯å¾„ï¼‰ |

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X GET "http://localhost:8080/api/oss/signed-url?objectKey=uploads/avatar/7/20251102/xxx.jpg" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "è·å–ç­¾åURLæˆåŠŸ",
  "data": "http://friend-mini.oss-cn-beijing.aliyuncs.com/uploads/avatar/7/20251102/xxx.jpg?Expires=1762090270&OSSAccessKeyId=xxx&Signature=xxx"
}
```

### ä¸šåŠ¡è¯´æ˜

1. **é€‚ç”¨åœºæ™¯**ï¼š
   - âš ï¸ **å½“å‰é…ç½®**ï¼šå¦‚æœbucketè®¾ç½®ä¸ºå…¬å…±è¯»ï¼Œä¸Šä¼ æ¥å£è¿”å›çš„URLæ°¸ä¹…æœ‰æ•ˆï¼Œ**æ— éœ€è°ƒç”¨æ­¤æ¥å£**
   - ğŸ“Œ **ç§æœ‰bucket**ï¼šå¦‚æœbucketæ˜¯ç§æœ‰çš„ï¼Œéœ€è¦ä½¿ç”¨æ­¤æ¥å£ç”Ÿæˆä¸´æ—¶ç­¾åURL
2. **URLæœ‰æ•ˆæœŸ**ï¼šç­¾åURLæœ‰æ•ˆæœŸ3600ç§’ï¼ˆ1å°æ—¶ï¼‰
3. **objectKeyæ ¼å¼**ï¼šuploads/{category}/{userId}/{yyyyMMdd}/{filename}
4. **æå–objectKey**ï¼šä»ä¸Šä¼ æ¥å£è¿”å›çš„URLä¸­æå–è·¯å¾„éƒ¨åˆ†
   - ä¾‹å¦‚ï¼š`https://friend-mini.oss-cn-beijing.aliyuncs.com/uploads/avatar/7/20251102/xxx.jpg`
   - å¯¹åº”çš„objectKeyä¸ºï¼š`uploads/avatar/7/20251102/xxx.jpg`

### æ¨èåšæ³•

| Bucketæƒé™ | ä¸Šä¼ æ¥å£è¿”å› | æ˜¯å¦éœ€è¦ç­¾åæ¥å£ |
|-----------|------------|----------------|
| å…¬å…±è¯» âœ…ï¼ˆæ¨èï¼‰ | æ°¸ä¹…URL | âŒ ä¸éœ€è¦ |
| ç§æœ‰ | æ™®é€šURL | âœ… éœ€è¦å®šæœŸåˆ·æ–°ç­¾å |

---

## 36. å‘å¸ƒåŠ¨æ€

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`POST /api/moments/publish`
- **æ¥å£è¯´æ˜**ï¼šå‘å¸ƒåŠ¨æ€ï¼Œæ”¯æŒæ™®é€šåŠ¨æ€ï¼ˆæ­å­ã€æ‹çˆ±ï¼‰å’Œæ´»åŠ¨ç±»å‹ï¼ˆæ­å­æ´»åŠ¨ã€å®˜æ–¹æ´»åŠ¨ï¼‰
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´
```
Authorization: Bearer {token}
Content-Type: application/json
```

### åŠ¨æ€ç±»å‹è¯´æ˜
- **Type 1 - æ­å­åŠ¨æ€**ï¼šæ™®é€šæ­å­åˆ†äº«ï¼Œå¯»æ‰¾æ­å­
- **Type 2 - æ‹çˆ±åŠ¨æ€**ï¼šæ‹çˆ±äº¤å‹ç›¸å…³çš„åŠ¨æ€
- **Type 3 - æ­å­æ´»åŠ¨**ï¼šç”¨æˆ·å‘èµ·çš„æ­å­æ´»åŠ¨ï¼ˆéœ€å¡«å†™æ´»åŠ¨æ—¶é—´ã€åœ°ç‚¹ï¼‰
- **Type 4 - å®˜æ–¹æ´»åŠ¨**ï¼šå¹³å°å®˜æ–¹å‘èµ·çš„çº¿ä¸‹æ´»åŠ¨

### æ´»åŠ¨ç±»å‹
- `sport` - è¿åŠ¨ï¼ˆç¾½æ¯›çƒã€ç¯®çƒã€è·‘æ­¥ç­‰ï¼‰
- `study` - å­¦ä¹ ï¼ˆå›¾ä¹¦é¦†ã€è‡ªä¹ å®¤ç­‰ï¼‰
- `travel` - æ—…æ¸¸ï¼ˆå‘¨æœ«æ¸¸ã€é•¿é€”æ¸¸ç­‰ï¼‰
- `workout` - å¥èº«ï¼ˆå¥èº«æˆ¿ã€ç‘œä¼½ç­‰ï¼‰
- `hobby` - çˆ±å¥½ï¼ˆæ‘„å½±ã€éŸ³ä¹ã€æ‰‹å·¥ç­‰ï¼‰
- `food` - ç¾é£Ÿï¼ˆæ¢åº—ã€èšé¤ç­‰ï¼‰
- `other` - å…¶ä»–

### è¯·æ±‚å‚æ•°

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| momentType | Integer | æ˜¯ | åŠ¨æ€ç±»å‹ï¼š1-æ­å­åŠ¨æ€ 2-æ‹çˆ±åŠ¨æ€ 3-æ­å­æ´»åŠ¨ 4-å®˜æ–¹æ´»åŠ¨ |
| content | String | å¦ | åŠ¨æ€å†…å®¹ï¼Œæœ€å¤š1000å­— |
| title | String | æ´»åŠ¨å¿…å¡« | æ ‡é¢˜ï¼Œæœ€å¤š100å­— |
| city | String | å¦ | åŸå¸‚ |
| location | String | å¦ | ä½ç½®ä¿¡æ¯ |
| latitude | Decimal | å¦ | çº¬åº¦ |
| longitude | Decimal | å¦ | ç»åº¦ |
| photoUrls | Array | å¦ | å›¾ç‰‡URLsæ•°ç»„ï¼Œæœ€å¤š9å¼  |
| activityTime | DateTime | æ´»åŠ¨å¿…å¡« | æ´»åŠ¨æ—¶é—´ |
| activityType | String | å¦ | æ´»åŠ¨ç±»å‹ |
| maxParticipants | Integer | å¦ | æœ€å¤§å‚ä¸äººæ•°ï¼Œ0è¡¨ç¤ºä¸é™åˆ¶ |
| activityFee | Decimal | å¦ | æ´»åŠ¨è´¹ç”¨ï¼Œ0è¡¨ç¤ºå…è´¹ |
| contactMethod | String | å¦ | è”ç³»æ–¹å¼ |

### è¯·æ±‚ç¤ºä¾‹

**å‘å¸ƒæ™®é€šæ­å­åŠ¨æ€**ï¼š
```json
{
  "momentType": 1,
  "content": "å‘¨æœ«æƒ³æ‰¾äººä¸€èµ·å»çˆ¬å±±ï¼Œæœ‰æ²¡æœ‰å°ä¼™ä¼´ä¸€èµ·ï¼Ÿ",
  "city": "åŒ—äº¬",
  "latitude": 39.9042,
  "longitude": 116.4074,
  "photoUrls": ["https://oss.example.com/photo1.jpg"]
}
```

**å‘å¸ƒæ­å­æ´»åŠ¨**ï¼š
```json
{
  "momentType": 3,
  "title": "å‘¨æœ«ç¾½æ¯›çƒæ´»åŠ¨",
  "content": "æ‰¾3ä¸ªå°ä¼™ä¼´ä¸€èµ·æ‰“ç¾½æ¯›çƒ",
  "activityTime": "2025-11-10 14:00:00",
  "activityType": "sport",
  "maxParticipants": 4,
  "activityFee": 20.00,
  "location": "æœé˜³ä½“è‚²é¦†",
  "city": "åŒ—äº¬",
  "contactMethod": "å¾®ä¿¡ï¼šxxx"
}
```

**curlå‘½ä»¤**ï¼š
```bash
curl -X POST http://localhost:8080/api/moments/publish \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "momentType": 3,
    "title": "å‘¨æœ«ç¾½æ¯›çƒæ´»åŠ¨",
    "content": "æ‰¾3ä¸ªå°ä¼™ä¼´ä¸€èµ·æ‰“ç¾½æ¯›çƒ",
    "activityTime": "2025-11-10 14:00:00",
    "activityType": "sport",
    "maxParticipants": 4,
    "activityFee": 20.00,
    "location": "æœé˜³ä½“è‚²é¦†",
    "city": "åŒ—äº¬"
  }'
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "å‘å¸ƒæˆåŠŸ",
  "data": {
    "id": 1,
    "publisher": {
      "userId": "U17623500638845TAWQ0",
      "nickname": "å¼ ä¸‰",
      "avatar": "https://...",
      "gender": 1,
      "age": 25,
      "isVerified": true,
      "isVip": false
    },
    "momentType": 3,
    "momentTypeName": "æ­å­æ´»åŠ¨",
    "title": "å‘¨æœ«ç¾½æ¯›çƒæ´»åŠ¨",
    "content": "æ‰¾3ä¸ªå°ä¼™ä¼´ä¸€èµ·æ‰“ç¾½æ¯›çƒ",
    "location": "æœé˜³ä½“è‚²é¦†",
    "city": "åŒ—äº¬",
    "photos": [],
    "activityTime": "2025-11-10T14:00:00",
    "activityType": "sport",
    "activityTypeName": "è¿åŠ¨",
    "maxParticipants": 4,
    "currentParticipants": 0,
    "activityFee": 20.00,
    "activityStatus": 1,
    "activityStatusName": "æ‹›å‹Ÿä¸­",
    "likeCount": 0,
    "commentCount": 0,
    "viewCount": 0,
    "isLiked": false,
    "isRegistered": false,
    "isTop": false,
    "isFeatured": false,
    "createdAt": "2025-11-07T15:00:00",
    "timeDesc": "åˆšåˆš"
  },
  "traceId": "abc123"
}
```

### ä¸šåŠ¡è§„åˆ™
1. æ™®é€šç”¨æˆ·æ¯æ—¥é™åˆ¶å‘å¸ƒ3æ¡ï¼ŒVIPç”¨æˆ·10æ¡
2. æ´»åŠ¨ç±»å‹åŠ¨æ€å¿…é¡»å¡«å†™`title`å’Œ`activityTime`
3. æ‰€æœ‰åŠ¨æ€é»˜è®¤å®¡æ ¸é€šè¿‡ï¼ˆå¯é…ç½®å®¡æ ¸ç­–ç•¥ï¼‰
4. å›¾ç‰‡éœ€å…ˆé€šè¿‡OSSä¸Šä¼ æ¥å£è·å–URL

---

## 37. è·å–åŠ¨æ€åˆ—è¡¨

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`GET /api/moments/list`
- **æ¥å£è¯´æ˜**ï¼šåˆ†é¡µè·å–åŠ¨æ€åˆ—è¡¨ï¼Œæ”¯æŒç±»å‹ç­›é€‰ã€åŸå¸‚ç­›é€‰
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´
```
Authorization: Bearer {token}
```

### è¯·æ±‚å‚æ•°

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| momentType | Integer | å¦ | åŠ¨æ€ç±»å‹ç­›é€‰ |
| city | String | å¦ | åŸå¸‚ç­›é€‰ |
| latitude | Decimal | å¦ | çº¬åº¦ï¼ˆç”¨äºè·ç¦»è®¡ç®—ï¼‰ |
| longitude | Decimal | å¦ | ç»åº¦ï¼ˆç”¨äºè·ç¦»è®¡ç®—ï¼‰ |
| page | Integer | å¦ | é¡µç ï¼Œé»˜è®¤1 |
| size | Integer | å¦ | æ¯é¡µæ•°é‡ï¼Œé»˜è®¤10 |

### è¯·æ±‚ç¤ºä¾‹

```bash
# è·å–æ‰€æœ‰åŠ¨æ€
curl -X GET "http://localhost:8080/api/moments/list?page=1&size=10" \
  -H "Authorization: Bearer YOUR_TOKEN"

# è·å–åŒ—äº¬çš„æ­å­æ´»åŠ¨
curl -X GET "http://localhost:8080/api/moments/list?momentType=3&city=åŒ—äº¬&page=1&size=10" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "records": [
      {
        "id": 1,
        "publisher": {
          "userId": "U17623500638845TAWQ0",
          "nickname": "å¼ ä¸‰",
          "avatar": "https://...",
          "gender": 1,
          "age": 25,
          "isVerified": true,
          "isVip": false
        },
        "momentType": 3,
        "momentTypeName": "æ­å­æ´»åŠ¨",
        "title": "å‘¨æœ«ç¾½æ¯›çƒæ´»åŠ¨",
        "activityTime": "2025-11-10T14:00:00",
        "currentParticipants": 2,
        "maxParticipants": 4,
        "activityStatus": 1,
        "activityStatusName": "æ‹›å‹Ÿä¸­",
        "likeCount": 5,
        "commentCount": 2,
        "isLiked": false,
        "isRegistered": false,
        "timeDesc": "2å°æ—¶å‰"
      }
    ],
    "total": 50,
    "current": 1,
    "size": 10,
    "pages": 5
  },
  "traceId": "abc123"
}
```

---

## 38. è·å–åŠ¨æ€è¯¦æƒ…

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`GET /api/moments/{momentId}`
- **æ¥å£è¯´æ˜**ï¼šè·å–åŠ¨æ€è¯¦æƒ…ï¼Œè‡ªåŠ¨å¢åŠ æµè§ˆæ•°
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´
```
Authorization: Bearer {token}
```

### è·¯å¾„å‚æ•°
- `momentId`ï¼šåŠ¨æ€ID

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "publisher": {
      "userId": "U17623500638845TAWQ0",
      "nickname": "å¼ ä¸‰",
      "avatar": "https://...",
      "gender": 1,
      "age": 25,
      "isVerified": true,
      "isVip": false
    },
    "momentType": 3,
    "momentTypeName": "æ­å­æ´»åŠ¨",
    "title": "å‘¨æœ«ç¾½æ¯›çƒæ´»åŠ¨",
    "content": "æ‰¾3ä¸ªå°ä¼™ä¼´ä¸€èµ·æ‰“ç¾½æ¯›çƒ",
    "location": "æœé˜³ä½“è‚²é¦†",
    "city": "åŒ—äº¬",
    "photos": ["https://..."],
    "activityTime": "2025-11-10T14:00:00",
    "activityType": "sport",
    "activityTypeName": "è¿åŠ¨",
    "maxParticipants": 4,
    "currentParticipants": 2,
    "activityFee": 20.00,
    "activityStatus": 1,
    "activityStatusName": "æ‹›å‹Ÿä¸­",
    "likeCount": 5,
    "commentCount": 2,
    "viewCount": 100,
    "isLiked": false,
    "isRegistered": false,
    "createdAt": "2025-11-07T15:00:00",
    "timeDesc": "2å°æ—¶å‰"
  },
  "traceId": "abc123"
}
```

---

## 39. ç‚¹èµåŠ¨æ€

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`POST /api/moments/{momentId}/like`
- **æ¥å£è¯´æ˜**ï¼šç‚¹èµåŠ¨æ€ï¼Œé‡å¤ç‚¹èµæ— æ•ˆ
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´
```
Authorization: Bearer {token}
```

### è·¯å¾„å‚æ•°
- `momentId`ï¼šåŠ¨æ€ID

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "ç‚¹èµæˆåŠŸ",
  "data": null,
  "traceId": "abc123"
}
```

---

## 40. å–æ¶ˆç‚¹èµ

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`DELETE /api/moments/{momentId}/like`
- **æ¥å£è¯´æ˜**ï¼šå–æ¶ˆç‚¹èµåŠ¨æ€
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´
```
Authorization: Bearer {token}
```

### è·¯å¾„å‚æ•°
- `momentId`ï¼šåŠ¨æ€ID

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "å–æ¶ˆç‚¹èµæˆåŠŸ",
  "data": null,
  "traceId": "abc123"
}
```

---

## 41. åˆ é™¤åŠ¨æ€

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`DELETE /api/moments/{momentId}`
- **æ¥å£è¯´æ˜**ï¼šåˆ é™¤è‡ªå·±å‘å¸ƒçš„åŠ¨æ€ï¼ˆè½¯åˆ é™¤ï¼‰
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´
```
Authorization: Bearer {token}
```

### è·¯å¾„å‚æ•°
- `momentId`ï¼šåŠ¨æ€ID

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "åˆ é™¤æˆåŠŸ",
  "data": null,
  "traceId": "abc123"
}
```

### ä¸šåŠ¡è§„åˆ™
- åªèƒ½åˆ é™¤è‡ªå·±å‘å¸ƒçš„åŠ¨æ€
- åˆ é™¤ä¸ºè½¯åˆ é™¤ï¼Œæ•°æ®ä¸ä¼šçœŸæ­£åˆ é™¤

---

## 42. æŠ¥åæ´»åŠ¨

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`POST /api/moments/{momentId}/register`
- **æ¥å£è¯´æ˜**ï¼šæŠ¥åå‚åŠ æ­å­æ´»åŠ¨æˆ–å®˜æ–¹æ´»åŠ¨
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´
```
Authorization: Bearer {token}
```

### è·¯å¾„å‚æ•°
- `momentId`ï¼šåŠ¨æ€IDï¼ˆæ´»åŠ¨ç±»å‹ï¼‰

### è¯·æ±‚å‚æ•°

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| contactInfo | String | å¦ | è”ç³»æ–¹å¼ |
| remark | String | å¦ | å¤‡æ³¨ä¿¡æ¯ |

### è¯·æ±‚ç¤ºä¾‹

```bash
curl -X POST "http://localhost:8080/api/moments/1/register?contactInfo=å¾®ä¿¡:xxx&remark=æœŸå¾…å‚åŠ " \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "æŠ¥åæˆåŠŸ",
  "data": null,
  "traceId": "abc123"
}
```

### ä¸šåŠ¡è§„åˆ™
1. åªèƒ½æŠ¥åæ´»åŠ¨ç±»å‹çš„åŠ¨æ€ï¼ˆmomentType=3æˆ–4ï¼‰
2. ä¸èƒ½é‡å¤æŠ¥å
3. æ´»åŠ¨æ»¡å‘˜åä¸èƒ½æŠ¥å
4. æŠ¥åæˆåŠŸåå½“å‰å‚ä¸äººæ•°+1
5. è¾¾åˆ°æœ€å¤§äººæ•°æ—¶æ´»åŠ¨çŠ¶æ€å˜ä¸º"å·²æ»¡å‘˜"

---

## 43. å–æ¶ˆæŠ¥å

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`POST /api/moments/{momentId}/cancel-registration`
- **æ¥å£è¯´æ˜**ï¼šå–æ¶ˆå·²æŠ¥åçš„æ´»åŠ¨
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´
```
Authorization: Bearer {token}
```

### è·¯å¾„å‚æ•°
- `momentId`ï¼šåŠ¨æ€IDï¼ˆæ´»åŠ¨ç±»å‹ï¼‰

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "å–æ¶ˆæŠ¥åæˆåŠŸ",
  "data": null,
  "traceId": "abc123"
}
```

### ä¸šåŠ¡è§„åˆ™
1. åªèƒ½å–æ¶ˆè‡ªå·±çš„æŠ¥å
2. å–æ¶ˆåå½“å‰å‚ä¸äººæ•°-1
3. å¦‚æœä¹‹å‰æ˜¯æ»¡å‘˜çŠ¶æ€ï¼Œå–æ¶ˆåæ¢å¤ä¸º"æ‹›å‹Ÿä¸­"

---

## 44. æ£€æŸ¥å‘å¸ƒé™åˆ¶

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`GET /api/moments/publish-limit`
- **æ¥å£è¯´æ˜**ï¼šæŸ¥è¯¢å½“å‰ç”¨æˆ·ä»Šæ—¥å‰©ä½™å‘å¸ƒæ¬¡æ•°
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´
```
Authorization: Bearer {token}
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": 2,
  "traceId": "abc123"
}
```

**è¯´æ˜**ï¼š
- è¿”å›å€¼ä¸ºä»Šæ—¥å‰©ä½™å‘å¸ƒæ¬¡æ•°
- æ™®é€šç”¨æˆ·æ¯æ—¥3æ¡
- VIPç”¨æˆ·æ¯æ—¥10æ¡ï¼ˆå¯é…ç½®ï¼‰

---

## 45. è·å–VIPä¿¡æ¯

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`GET /api/vip/info`
- **æ¥å£è¯´æ˜**ï¼šè·å–å½“å‰ç”¨æˆ·çš„VIPä¼šå‘˜ä¿¡æ¯
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´
```
Authorization: Bearer {token}
```

### å“åº”ç¤ºä¾‹ï¼ˆVIPç”¨æˆ·ï¼‰

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "isVip": true,
    "vipLevel": 2,
    "vipLevelName": "å­£åº¦ä¼šå‘˜",
    "startTime": "2025-11-01T10:00:00",
    "expireTime": "2026-01-30T10:00:00",
    "remainingDays": 84,
    "autoRenew": false
  },
  "traceId": "abc123"
}
```

### å“åº”ç¤ºä¾‹ï¼ˆéVIPç”¨æˆ·ï¼‰

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "isVip": false
  },
  "traceId": "abc123"
}
```

### å­—æ®µè¯´æ˜

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| isVip | Boolean | æ˜¯å¦æ˜¯VIP |
| vipLevel | Integer | ä¼šå‘˜ç­‰çº§ï¼š1-æœˆåº¦ 2-å­£åº¦ 3-å¹´åº¦ |
| vipLevelName | String | ä¼šå‘˜ç­‰çº§åç§° |
| startTime | DateTime | ä¼šå‘˜å¼€å§‹æ—¶é—´ |
| expireTime | DateTime | ä¼šå‘˜åˆ°æœŸæ—¶é—´ |
| remainingDays | Long | å‰©ä½™å¤©æ•° |
| autoRenew | Boolean | æ˜¯å¦è‡ªåŠ¨ç»­è´¹ |

---

## 46. æ£€æŸ¥VIPçŠ¶æ€

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`GET /api/vip/check`
- **æ¥å£è¯´æ˜**ï¼šå¿«é€Ÿæ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦æ˜¯VIP
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´
```
Authorization: Bearer {token}
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": true,
  "traceId": "abc123"
}
```

**è¯´æ˜**ï¼š
- è¿”å›`true`è¡¨ç¤ºæ˜¯VIPä¸”æœªè¿‡æœŸ
- è¿”å›`false`è¡¨ç¤ºä¸æ˜¯VIPæˆ–å·²è¿‡æœŸ

---

## 47. æ£€æŸ¥VIPåŠŸèƒ½æƒé™

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`GET /api/vip/check-feature`
- **æ¥å£è¯´æ˜**ï¼šæ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦æœ‰æƒé™ä½¿ç”¨æŸä¸ªVIPåŠŸèƒ½
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´
```
Authorization: Bearer {token}
```

### è¯·æ±‚å‚æ•°

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| feature | String | æ˜¯ | åŠŸèƒ½åç§° |

### åŠŸèƒ½åç§°åˆ—è¡¨
- `unlimited_match` - æ— é™åˆ¶åŒ¹é…
- `advanced_filter` - é«˜çº§ç­›é€‰
- `see_who_liked_me` - æŸ¥çœ‹è°å–œæ¬¢æˆ‘
- `priority_display` - ä¼˜å…ˆå±•ç¤º
- `moment_top` - åŠ¨æ€ç½®é¡¶
- `super_like` - è¶…çº§å–œæ¬¢

### è¯·æ±‚ç¤ºä¾‹

```bash
curl -X GET "http://localhost:8080/api/vip/check-feature?feature=unlimited_match" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": true,
  "traceId": "abc123"
}
```

**è¯´æ˜**ï¼š
- å½“å‰é˜¶æ®µä¼šå‘˜åŠŸèƒ½å¼€å…³é»˜è®¤å…³é—­ï¼Œæ‰€æœ‰åŠŸèƒ½è¿”å›`true`
- åæœŸå¯é€šè¿‡é…ç½®è¡¨`t_system_config`å¼€å¯ä¼šå‘˜åŠŸèƒ½

---

## 48. åˆ›å»ºè®¢å•

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`POST /api/payment/create-order`
- **æ¥å£è¯´æ˜**ï¼šåˆ›å»ºVIPä¼šå‘˜è®¢å•ï¼Œè°ƒç”¨å¾®ä¿¡æ”¯ä»˜ç»Ÿä¸€ä¸‹å•æ¥å£
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´
```
Authorization: Bearer {token}
Content-Type: application/json
```

### è¯·æ±‚å‚æ•°

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| productType | Integer | æ˜¯ | å•†å“ç±»å‹ï¼š1-VIPä¼šå‘˜ |
| vipLevel | Integer | æ˜¯ | VIPç­‰çº§ï¼š1-æœˆåº¦ 2-å­£åº¦ 3-å¹´åº¦ |

### VIPå¥—é¤è¯´æ˜

| VIPç­‰çº§ | å¥—é¤åç§° | ä»·æ ¼ | æœ‰æ•ˆæœŸ |
|---------|---------|------|--------|
| 1 | æœˆåº¦ä¼šå‘˜ | Â¥29.9 | 30å¤© |
| 2 | å­£åº¦ä¼šå‘˜ | Â¥79.9 | 90å¤© |
| 3 | å¹´åº¦ä¼šå‘˜ | Â¥299.9 | 365å¤© |

### è¯·æ±‚ç¤ºä¾‹

```bash
curl -X POST http://localhost:8080/api/payment/create-order \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "productType": 1,
    "vipLevel": 1
  }'
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "orderNo": "PO1699876543210ABC",
    "userId": "U17623500638845TAWQ0",
    "productType": 1,
    "vipLevel": 1,
    "vipLevelName": "æœˆåº¦ä¼šå‘˜",
    "amount": 29.90,
    "paymentStatus": 0,
    "paymentStatusName": "å¾…æ”¯ä»˜",
    "paymentMethod": 1,
    "wxPayParams": {
      "timeStamp": "1699876543",
      "nonceStr": "a1b2c3d4e5f6",
      "packageValue": "prepay_id=wx201699876543abcd",
      "signType": "MD5",
      "paySign": "9A5B7C3D1E2F4A6B8C0D1E2F3A4B5C6D"
    },
    "createdAt": "2025-11-07T16:00:00"
  },
  "traceId": "abc123"
}
```

### å“åº”å­—æ®µè¯´æ˜

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| orderNo | String | è®¢å•å·ï¼ˆå…¨å±€å”¯ä¸€ï¼‰ |
| wxPayParams | Object | å¾®ä¿¡æ”¯ä»˜å‚æ•°ï¼ˆç”¨äºè°ƒèµ·æ”¯ä»˜ï¼‰ |
| timeStamp | String | æ—¶é—´æˆ³ |
| nonceStr | String | éšæœºå­—ç¬¦ä¸² |
| packageValue | String | é¢„æ”¯ä»˜äº¤æ˜“ä¼šè¯æ ‡è¯† |
| signType | String | ç­¾åç±»å‹ï¼ˆå›ºå®šMD5ï¼‰ |
| paySign | String | ç­¾å |

### å‰ç«¯è°ƒèµ·æ”¯ä»˜ç¤ºä¾‹

```javascript
// 1. åˆ›å»ºè®¢å•
const orderRes = await fetch('/api/payment/create-order', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${token}`,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({ productType: 1, vipLevel: 1 })
});

const { data } = await orderRes.json();

// 2. è°ƒèµ·å¾®ä¿¡æ”¯ä»˜
wx.requestPayment({
  timeStamp: data.wxPayParams.timeStamp,
  nonceStr: data.wxPayParams.nonceStr,
  package: data.wxPayParams.packageValue,
  signType: data.wxPayParams.signType,
  paySign: data.wxPayParams.paySign,
  success: function(res) {
    console.log('æ”¯ä»˜æˆåŠŸ');
    // æŸ¥è¯¢è®¢å•çŠ¶æ€æˆ–åˆ·æ–°VIPä¿¡æ¯
  },
  fail: function(err) {
    console.error('æ”¯ä»˜å¤±è´¥', err);
  }
});
```

---

## 49. æŸ¥è¯¢è®¢å•

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`GET /api/payment/order/{orderNo}`
- **æ¥å£è¯´æ˜**ï¼šæ ¹æ®è®¢å•å·æŸ¥è¯¢è®¢å•è¯¦æƒ…å’Œæ”¯ä»˜çŠ¶æ€
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´
```
Authorization: Bearer {token}
```

### è·¯å¾„å‚æ•°

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| orderNo | String | æ˜¯ | è®¢å•å· |

### è¯·æ±‚ç¤ºä¾‹

```bash
curl -X GET http://localhost:8080/api/payment/order/PO1699876543210ABC \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "orderNo": "PO1699876543210ABC",
    "userId": "U17623500638845TAWQ0",
    "productType": 1,
    "vipLevel": 1,
    "vipLevelName": "æœˆåº¦ä¼šå‘˜",
    "amount": 29.90,
    "paymentStatus": 1,
    "paymentStatusName": "å·²æ”¯ä»˜",
    "paymentMethod": 1,
    "transactionId": "4200001234567890",
    "createdAt": "2025-11-07T16:00:00",
    "paidAt": "2025-11-07T16:05:30"
  },
  "traceId": "abc123"
}
```

### æ”¯ä»˜çŠ¶æ€è¯´æ˜

| çŠ¶æ€å€¼ | çŠ¶æ€åç§° | è¯´æ˜ |
|--------|---------|------|
| 0 | å¾…æ”¯ä»˜ | è®¢å•å·²åˆ›å»ºï¼Œç­‰å¾…æ”¯ä»˜ |
| 1 | å·²æ”¯ä»˜ | æ”¯ä»˜æˆåŠŸï¼ŒVIPå·²å¼€é€š |
| 2 | å·²å–æ¶ˆ | ç”¨æˆ·ä¸»åŠ¨å–æ¶ˆè®¢å• |
| 3 | å·²é€€æ¬¾ | å·²é€€æ¬¾ï¼ˆé¢„ç•™ï¼‰ |

---

## 50. å–æ¶ˆè®¢å•

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`POST /api/payment/order/{orderNo}/cancel`
- **æ¥å£è¯´æ˜**ï¼šå–æ¶ˆå¾…æ”¯ä»˜çŠ¶æ€çš„è®¢å•
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´
```
Authorization: Bearer {token}
```

### è·¯å¾„å‚æ•°

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| orderNo | String | æ˜¯ | è®¢å•å· |

### è¯·æ±‚ç¤ºä¾‹

```bash
curl -X POST http://localhost:8080/api/payment/order/PO1699876543210ABC/cancel \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "è®¢å•å–æ¶ˆæˆåŠŸ",
  "traceId": "abc123"
}
```

### ä¸šåŠ¡è§„åˆ™

1. **åªèƒ½å–æ¶ˆå¾…æ”¯ä»˜è®¢å•**
   - å·²æ”¯ä»˜è®¢å•ä¸èƒ½å–æ¶ˆ
   - å·²å–æ¶ˆè®¢å•é‡å¤æ“ä½œä¼šè¿”å›é”™è¯¯

2. **å–æ¶ˆå**
   - è®¢å•çŠ¶æ€å˜ä¸º"å·²å–æ¶ˆ"
   - ä¸ä¼šé€€æ¬¾ï¼ˆå› ä¸ºè¿˜æœªæ”¯ä»˜ï¼‰
   - ç”¨æˆ·å¯ä»¥é‡æ–°åˆ›å»ºæ–°è®¢å•

### é”™è¯¯ç¤ºä¾‹

```json
{
  "code": 400,
  "message": "è®¢å•ä¸å­˜åœ¨æˆ–å·²æ”¯ä»˜ï¼Œæ— æ³•å–æ¶ˆ",
  "traceId": "abc123"
}
```

---

## é™„å½•ï¼šå¹´é¾„ç®¡ç†è§„åˆ™è¯´æ˜

### å¹´é¾„å­—æ®µè§„åˆ™

1. **é¦–æ¬¡è®¾ç½®**
   - ç”¨æˆ·å®Œå–„èµ„æ–™æ—¶å¯ä»¥å¡«å†™`age`å­—æ®µ
   - å¡«å†™å`age_set_by_user`æ ‡è®°ä¸º1
   - ç”¨æˆ·åªèƒ½è®¾ç½®ä¸€æ¬¡

2. **å®åè®¤è¯åæ›´æ–°**
   - æäº¤å®åè®¤è¯æ—¶ï¼Œç³»ç»Ÿè‡ªåŠ¨ä»èº«ä»½è¯å·æå–ç”Ÿæ—¥
   - æ ¹æ®ç”Ÿæ—¥è®¡ç®—çœŸå®å¹´é¾„å¹¶æ›´æ–°
   - æ ‡è®°ä¸ºå·²å®åè®¤è¯

3. **ä¿®æ”¹é™åˆ¶**
   - `age_set_by_user=1`åï¼Œç”¨æˆ·æ— æ³•å†ä¿®æ”¹å¹´é¾„
   - å°è¯•ä¿®æ”¹ä¼šè¿”å›é”™è¯¯ï¼š"å¹´é¾„åªèƒ½è®¾ç½®ä¸€æ¬¡ï¼Œåç»­éœ€é€šè¿‡å®åè®¤è¯è‡ªåŠ¨æ›´æ–°"

### å­—æ®µè¯´æ˜

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| age | Integer | å¹´é¾„ |
| age_set_by_user | Integer | 0-æœªè®¾ç½®ï¼Œ1-å·²è®¾ç½® |
| is_real_name_verified | Integer | 0-æœªè®¤è¯ï¼Œ1-å·²è®¤è¯ |
| birthday | Date | ç”Ÿæ—¥ |
| real_name | String | çœŸå®å§“å |
| id_card | String | èº«ä»½è¯å· |

---

## æ¥å£æ›´æ–°æ—¥å¿—

### v1.5 (2025-11-07 18:00)
- ğŸ’° æ–°å¢ï¼šæ”¯ä»˜æ¨¡å—ï¼ˆ3ä¸ªæ¥å£ï¼‰â­
  - åˆ›å»ºè®¢å•ï¼ˆæ”¯æŒ3ç§VIPå¥—é¤ï¼‰
  - æŸ¥è¯¢è®¢å•è¯¦æƒ…
  - å–æ¶ˆè®¢å•
  - å¾®ä¿¡æ”¯ä»˜å›è°ƒå¤„ç†
  - è‡ªåŠ¨å¼€é€šVIPä¼šå‘˜
- ğŸ—ï¸ æ¶æ„ï¼šå®Œæ•´å¾®ä¿¡æ”¯ä»˜æµç¨‹æ¥å…¥
- ğŸ“– æ–‡æ¡£ï¼šæ–°å¢å¾®ä¿¡æ”¯ä»˜é›†æˆæ–‡æ¡£

### v1.4 (2025-11-07 15:30)
- âœ¨ æ–°å¢ï¼šåŠ¨æ€å¹¿åœºæ¨¡å—ï¼ˆ9ä¸ªæ¥å£ï¼‰
  - å‘å¸ƒåŠ¨æ€ï¼ˆæ”¯æŒ4ç§ç±»å‹ï¼šæ­å­ã€æ‹çˆ±ã€æ­å­æ´»åŠ¨ã€å®˜æ–¹æ´»åŠ¨ï¼‰
  - åŠ¨æ€åˆ—è¡¨æŸ¥è¯¢ï¼ˆæ”¯æŒç±»å‹ã€åŸå¸‚ç­›é€‰ï¼‰
  - åŠ¨æ€è¯¦æƒ…æŸ¥çœ‹
  - ç‚¹èµ/å–æ¶ˆç‚¹èµ
  - åˆ é™¤åŠ¨æ€
  - æ´»åŠ¨æŠ¥å/å–æ¶ˆæŠ¥å
  - å‘å¸ƒé™åˆ¶æŸ¥è¯¢
- âœ¨ æ–°å¢ï¼šVIPä¼šå‘˜æ¨¡å—ï¼ˆ3ä¸ªæ¥å£ï¼‰
  - è·å–VIPä¿¡æ¯
  - æ£€æŸ¥VIPçŠ¶æ€
  - æ£€æŸ¥VIPåŠŸèƒ½æƒé™
- ğŸ“ å®Œå–„ï¼šæ­å­å¹³å°å’Œçº¿ä¸‹æ´»åŠ¨å·²æ•´åˆåˆ°åŠ¨æ€å¹¿åœºæ¨¡å—
- ğŸ—ï¸ æ¶æ„ï¼šé‡‡ç”¨ç»Ÿä¸€è¡¨ç»“æ„è®¾è®¡ï¼Œé€šè¿‡momentTypeåŒºåˆ†åŠ¨æ€ç±»å‹
- ğŸ“Š æ•°æ®åº“ï¼šæ–°å¢12å¼ è¡¨ï¼ˆåŠ¨æ€æ¨¡å—7å¼ ï¼Œä¼šå‘˜æ¨¡å—5å¼ ï¼‰

### v1.3 (2025-11-02 21:30)
- âœ¨ æ–°å¢ï¼šTokenæ ¡éªŒæ¥å£ (POST /api/auth/token/validate)
- âœ¨ æ–°å¢ï¼šå›¾ç‰‡åˆ†ç±»æ–°å¢backgroundï¼ˆèƒŒæ™¯å¢™ï¼‰ç±»å‹
- ğŸ“ å®Œå–„ï¼šç”Ÿæ—¥å­—æ®µæ”¹ä¸ºå¯é€‰ï¼Œå¹´é¾„å­—æ®µæ”¹ä¸ºå¿…å¡«
- ğŸ“ å®Œå–„ï¼šOSSå›¾ç‰‡ä¸Šä¼ æ¥å£è¿”å›æ°¸ä¹…æœ‰æ•ˆçš„URLï¼ˆæ— è¿‡æœŸæ—¶é—´ï¼‰
- ğŸ“ å®Œå–„ï¼šMyBatis SQLæ—¥å¿—ç‹¬ç«‹è¾“å‡ºåˆ°å•ç‹¬æ–‡ä»¶ï¼ŒåŒ…å«traceID

### v1.2 (2025-11-02 20:45)
- âœ¨ æ–°å¢ï¼šæµ‹è¯•Tokenç”Ÿæˆæ¥å£ (POST /api/test/generate-token)
- âœ¨ æ–°å¢ï¼šå®åè®¤è¯æ¥å£ï¼ˆæäº¤ã€æŸ¥è¯¢çŠ¶æ€ï¼‰
- âœ¨ æ–°å¢ï¼šOSSå›¾ç‰‡ä¸Šä¼ æ¥å£ï¼ˆæ–‡ä»¶ã€Base64ã€æ‰¹é‡ï¼‰
- âœ¨ æ–°å¢ï¼šOSSå›¾ç‰‡åˆ é™¤å’Œç­¾åURLæ¥å£
- ğŸ“ å®Œå–„ï¼šå®Œå–„èµ„æ–™æ¥å£å¢åŠ ageå­—æ®µ
- ğŸ“ å®Œå–„ï¼šå®ç°å¹´é¾„ç®¡ç†è§„åˆ™ï¼ˆåªèƒ½è®¾ç½®ä¸€æ¬¡ï¼‰

### v1.1 (2025-11-01)
- âœ¨ æ–°å¢ï¼šæ›´æ–°èµ„æ–™æ¥å£ (POST /api/user/profile/update)
- âœ¨ æ–°å¢ï¼šæŸ¥çœ‹ä»–äººèµ„æ–™æ¥å£ (GET /api/user/profile/{userId})
- âœ¨ æ–°å¢ï¼šç›¸å†Œç®¡ç†æ¥å£ï¼ˆä¸Šä¼ ã€åˆ é™¤ã€è®¾ç½®å°é¢ï¼‰
- âœ¨ æ–°å¢ï¼šæ ‡ç­¾ç®¡ç†æ¥å£ï¼ˆè·å–æ ‡ç­¾åº“ã€è®¾ç½®æ ‡ç­¾ï¼‰
- âœ¨ æ–°å¢ï¼šéšç§è®¾ç½®æ¥å£ï¼ˆæ›´æ–°ã€è·å–ï¼‰
- âœ¨ æ–°å¢ï¼šé»‘åå•ç®¡ç†æ¥å£ï¼ˆæ‹‰é»‘ã€ç§»é™¤ï¼‰
- ğŸ“ å®Œå–„ï¼šè¡¥å……äº†11ä¸ªé—æ¼çš„æ¥å£æ–‡æ¡£
- ğŸ“ ä¼˜åŒ–ï¼šæ·»åŠ æ¥å£é€ŸæŸ¥è¡¨å’Œè¯¦ç»†çš„ä¸šåŠ¡è¯´æ˜
- ğŸ“ ä¼˜åŒ–ï¼šå®Œå–„å‰ç«¯é›†æˆç¤ºä¾‹

### v1.0 (2025-11-01)
- ğŸ‰ åˆå§‹ç‰ˆæœ¬
- âœ… å¾®ä¿¡ç™»å½•
- âœ… å®Œå–„èµ„æ–™
- âœ… æŸ¥çœ‹æˆ‘çš„èµ„æ–™
- âœ… æŸ¥çœ‹èµ„æ–™å®Œå–„çŠ¶æ€
- âœ… è·å–ç”¨æˆ·ç»Ÿè®¡æ•°æ®
- âœ… è®¾ç½®/è·å–åŒ¹é…åå¥½

---

**æ–‡æ¡£ç»“æŸ**

