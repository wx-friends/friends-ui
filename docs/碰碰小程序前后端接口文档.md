# ç¢°ç¢°å°ç¨‹åºå‰åç«¯æ¥å£æ–‡æ¡£

## æ–‡æ¡£ä¿¡æ¯
- **ç”Ÿæˆæ—¶é—´**ï¼š2025-11-02 21:30
- **æ›´æ–°æ—¶é—´**ï¼š2025-11-04ï¼ˆuserIdå­—æ®µç±»å‹å˜æ›´ï¼‰
- **æ¥å£æ•°é‡**ï¼š29ä¸ª
- **Base URL**ï¼š`http://localhost:8080`
- **è®¤è¯æ–¹å¼**ï¼šBearer Tokenï¼ˆJWTï¼‰

## âš ï¸ é‡è¦å˜æ›´è¯´æ˜

### userId å­—æ®µç±»å‹å˜æ›´ï¼ˆ2025-11-04ï¼‰

**å˜æ›´å†…å®¹**ï¼š
- æ‰€æœ‰æ¥å£è¿”å›çš„ `userId` å­—æ®µç±»å‹ä» `Long`ï¼ˆæ•°å­—ï¼‰ å˜æ›´ä¸º `String`ï¼ˆå­—ç¬¦ä¸²ï¼‰
- `userId` ç°åœ¨ä¸ºä¸šåŠ¡ç”¨æˆ·IDï¼Œæ ¼å¼ä¸ºï¼š`U` + 13ä½æ—¶é—´æˆ³ + 6ä½éšæœºå­—ç¬¦ï¼ˆå…±20ä½ï¼‰
- ç¤ºä¾‹ï¼š`U1699123456789AB12CD`

**å½±å“èŒƒå›´**ï¼š
1. **å¾®ä¿¡ç™»å½•æ¥å£**ï¼šè¿”å›çš„ `userId` ä¸º String ç±»å‹
2. **è·å–ç”¨æˆ·ä¿¡æ¯æ¥å£**ï¼šè¿”å›çš„ `userId` ä¸º String ç±»å‹
3. **ç”¨æˆ·èµ„æ–™æ¥å£**ï¼šè¿”å›çš„ `userId` ä¸º String ç±»å‹
4. **æŸ¥çœ‹ä»–äººèµ„æ–™æ¥å£**ï¼šè·¯å¾„å‚æ•° `userId` éœ€ä¼  String ç±»å‹çš„ä¸šåŠ¡ç”¨æˆ·ID
5. **åŒ¹é…åå¥½æ¥å£**ï¼šè¿”å›çš„ `userId` ä¸º String ç±»å‹

**å‰ç«¯é€‚é…è¦ç‚¹**ï¼š
```typescript
// ä¿®æ”¹å‰
interface User {
  userId: number;  // Longç±»å‹
}

// ä¿®æ”¹å
interface User {
  userId: string;  // Stringç±»å‹ï¼Œä¸šåŠ¡ç”¨æˆ·ID
}
```

**å†…éƒ¨å®ç°**ï¼š
- JWT Token å†…éƒ¨ä»ä½¿ç”¨æ•°æ®åº“è‡ªå¢IDï¼ˆLongç±»å‹ï¼‰è¿›è¡Œè®¤è¯
- å¯¹å¤–æ¥å£ç»Ÿä¸€è¿”å›ä¸šåŠ¡ç”¨æˆ·IDï¼ˆStringç±»å‹ï¼‰
- æ•°æ®åº“ä¸­åŒæ—¶å­˜å‚¨æ•°æ®åº“IDï¼ˆ`id`å­—æ®µï¼‰å’Œä¸šåŠ¡ç”¨æˆ·IDï¼ˆ`user_id`å­—æ®µï¼‰

---

## æ¥å£ç›®å½•

### è®¤è¯ç›¸å…³
1. [å¾®ä¿¡ç™»å½•](#1-å¾®ä¿¡ç™»å½•)
2. [ç”Ÿæˆæµ‹è¯•Token](#2-ç”Ÿæˆæµ‹è¯•tokenä»…å¼€å‘ç¯å¢ƒ)
3. [æ ¡éªŒToken](#3-æ ¡éªŒtoken)

### ç”¨æˆ·èµ„æ–™
4. [å®Œå–„èµ„æ–™](#4-å®Œå–„èµ„æ–™)
5. [æ›´æ–°èµ„æ–™](#5-æ›´æ–°èµ„æ–™)
6. [æŸ¥çœ‹æˆ‘çš„èµ„æ–™](#6-æŸ¥çœ‹æˆ‘çš„èµ„æ–™)
7. [æŸ¥çœ‹ä»–äººèµ„æ–™](#7-æŸ¥çœ‹ä»–äººèµ„æ–™)
8. [æŸ¥çœ‹èµ„æ–™å®Œå–„çŠ¶æ€](#8-æŸ¥çœ‹èµ„æ–™å®Œå–„çŠ¶æ€)
9. [è·å–ç”¨æˆ·ç»Ÿè®¡æ•°æ®](#9-è·å–ç”¨æˆ·ç»Ÿè®¡æ•°æ®)

### å®åè®¤è¯
10. [æäº¤å®åè®¤è¯](#10-æäº¤å®åè®¤è¯)
11. [æŸ¥è¯¢å®åè®¤è¯çŠ¶æ€](#11-æŸ¥è¯¢å®åè®¤è¯çŠ¶æ€)

### ç›¸å†Œç®¡ç†
12. [ä¸Šä¼ ç…§ç‰‡](#12-ä¸Šä¼ ç…§ç‰‡)
13. [åˆ é™¤ç…§ç‰‡](#13-åˆ é™¤ç…§ç‰‡)
14. [è®¾ç½®å°é¢ç…§ç‰‡](#14-è®¾ç½®å°é¢ç…§ç‰‡)

### æ ‡ç­¾ç®¡ç†
15. [è·å–æ ‡ç­¾åº“](#15-è·å–æ ‡ç­¾åº“)
16. [è®¾ç½®æˆ‘çš„æ ‡ç­¾](#16-è®¾ç½®æˆ‘çš„æ ‡ç­¾)

### éšç§è®¾ç½®
17. [æ›´æ–°éšç§è®¾ç½®](#17-æ›´æ–°éšç§è®¾ç½®)
18. [è·å–éšç§è®¾ç½®](#18-è·å–éšç§è®¾ç½®)

### é»‘åå•ç®¡ç†
19. [æ‹‰é»‘ç”¨æˆ·](#19-æ‹‰é»‘ç”¨æˆ·)
20. [ç§»é™¤é»‘åå•](#20-ç§»é™¤é»‘åå•)

### åŒ¹é…åå¥½
21. [è®¾ç½®åŒ¹é…åå¥½](#21-è®¾ç½®åŒ¹é…åå¥½)
22. [è·å–åŒ¹é…åå¥½](#22-è·å–åŒ¹é…åå¥½)

### OSSå›¾ç‰‡ä¸Šä¼ 
23. [ä¸Šä¼ å›¾ç‰‡ï¼ˆæ–‡ä»¶æ–¹å¼ï¼‰](#23-ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶æ–¹å¼)
24. [ä¸Šä¼ å›¾ç‰‡ï¼ˆBase64æ–¹å¼ï¼‰](#24-ä¸Šä¼ å›¾ç‰‡base64æ–¹å¼)
25. [æ‰¹é‡ä¸Šä¼ å›¾ç‰‡](#25-æ‰¹é‡ä¸Šä¼ å›¾ç‰‡)
26. [åˆ é™¤OSSå›¾ç‰‡](#26-åˆ é™¤osså›¾ç‰‡)
27. [è·å–å›¾ç‰‡ç­¾åURL](#27-è·å–å›¾ç‰‡ç­¾åurl)

---

## 1. å¾®ä¿¡ç™»å½•

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`POST /api/auth/wx/login`
- **æ¥å£è¯´æ˜**ï¼šå¾®ä¿¡å°ç¨‹åºç™»å½•ï¼Œè¿”å›ç”¨æˆ·ä¿¡æ¯å’ŒçŠ¶æ€æ ‡è¯†
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šå¦

### è¯·æ±‚å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| code | String | æ˜¯ | å¾®ä¿¡ç™»å½•code |

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X POST http://localhost:8080/api/auth/wx/login \
  -H "Content-Type: application/json" \
  -d "{\"code\": \"test_code_12345\"}"
```

**è¯·æ±‚Body**ï¼š
```json
{
  "code": "test_code_12345"
}
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiJ9.eyJ1c2VySWQiOjEwMDF9...",
    "userId": "U1699123456789AB12CD",
    "isNewUser": false,
    "nickname": "æµ‹è¯•ç”¨æˆ·",
    "avatar": "https://example.com/avatar.jpg",
    "vipLevel": 0,
    "profileComplete": 0,
    "matchPreferenceSet": 0
  }
}
```

### å“åº”å­—æ®µè¯´æ˜

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| token | String | JWTè®¿é—®ä»¤ç‰Œï¼ˆå†…éƒ¨åŒ…å«æ•°æ®åº“IDç”¨äºè®¤è¯ï¼‰ |
| userId | String | ä¸šåŠ¡ç”¨æˆ·IDï¼ˆç”¨äºå¯¹å¤–å±•ç¤ºï¼Œæ ¼å¼ï¼šU + æ—¶é—´æˆ³ + éšæœºæ•°ï¼‰ |
| isNewUser | Boolean | æ˜¯å¦æ–°ç”¨æˆ· |
| nickname | String | ç”¨æˆ·æ˜µç§° |
| avatar | String | ç”¨æˆ·å¤´åƒ |
| vipLevel | Integer | ä¼šå‘˜ç­‰çº§ï¼ˆ0-æ™®é€šï¼Œ1-VIPï¼Œ2-SVIPï¼‰ |
| **profileComplete** | **Integer** | **èµ„æ–™æ˜¯å¦å®Œå–„ï¼ˆ0-å¦ï¼Œ1-æ˜¯ï¼‰** |
| **matchPreferenceSet** | **Integer** | **åŒ¹é…åå¥½æ˜¯å¦è®¾ç½®ï¼ˆ0-æœªè®¾ç½®ï¼Œ1-å·²è®¾ç½®ï¼‰** |

### ä¸šåŠ¡è¯´æ˜

ç™»å½•åæ ¹æ®ä¸¤ä¸ªæ ‡å¿—ä½å¼•å¯¼ç”¨æˆ·ï¼š

1. **profileComplete = 0**ï¼šå¼•å¯¼ç”¨æˆ·å®Œå–„èµ„æ–™
2. **profileComplete = 1 ä¸” matchPreferenceSet = 0**ï¼šå¼•å¯¼ç”¨æˆ·è®¾ç½®åŒ¹é…åå¥½
3. **ä¸¤è€…éƒ½ä¸º1**ï¼šè¿›å…¥ä¸»é¡µï¼Œå¼€å§‹åŒ¹é…

---

## 2. ç”Ÿæˆæµ‹è¯•Tokenï¼ˆä»…å¼€å‘ç¯å¢ƒï¼‰

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`POST /api/test/generate-token`
- **æ¥å£è¯´æ˜**ï¼šç”Ÿæˆæµ‹è¯•ç”¨çš„JWT Tokenï¼Œæ— éœ€å¾®ä¿¡ç™»å½•ï¼ˆä»…åœ¨devå’Œuatç¯å¢ƒå¯ç”¨ï¼‰
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šå¦

### è¯·æ±‚å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| userId | Long | å¦ | ç”¨æˆ·IDï¼ˆé»˜è®¤1001ï¼‰ |
| vipLevel | Integer | å¦ | ä¼šå‘˜ç­‰çº§ï¼ˆé»˜è®¤0ï¼‰ |

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X POST "http://localhost:8080/api/test/generate-token?userId=7&vipLevel=0"
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "æµ‹è¯•Tokenç”ŸæˆæˆåŠŸ",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiJ9...",
    "userId": 7,
    "openid": "test_openid_7",
    "vipLevel": 0,
    "expiresIn": 604800,
    "authHeader": "Bearer eyJhbGciOiJIUzI1NiJ9..."
  }
}
```

### ä¸šåŠ¡è¯´æ˜

1. **ä»…ç”¨äºå¼€å‘æµ‹è¯•**ï¼šç”Ÿäº§ç¯å¢ƒä¸å¯ç”¨
2. **Tokenæœ‰æ•ˆæœŸ**ï¼š7å¤©
3. **è‡ªåŠ¨å­˜å…¥Redis**ï¼šæ¨¡æ‹Ÿç™»å½•çŠ¶æ€

---

## 3. æ ¡éªŒToken

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`POST /api/auth/token/validate`
- **æ¥å£è¯´æ˜**ï¼šæ ¡éªŒJWT Tokençš„æœ‰æ•ˆæ€§ï¼Œè¿”å›Tokenç›¸å…³ä¿¡æ¯
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šå¦ï¼ˆä½†éœ€è¦æä¾›Tokenï¼‰

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
```

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X POST http://localhost:8080/api/auth/token/validate \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### å“åº”ç¤ºä¾‹

**Tokenæœ‰æ•ˆ**ï¼š
```json
{
  "code": 200,
  "message": "Tokenæœ‰æ•ˆ",
  "data": {
    "valid": true,
    "userId": "U1699123456789AB12CD",
    "openid": "oAB***xyz",
    "vipLevel": 0,
    "expireTime": 1730000000000
  }
}
```

**Tokenæ— æ•ˆ**ï¼š
```json
{
  "code": 401,
  "message": "Tokenå·²å¤±æ•ˆæˆ–ç”¨æˆ·å·²ç™»å‡º",
  "data": {
    "valid": false,
    "userId": null,
    "openid": null,
    "vipLevel": null,
    "expireTime": null,
    "reason": "Tokenå·²å¤±æ•ˆæˆ–ç”¨æˆ·å·²ç™»å‡º"
  }
}
```

### å“åº”å­—æ®µè¯´æ˜

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| valid | Boolean | Tokenæ˜¯å¦æœ‰æ•ˆ |
| userId | String | ç”¨æˆ·IDï¼ˆä¸šåŠ¡ç”¨æˆ·IDï¼‰ |
| openid | String | å¾®ä¿¡OpenIDï¼ˆè„±æ•æ˜¾ç¤ºï¼‰ |
| vipLevel | Integer | ä¼šå‘˜ç­‰çº§ï¼ˆ0-æ™®é€šï¼Œ1-VIPï¼Œ2-SVIPï¼‰ |
| expireTime | Long | Tokenè¿‡æœŸæ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰ |
| reason | String | å¤±è´¥åŸå› ï¼ˆä»…åœ¨valid=falseæ—¶æœ‰å€¼ï¼‰ |

### ä¸šåŠ¡è¯´æ˜

1. **å¤šé‡éªŒè¯**ï¼š
   - JWTç­¾åéªŒè¯
   - Tokenè¿‡æœŸæ—¶é—´éªŒè¯
   - Redisç¼“å­˜éªŒè¯ï¼ˆé˜²æ­¢tokenè¢«ç™»å‡ºåä»ç„¶ä½¿ç”¨ï¼‰
   - ç”¨æˆ·çŠ¶æ€éªŒè¯ï¼ˆç”¨æˆ·æ˜¯å¦å­˜åœ¨ã€æ˜¯å¦è¢«å°ç¦ï¼‰

2. **å¤±è´¥åŸå› **ï¼š
   - "Tokenæ— æ•ˆæˆ–å·²è¿‡æœŸ"ï¼šJWTç­¾åé”™è¯¯æˆ–å·²è¿‡æœŸ
   - "Tokenå·²å¤±æ•ˆæˆ–ç”¨æˆ·å·²ç™»å‡º"ï¼šç”¨æˆ·å·²ä¸»åŠ¨ç™»å‡º
   - "ç”¨æˆ·ä¸å­˜åœ¨"ï¼šç”¨æˆ·å·²è¢«åˆ é™¤
   - "ç”¨æˆ·å·²è¢«å°ç¦"ï¼šç”¨æˆ·è´¦å·è¢«å°ç¦

3. **å®‰å…¨æ€§**ï¼š
   - openidè¿›è¡Œè„±æ•æ˜¾ç¤º
   - ä¸ä¼šæš´éœ²æ•æ„Ÿä¿¡æ¯

---

## 4. å®Œå–„èµ„æ–™

**è¯´æ˜**ï¼šæ­¤æ¥å£ç”¨äº**é¦–æ¬¡å®Œå–„èµ„æ–™**æˆ–åç»­æ›´æ–°èµ„æ–™ï¼Œæ”¯æŒä¸€æ¬¡æ€§æäº¤æ‰€æœ‰å­—æ®µã€‚

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`POST /api/user/profile`
- **æ¥å£è¯´æ˜**ï¼šå®Œå–„æˆ–æ›´æ–°ç”¨æˆ·èµ„æ–™ï¼ˆæ”¯æŒä¸€æ¬¡æ€§æäº¤æ‰€æœ‰å¿…å¡«å­—æ®µï¼‰
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
Content-Type: application/json
```

### è¯·æ±‚å‚æ•°

#### å¿…å¡«å­—æ®µï¼ˆå®Œå–„èµ„æ–™æ—¶å¿…é¡»æä¾›ï¼‰

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| nickname | String | æ˜¯ | æ˜µç§°ï¼ˆæœ€å¤š50å­—ï¼‰ |
| avatar | String | æ˜¯ | å¤´åƒURLï¼ˆæœ€å¤š255å­—ï¼‰ |
| gender | Integer | æ˜¯ | æ€§åˆ«ï¼ˆ0-æœªçŸ¥ï¼Œ1-ç”·ï¼Œ2-å¥³ï¼‰ |
| age | Integer | æ˜¯ | å¹´é¾„ï¼ˆèŒƒå›´0-100ï¼Œç”¨æˆ·åªèƒ½è®¾ç½®ä¸€æ¬¡ï¼‰ |
| tagIds | Array | æ˜¯ | å…´è¶£æ ‡ç­¾IDåˆ—è¡¨ï¼ˆæœ€å¤š10ä¸ªï¼‰ |

#### å¯é€‰å­—æ®µï¼ˆç¼–è¾‘èµ„æ–™æ—¶å¯è¡¥å……ï¼‰

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| birthday | String | å¦ | ç”Ÿæ—¥ï¼ˆæ ¼å¼ï¼šYYYY-MM-DDï¼‰ |
| height | Integer | å¦ | èº«é«˜ï¼ˆcmï¼ŒèŒƒå›´100-250ï¼‰ |
| weight | Integer | å¦ | ä½“é‡ï¼ˆkgï¼ŒèŒƒå›´30-200ï¼‰ |
| occupation | String | å¦ | èŒä¸šï¼ˆæœ€å¤š50å­—ï¼‰ |
| education | String | å¦ | å­¦å†ï¼ˆæœ€å¤š20å­—ï¼‰ |
| income | String | å¦ | æ”¶å…¥ï¼ˆæœ€å¤š20å­—ï¼‰ |
| hometown | String | å¦ | å®¶ä¹¡ï¼ˆæœ€å¤š50å­—ï¼‰ |
| currentCity | String | å¦ | ç°å±…åŸå¸‚ï¼ˆæœ€å¤š50å­—ï¼‰ |
| bio | String | å¦ | ä¸ªäººç®€ä»‹ï¼ˆæœ€å¤š200å­—ï¼‰ |
| maritalStatus | String | å¦ | å©šå§»çŠ¶å†µï¼ˆæœ€å¤š20å­—ï¼‰ |

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X POST http://localhost:8080/api/user/profile \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "nickname": "æµ‹è¯•ç”¨æˆ·å°é›¨",
    "avatar": "https://example.com/avatar.jpg",
    "gender": 2,
    "birthday": "1998-05-20",
    "age": 25,
    "tagIds": [1, 5, 8],
    "height": 165,
    "occupation": "UIè®¾è®¡å¸ˆ",
    "education": "æœ¬ç§‘",
    "currentCity": "åŒ—äº¬å¸‚æœé˜³åŒº",
    "bio": "çƒ­çˆ±ç”Ÿæ´»ï¼Œå–œæ¬¢æ‘„å½±å’Œæ—…è¡Œã€‚"
  }'
```

**è¯·æ±‚Body**ï¼š
```json
{
  "nickname": "æµ‹è¯•ç”¨æˆ·å°é›¨",
  "avatar": "https://example.com/avatar.jpg",
  "gender": 2,
  "birthday": "1998-05-20",
  "age": 25,
  "tagIds": [1, 5, 8],
  "height": 165,
  "occupation": "UIè®¾è®¡å¸ˆ",
  "education": "æœ¬ç§‘",
  "currentCity": "åŒ—äº¬å¸‚æœé˜³åŒº",
  "bio": "çƒ­çˆ±ç”Ÿæ´»ï¼Œå–œæ¬¢æ‘„å½±å’Œæ—…è¡Œã€‚å¸Œæœ›èƒ½æ‰¾åˆ°å¿—åŒé“åˆçš„æœ‹å‹ã€‚"
}
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "èµ„æ–™ä¿å­˜æˆåŠŸ",
  "data": true
}
```

### ä¸šåŠ¡è¯´æ˜

1. **è‡ªåŠ¨æ›´æ–°WxUserè¡¨**ï¼šæ˜µç§°ã€å¤´åƒã€æ€§åˆ«ã€å¹´é¾„ã€ç”Ÿæ—¥ï¼ˆå¯é€‰ï¼‰
2. **è‡ªåŠ¨è®¾ç½®æ ‡ç­¾**ï¼šä¿å­˜åˆ°`t_user_tag`è¡¨
3. **è‡ªåŠ¨æ£€æŸ¥å®Œå–„çŠ¶æ€**ï¼šå¦‚æœ5ä¸ªå¿…å¡«å­—æ®µï¼ˆæ˜µç§°ã€å¤´åƒã€æ€§åˆ«ã€å¹´é¾„ã€æ ‡ç­¾ï¼‰éƒ½å¡«å†™ï¼Œè‡ªåŠ¨æ›´æ–°`profile_complete=1`
4. **æ€§åˆ«ä¸º0ï¼ˆæœªçŸ¥ï¼‰ä¸ç®—å®Œå–„**ï¼šå¿…é¡»é€‰æ‹©1æˆ–2

---

## 5. æ›´æ–°èµ„æ–™

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`POST /api/user/profile/update`
- **æ¥å£è¯´æ˜**ï¼šæ›´æ–°ç”¨æˆ·èµ„æ–™ï¼ˆä¸å®Œå–„èµ„æ–™ä½¿ç”¨åŒä¸€ä¸ªserviceæ–¹æ³•ï¼Œå‚æ•°ç›¸åŒï¼‰
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
Content-Type: application/json
```

### è¯·æ±‚å‚æ•°

å‚æ•°ä¸"å®Œå–„èµ„æ–™"æ¥å£å®Œå…¨ç›¸åŒï¼Œæ”¯æŒéƒ¨åˆ†æ›´æ–°ã€‚

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X POST http://localhost:8080/api/user/profile/update \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "bio": "æ›´æ–°åçš„ä¸ªäººç®€ä»‹",
    "currentCity": "æ·±åœ³å¸‚å—å±±åŒº"
  }'
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "èµ„æ–™æ›´æ–°æˆåŠŸ",
  "data": true
}
```

---

## 6. æŸ¥çœ‹æˆ‘çš„èµ„æ–™

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`GET /api/user/profile`
- **æ¥å£è¯´æ˜**ï¼šæŸ¥çœ‹å½“å‰ç™»å½•ç”¨æˆ·çš„å®Œæ•´èµ„æ–™
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
```

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X GET http://localhost:8080/api/user/profile \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "userId": "U1699123456789AB12CD",
    "nickname": "æµ‹è¯•ç”¨æˆ·å°é›¨",
    "avatar": "https://example.com/avatar.jpg",
    "gender": 2,
    "age": 27,
    "height": 165,
    "occupation": "UIè®¾è®¡å¸ˆ",
    "education": "æœ¬ç§‘",
    "income": null,
    "hometown": null,
    "currentCity": "åŒ—äº¬å¸‚æœé˜³åŒº",
    "bio": "çƒ­çˆ±ç”Ÿæ´»ï¼Œå–œæ¬¢æ‘„å½±å’Œæ—…è¡Œã€‚",
    "voiceIntroUrl": null,
    "isVerified": 0,
    "verifyStatus": 0,
    "photos": [],
    "tags": [
      {
        "tagId": 1,
        "tagName": "æ—…æ¸¸",
        "icon": "ğŸ–ï¸"
      },
      {
        "tagId": 5,
        "tagName": "ç”µå½±",
        "icon": "ğŸ¬"
      },
      {
        "tagId": 8,
        "tagName": "è¯»ä¹¦",
        "icon": "ğŸ“š"
      }
    ],
    "profileComplete": 1,
    "onlineStatus": 1,
    "lastLoginTime": "2025-11-01T21:15:00",
    "createdAt": "2025-10-28T10:00:00",
    "updatedAt": "2025-11-01T21:15:30"
  }
}
```

---

## 7. æŸ¥çœ‹ä»–äººèµ„æ–™

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`GET /api/user/profile/{userId}`
- **æ¥å£è¯´æ˜**ï¼šæŸ¥çœ‹å…¶ä»–ç”¨æˆ·çš„èµ„æ–™ï¼ˆä¼šæ ¹æ®éšç§è®¾ç½®è¿‡æ»¤éƒ¨åˆ†ä¿¡æ¯ï¼‰
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
```

### è·¯å¾„å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| userId | String | æ˜¯ | è¦æŸ¥çœ‹çš„ç”¨æˆ·IDï¼ˆä¸šåŠ¡ç”¨æˆ·IDï¼Œå¦‚ï¼šU1699123456789AB12CDï¼‰ |

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X GET http://localhost:8080/api/user/profile/U1699234567890CD34EF \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "userId": "U1699234567890CD34EF",
    "nickname": "æå››",
    "avatar": "https://example.com/avatar2.jpg",
    "gender": 1,
    "age": 28,
    "height": 180,
    "occupation": "äº§å“ç»ç†",
    "education": "ç¡•å£«",
    "currentCity": "åŒ—äº¬å¸‚æµ·æ·€åŒº",
    "bio": "å–œæ¬¢è¿åŠ¨å’Œè¯»ä¹¦",
    "isVerified": 1,
    "vipLevel": 1,
    "photos": [
      {
        "id": 1,
        "photoUrl": "https://example.com/photo1.jpg",
        "isCover": 1,
        "auditStatus": 1,
        "sortOrder": 0
      }
    ],
    "tags": [
      {
        "id": 2,
        "tagName": "å¥èº«",
        "category": "è¿åŠ¨",
        "icon": "icon-fitness"
      }
    ],
    "onlineStatus": 1,
    "lastLoginTime": "2025-11-01T20:00:00"
  }
}
```

### ä¸šåŠ¡è¯´æ˜

1. **éšç§è¿‡æ»¤**ï¼šæ ¹æ®è¢«æŸ¥çœ‹ç”¨æˆ·çš„éšç§è®¾ç½®ï¼ŒæŸäº›ä¿¡æ¯å¯èƒ½ä¸å¯è§
2. **é»‘åå•åˆ¤æ–­**ï¼šå¦‚æœåœ¨å¯¹æ–¹é»‘åå•ä¸­ï¼Œå¯èƒ½è¿”å›å—é™ä¿¡æ¯
3. **è·ç¦»æ˜¾ç¤º**ï¼šæ ¹æ®å¯¹æ–¹çš„éšç§è®¾ç½®å†³å®šæ˜¯å¦æ˜¾ç¤ºè·ç¦»

---

## 8. æŸ¥çœ‹èµ„æ–™å®Œå–„çŠ¶æ€

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`GET /api/user/profile/status`
- **æ¥å£è¯´æ˜**ï¼šæŸ¥çœ‹å½“å‰ç”¨æˆ·çš„èµ„æ–™å®Œå–„çŠ¶æ€å’Œç¼ºå¤±å­—æ®µ
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
```

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X GET http://localhost:8080/api/user/profile/status \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### å“åº”ç¤ºä¾‹

**èµ„æ–™æœªå®Œå–„æ—¶**ï¼š
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "profileComplete": false,
    "completionRate": 60,
    "completedFields": 3,
    "totalFields": 5,
    "missingFields": [
      "æ€§åˆ«",
      "å…´è¶£æ ‡ç­¾"
    ],
    "suggestions": [
      "è®¾ç½®æ‚¨çš„æ€§åˆ«ä¿¡æ¯",
      "é€‰æ‹©è‡³å°‘1ä¸ªå…´è¶£æ ‡ç­¾ï¼Œè®©åˆ«äººæ›´äº†è§£ä½ ",
      "ğŸ’¡ å»ºè®®ï¼šç»‘å®šæ‰‹æœºå·æé«˜ä¿¡ä»»åº¦",
      "ğŸ’¡ å»ºè®®ï¼šå¡«å†™èº«é«˜ä¿¡æ¯"
    ]
  }
}
```

**èµ„æ–™å·²å®Œå–„æ—¶**ï¼š
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "profileComplete": true,
    "completionRate": 100,
    "completedFields": 5,
    "totalFields": 5,
    "missingFields": [],
    "suggestions": [
      "ğŸ’¡ å»ºè®®ï¼šç»‘å®šæ‰‹æœºå·æé«˜ä¿¡ä»»åº¦",
      "ğŸ’¡ å»ºè®®ï¼šå¡«å†™èº«é«˜ä¿¡æ¯",
      "ğŸ’¡ å»ºè®®ï¼šå¡«å†™å­¦å†ä¿¡æ¯"
    ]
  }
}
```

### å“åº”å­—æ®µè¯´æ˜

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| profileComplete | Boolean | èµ„æ–™æ˜¯å¦å®Œå–„ |
| completionRate | Integer | å®Œå–„åº¦ç™¾åˆ†æ¯”ï¼ˆ0-100ï¼‰ |
| completedFields | Integer | å·²å®Œå–„çš„å¿…å¡«å­—æ®µæ•°é‡ |
| totalFields | Integer | æ€»å¿…å¡«å­—æ®µæ•°é‡ï¼ˆå›ºå®šä¸º5ï¼‰ |
| missingFields | Array | ç¼ºå¤±çš„å¿…å¡«å­—æ®µåˆ—è¡¨ |
| suggestions | Array | æ”¹è¿›å»ºè®®ï¼ˆåŒ…æ‹¬å¿…å¡«å’Œå¯é€‰å­—æ®µæç¤ºï¼‰ |

### å¿…å¡«å­—æ®µè¯´æ˜

1. æ˜µç§°
2. å¤´åƒ
3. æ€§åˆ«ï¼ˆ1æˆ–2ï¼Œ0ä¸ç®—å®Œå–„ï¼‰
4. å¹´é¾„
5. å…´è¶£æ ‡ç­¾ï¼ˆè‡³å°‘1ä¸ªï¼‰

---

## 9. è·å–ç”¨æˆ·ç»Ÿè®¡æ•°æ®

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`GET /api/user/stats`
- **æ¥å£è¯´æ˜**ï¼šè·å–ç”¨æˆ·çš„ç»Ÿè®¡æ•°æ®ï¼ˆå…³æ³¨ã€ç²‰ä¸ã€åŒ¹é…ç­‰ï¼‰
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
```

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X GET http://localhost:8080/api/user/stats \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "followingCount": 0,
    "followersCount": 0,
    "buddyMatchCount": 0,
    "activityJoinCount": 0,
    "momentCount": 0,
    "likedMeCount": 0,
    "myFavoritesCount": 0
  }
}
```

### å“åº”å­—æ®µè¯´æ˜

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| followingCount | Integer | å…³æ³¨æ•°é‡ |
| followersCount | Integer | ç²‰ä¸æ•°é‡ |
| buddyMatchCount | Integer | æ­å­åŒ¹é…æ•°é‡ |
| activityJoinCount | Integer | æ´»åŠ¨å‚ä¸æ•°é‡ |
| momentCount | Integer | åŠ¨æ€æ•°é‡ |
| likedMeCount | Integer | å–œæ¬¢æˆ‘çš„äººæ•° |
| myFavoritesCount | Integer | æˆ‘æ”¶è—çš„äººæ•° |

**æ³¨æ„**ï¼šå½“å‰ç‰ˆæœ¬æš‚æ—¶è¿”å›0ï¼Œç­‰ç›¸å…³æ¨¡å—å¼€å‘å®Œæˆåä¼šè¿”å›çœŸå®æ•°æ®ã€‚

---

## 12. ä¸Šä¼ ç…§ç‰‡

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`POST /api/user/album/upload`
- **æ¥å£è¯´æ˜**ï¼šä¸Šä¼ ç”¨æˆ·ç›¸å†Œç…§ç‰‡
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
Content-Type: application/json
```

### è¯·æ±‚å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| photoUrl | String | æ˜¯ | ç…§ç‰‡URLï¼ˆæœ€å¤š255å­—ï¼‰ |
| isCover | Boolean | å¦ | æ˜¯å¦è®¾ä¸ºå°é¢ï¼ˆé»˜è®¤falseï¼‰ |

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X POST http://localhost:8080/api/user/album/upload \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "photoUrl": "https://example.com/my-photo.jpg",
    "isCover": false
  }'
```

**è¯·æ±‚Body**ï¼š
```json
{
  "photoUrl": "https://example.com/my-photo.jpg",
  "isCover": false
}
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "ç…§ç‰‡ä¸Šä¼ æˆåŠŸ",
  "data": 123
}
```

### å“åº”å­—æ®µè¯´æ˜

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| data | Long | ä¸Šä¼ æˆåŠŸåçš„ç…§ç‰‡ID |

### ä¸šåŠ¡è¯´æ˜

1. **ç…§ç‰‡æ•°é‡é™åˆ¶**ï¼šæœ€å¤š9å¼ ç…§ç‰‡
2. **è‡ªåŠ¨å®¡æ ¸çŠ¶æ€**ï¼šä¸Šä¼ åçŠ¶æ€ä¸ºå¾…å®¡æ ¸ï¼ˆauditStatus=0ï¼‰
3. **å°é¢è®¾ç½®**ï¼šå¦‚æœisCover=trueï¼Œä¼šè‡ªåŠ¨è®¾ä¸ºå°é¢ç…§ç‰‡
4. **æ’åºè§„åˆ™**ï¼šæŒ‰ä¸Šä¼ æ—¶é—´è‡ªåŠ¨æ’åº

---

## 13. åˆ é™¤ç…§ç‰‡

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`DELETE /api/user/album/{photoId}`
- **æ¥å£è¯´æ˜**ï¼šåˆ é™¤æŒ‡å®šçš„ç›¸å†Œç…§ç‰‡
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
```

### è·¯å¾„å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| photoId | Long | æ˜¯ | ç…§ç‰‡ID |

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X DELETE http://localhost:8080/api/user/album/123 \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "ç…§ç‰‡åˆ é™¤æˆåŠŸ",
  "data": true
}
```

### ä¸šåŠ¡è¯´æ˜

1. **æƒé™éªŒè¯**ï¼šåªèƒ½åˆ é™¤è‡ªå·±çš„ç…§ç‰‡
2. **å°é¢å¤„ç†**ï¼šå¦‚æœåˆ é™¤çš„æ˜¯å°é¢ç…§ç‰‡ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å°†ç¬¬ä¸€å¼ ç…§ç‰‡è®¾ä¸ºå°é¢
3. **ç‰©ç†åˆ é™¤**ï¼šä»æ•°æ®åº“ä¸­ç‰©ç†åˆ é™¤è®°å½•

---

## 14. è®¾ç½®å°é¢ç…§ç‰‡

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`POST /api/user/album/cover/{photoId}`
- **æ¥å£è¯´æ˜**ï¼šå°†æŒ‡å®šç…§ç‰‡è®¾ç½®ä¸ºå°é¢
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
```

### è·¯å¾„å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| photoId | Long | æ˜¯ | ç…§ç‰‡ID |

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X POST http://localhost:8080/api/user/album/cover/123 \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "å°é¢è®¾ç½®æˆåŠŸ",
  "data": true
}
```

### ä¸šåŠ¡è¯´æ˜

1. **è‡ªåŠ¨å–æ¶ˆæ—§å°é¢**ï¼šè®¾ç½®æ–°å°é¢æ—¶ï¼Œæ—§å°é¢çš„isCoverä¼šè‡ªåŠ¨è®¾ä¸º0
2. **æƒé™éªŒè¯**ï¼šåªèƒ½è®¾ç½®è‡ªå·±çš„ç…§ç‰‡
3. **çŠ¶æ€æ£€æŸ¥**ï¼šåªæœ‰å®¡æ ¸é€šè¿‡çš„ç…§ç‰‡æ‰èƒ½è®¾ä¸ºå°é¢

---

## 15. è·å–æ ‡ç­¾åº“

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`GET /api/user/tags`
- **æ¥å£è¯´æ˜**ï¼šè·å–ç³»ç»Ÿæ ‡ç­¾åº“ï¼ˆæ‰€æœ‰å¯é€‰æ ‡ç­¾ï¼‰
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šå¦

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X GET http://localhost:8080/api/user/tags
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1,
      "tagName": "æ—…è¡Œ",
      "category": "å…´è¶£çˆ±å¥½",
      "icon": "icon-travel"
    },
    {
      "id": 2,
      "tagName": "å¥èº«",
      "category": "è¿åŠ¨",
      "icon": "icon-fitness"
    },
    {
      "id": 3,
      "tagName": "ç¾é£Ÿ",
      "category": "ç”Ÿæ´»",
      "icon": "icon-food"
    },
    {
      "id": 4,
      "tagName": "éŸ³ä¹",
      "category": "è‰ºæœ¯",
      "icon": "icon-music"
    },
    {
      "id": 5,
      "tagName": "ç”µå½±",
      "category": "å¨±ä¹",
      "icon": "icon-movie"
    }
  ]
}
```

### å“åº”å­—æ®µè¯´æ˜

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| id | Long | æ ‡ç­¾ID |
| tagName | String | æ ‡ç­¾åç§° |
| category | String | æ ‡ç­¾åˆ†ç±» |
| icon | String | æ ‡ç­¾å›¾æ ‡ |

---

## 16. è®¾ç½®æˆ‘çš„æ ‡ç­¾

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`POST /api/user/tags`
- **æ¥å£è¯´æ˜**ï¼šè®¾ç½®/æ›´æ–°å½“å‰ç”¨æˆ·çš„å…´è¶£æ ‡ç­¾
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
Content-Type: application/json
```

### è¯·æ±‚å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| tagIds | Array | æ˜¯ | æ ‡ç­¾IDåˆ—è¡¨ï¼ˆæœ€å¤š10ä¸ªï¼‰ |

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X POST http://localhost:8080/api/user/tags \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "tagIds": [1, 2, 3, 5, 8]
  }'
```

**è¯·æ±‚Body**ï¼š
```json
{
  "tagIds": [1, 2, 3, 5, 8]
}
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "æ ‡ç­¾è®¾ç½®æˆåŠŸ",
  "data": true
}
```

### ä¸šåŠ¡è¯´æ˜

1. **è¦†ç›–å¼æ›´æ–°**ï¼šæ–°æ ‡ç­¾ä¼šè¦†ç›–æ—§æ ‡ç­¾
2. **æ•°é‡é™åˆ¶**ï¼šæœ€å¤šé€‰æ‹©10ä¸ªæ ‡ç­¾
3. **å¿…å¡«é¡¹æ£€æŸ¥**ï¼šè‡³å°‘éœ€è¦1ä¸ªæ ‡ç­¾
4. **è‡ªåŠ¨æ›´æ–°å®Œå–„åº¦**ï¼šè®¾ç½®æ ‡ç­¾åä¼šå½±å“èµ„æ–™å®Œå–„çŠ¶æ€

---

## 17. æ›´æ–°éšç§è®¾ç½®

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`POST /api/user/privacy`
- **æ¥å£è¯´æ˜**ï¼šæ›´æ–°ç”¨æˆ·çš„éšç§è®¾ç½®
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
Content-Type: application/json
```

### è¯·æ±‚å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| whoCanSeeMe | Integer | å¦ | è°å¯ä»¥çœ‹æˆ‘ï¼ˆ1-æ‰€æœ‰äººï¼Œ2-ä»…åŒ¹é…çš„äººï¼Œ3-å…³é—­ï¼‰ |
| showDistance | Integer | å¦ | æ˜¾ç¤ºè·ç¦»ï¼ˆ0-å¦ï¼Œ1-æ˜¯ï¼‰ |
| showOnlineStatus | Integer | å¦ | æ˜¾ç¤ºåœ¨çº¿çŠ¶æ€ï¼ˆ0-å¦ï¼Œ1-æ˜¯ï¼‰ |

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X POST http://localhost:8080/api/user/privacy \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "whoCanSeeMe": 2,
    "showDistance": 1,
    "showOnlineStatus": 0
  }'
```

**è¯·æ±‚Body**ï¼š
```json
{
  "whoCanSeeMe": 2,
  "showDistance": 1,
  "showOnlineStatus": 0
}
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "éšç§è®¾ç½®æˆåŠŸ",
  "data": true
}
```

### ä¸šåŠ¡è¯´æ˜

1. **éƒ¨åˆ†æ›´æ–°**ï¼šåªæ›´æ–°æä¾›çš„å­—æ®µ
2. **é»˜è®¤å€¼**ï¼šé¦–æ¬¡è®¾ç½®æ—¶ï¼Œæœªæä¾›çš„å­—æ®µä½¿ç”¨é»˜è®¤å€¼ï¼ˆwhoCanSeeMe=1, showDistance=1, showOnlineStatus=1ï¼‰
3. **ç«‹å³ç”Ÿæ•ˆ**ï¼šè®¾ç½®åç«‹å³å½±å“å…¶ä»–ç”¨æˆ·æŸ¥çœ‹ä½ çš„èµ„æ–™

---

## 18. è·å–éšç§è®¾ç½®

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`GET /api/user/privacy`
- **æ¥å£è¯´æ˜**ï¼šè·å–å½“å‰ç”¨æˆ·çš„éšç§è®¾ç½®
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
```

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X GET http://localhost:8080/api/user/privacy \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "whoCanSeeMe": 2,
    "showDistance": 1,
    "showOnlineStatus": 0
  }
}
```

### å“åº”å­—æ®µè¯´æ˜

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| whoCanSeeMe | Integer | è°å¯ä»¥çœ‹æˆ‘ï¼ˆ1-æ‰€æœ‰äººï¼Œ2-ä»…åŒ¹é…çš„äººï¼Œ3-å…³é—­ï¼‰ |
| showDistance | Integer | æ˜¾ç¤ºè·ç¦»ï¼ˆ0-å¦ï¼Œ1-æ˜¯ï¼‰ |
| showOnlineStatus | Integer | æ˜¾ç¤ºåœ¨çº¿çŠ¶æ€ï¼ˆ0-å¦ï¼Œ1-æ˜¯ï¼‰ |

---

## 19. æ‹‰é»‘ç”¨æˆ·

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`POST /api/user/blacklist/{blockedUserId}`
- **æ¥å£è¯´æ˜**ï¼šå°†æŒ‡å®šç”¨æˆ·åŠ å…¥é»‘åå•
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
```

### è·¯å¾„å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| blockedUserId | String | æ˜¯ | è¦æ‹‰é»‘çš„ç”¨æˆ·IDï¼ˆä¸šåŠ¡ç”¨æˆ·IDï¼Œå¦‚ï¼šU1699123456789AB12CDï¼‰ |

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X POST http://localhost:8080/api/user/blacklist/U1699234567890CD34EF \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "æ‹‰é»‘æˆåŠŸ",
  "data": true
}
```

### ä¸šåŠ¡è¯´æ˜

1. **åŒå‘éš”ç¦»**ï¼šæ‹‰é»‘åï¼ŒåŒæ–¹éƒ½æ— æ³•çœ‹åˆ°å¯¹æ–¹çš„åŠ¨æ€å’Œèµ„æ–™
2. **è‡ªåŠ¨å–æ¶ˆå…³æ³¨**ï¼šæ‹‰é»‘åè‡ªåŠ¨å–æ¶ˆå…³æ³¨å’Œç²‰ä¸å…³ç³»
3. **èŠå¤©é™åˆ¶**ï¼šæ‹‰é»‘åæ— æ³•äº’ç›¸å‘é€æ¶ˆæ¯
4. **é‡å¤æ‹‰é»‘**ï¼šé‡å¤æ‹‰é»‘åŒä¸€ç”¨æˆ·ä¼šè¿”å›æˆåŠŸï¼ˆå¹‚ç­‰æ“ä½œï¼‰

---

## 20. ç§»é™¤é»‘åå•

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`DELETE /api/user/blacklist/{blockedUserId}`
- **æ¥å£è¯´æ˜**ï¼šå°†æŒ‡å®šç”¨æˆ·ä»é»‘åå•ç§»é™¤
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
```

### è·¯å¾„å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| blockedUserId | String | æ˜¯ | è¦ç§»é™¤çš„ç”¨æˆ·IDï¼ˆä¸šåŠ¡ç”¨æˆ·IDï¼Œå¦‚ï¼šU1699123456789AB12CDï¼‰ |

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X DELETE http://localhost:8080/api/user/blacklist/U1699234567890CD34EF \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "ç§»é™¤æˆåŠŸ",
  "data": true
}
```

### ä¸šåŠ¡è¯´æ˜

1. **æ¢å¤å¯è§**ï¼šç§»é™¤åï¼ŒåŒæ–¹å¯ä»¥é‡æ–°çœ‹åˆ°å¯¹æ–¹çš„èµ„æ–™
2. **ä¸æ¢å¤å…³æ³¨**ï¼šç§»é™¤é»‘åå•ä¸ä¼šè‡ªåŠ¨æ¢å¤ä¹‹å‰çš„å…³æ³¨å…³ç³»
3. **é‡å¤ç§»é™¤**ï¼šé‡å¤ç§»é™¤åŒä¸€ç”¨æˆ·ä¼šè¿”å›æˆåŠŸï¼ˆå¹‚ç­‰æ“ä½œï¼‰

---

## 21. è®¾ç½®åŒ¹é…åå¥½

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`POST /api/matching/preference`
- **æ¥å£è¯´æ˜**ï¼šè®¾ç½®ç”¨æˆ·çš„åŒ¹é…åå¥½æ¡ä»¶
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
Content-Type: application/json
```

### è¯·æ±‚å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| minAge | Integer | å¦ | æœŸæœ›æœ€å°å¹´é¾„ï¼ˆèŒƒå›´18-100ï¼‰ |
| maxAge | Integer | å¦ | æœŸæœ›æœ€å¤§å¹´é¾„ï¼ˆèŒƒå›´18-100ï¼‰ |
| minHeight | Integer | å¦ | æœŸæœ›æœ€å°èº«é«˜ï¼ˆèŒƒå›´100-250ï¼‰ |
| maxHeight | Integer | å¦ | æœŸæœ›æœ€å¤§èº«é«˜ï¼ˆèŒƒå›´100-250ï¼‰ |
| education | String | å¦ | æœŸæœ›å­¦å†ï¼ˆå¤šä¸ªç”¨é€—å·åˆ†éš”ï¼‰ |
| incomeRange | String | å¦ | æœŸæœ›æ”¶å…¥èŒƒå›´ |
| maxDistance | Integer | å¦ | æœ€å¤§è·ç¦»ï¼ˆkmï¼ŒèŒƒå›´1-1000ï¼‰ |
| locationLatitude | BigDecimal | å¦ | ç”¨æˆ·çº¬åº¦ |
| locationLongitude | BigDecimal | å¦ | ç”¨æˆ·ç»åº¦ |

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X POST http://localhost:8080/api/matching/preference \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "minAge": 20,
    "maxAge": 35,
    "minHeight": 160,
    "maxHeight": 180,
    "education": "æœ¬ç§‘,ç¡•å£«",
    "incomeRange": "10-20ä¸‡",
    "maxDistance": 10,
    "locationLatitude": 39.908823,
    "locationLongitude": 116.397470
  }'
```

**è¯·æ±‚Body**ï¼š
```json
{
  "minAge": 20,
  "maxAge": 35,
  "minHeight": 160,
  "maxHeight": 180,
  "education": "æœ¬ç§‘,ç¡•å£«",
  "incomeRange": "10-20ä¸‡",
  "maxDistance": 10,
  "locationLatitude": 39.908823,
  "locationLongitude": 116.397470
}
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "åŒ¹é…åå¥½è®¾ç½®æˆåŠŸ",
  "data": true
}
```

### ä¸šåŠ¡è¯´æ˜

1. **è‡ªåŠ¨æ›´æ–°æ ‡å¿—ä½**ï¼šè®¾ç½®æˆåŠŸåï¼Œè‡ªåŠ¨å°†`match_preference_set=1`
2. **æ”¯æŒéƒ¨åˆ†æ›´æ–°**ï¼šæ‰€æœ‰å‚æ•°éƒ½æ˜¯å¯é€‰çš„ï¼Œåªæ›´æ–°æä¾›çš„å­—æ®µ
3. **è¦†ç›–å¼æ›´æ–°**ï¼šæ–°çš„è®¾ç½®ä¼šè¦†ç›–æ—§çš„è®¾ç½®

---

## 22. è·å–åŒ¹é…åå¥½

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`GET /api/matching/preference`
- **æ¥å£è¯´æ˜**ï¼šè·å–å½“å‰ç”¨æˆ·çš„åŒ¹é…åå¥½è®¾ç½®
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
```

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X GET http://localhost:8080/api/matching/preference \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### å“åº”ç¤ºä¾‹

**å·²è®¾ç½®åå¥½æ—¶**ï¼š
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "userId": "U1699123456789AB12CD",
    "minAge": 20,
    "maxAge": 35,
    "minHeight": 160,
    "maxHeight": 180,
    "education": "æœ¬ç§‘,ç¡•å£«",
    "incomeRange": "10-20ä¸‡",
    "maxDistance": 10,
    "locationLatitude": 39.908823,
    "locationLongitude": 116.397470
  }
}
```

**æœªè®¾ç½®åå¥½æ—¶**ï¼š
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "userId": "U1699123456789AB12CD",
    "minAge": null,
    "maxAge": null,
    "minHeight": null,
    "maxHeight": null,
    "education": null,
    "incomeRange": null,
    "maxDistance": null,
    "locationLatitude": null,
    "locationLongitude": null
  }
}
```

---

## æ¥å£é€ŸæŸ¥è¡¨

| åºå· | æ¥å£è·¯å¾„ | æ–¹æ³• | è¯´æ˜ | è®¤è¯ |
|------|---------|------|------|------|
| 1 | `/api/auth/wx/login` | POST | å¾®ä¿¡ç™»å½• | âŒ |
| 2 | `/api/user/profile` | POST | å®Œå–„èµ„æ–™ | âœ… |
| 3 | `/api/user/profile/update` | POST | æ›´æ–°èµ„æ–™ | âœ… |
| 4 | `/api/user/profile` | GET | æŸ¥çœ‹æˆ‘çš„èµ„æ–™ | âœ… |
| 5 | `/api/user/profile/{userId}` | GET | æŸ¥çœ‹ä»–äººèµ„æ–™ | âœ… |
| 6 | `/api/user/profile/status` | GET | æŸ¥çœ‹èµ„æ–™å®Œå–„çŠ¶æ€ | âœ… |
| 7 | `/api/user/stats` | GET | è·å–ç”¨æˆ·ç»Ÿè®¡æ•°æ® | âœ… |
| 8 | `/api/user/album/upload` | POST | ä¸Šä¼ ç…§ç‰‡ | âœ… |
| 9 | `/api/user/album/{photoId}` | DELETE | åˆ é™¤ç…§ç‰‡ | âœ… |
| 10 | `/api/user/album/cover/{photoId}` | POST | è®¾ç½®å°é¢ç…§ç‰‡ | âœ… |
| 11 | `/api/user/tags` | GET | è·å–æ ‡ç­¾åº“ | âŒ |
| 12 | `/api/user/tags` | POST | è®¾ç½®æˆ‘çš„æ ‡ç­¾ | âœ… |
| 13 | `/api/user/privacy` | POST | æ›´æ–°éšç§è®¾ç½® | âœ… |
| 14 | `/api/user/privacy` | GET | è·å–éšç§è®¾ç½® | âœ… |
| 15 | `/api/user/blacklist/{blockedUserId}` | POST | æ‹‰é»‘ç”¨æˆ· | âœ… |
| 16 | `/api/user/blacklist/{blockedUserId}` | DELETE | ç§»é™¤é»‘åå• | âœ… |
| 17 | `/api/matching/preference` | POST | è®¾ç½®åŒ¹é…åå¥½ | âœ… |
| 18 | `/api/matching/preference` | GET | è·å–åŒ¹é…åå¥½ | âœ… |

---

## å®Œæ•´æµ‹è¯•æµç¨‹

### Step 1: å¾®ä¿¡ç™»å½•
```bash
curl -X POST http://localhost:8080/api/auth/wx/login \
  -H "Content-Type: application/json" \
  -d '{"code": "test_code_12345"}'
```

**è·å–token**ï¼šä»å“åº”ä¸­æå–`data.token`

### Step 2: å®Œå–„èµ„æ–™
```bash
TOKEN="ä»ä¸Šä¸€æ­¥è·å–çš„token"

curl -X POST http://localhost:8080/api/user/profile \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TOKEN" \
  -d '{
    "nickname": "æµ‹è¯•ç”¨æˆ·",
    "avatar": "https://example.com/avatar.jpg",
    "gender": 2,
    "birthday": "1998-05-20",
    "tagIds": [1, 5, 8]
  }'
```

### Step 3: æ£€æŸ¥èµ„æ–™çŠ¶æ€
```bash
curl -X GET http://localhost:8080/api/user/profile/status \
  -H "Authorization: Bearer $TOKEN"
```

### Step 4: è®¾ç½®åŒ¹é…åå¥½
```bash
curl -X POST http://localhost:8080/api/matching/preference \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TOKEN" \
  -d '{
    "minAge": 20,
    "maxAge": 35,
    "maxDistance": 10
  }'
```

### Step 5: ä¸Šä¼ ç…§ç‰‡
```bash
curl -X POST http://localhost:8080/api/user/album/upload \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TOKEN" \
  -d '{
    "photoUrl": "https://example.com/photo1.jpg",
    "isCover": true
  }'
```

### Step 6: è·å–æ ‡ç­¾åº“å¹¶è®¾ç½®æ ‡ç­¾
```bash
# è·å–æ ‡ç­¾åº“
curl -X GET http://localhost:8080/api/user/tags

# è®¾ç½®æˆ‘çš„æ ‡ç­¾
curl -X POST http://localhost:8080/api/user/tags \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TOKEN" \
  -d '{
    "tagIds": [1, 2, 3, 5]
  }'
```

### Step 7: è®¾ç½®éšç§
```bash
curl -X POST http://localhost:8080/api/user/privacy \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TOKEN" \
  -d '{
    "whoCanSeeMe": 2,
    "showDistance": 1,
    "showOnlineStatus": 0
  }'
```

### Step 8: æŸ¥çœ‹ä»–äººèµ„æ–™
```bash
curl -X GET http://localhost:8080/api/user/profile/1002 \
  -H "Authorization: Bearer $TOKEN"
```

### Step 9: éªŒè¯çŠ¶æ€
```bash
# å†æ¬¡ç™»å½•ï¼ŒæŸ¥çœ‹æ ‡å¿—ä½
curl -X POST http://localhost:8080/api/auth/wx/login \
  -H "Content-Type: application/json" \
  -d '{"code": "test_code_12345"}'
```

**é¢„æœŸç»“æœ**ï¼š
```json
{
  "profileComplete": 1,
  "matchPreferenceSet": 1
}
```

---

## é”™è¯¯ç è¯´æ˜

| é”™è¯¯ç  | è¯´æ˜ |
|--------|------|
| 200 | æˆåŠŸ |
| 400 | è¯·æ±‚å‚æ•°é”™è¯¯ |
| 401 | æœªç™»å½•æˆ–tokenæ— æ•ˆ |
| 404 | ç”¨æˆ·ä¸å­˜åœ¨ |
| 40001 | ç…§ç‰‡æ•°é‡è¶…é™ |
| 40002 | æ ‡ç­¾æ•°é‡è¶…é™ï¼ˆæœ€å¤š10ä¸ªï¼‰ |
| 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ |

---

## å¸¸è§é—®é¢˜

### 1. ä¸ºä»€ä¹ˆæˆ‘è®¾ç½®äº†èµ„æ–™ï¼ŒprofileCompleteè¿˜æ˜¯0ï¼Ÿ

**å¯èƒ½åŸå› **ï¼š
- æ€§åˆ«ä¸º0ï¼ˆæœªçŸ¥ï¼‰
- ç¼ºå°‘å…´è¶£æ ‡ç­¾
- æ˜µç§°ã€å¤´åƒã€ç”Ÿæ—¥æœªå¡«å†™

**è§£å†³æ–¹æ¡ˆ**ï¼šè°ƒç”¨`/api/user/profile/status`æŸ¥çœ‹ç¼ºå¤±å­—æ®µ

### 2. å¯ä»¥åªæ›´æ–°éƒ¨åˆ†å­—æ®µå—ï¼Ÿ

**å¯ä»¥ï¼** æ‰€æœ‰å­—æ®µéƒ½æ˜¯å¯é€‰çš„ï¼Œåªæ›´æ–°æä¾›çš„å­—æ®µã€‚

### 3. æ ‡ç­¾æœ€å¤šå¯ä»¥é€‰å‡ ä¸ªï¼Ÿ

**æœ€å¤š10ä¸ª**ã€‚å®Œå–„èµ„æ–™æ—¶è‡³å°‘é€‰1ä¸ªï¼Œå¦åˆ™profileCompleteä¸ä¼šå˜ä¸º1ã€‚

### 4. æ€§åˆ«å¯ä»¥è®¾ç½®ä¸º0ï¼ˆæœªçŸ¥ï¼‰å—ï¼Ÿ

**å¯ä»¥è®¾ç½®ï¼Œä½†ä¸ç®—å®Œå–„ã€‚** èµ„æ–™å®Œå–„åˆ¤æ–­æ—¶ï¼Œæ€§åˆ«å¿…é¡»æ˜¯1æˆ–2ã€‚

### 5. å®Œå–„èµ„æ–™å’Œæ›´æ–°èµ„æ–™æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**æ²¡æœ‰æœ¬è´¨åŒºåˆ«**ã€‚ä¸¤ä¸ªæ¥å£éƒ½è°ƒç”¨åŒä¸€ä¸ªserviceæ–¹æ³•ï¼Œåªæ˜¯è·¯å¾„å’Œè¿”å›æ¶ˆæ¯ä¸åŒï¼š
- `/api/user/profile` - è¿”å›"èµ„æ–™ä¿å­˜æˆåŠŸ"
- `/api/user/profile/update` - è¿”å›"èµ„æ–™æ›´æ–°æˆåŠŸ"

### 6. ç…§ç‰‡æœ€å¤šå¯ä»¥ä¸Šä¼ å‡ å¼ ï¼Ÿ

**æœ€å¤š9å¼ **ã€‚è¶…è¿‡é™åˆ¶ä¼šè¿”å›é”™è¯¯ç 40001ã€‚

### 7. å¦‚ä½•æŸ¥çœ‹ä»–äººèµ„æ–™ï¼Ÿ

ä½¿ç”¨ `GET /api/user/profile/{userId}`ï¼Œä¼šæ ¹æ®å¯¹æ–¹çš„éšç§è®¾ç½®è¿”å›ç›¸åº”ä¿¡æ¯ã€‚

### 8. æ‹‰é»‘ç”¨æˆ·åä¼šæœ‰ä»€ä¹ˆå½±å“ï¼Ÿ

- åŒæ–¹æ— æ³•çœ‹åˆ°å¯¹æ–¹çš„åŠ¨æ€å’Œèµ„æ–™
- è‡ªåŠ¨å–æ¶ˆå…³æ³¨å’Œç²‰ä¸å…³ç³»
- æ— æ³•äº’ç›¸å‘é€æ¶ˆæ¯

### 9. éšç§è®¾ç½®ä¸­"è°å¯ä»¥çœ‹æˆ‘"çš„é€‰é¡¹è¯´æ˜ï¼Ÿ

- **1-æ‰€æœ‰äºº**ï¼šä»»ä½•ç”¨æˆ·éƒ½å¯ä»¥æŸ¥çœ‹ä½ çš„èµ„æ–™
- **2-ä»…åŒ¹é…çš„äºº**ï¼šåªæœ‰åŒ¹é…æˆåŠŸçš„ç”¨æˆ·å¯ä»¥æŸ¥çœ‹
- **3-å…³é—­**ï¼šå…³é—­èµ„æ–™å±•ç¤ºï¼Œå…¶ä»–äººæ— æ³•æŸ¥çœ‹

---

## é™„å½•ï¼šå‰ç«¯é›†æˆç¤ºä¾‹

### å°ç¨‹åºç™»å½•å¼•å¯¼é€»è¾‘

```javascript
// ç™»å½•
wx.request({
  url: 'http://localhost:8080/api/auth/wx/login',
  method: 'POST',
  data: { code: wxCode },
  success: (res) => {
    const { profileComplete, matchPreferenceSet, token } = res.data.data;
    
    // ä¿å­˜token
    wx.setStorageSync('token', token);
    
    // æ ¹æ®çŠ¶æ€å¼•å¯¼
    if (profileComplete === 0) {
      // å¼•å¯¼å®Œå–„èµ„æ–™
      wx.navigateTo({ url: '/pages/profile-setup/index' });
    } else if (matchPreferenceSet === 0) {
      // å¼•å¯¼è®¾ç½®åŒ¹é…åå¥½
      wx.navigateTo({ url: '/pages/matching-preference/index' });
    } else {
      // è¿›å…¥ä¸»é¡µ
      wx.switchTab({ url: '/pages/home/index' });
    }
  }
});
```

### æäº¤å®Œå–„èµ„æ–™

```javascript
wx.request({
  url: 'http://localhost:8080/api/user/profile',
  method: 'POST',
  header: {
    'Authorization': `Bearer ${wx.getStorageSync('token')}`
  },
  data: {
    nickname: 'å°é›¨',
    avatar: 'https://...',
    gender: 2,
    birthday: '1998-05-20',
    tagIds: [1, 5, 8]
  },
  success: (res) => {
    wx.showToast({ title: 'èµ„æ–™ä¿å­˜æˆåŠŸ' });
    // å¼•å¯¼è®¾ç½®åŒ¹é…åå¥½
    wx.navigateTo({ url: '/pages/matching-preference/index' });
  }
});
```

### ä¸Šä¼ ç…§ç‰‡

```javascript
// 1. é€‰æ‹©å›¾ç‰‡
wx.chooseImage({
  count: 1,
  success: (res) => {
    const tempFilePath = res.tempFilePaths[0];
    
    // 2. ä¸Šä¼ åˆ°äº‘å­˜å‚¨ï¼ˆæˆ–è‡ªå·±çš„æœåŠ¡å™¨ï¼‰
    wx.cloud.uploadFile({
      cloudPath: `photos/${Date.now()}.jpg`,
      filePath: tempFilePath,
      success: (uploadRes) => {
        const photoUrl = uploadRes.fileID;
        
        // 3. è°ƒç”¨æ¥å£ä¿å­˜ç…§ç‰‡è®°å½•
        wx.request({
          url: 'http://localhost:8080/api/user/album/upload',
          method: 'POST',
          header: {
            'Authorization': `Bearer ${wx.getStorageSync('token')}`
          },
          data: {
            photoUrl: photoUrl,
            isCover: false
          },
          success: (res) => {
            wx.showToast({ title: 'ä¸Šä¼ æˆåŠŸ' });
          }
        });
      }
    });
  }
});
```

### æŸ¥çœ‹ä»–äººèµ„æ–™

```javascript
// ç‚¹å‡»ç”¨æˆ·å¤´åƒæ—¶
onUserClick(userId) {
  wx.request({
    url: `http://localhost:8080/api/user/profile/${userId}`,
    method: 'GET',
    header: {
      'Authorization': `Bearer ${wx.getStorageSync('token')}`
    },
    success: (res) => {
      const userProfile = res.data.data;
      // è·³è½¬åˆ°ç”¨æˆ·è¯¦æƒ…é¡µ
      wx.navigateTo({
        url: `/pages/user-detail/index?userId=${userId}`,
        success: (res) => {
          // é€šè¿‡eventChannelä¼ é€’æ•°æ®
          res.eventChannel.emit('userProfile', userProfile);
        }
      });
    }
  });
}
```

### è®¾ç½®éšç§

```javascript
wx.request({
  url: 'http://localhost:8080/api/user/privacy',
  method: 'POST',
  header: {
    'Authorization': `Bearer ${wx.getStorageSync('token')}`
  },
  data: {
    whoCanSeeMe: 2,        // ä»…åŒ¹é…çš„äºº
    showDistance: 1,       // æ˜¾ç¤ºè·ç¦»
    showOnlineStatus: 0    // ä¸æ˜¾ç¤ºåœ¨çº¿çŠ¶æ€
  },
  success: (res) => {
    wx.showToast({ title: 'è®¾ç½®æˆåŠŸ' });
  }
});
```

### æ‹‰é»‘ç”¨æˆ·

```javascript
onBlockUser(userId) {
  wx.showModal({
    title: 'ç¡®è®¤æ‹‰é»‘',
    content: 'æ‹‰é»‘åå°†æ— æ³•çœ‹åˆ°å¯¹æ–¹çš„åŠ¨æ€',
    success: (res) => {
      if (res.confirm) {
        wx.request({
          url: `http://localhost:8080/api/user/blacklist/${userId}`,
          method: 'POST',
          header: {
            'Authorization': `Bearer ${wx.getStorageSync('token')}`
          },
          success: (res) => {
            wx.showToast({ title: 'æ‹‰é»‘æˆåŠŸ' });
            // è¿”å›ä¸Šä¸€é¡µæˆ–åˆ·æ–°åˆ—è¡¨
            wx.navigateBack();
          }
        });
      }
    }
  });
}
```

### è·å–å¹¶è®¾ç½®æ ‡ç­¾

```javascript
// 1. è·å–æ ‡ç­¾åº“
wx.request({
  url: 'http://localhost:8080/api/user/tags',
  method: 'GET',
  success: (res) => {
    const tagLibrary = res.data.data;
    this.setData({ tagLibrary });
  }
});

// 2. ç”¨æˆ·é€‰æ‹©æ ‡ç­¾åä¿å­˜
onTagsConfirm(selectedTagIds) {
  wx.request({
    url: 'http://localhost:8080/api/user/tags',
    method: 'POST',
    header: {
      'Authorization': `Bearer ${wx.getStorageSync('token')}`
    },
    data: {
      tagIds: selectedTagIds
    },
    success: (res) => {
      wx.showToast({ title: 'æ ‡ç­¾è®¾ç½®æˆåŠŸ' });
    }
  });
}
```

---

## 10. æäº¤å®åè®¤è¯

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`POST /api/user/real-name-verify`
- **æ¥å£è¯´æ˜**ï¼šæäº¤å®åè®¤è¯ï¼Œç³»ç»Ÿè‡ªåŠ¨ä»èº«ä»½è¯å·æå–ç”Ÿæ—¥å¹¶æ›´æ–°çœŸå®å¹´é¾„
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
Content-Type: application/json
```

### è¯·æ±‚å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| realName | String | æ˜¯ | çœŸå®å§“åï¼ˆ2-50ä¸ªå­—ç¬¦ï¼‰ |
| idCard | String | æ˜¯ | èº«ä»½è¯å·ï¼ˆ18ä½ï¼Œç¬¦åˆæ ¼å¼è§„åˆ™ï¼‰ |

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X POST http://localhost:8080/api/user/real-name-verify \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "realName": "å¼ ä¸‰",
    "idCard": "110101199001011234"
  }'
```

**è¯·æ±‚Body**ï¼š
```json
{
  "realName": "å¼ ä¸‰",
  "idCard": "110101199001011234"
}
```

### å“åº”ç¤ºä¾‹

**æˆåŠŸå“åº”**ï¼š
```json
{
  "code": 200,
  "message": "å®åè®¤è¯æäº¤æˆåŠŸï¼Œå¹´é¾„å·²æ ¹æ®ç”Ÿæ—¥è‡ªåŠ¨æ›´æ–°",
  "data": true
}
```

**å¤±è´¥å“åº”**ï¼š
```json
{
  "code": 40001,
  "message": "æ‚¨å·²å®Œæˆå®åè®¤è¯ï¼Œæ— éœ€é‡å¤æäº¤",
  "data": null
}
```

### ä¸šåŠ¡è¯´æ˜

1. **è‡ªåŠ¨æå–ç”Ÿæ—¥**ï¼šä»èº«ä»½è¯å·ç¬¬7-14ä½æå–å‡ºç”Ÿæ—¥æœŸ
2. **è‡ªåŠ¨è®¡ç®—å¹´é¾„**ï¼šæ ¹æ®ç”Ÿæ—¥è®¡ç®—çœŸå®å¹´é¾„å¹¶æ›´æ–°
3. **é”å®šå¹´é¾„**ï¼šå®åè®¤è¯åï¼Œç”¨æˆ·æ— æ³•å†ä¿®æ”¹å¹´é¾„
4. **å¹´é¾„é™åˆ¶**ï¼šå¿…é¡»â‰¥18å²æ‰èƒ½ä½¿ç”¨æœåŠ¡
5. **é˜²é‡å¤è®¤è¯**ï¼šå·²è®¤è¯ç”¨æˆ·æ— æ³•é‡å¤æäº¤

### é”™è¯¯ç è¯´æ˜

| é”™è¯¯ç  | é”™è¯¯ä¿¡æ¯ |
|--------|---------|
| 40001 | æ‚¨å·²å®Œæˆå®åè®¤è¯ï¼Œæ— éœ€é‡å¤æäº¤ |
| 40002 | èº«ä»½è¯å·æ ¼å¼ä¸æ­£ç¡® |
| 40002 | æœªæ»¡18å²ä¸èƒ½ä½¿ç”¨æœ¬æœåŠ¡ |
| 40002 | èº«ä»½è¯å‡ºç”Ÿæ—¥æœŸå¼‚å¸¸ |
| 40401 | ç”¨æˆ·ä¸å­˜åœ¨ |

---

## 11. æŸ¥è¯¢å®åè®¤è¯çŠ¶æ€

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`GET /api/user/real-name-verify/status`
- **æ¥å£è¯´æ˜**ï¼šæŸ¥è¯¢ç”¨æˆ·æ˜¯å¦å·²å®Œæˆå®åè®¤è¯
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
```

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X GET http://localhost:8080/api/user/real-name-verify/status \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "success",
  "data": true
}
```

### å“åº”å­—æ®µè¯´æ˜

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| data | Boolean | true-å·²è®¤è¯ï¼Œfalse-æœªè®¤è¯ |

---

## 23. ä¸Šä¼ å›¾ç‰‡ï¼ˆæ–‡ä»¶æ–¹å¼ï¼‰

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`POST /api/oss/upload`
- **æ¥å£è¯´æ˜**ï¼šä¸Šä¼ å›¾ç‰‡æ–‡ä»¶åˆ°é˜¿é‡Œäº‘OSS
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
Content-Type: multipart/form-data
```

### è¯·æ±‚å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| file | File | æ˜¯ | å›¾ç‰‡æ–‡ä»¶ |
| category | String | æ˜¯ | å›¾ç‰‡åˆ†ç±»ï¼Œå¯é€‰å€¼ï¼š<br/>â€¢ `avatar` - ç”¨æˆ·å¤´åƒ<br/>â€¢ `album` - ç›¸å†Œç…§ç‰‡<br/>â€¢ `moment` - åŠ¨æ€å›¾ç‰‡<br/>â€¢ `activity` - æ´»åŠ¨å›¾ç‰‡<br/>â€¢ `background` - ä¸ªäººä¸»é¡µèƒŒæ™¯å¢™ |

### categoryå‚æ•°è¯´æ˜

| å€¼ | è¯´æ˜ | ç”¨é€” |
|-------|------|------|
| avatar | ç”¨æˆ·å¤´åƒ | ä¸ªäººèµ„æ–™é¡µçš„å¤´åƒå›¾ç‰‡ |
| album | ç›¸å†Œç…§ç‰‡ | ç”¨æˆ·ç›¸å†Œä¸­çš„ç…§ç‰‡ |
| moment | åŠ¨æ€å›¾ç‰‡ | å‘å¸ƒåŠ¨æ€/æœ‹å‹åœˆæ—¶çš„é…å›¾ |
| activity | æ´»åŠ¨å›¾ç‰‡ | æ­å­æ´»åŠ¨çš„å°é¢æˆ–è¯¦æƒ…å›¾ |
| background | èƒŒæ™¯å¢™å›¾ç‰‡ | ä¸ªäººä¸»é¡µçš„èƒŒæ™¯å¢™å›¾ç‰‡ |

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X POST http://localhost:8080/api/oss/upload \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -F "file=@/path/to/image.jpg" \
  -F "category=avatar"
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "å›¾ç‰‡ä¸Šä¼ æˆåŠŸ",
  "data": {
    "imageUrl": "https://friend-mini.oss-cn-beijing.aliyuncs.com/uploads/avatar/7/20251102/xxx.jpg",
    "category": "avatar",
    "uploadTime": 1699000000000
  }
}
```

### å“åº”å­—æ®µè¯´æ˜

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| imageUrl | String | å›¾ç‰‡è®¿é—®URLï¼ˆæ°¸ä¹…æœ‰æ•ˆï¼‰ï¼Œå¯ç›´æ¥åœ¨æµè§ˆå™¨é¢„è§ˆ |
| category | String | å›¾ç‰‡åˆ†ç±» |
| uploadTime | Long | ä¸Šä¼ æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰ |

### ä¸šåŠ¡è¯´æ˜

1. **æ”¯æŒæ ¼å¼**ï¼šjpgã€pngã€gifã€webp
2. **æ–‡ä»¶å¤§å°é™åˆ¶**ï¼š10MB
3. **å­˜å‚¨è·¯å¾„**ï¼šuploads/{category}/{userId}/{yyyyMMdd}/{uuid}.{ext}
4. **è‡ªåŠ¨è®¾ç½®å…ƒæ•°æ®**ï¼šContent-Typeå’ŒContent-Dispositionï¼Œæµè§ˆå™¨å¯ç›´æ¥é¢„è§ˆ
5. **URLæ°¸ä¹…æœ‰æ•ˆ**ï¼šè¿”å›çš„URLæ— è¿‡æœŸæ—¶é—´ï¼Œå¯æ°¸ä¹…è®¿é—®ï¼ˆéœ€ç¡®ä¿OSS bucketè®¾ç½®ä¸ºå…¬å…±è¯»ï¼‰

---

## 24. ä¸Šä¼ å›¾ç‰‡ï¼ˆBase64æ–¹å¼ï¼‰

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`POST /api/oss/upload/base64`
- **æ¥å£è¯´æ˜**ï¼šä¸Šä¼ Base64ç¼–ç çš„å›¾ç‰‡
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
Content-Type: application/json
```

### è¯·æ±‚å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| imageData | String | æ˜¯ | Base64ç¼–ç çš„å›¾ç‰‡æ•°æ® |
| category | String | æ˜¯ | å›¾ç‰‡åˆ†ç±»ï¼Œå¯é€‰å€¼ï¼š<br/>â€¢ `avatar` - ç”¨æˆ·å¤´åƒ<br/>â€¢ `album` - ç›¸å†Œç…§ç‰‡<br/>â€¢ `moment` - åŠ¨æ€å›¾ç‰‡<br/>â€¢ `activity` - æ´»åŠ¨å›¾ç‰‡<br/>â€¢ `background` - ä¸ªäººä¸»é¡µèƒŒæ™¯å¢™ |
| fileExtension | String | å¦ | æ–‡ä»¶æ‰©å±•åï¼ˆé»˜è®¤jpgï¼‰ |

### categoryå‚æ•°è¯´æ˜

| å€¼ | è¯´æ˜ | ç”¨é€” |
|-------|------|------|
| avatar | ç”¨æˆ·å¤´åƒ | ä¸ªäººèµ„æ–™é¡µçš„å¤´åƒå›¾ç‰‡ |
| album | ç›¸å†Œç…§ç‰‡ | ç”¨æˆ·ç›¸å†Œä¸­çš„ç…§ç‰‡ |
| moment | åŠ¨æ€å›¾ç‰‡ | å‘å¸ƒåŠ¨æ€/æœ‹å‹åœˆæ—¶çš„é…å›¾ |
| activity | æ´»åŠ¨å›¾ç‰‡ | æ­å­æ´»åŠ¨çš„å°é¢æˆ–è¯¦æƒ…å›¾ |
| background | èƒŒæ™¯å¢™å›¾ç‰‡ | ä¸ªäººä¸»é¡µçš„èƒŒæ™¯å¢™å›¾ç‰‡ |

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X POST http://localhost:8080/api/oss/upload/base64 \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "imageData": "data:image/png;base64,iVBORw0KGgo...",
    "category": "album",
    "fileExtension": "png"
  }'
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "å›¾ç‰‡ä¸Šä¼ æˆåŠŸ",
  "data": {
    "imageUrl": "https://friend-mini.oss-cn-beijing.aliyuncs.com/uploads/album/7/20251102/xxx.png",
    "category": "album",
    "uploadTime": 1699000000000
  }
}
```

### å“åº”å­—æ®µè¯´æ˜

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| imageUrl | String | å›¾ç‰‡è®¿é—®URLï¼ˆæ°¸ä¹…æœ‰æ•ˆï¼‰ï¼Œå¯ç›´æ¥åœ¨æµè§ˆå™¨é¢„è§ˆ |
| category | String | å›¾ç‰‡åˆ†ç±» |
| uploadTime | Long | ä¸Šä¼ æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰ |

### ä¸šåŠ¡è¯´æ˜

1. **æ”¯æŒBase64æ ¼å¼**ï¼šæ”¯æŒ `data:image/png;base64,xxx` æˆ–çº¯Base64æ•°æ®
2. **æ–‡ä»¶å¤§å°é™åˆ¶**ï¼š10MB
3. **å­˜å‚¨è·¯å¾„**ï¼šuploads/{category}/{userId}/{yyyyMMdd}/{uuid}.{ext}
4. **URLæ°¸ä¹…æœ‰æ•ˆ**ï¼šè¿”å›çš„URLæ— è¿‡æœŸæ—¶é—´ï¼Œå¯æ°¸ä¹…è®¿é—®ï¼ˆéœ€ç¡®ä¿OSS bucketè®¾ç½®ä¸ºå…¬å…±è¯»ï¼‰

---

## 25. æ‰¹é‡ä¸Šä¼ å›¾ç‰‡

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`POST /api/oss/upload/batch`
- **æ¥å£è¯´æ˜**ï¼šæ‰¹é‡ä¸Šä¼ å¤šå¼ å›¾ç‰‡
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
Content-Type: multipart/form-data
```

### è¯·æ±‚å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| files | File[] | æ˜¯ | å›¾ç‰‡æ–‡ä»¶æ•°ç»„ |
| category | String | æ˜¯ | å›¾ç‰‡åˆ†ç±»ï¼Œå¯é€‰å€¼ï¼š<br/>â€¢ `avatar` - ç”¨æˆ·å¤´åƒ<br/>â€¢ `album` - ç›¸å†Œç…§ç‰‡<br/>â€¢ `moment` - åŠ¨æ€å›¾ç‰‡<br/>â€¢ `activity` - æ´»åŠ¨å›¾ç‰‡<br/>â€¢ `background` - ä¸ªäººä¸»é¡µèƒŒæ™¯å¢™ |

### categoryå‚æ•°è¯´æ˜

| å€¼ | è¯´æ˜ | ç”¨é€” |
|-------|------|------|
| avatar | ç”¨æˆ·å¤´åƒ | ä¸ªäººèµ„æ–™é¡µçš„å¤´åƒå›¾ç‰‡ |
| album | ç›¸å†Œç…§ç‰‡ | ç”¨æˆ·ç›¸å†Œä¸­çš„ç…§ç‰‡ |
| moment | åŠ¨æ€å›¾ç‰‡ | å‘å¸ƒåŠ¨æ€/æœ‹å‹åœˆæ—¶çš„é…å›¾ |
| activity | æ´»åŠ¨å›¾ç‰‡ | æ­å­æ´»åŠ¨çš„å°é¢æˆ–è¯¦æƒ…å›¾ |
| background | èƒŒæ™¯å¢™å›¾ç‰‡ | ä¸ªäººä¸»é¡µçš„èƒŒæ™¯å¢™å›¾ç‰‡ |

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X POST http://localhost:8080/api/oss/upload/batch \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -F "files=@image1.jpg" \
  -F "files=@image2.jpg" \
  -F "category=moment"
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "æ‰¹é‡ä¸Šä¼ æˆåŠŸ",
  "data": [
    {
      "imageUrl": "https://friend-mini.oss-cn-beijing.aliyuncs.com/uploads/moment/7/20251102/xxx1.jpg",
      "category": "moment",
      "uploadTime": 1699000000000
    },
    {
      "imageUrl": "https://friend-mini.oss-cn-beijing.aliyuncs.com/uploads/moment/7/20251102/xxx2.jpg",
      "category": "moment",
      "uploadTime": 1699000000001
    }
  ]
}
```

### å“åº”å­—æ®µè¯´æ˜

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| data | Array | ä¸Šä¼ ç»“æœæ•°ç»„ |
| imageUrl | String | å›¾ç‰‡è®¿é—®URLï¼ˆæ°¸ä¹…æœ‰æ•ˆï¼‰ï¼Œå¯ç›´æ¥åœ¨æµè§ˆå™¨é¢„è§ˆ |
| category | String | å›¾ç‰‡åˆ†ç±» |
| uploadTime | Long | ä¸Šä¼ æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰ |

### ä¸šåŠ¡è¯´æ˜

1. **æ‰¹é‡é™åˆ¶**ï¼šä¸€æ¬¡æœ€å¤šä¸Šä¼ 10å¼ å›¾ç‰‡
2. **åŸå­æ€§**ï¼šå¦‚æœæŸå¼ å›¾ç‰‡ä¸Šä¼ å¤±è´¥ï¼Œä¸å½±å“å…¶ä»–å›¾ç‰‡
3. **URLæ°¸ä¹…æœ‰æ•ˆ**ï¼šè¿”å›çš„URLæ— è¿‡æœŸæ—¶é—´ï¼Œå¯æ°¸ä¹…è®¿é—®ï¼ˆéœ€ç¡®ä¿OSS bucketè®¾ç½®ä¸ºå…¬å…±è¯»ï¼‰

---

## 26. åˆ é™¤OSSå›¾ç‰‡

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`DELETE /api/oss/delete`
- **æ¥å£è¯´æ˜**ï¼šåˆ é™¤OSSä¸Šçš„å›¾ç‰‡æ–‡ä»¶
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
```

### è¯·æ±‚å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| imageUrl | String | æ˜¯ | å›¾ç‰‡å®Œæ•´URL |

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X DELETE "http://localhost:8080/api/oss/delete?imageUrl=https://friend-mini.oss-cn-beijing.aliyuncs.com/uploads/avatar/7/20251102/xxx.jpg" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "å›¾ç‰‡åˆ é™¤æˆåŠŸ",
  "data": true
}
```

---

## 27. è·å–å›¾ç‰‡ç­¾åURL

### åŸºæœ¬ä¿¡æ¯
- **æ¥å£è·¯å¾„**ï¼š`GET /api/oss/signed-url`
- **æ¥å£è¯´æ˜**ï¼šè·å–OSSå›¾ç‰‡çš„ä¸´æ—¶è®¿é—®ç­¾åURLï¼ˆâš ï¸ å¦‚æœbucketè®¾ç½®ä¸ºå…¬å…±è¯»ï¼Œæ— éœ€è°ƒç”¨æ­¤æ¥å£ï¼‰
- **æ˜¯å¦éœ€è¦è®¤è¯**ï¼šæ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {token}
```

### è¯·æ±‚å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| objectKey | String | æ˜¯ | å¯¹è±¡é”®ï¼ˆæ–‡ä»¶è·¯å¾„ï¼‰ |

### è¯·æ±‚ç¤ºä¾‹

**curlå‘½ä»¤**ï¼š
```bash
curl -X GET "http://localhost:8080/api/oss/signed-url?objectKey=uploads/avatar/7/20251102/xxx.jpg" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "è·å–ç­¾åURLæˆåŠŸ",
  "data": "http://friend-mini.oss-cn-beijing.aliyuncs.com/uploads/avatar/7/20251102/xxx.jpg?Expires=1762090270&OSSAccessKeyId=xxx&Signature=xxx"
}
```

### ä¸šåŠ¡è¯´æ˜

1. **é€‚ç”¨åœºæ™¯**ï¼š
   - âš ï¸ **å½“å‰é…ç½®**ï¼šå¦‚æœbucketè®¾ç½®ä¸ºå…¬å…±è¯»ï¼Œä¸Šä¼ æ¥å£è¿”å›çš„URLæ°¸ä¹…æœ‰æ•ˆï¼Œ**æ— éœ€è°ƒç”¨æ­¤æ¥å£**
   - ğŸ“Œ **ç§æœ‰bucket**ï¼šå¦‚æœbucketæ˜¯ç§æœ‰çš„ï¼Œéœ€è¦ä½¿ç”¨æ­¤æ¥å£ç”Ÿæˆä¸´æ—¶ç­¾åURL
2. **URLæœ‰æ•ˆæœŸ**ï¼šç­¾åURLæœ‰æ•ˆæœŸ3600ç§’ï¼ˆ1å°æ—¶ï¼‰
3. **objectKeyæ ¼å¼**ï¼šuploads/{category}/{userId}/{yyyyMMdd}/{filename}
4. **æå–objectKey**ï¼šä»ä¸Šä¼ æ¥å£è¿”å›çš„URLä¸­æå–è·¯å¾„éƒ¨åˆ†
   - ä¾‹å¦‚ï¼š`https://friend-mini.oss-cn-beijing.aliyuncs.com/uploads/avatar/7/20251102/xxx.jpg`
   - å¯¹åº”çš„objectKeyä¸ºï¼š`uploads/avatar/7/20251102/xxx.jpg`

### æ¨èåšæ³•

| Bucketæƒé™ | ä¸Šä¼ æ¥å£è¿”å› | æ˜¯å¦éœ€è¦ç­¾åæ¥å£ |
|-----------|------------|----------------|
| å…¬å…±è¯» âœ…ï¼ˆæ¨èï¼‰ | æ°¸ä¹…URL | âŒ ä¸éœ€è¦ |
| ç§æœ‰ | æ™®é€šURL | âœ… éœ€è¦å®šæœŸåˆ·æ–°ç­¾å |

---

## é™„å½•ï¼šå¹´é¾„ç®¡ç†è§„åˆ™è¯´æ˜

### å¹´é¾„å­—æ®µè§„åˆ™

1. **é¦–æ¬¡è®¾ç½®**
   - ç”¨æˆ·å®Œå–„èµ„æ–™æ—¶å¯ä»¥å¡«å†™`age`å­—æ®µ
   - å¡«å†™å`age_set_by_user`æ ‡è®°ä¸º1
   - ç”¨æˆ·åªèƒ½è®¾ç½®ä¸€æ¬¡

2. **å®åè®¤è¯åæ›´æ–°**
   - æäº¤å®åè®¤è¯æ—¶ï¼Œç³»ç»Ÿè‡ªåŠ¨ä»èº«ä»½è¯å·æå–ç”Ÿæ—¥
   - æ ¹æ®ç”Ÿæ—¥è®¡ç®—çœŸå®å¹´é¾„å¹¶æ›´æ–°
   - æ ‡è®°ä¸ºå·²å®åè®¤è¯

3. **ä¿®æ”¹é™åˆ¶**
   - `age_set_by_user=1`åï¼Œç”¨æˆ·æ— æ³•å†ä¿®æ”¹å¹´é¾„
   - å°è¯•ä¿®æ”¹ä¼šè¿”å›é”™è¯¯ï¼š"å¹´é¾„åªèƒ½è®¾ç½®ä¸€æ¬¡ï¼Œåç»­éœ€é€šè¿‡å®åè®¤è¯è‡ªåŠ¨æ›´æ–°"

### å­—æ®µè¯´æ˜

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| age | Integer | å¹´é¾„ |
| age_set_by_user | Integer | 0-æœªè®¾ç½®ï¼Œ1-å·²è®¾ç½® |
| is_real_name_verified | Integer | 0-æœªè®¤è¯ï¼Œ1-å·²è®¤è¯ |
| birthday | Date | ç”Ÿæ—¥ |
| real_name | String | çœŸå®å§“å |
| id_card | String | èº«ä»½è¯å· |

---

## æ¥å£æ›´æ–°æ—¥å¿—

### v1.3 (2025-11-02 21:30)
- âœ¨ æ–°å¢ï¼šTokenæ ¡éªŒæ¥å£ (POST /api/auth/token/validate)
- âœ¨ æ–°å¢ï¼šå›¾ç‰‡åˆ†ç±»æ–°å¢backgroundï¼ˆèƒŒæ™¯å¢™ï¼‰ç±»å‹
- ğŸ“ å®Œå–„ï¼šç”Ÿæ—¥å­—æ®µæ”¹ä¸ºå¯é€‰ï¼Œå¹´é¾„å­—æ®µæ”¹ä¸ºå¿…å¡«
- ğŸ“ å®Œå–„ï¼šOSSå›¾ç‰‡ä¸Šä¼ æ¥å£è¿”å›æ°¸ä¹…æœ‰æ•ˆçš„URLï¼ˆæ— è¿‡æœŸæ—¶é—´ï¼‰
- ğŸ“ å®Œå–„ï¼šMyBatis SQLæ—¥å¿—ç‹¬ç«‹è¾“å‡ºåˆ°å•ç‹¬æ–‡ä»¶ï¼ŒåŒ…å«traceID

### v1.2 (2025-11-02 20:45)
- âœ¨ æ–°å¢ï¼šæµ‹è¯•Tokenç”Ÿæˆæ¥å£ (POST /api/test/generate-token)
- âœ¨ æ–°å¢ï¼šå®åè®¤è¯æ¥å£ï¼ˆæäº¤ã€æŸ¥è¯¢çŠ¶æ€ï¼‰
- âœ¨ æ–°å¢ï¼šOSSå›¾ç‰‡ä¸Šä¼ æ¥å£ï¼ˆæ–‡ä»¶ã€Base64ã€æ‰¹é‡ï¼‰
- âœ¨ æ–°å¢ï¼šOSSå›¾ç‰‡åˆ é™¤å’Œç­¾åURLæ¥å£
- ğŸ“ å®Œå–„ï¼šå®Œå–„èµ„æ–™æ¥å£å¢åŠ ageå­—æ®µ
- ğŸ“ å®Œå–„ï¼šå®ç°å¹´é¾„ç®¡ç†è§„åˆ™ï¼ˆåªèƒ½è®¾ç½®ä¸€æ¬¡ï¼‰

### v1.1 (2025-11-01)
- âœ¨ æ–°å¢ï¼šæ›´æ–°èµ„æ–™æ¥å£ (POST /api/user/profile/update)
- âœ¨ æ–°å¢ï¼šæŸ¥çœ‹ä»–äººèµ„æ–™æ¥å£ (GET /api/user/profile/{userId})
- âœ¨ æ–°å¢ï¼šç›¸å†Œç®¡ç†æ¥å£ï¼ˆä¸Šä¼ ã€åˆ é™¤ã€è®¾ç½®å°é¢ï¼‰
- âœ¨ æ–°å¢ï¼šæ ‡ç­¾ç®¡ç†æ¥å£ï¼ˆè·å–æ ‡ç­¾åº“ã€è®¾ç½®æ ‡ç­¾ï¼‰
- âœ¨ æ–°å¢ï¼šéšç§è®¾ç½®æ¥å£ï¼ˆæ›´æ–°ã€è·å–ï¼‰
- âœ¨ æ–°å¢ï¼šé»‘åå•ç®¡ç†æ¥å£ï¼ˆæ‹‰é»‘ã€ç§»é™¤ï¼‰
- ğŸ“ å®Œå–„ï¼šè¡¥å……äº†11ä¸ªé—æ¼çš„æ¥å£æ–‡æ¡£
- ğŸ“ ä¼˜åŒ–ï¼šæ·»åŠ æ¥å£é€ŸæŸ¥è¡¨å’Œè¯¦ç»†çš„ä¸šåŠ¡è¯´æ˜
- ğŸ“ ä¼˜åŒ–ï¼šå®Œå–„å‰ç«¯é›†æˆç¤ºä¾‹

### v1.0 (2025-11-01)
- ğŸ‰ åˆå§‹ç‰ˆæœ¬
- âœ… å¾®ä¿¡ç™»å½•
- âœ… å®Œå–„èµ„æ–™
- âœ… æŸ¥çœ‹æˆ‘çš„èµ„æ–™
- âœ… æŸ¥çœ‹èµ„æ–™å®Œå–„çŠ¶æ€
- âœ… è·å–ç”¨æˆ·ç»Ÿè®¡æ•°æ®
- âœ… è®¾ç½®/è·å–åŒ¹é…åå¥½

---

**æ–‡æ¡£ç»“æŸ**

