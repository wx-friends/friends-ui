# äº¤å‹ç¤¾äº¤åº”ç”¨ç³»ç»Ÿåˆ†ææ–‡æ¡£ï¼ˆåŸºäº wxmini-friends é¡¹ç›®ï¼‰

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯

- **é¡¹ç›®åç§°**ï¼šæœ‹æœ‹äº¤å‹ï¼ˆpengpengï¼‰å¾®ä¿¡å°ç¨‹åº
- **åç«¯å·¥ç¨‹**ï¼šwxmini-friends
- **æ–‡æ¡£ç‰ˆæœ¬**ï¼šv2.0ï¼ˆåŸºäºç°æœ‰é¡¹ç›®ï¼‰
- **åˆ›å»ºæ—¥æœŸ**ï¼š2025-01-29
- **æ–‡æ¡£ç±»å‹**ï¼šç³»ç»Ÿåˆ†æä¸æŠ€æœ¯æ¶æ„è®¾è®¡
- **ç›®æ ‡å¹³å°**ï¼šå¾®ä¿¡å°ç¨‹åº + Javaåç«¯ï¼ˆå•ä½“æ¶æ„ï¼‰

---

## ğŸ¯ ä¸€ã€é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®èƒŒæ™¯
åŸºäºç°æœ‰ `wxmini-friends` é¡¹ç›®æ‰©å±•çš„äº¤å‹ç¤¾äº¤å¹³å°ï¼Œæä¾›æ™ºèƒ½åŒ¹é…ã€åœ¨çº¿èŠå¤©ã€åŠ¨æ€ç¤¾åŒºã€æ­å­æ´»åŠ¨ã€çº¿ä¸‹æ´»åŠ¨ç­‰åŠŸèƒ½ï¼Œå¸®åŠ©ç”¨æˆ·æ‹“å±•ç¤¾äº¤åœˆã€‚

### 1.2 æ ¸å¿ƒä»·å€¼
- **ç²¾å‡†åŒ¹é…**ï¼šåŸºäºç®—æ³•çš„æ™ºèƒ½æ¨èç³»ç»Ÿ
- **ç¤¾äº¤ç”Ÿæ€**ï¼šåŠ¨æ€åˆ†äº«ã€åœ¨çº¿èŠå¤©ã€çº¿ä¸‹æ´»åŠ¨
- **æ­å­å¹³å°**ï¼šæ‰¾é¥­æ­ã€è¿åŠ¨æ­ã€æ—…æ¸¸æ­ç­‰å¤šåœºæ™¯åŒ¹é…
- **ä¼šå‘˜ä½“ç³»**ï¼šVIPç‰¹æƒã€å¢å€¼æœåŠ¡

### 1.3 æŠ€æœ¯æ ˆï¼ˆåŸºäºç°æœ‰é¡¹ç›®ï¼‰

#### å‰ç«¯æŠ€æœ¯æ ˆ
- **å¾®ä¿¡å°ç¨‹åº**ï¼šåŸç”Ÿå¼€å‘æ¡†æ¶
- **UIç»„ä»¶åº“**ï¼šVant Weapp / ColorUI
- **çŠ¶æ€ç®¡ç†**ï¼šMobXï¼ˆè½»é‡çº§ï¼‰
- **ç½‘ç»œè¯·æ±‚**ï¼šwx.request å°è£…

#### åç«¯æŠ€æœ¯æ ˆï¼ˆå·²ç¡®å®šï¼‰
- **å¼€å‘æ¡†æ¶**ï¼šSpring Boot 2.7.18 âœ…ï¼ˆå·²ä½¿ç”¨ï¼‰
- **æ¶æ„æ¨¡å¼**ï¼šå•ä½“åˆ†å±‚æ¶æ„ï¼ˆéå¾®æœåŠ¡ï¼‰
- **ORMæ¡†æ¶**ï¼šMyBatis-Plus 3.5.3.1 âœ…ï¼ˆå·²ä½¿ç”¨ï¼‰
- **æ•°æ®åº“**ï¼šMySQL 8.0 âœ…ï¼ˆå·²ä½¿ç”¨ï¼‰
- **ç¼“å­˜**ï¼šRedis âœ…ï¼ˆå·²ä½¿ç”¨ï¼‰
- **è®¤è¯æ–¹æ¡ˆ**ï¼šJWTï¼ˆjjwt 0.11.5ï¼‰âœ…ï¼ˆå·²å®ç°ï¼‰
- **å·¥å…·åº“**ï¼šHutool 5.8.20 âœ…ï¼ˆå·²ä½¿ç”¨ï¼‰
- **APIæ–‡æ¡£**ï¼šSwagger 3.0.0 âœ…ï¼ˆå·²é…ç½®ï¼‰
- **æ—¥å¿—æ¡†æ¶**ï¼šLogback âœ…ï¼ˆå·²é…ç½®ï¼‰
- **æ¶ˆæ¯é˜Ÿåˆ—**ï¼šRocketMQï¼ˆå¾…å¼•å…¥ï¼‰
- **æ–‡ä»¶å­˜å‚¨**ï¼šé˜¿é‡Œäº‘OSS / è…¾è®¯äº‘COSï¼ˆå¾…å¼•å…¥ï¼‰
- **å³æ—¶é€šè®¯**ï¼šWebSocket / è…¾è®¯äº‘IMï¼ˆå¾…é€‰å‹ï¼‰
- **ä»»åŠ¡è°ƒåº¦**ï¼šXXL-Job / Spring @Scheduledï¼ˆå¾…é€‰å‹ï¼‰

---

## âœ… äºŒã€å·²å®ç°åŠŸèƒ½æ¸…å•

### 2.1 ç”¨æˆ·è®¤è¯æ¨¡å—ï¼ˆâœ… å·²å®Œæˆï¼‰

#### å·²å®ç°åŠŸèƒ½
1. **å¾®ä¿¡å°ç¨‹åºç™»å½•** âœ…
   - å¾®ä¿¡code2Sessionè·å–openid
   - è‡ªåŠ¨æ³¨å†Œ/ç™»å½•é€»è¾‘
   - JWT Tokenç”Ÿæˆ

2. **Tokenç®¡ç†** âœ…
   - JWT Tokenç”Ÿæˆä¸éªŒè¯
   - Tokenåˆ·æ–°æœºåˆ¶
   - Tokenå­˜å‚¨Redisï¼ˆ7å¤©è¿‡æœŸï¼‰

3. **ç”¨æˆ·ç™»å‡º** âœ…
   - æ¸…é™¤Redisä¸­çš„Token

4. **è®¤è¯æ‹¦æˆªå™¨** âœ…
   - JwtAuthInterceptorï¼ˆJWTè®¤è¯ï¼‰
   - TraceIdInterceptorï¼ˆé“¾è·¯è¿½è¸ªï¼‰

#### å·²æœ‰æ•°æ®è¡¨
```sql
-- t_userï¼ˆå¾®ä¿¡ç”¨æˆ·è¡¨ï¼‰âœ… å·²åˆ›å»º
id, openid, unionid, phone, nickname, avatar, 
gender, birthday, status, vip_level, vip_expire_time,
created_at, updated_at, deleted
```

#### å·²å®ç°æ¥å£
```
âœ… POST   /api/auth/wx/login          - å¾®ä¿¡å°ç¨‹åºç™»å½•
âœ… GET    /api/auth/user/info         - è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
âœ… POST   /api/auth/token/refresh     - åˆ·æ–°Token
âœ… POST   /api/auth/logout            - ç™»å‡º
```

### 2.2 åŸºç¡€è®¾æ–½ï¼ˆâœ… å·²å®Œæˆï¼‰

1. **ç»Ÿä¸€å“åº”æ ¼å¼** âœ…
   - `Result<T>` å°è£…ç±»

2. **å¤šç¯å¢ƒé…ç½®** âœ…
   - devã€uatã€prodç¯å¢ƒ

3. **é“¾è·¯è¿½è¸ª** âœ…
   - TraceIdç”Ÿæˆä¸ä¼ é€’

4. **æ—¥å¿—ç®¡ç†** âœ…
   - Logbackåˆ†çº§æ—¥å¿—
   - æ—¥å¿—æ–‡ä»¶æ»šåŠ¨

5. **APIæ–‡æ¡£** âœ…
   - Swagger UIï¼ˆ/api/swagger-ui/index.htmlï¼‰

---

## ğŸš§ ä¸‰ã€å¾…å¼€å‘åŠŸèƒ½æ¨¡å—

### 3.1 ç”¨æˆ·èµ„æ–™æ¨¡å—ï¼ˆå¾…å¼€å‘ï¼‰

#### åŠŸèƒ½æè¿°
æ‰©å±•ç”¨æˆ·ä¸ªäººä¿¡æ¯ç®¡ç†ã€èµ„æ–™å®Œå–„ã€éšç§è®¾ç½®ã€‚

#### æ ¸å¿ƒåŠŸèƒ½ç‚¹
1. **èµ„æ–™å®Œå–„**
   - èº«é«˜ã€èŒä¸šã€å­¦å†ã€æ”¶å…¥ã€å®¶ä¹¡
   - ä¸ªäººç®€ä»‹ï¼ˆæœ€å¤š200å­—ï¼‰
   - å…´è¶£æ ‡ç­¾ï¼ˆæœ€å¤š10ä¸ªï¼Œä»æ ‡ç­¾åº“é€‰æ‹©ï¼‰
   - ç”Ÿæ´»ç…§ç‰‡ï¼ˆæœ€å¤š9å¼ ï¼‰
   - è¯­éŸ³ä»‹ç»ï¼ˆæœ€å¤š30ç§’ï¼‰

2. **ç…§ç‰‡ç®¡ç†**
   - ç…§ç‰‡ä¸Šä¼ /åˆ é™¤
   - è®¾ç½®å°é¢ç…§ç‰‡
   - ç…§ç‰‡å®¡æ ¸çŠ¶æ€

3. **éšç§è®¾ç½®**
   - è°å¯ä»¥çœ‹æˆ‘ï¼ˆæ‰€æœ‰äºº/ä»…åŒ¹é…çš„äºº/å…³é—­ï¼‰
   - è·ç¦»å¯è§æ€§
   - åœ¨çº¿çŠ¶æ€éšè—
   - é»‘åå•ç®¡ç†

#### æ•°æ®è¡¨è®¾è®¡
```sql
-- t_user_profileï¼ˆç”¨æˆ·è¯¦ç»†èµ„æ–™è¡¨ï¼‰
CREATE TABLE `t_user_profile` (
    `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
    `user_id` BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
    `height` INT COMMENT 'èº«é«˜(cm)',
    `occupation` VARCHAR(50) COMMENT 'èŒä¸š',
    `education` VARCHAR(20) COMMENT 'å­¦å†',
    `income` VARCHAR(20) COMMENT 'æ”¶å…¥',
    `hometown` VARCHAR(50) COMMENT 'å®¶ä¹¡',
    `current_city` VARCHAR(50) COMMENT 'å½“å‰åŸå¸‚',
    `bio` VARCHAR(200) COMMENT 'ä¸ªäººç®€ä»‹',
    `voice_intro_url` VARCHAR(255) COMMENT 'è¯­éŸ³ä»‹ç»URL',
    `is_verified` TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦è®¤è¯ 0æœªè®¤è¯ 1å·²è®¤è¯',
    `verify_status` TINYINT DEFAULT 0 COMMENT 'è®¤è¯çŠ¶æ€ 0æœªæäº¤ 1å®¡æ ¸ä¸­ 2é€šè¿‡ 3æ‹’ç»',
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP,
    `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    `deleted` TINYINT DEFAULT 0,
    UNIQUE KEY `uk_user_id` (`user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç”¨æˆ·è¯¦ç»†èµ„æ–™è¡¨';

-- t_user_albumï¼ˆç”¨æˆ·ç›¸å†Œè¡¨ï¼‰
CREATE TABLE `t_user_album` (
    `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
    `user_id` BIGINT NOT NULL,
    `photo_url` VARCHAR(255) NOT NULL COMMENT 'ç…§ç‰‡URL',
    `is_cover` TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦å°é¢ç…§ 0å¦ 1æ˜¯',
    `audit_status` TINYINT DEFAULT 0 COMMENT 'å®¡æ ¸çŠ¶æ€ 0å¾…å®¡æ ¸ 1é€šè¿‡ 2æ‹’ç»',
    `sort_order` INT DEFAULT 0 COMMENT 'æ’åº',
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP,
    `deleted` TINYINT DEFAULT 0,
    KEY `idx_user_id` (`user_id`),
    KEY `idx_audit_status` (`audit_status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç”¨æˆ·ç›¸å†Œè¡¨';

-- t_tag_libraryï¼ˆæ ‡ç­¾åº“è¡¨ï¼‰
CREATE TABLE `t_tag_library` (
    `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
    `tag_name` VARCHAR(20) NOT NULL COMMENT 'æ ‡ç­¾åç§°',
    `category` VARCHAR(20) NOT NULL COMMENT 'åˆ†ç±»ï¼ˆå…´è¶£/æ€§æ ¼/ç”Ÿæ´»æ–¹å¼ç­‰ï¼‰',
    `icon` VARCHAR(100) COMMENT 'å›¾æ ‡',
    `sort_order` INT DEFAULT 0,
    `status` TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€ 1å¯ç”¨ 0ç¦ç”¨',
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP,
    UNIQUE KEY `uk_tag_name` (`tag_name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ ‡ç­¾åº“è¡¨';

-- t_user_tagï¼ˆç”¨æˆ·æ ‡ç­¾å…³è”è¡¨ï¼‰
CREATE TABLE `t_user_tag` (
    `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
    `user_id` BIGINT NOT NULL,
    `tag_id` BIGINT NOT NULL,
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP,
    KEY `idx_user_id` (`user_id`),
    KEY `idx_tag_id` (`tag_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç”¨æˆ·æ ‡ç­¾å…³è”è¡¨';

-- t_user_privacyï¼ˆéšç§è®¾ç½®è¡¨ï¼‰
CREATE TABLE `t_user_privacy` (
    `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
    `user_id` BIGINT NOT NULL,
    `who_can_see_me` TINYINT DEFAULT 1 COMMENT 'è°å¯ä»¥çœ‹æˆ‘ 1æ‰€æœ‰äºº 2ä»…åŒ¹é…çš„äºº 3å…³é—­',
    `show_distance` TINYINT DEFAULT 1 COMMENT 'æ˜¾ç¤ºè·ç¦» 0å¦ 1æ˜¯',
    `show_online_status` TINYINT DEFAULT 1 COMMENT 'æ˜¾ç¤ºåœ¨çº¿çŠ¶æ€ 0å¦ 1æ˜¯',
    `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    UNIQUE KEY `uk_user_id` (`user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='éšç§è®¾ç½®è¡¨';

-- t_user_blacklistï¼ˆé»‘åå•è¡¨ï¼‰
CREATE TABLE `t_user_blacklist` (
    `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
    `user_id` BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
    `blocked_user_id` BIGINT NOT NULL COMMENT 'è¢«æ‹‰é»‘çš„ç”¨æˆ·ID',
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP,
    KEY `idx_user_id` (`user_id`),
    UNIQUE KEY `uk_user_blocked` (`user_id`, `blocked_user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='é»‘åå•è¡¨';
```

#### å¾…å¼€å‘æ¥å£
```
POST   /api/user/profile              - å®Œå–„èµ„æ–™
PUT    /api/user/profile              - æ›´æ–°èµ„æ–™
GET    /api/user/profile/{userId}     - æŸ¥çœ‹ä»–äººèµ„æ–™
POST   /api/user/album/upload         - ä¸Šä¼ ç…§ç‰‡
DELETE /api/user/album/{photoId}      - åˆ é™¤ç…§ç‰‡
PUT    /api/user/album/cover/{photoId}- è®¾ç½®å°é¢
GET    /api/user/tags                 - è·å–æ ‡ç­¾åº“
POST   /api/user/tags                 - è®¾ç½®æˆ‘çš„æ ‡ç­¾
POST   /api/user/privacy              - éšç§è®¾ç½®
POST   /api/user/blacklist/{userId}   - æ‹‰é»‘ç”¨æˆ·
DELETE /api/user/blacklist/{userId}   - ç§»é™¤é»‘åå•
```

---

### 3.2 æ™ºèƒ½åŒ¹é…æ¨¡å—ï¼ˆå¾…å¼€å‘ï¼‰

#### åŠŸèƒ½æè¿°
åŸºäºç®—æ³•çš„ç”¨æˆ·æ¨èä¸åŒ¹é…ç³»ç»Ÿã€‚

#### æ ¸å¿ƒåŠŸèƒ½ç‚¹
1. **åŒ¹é…ç®—æ³•**
   - åŸºç¡€æ¡ä»¶ç­›é€‰ï¼ˆæ€§åˆ«ã€å¹´é¾„ã€åœ°åŒºã€è·ç¦»ï¼‰
   - æ ‡ç­¾åŒ¹é…åº¦è®¡ç®—ï¼ˆä½™å¼¦ç›¸ä¼¼åº¦ï¼‰
   - æ´»è·ƒåº¦æƒé‡
   - å·²æ»‘åŠ¨ç”¨æˆ·å»é‡

2. **åŒ¹é…åå¥½è®¾ç½®**
   - æœŸæœ›å¹´é¾„èŒƒå›´
   - æœŸæœ›åœ°åŒº
   - æœ€å¤§è·ç¦»
   - æœŸæœ›æ ‡ç­¾

3. **åŒ¹é…æ“ä½œ**
   - å·¦æ»‘ï¼ˆä¸å–œæ¬¢ï¼‰
   - å³æ»‘ï¼ˆå–œæ¬¢ï¼‰
   - è¶…çº§å–œæ¬¢ï¼ˆæ¶ˆè€—1ä¸ªï¼Œæ¯å¤©3ä¸ªï¼ŒVIPæ— é™ï¼‰
   - åŒ¹é…æˆåŠŸé€šçŸ¥

4. **ç­›é€‰åŠŸèƒ½**
   - è·ç¦»ç­›é€‰ï¼ˆ5km/10km/20km/ä¸é™ï¼‰
   - å¹´é¾„èŒƒå›´ç­›é€‰
   - åœ¨çº¿ç”¨æˆ·ä¼˜å…ˆ
   - è®¤è¯ç”¨æˆ·ä¼˜å…ˆ

#### æ•°æ®è¡¨è®¾è®¡
```sql
-- t_user_matching_preferenceï¼ˆåŒ¹é…åå¥½è¡¨ï¼‰
CREATE TABLE `t_user_matching_preference` (
    `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
    `user_id` BIGINT NOT NULL,
    `gender_preference` TINYINT COMMENT 'æœŸæœ›æ€§åˆ« 1ç”· 2å¥³ 0ä¸é™',
    `min_age` INT DEFAULT 18,
    `max_age` INT DEFAULT 60,
    `max_distance` INT DEFAULT 0 COMMENT 'æœ€å¤§è·ç¦»(km) 0ä¸é™',
    `preferred_city` VARCHAR(50),
    `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    UNIQUE KEY `uk_user_id` (`user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='åŒ¹é…åå¥½è¡¨';

-- t_user_swipe_recordï¼ˆæ»‘åŠ¨è®°å½•è¡¨ï¼‰
CREATE TABLE `t_user_swipe_record` (
    `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
    `user_id` BIGINT NOT NULL COMMENT 'æ“ä½œç”¨æˆ·ID',
    `target_user_id` BIGINT NOT NULL COMMENT 'ç›®æ ‡ç”¨æˆ·ID',
    `action` TINYINT NOT NULL COMMENT 'æ“ä½œ 1å–œæ¬¢ 2ä¸å–œæ¬¢ 3è¶…çº§å–œæ¬¢',
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP,
    KEY `idx_user_id` (`user_id`),
    KEY `idx_target_user_id` (`target_user_id`),
    UNIQUE KEY `uk_user_target` (`user_id`, `target_user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ»‘åŠ¨è®°å½•è¡¨';

-- t_user_matchï¼ˆåŒ¹é…å…³ç³»è¡¨ï¼‰
CREATE TABLE `t_user_match` (
    `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
    `user_id_1` BIGINT NOT NULL COMMENT 'ç”¨æˆ·1 IDï¼ˆè¾ƒå°IDï¼‰',
    `user_id_2` BIGINT NOT NULL COMMENT 'ç”¨æˆ·2 IDï¼ˆè¾ƒå¤§IDï¼‰',
    `match_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åŒ¹é…æ—¶é—´',
    `is_active` TINYINT DEFAULT 1 COMMENT 'æ˜¯å¦æœ‰æ•ˆ 0æ— æ•ˆ 1æœ‰æ•ˆ',
    KEY `idx_user_id_1` (`user_id_1`),
    KEY `idx_user_id_2` (`user_id_2`),
    UNIQUE KEY `uk_user_match` (`user_id_1`, `user_id_2`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='åŒ¹é…å…³ç³»è¡¨';

-- t_user_likeï¼ˆå–œæ¬¢è®°å½•è¡¨ï¼‰
CREATE TABLE `t_user_like` (
    `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
    `from_user_id` BIGINT NOT NULL COMMENT 'å‘èµ·ç”¨æˆ·ID',
    `to_user_id` BIGINT NOT NULL COMMENT 'ç›®æ ‡ç”¨æˆ·ID',
    `like_type` TINYINT DEFAULT 1 COMMENT 'ç±»å‹ 1æ™®é€šå–œæ¬¢ 2è¶…çº§å–œæ¬¢',
    `is_read` TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦å·²è¯»ï¼ˆVIPå¯è§ï¼‰',
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP,
    KEY `idx_from_user` (`from_user_id`),
    KEY `idx_to_user` (`to_user_id`),
    UNIQUE KEY `uk_from_to` (`from_user_id`, `to_user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='å–œæ¬¢è®°å½•è¡¨';

-- t_recommendation_poolï¼ˆæ¨èæ± è¡¨ - Redisç¼“å­˜ä¸ºä¸»ï¼ŒDBå¤‡ä»½ï¼‰
CREATE TABLE `t_recommendation_pool` (
    `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
    `user_id` BIGINT NOT NULL,
    `recommended_user_id` BIGINT NOT NULL,
    `score` DECIMAL(5,2) DEFAULT 0 COMMENT 'æ¨èåˆ†æ•°',
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP,
    `expired_at` DATETIME COMMENT 'è¿‡æœŸæ—¶é—´',
    KEY `idx_user_id` (`user_id`),
    KEY `idx_score` (`score`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ¨èæ± è¡¨';

-- t_user_locationï¼ˆç”¨æˆ·ä½ç½®è¡¨ï¼‰
CREATE TABLE `t_user_location` (
    `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
    `user_id` BIGINT NOT NULL,
    `longitude` DECIMAL(10,6) NOT NULL COMMENT 'ç»åº¦',
    `latitude` DECIMAL(10,6) NOT NULL COMMENT 'çº¬åº¦',
    `city` VARCHAR(50),
    `district` VARCHAR(50),
    `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    UNIQUE KEY `uk_user_id` (`user_id`),
    SPATIAL INDEX `idx_location` (`longitude`, `latitude`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç”¨æˆ·ä½ç½®è¡¨';
```

#### å¾…å¼€å‘æ¥å£
```
GET    /api/match/recommend           - è·å–æ¨èåˆ—è¡¨
POST   /api/match/swipe               - æ»‘åŠ¨æ“ä½œï¼ˆå–œæ¬¢/ä¸å–œæ¬¢ï¼‰
GET    /api/match/matches             - è·å–åŒ¹é…åˆ—è¡¨
GET    /api/match/liked-me            - è°å–œæ¬¢æˆ‘ï¼ˆVIPï¼‰
POST   /api/match/preference          - è®¾ç½®åŒ¹é…åå¥½
GET    /api/match/preference          - è·å–åŒ¹é…åå¥½
POST   /api/match/location            - æ›´æ–°ä½ç½®
```

#### å…³é”®æŠ€æœ¯ç‚¹
```java
// æ¨èç®—æ³•ä¼ªä»£ç 
public class MatchingAlgorithm {
    
    /**
     * è®¡ç®—åŒ¹é…åˆ†æ•°
     */
    public BigDecimal calculateMatchScore(User currentUser, User targetUser) {
        BigDecimal score = BigDecimal.ZERO;
        
        // 1. æ ‡ç­¾åŒ¹é…åº¦ï¼ˆæƒé‡40%ï¼‰
        BigDecimal tagScore = calculateTagSimilarity(currentUser, targetUser);
        score = score.add(tagScore.multiply(new BigDecimal("0.4")));
        
        // 2. å¹´é¾„åŒ¹é…åº¦ï¼ˆæƒé‡20%ï¼‰
        BigDecimal ageScore = calculateAgeScore(currentUser, targetUser);
        score = score.add(ageScore.multiply(new BigDecimal("0.2")));
        
        // 3. è·ç¦»æƒé‡ï¼ˆæƒé‡15%ï¼‰
        BigDecimal distanceScore = calculateDistanceScore(currentUser, targetUser);
        score = score.add(distanceScore.multiply(new BigDecimal("0.15")));
        
        // 4. æ´»è·ƒåº¦æƒé‡ï¼ˆæƒé‡15%ï¼‰
        BigDecimal activityScore = calculateActivityScore(targetUser);
        score = score.add(activityScore.multiply(new BigDecimal("0.15")));
        
        // 5. è®¤è¯åŠ åˆ†ï¼ˆæƒé‡10%ï¼‰
        BigDecimal verifyScore = targetUser.getIsVerified() == 1 ? 
            new BigDecimal("1.0") : BigDecimal.ZERO;
        score = score.add(verifyScore.multiply(new BigDecimal("0.1")));
        
        return score;
    }
    
    /**
     * æ ‡ç­¾ç›¸ä¼¼åº¦ï¼ˆä½™å¼¦ç›¸ä¼¼åº¦ï¼‰
     */
    private BigDecimal calculateTagSimilarity(User user1, User user2) {
        List<Long> tags1 = getUserTagIds(user1.getId());
        List<Long> tags2 = getUserTagIds(user2.getId());
        
        if (tags1.isEmpty() || tags2.isEmpty()) {
            return BigDecimal.ZERO;
        }
        
        // äº¤é›†
        long intersection = tags1.stream()
            .filter(tags2::contains)
            .count();
        
        // ä½™å¼¦ç›¸ä¼¼åº¦
        double similarity = intersection / 
            Math.sqrt(tags1.size() * tags2.size());
        
        return new BigDecimal(similarity);
    }
}
```

---

### 3.3 å³æ—¶é€šè®¯æ¨¡å—ï¼ˆå¾…å¼€å‘ï¼‰

#### åŠŸèƒ½æè¿°
å®æ—¶èŠå¤©ã€æ¶ˆæ¯æ¨é€ã€èŠå¤©è®°å½•ç®¡ç†ã€‚

#### æŠ€æœ¯é€‰å‹å»ºè®®
**æ–¹æ¡ˆAï¼šè‡ªå»ºIMç³»ç»Ÿ**
- WebSocket + Netty
- Redis Pub/Subæ¶ˆæ¯åˆ†å‘
- MongoDBå­˜å‚¨èŠå¤©è®°å½•
- å¼€å‘æˆæœ¬é«˜ï¼Œçµæ´»æ€§å¼º

**æ–¹æ¡ˆBï¼šç¬¬ä¸‰æ–¹IMï¼ˆæ¨èï¼‰**
- è…¾è®¯äº‘IM SDKï¼ˆæ¨èï¼‰
- ç¯ä¿¡IM SDK
- å¼€å‘æˆæœ¬ä½ï¼Œç¨³å®šæ€§å¥½

#### æ ¸å¿ƒåŠŸèƒ½ç‚¹ï¼ˆåŸºäºç¬¬ä¸‰æ–¹IMï¼‰
1. **èŠå¤©åŠŸèƒ½**
   - æ–‡æœ¬æ¶ˆæ¯
   - å›¾ç‰‡æ¶ˆæ¯ï¼ˆå‹ç¼©ä¸Šä¼ ï¼‰
   - è¯­éŸ³æ¶ˆæ¯ï¼ˆæœ€å¤š60ç§’ï¼‰
   - è¡¨æƒ…åŒ…
   - æ¶ˆæ¯æ’¤å›ï¼ˆ2åˆ†é’Ÿå†…ï¼‰

2. **èŠå¤©åˆ—è¡¨**
   - æœ€è¿‘èŠå¤©
   - æœªè¯»æ¶ˆæ¯æç¤º
   - ç½®é¡¶èŠå¤©
   - åˆ é™¤èŠå¤©

3. **æ¶ˆæ¯ç®¡ç†**
   - æ¶ˆæ¯å·²è¯»/æœªè¯»
   - æ¶ˆæ¯æ¨é€
   - æ•æ„Ÿè¯è¿‡æ»¤ï¼ˆæœ¬åœ°ï¼‰

#### æ•°æ®è¡¨è®¾è®¡ï¼ˆè¾…åŠ©è¡¨ï¼Œä¸»è¦èŠå¤©æ•°æ®åœ¨IMå¹³å°ï¼‰
```sql
-- t_chat_conversationï¼ˆä¼šè¯è¡¨ - ç”¨äºæœ¬åœ°å±•ç¤ºï¼‰
CREATE TABLE `t_chat_conversation` (
    `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
    `conversation_id` VARCHAR(100) NOT NULL COMMENT 'IMå¹³å°ä¼šè¯ID',
    `user_id` BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
    `peer_user_id` BIGINT NOT NULL COMMENT 'å¯¹æ–¹ç”¨æˆ·ID',
    `last_message` VARCHAR(500) COMMENT 'æœ€åä¸€æ¡æ¶ˆæ¯',
    `last_message_time` DATETIME COMMENT 'æœ€åæ¶ˆæ¯æ—¶é—´',
    `unread_count` INT DEFAULT 0 COMMENT 'æœªè¯»æ•°',
    `is_top` TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦ç½®é¡¶',
    `is_deleted` TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦åˆ é™¤',
    `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    KEY `idx_user_id` (`user_id`),
    KEY `idx_peer_user_id` (`peer_user_id`),
    UNIQUE KEY `uk_conversation` (`user_id`, `peer_user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ä¼šè¯è¡¨';

-- t_sensitive_wordï¼ˆæ•æ„Ÿè¯åº“è¡¨ï¼‰
CREATE TABLE `t_sensitive_word` (
    `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
    `word` VARCHAR(50) NOT NULL,
    `category` VARCHAR(20) COMMENT 'åˆ†ç±»ï¼ˆæ”¿æ²»/è‰²æƒ…/å¹¿å‘Šç­‰ï¼‰',
    `status` TINYINT DEFAULT 1,
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP,
    UNIQUE KEY `uk_word` (`word`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ•æ„Ÿè¯åº“è¡¨';
```

#### å¾…å¼€å‘æ¥å£ï¼ˆä¸IM SDKç»“åˆï¼‰
```
GET    /api/chat/conversations        - è·å–ä¼šè¯åˆ—è¡¨
GET    /api/chat/im-signature         - è·å–IMç­¾åï¼ˆç™»å½•IMç”¨ï¼‰
POST   /api/chat/conversation/top     - ç½®é¡¶ä¼šè¯
DELETE /api/chat/conversation/{id}    - åˆ é™¤ä¼šè¯
POST   /api/chat/report               - ä¸¾æŠ¥æ¶ˆæ¯
```

---

### 3.4 åŠ¨æ€ç¤¾åŒºæ¨¡å—ï¼ˆå¾…å¼€å‘ï¼‰

#### åŠŸèƒ½æè¿°
ç”¨æˆ·å‘å¸ƒåŠ¨æ€ã€æµè§ˆåŠ¨æ€ã€äº’åŠ¨ï¼ˆç‚¹èµ/è¯„è®ºï¼‰ã€‚

#### æ ¸å¿ƒåŠŸèƒ½ç‚¹
1. **å‘å¸ƒåŠ¨æ€**
   - å›¾æ–‡åŠ¨æ€ï¼ˆæœ€å¤š9å¼ å›¾ï¼‰
   - çº¯æ–‡å­—åŠ¨æ€
   - è¯é¢˜æ ‡ç­¾
   - å®šä½

2. **æµè§ˆåŠ¨æ€**
   - æ¨èæµï¼ˆç®—æ³•æ¨èï¼‰
   - å…³æ³¨æµï¼ˆæœªæ¥åŠŸèƒ½ï¼‰
   - é™„è¿‘åŠ¨æ€
   - è¯é¢˜å¹¿åœº

3. **äº’åŠ¨åŠŸèƒ½**
   - ç‚¹èµ
   - è¯„è®º/å›å¤
   - ä¸¾æŠ¥

#### æ•°æ®è¡¨è®¾è®¡
```sql
-- t_momentï¼ˆåŠ¨æ€è¡¨ï¼‰
CREATE TABLE `t_moment` (
    `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
    `user_id` BIGINT NOT NULL,
    `content` VARCHAR(1000) COMMENT 'åŠ¨æ€å†…å®¹',
    `location` VARCHAR(100) COMMENT 'å®šä½',
    `longitude` DECIMAL(10,6) COMMENT 'ç»åº¦',
    `latitude` DECIMAL(10,6) COMMENT 'çº¬åº¦',
    `topic_id` BIGINT COMMENT 'è¯é¢˜ID',
    `audit_status` TINYINT DEFAULT 0 COMMENT 'å®¡æ ¸çŠ¶æ€ 0å¾…å®¡æ ¸ 1é€šè¿‡ 2æ‹’ç»',
    `like_count` INT DEFAULT 0 COMMENT 'ç‚¹èµæ•°',
    `comment_count` INT DEFAULT 0 COMMENT 'è¯„è®ºæ•°',
    `view_count` INT DEFAULT 0 COMMENT 'æµè§ˆæ•°',
    `is_deleted` TINYINT DEFAULT 0,
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP,
    `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    KEY `idx_user_id` (`user_id`),
    KEY `idx_topic_id` (`topic_id`),
    KEY `idx_audit_status` (`audit_status`),
    KEY `idx_created_at` (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='åŠ¨æ€è¡¨';

-- t_moment_imageï¼ˆåŠ¨æ€å›¾ç‰‡è¡¨ï¼‰
CREATE TABLE `t_moment_image` (
    `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
    `moment_id` BIGINT NOT NULL,
    `image_url` VARCHAR(255) NOT NULL,
    `sort_order` INT DEFAULT 0,
    KEY `idx_moment_id` (`moment_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='åŠ¨æ€å›¾ç‰‡è¡¨';

-- t_moment_likeï¼ˆç‚¹èµè¡¨ï¼‰
CREATE TABLE `t_moment_like` (
    `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
    `moment_id` BIGINT NOT NULL,
    `user_id` BIGINT NOT NULL,
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP,
    KEY `idx_moment_id` (`moment_id`),
    KEY `idx_user_id` (`user_id`),
    UNIQUE KEY `uk_moment_user` (`moment_id`, `user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç‚¹èµè¡¨';

-- t_moment_commentï¼ˆè¯„è®ºè¡¨ï¼‰
CREATE TABLE `t_moment_comment` (
    `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
    `moment_id` BIGINT NOT NULL,
    `user_id` BIGINT NOT NULL,
    `parent_id` BIGINT DEFAULT 0 COMMENT 'çˆ¶è¯„è®ºIDï¼ˆå›å¤ç”¨ï¼‰',
    `reply_to_user_id` BIGINT COMMENT 'å›å¤çš„ç”¨æˆ·ID',
    `content` VARCHAR(500) NOT NULL,
    `is_deleted` TINYINT DEFAULT 0,
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP,
    KEY `idx_moment_id` (`moment_id`),
    KEY `idx_user_id` (`user_id`),
    KEY `idx_parent_id` (`parent_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='è¯„è®ºè¡¨';

-- t_moment_topicï¼ˆè¯é¢˜è¡¨ï¼‰
CREATE TABLE `t_moment_topic` (
    `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
    `topic_name` VARCHAR(50) NOT NULL,
    `cover_image` VARCHAR(255),
    `description` VARCHAR(200),
    `moment_count` INT DEFAULT 0 COMMENT 'åŠ¨æ€æ•°',
    `view_count` INT DEFAULT 0 COMMENT 'æµè§ˆæ•°',
    `is_hot` TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦çƒ­é—¨',
    `status` TINYINT DEFAULT 1,
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP,
    UNIQUE KEY `uk_topic_name` (`topic_name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='è¯é¢˜è¡¨';

-- t_moment_reportï¼ˆä¸¾æŠ¥è¡¨ï¼‰
CREATE TABLE `t_moment_report` (
    `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
    `moment_id` BIGINT NOT NULL,
    `user_id` BIGINT NOT NULL COMMENT 'ä¸¾æŠ¥äººID',
    `reason` TINYINT NOT NULL COMMENT 'åŸå›  1è‰²æƒ… 2æš´åŠ› 3è¯ˆéª— 4å…¶ä»–',
    `description` VARCHAR(200),
    `status` TINYINT DEFAULT 0 COMMENT 'å¤„ç†çŠ¶æ€ 0å¾…å¤„ç† 1å·²å¤„ç†',
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP,
    KEY `idx_moment_id` (`moment_id`),
    KEY `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ä¸¾æŠ¥è¡¨';
```

#### å¾…å¼€å‘æ¥å£
```
GET    /api/moment/feed               - è·å–åŠ¨æ€æµ
GET    /api/moment/nearby             - é™„è¿‘åŠ¨æ€
GET    /api/moment/topic/{topicId}    - è¯é¢˜åŠ¨æ€
POST   /api/moment/publish            - å‘å¸ƒåŠ¨æ€
DELETE /api/moment/{momentId}         - åˆ é™¤åŠ¨æ€
POST   /api/moment/like               - ç‚¹èµ
DELETE /api/moment/like/{momentId}    - å–æ¶ˆç‚¹èµ
POST   /api/moment/comment            - è¯„è®º
DELETE /api/moment/comment/{commentId}- åˆ é™¤è¯„è®º
POST   /api/moment/report             - ä¸¾æŠ¥
GET    /api/moment/topics/hot         - çƒ­é—¨è¯é¢˜
```

---

### 3.5 æ­å­å¹³å°æ¨¡å—ï¼ˆå¾…å¼€å‘ï¼‰

#### åŠŸèƒ½æè¿°
ç”¨æˆ·å‘å¸ƒ/å‚ä¸æ­å­æ´»åŠ¨ï¼Œæ‰¾é¥­æ­ã€è¿åŠ¨æ­ã€æ—…æ¸¸æ­ç­‰ã€‚

#### æ ¸å¿ƒåŠŸèƒ½ç‚¹
1. **æ´»åŠ¨å‘å¸ƒ**
   - æ´»åŠ¨ç±»å‹ï¼ˆé¥­æ­ã€è¿åŠ¨ã€æ—…æ¸¸ã€å­¦ä¹ ã€å¨±ä¹ç­‰ï¼‰
   - æ´»åŠ¨æ—¶é—´åœ°ç‚¹
   - å‚ä¸äººæ•°é™åˆ¶
   - è´¹ç”¨è¯´æ˜ï¼ˆAA/å…è´¹/è¯·å®¢ï¼‰
   - æ€§åˆ«é™åˆ¶

2. **æ´»åŠ¨ç®¡ç†**
   - æŠ¥åå®¡æ ¸ï¼ˆå¯é€‰ï¼‰
   - å‚ä¸äººå‘˜ç®¡ç†
   - æ´»åŠ¨å–æ¶ˆ/ç»“æŸ

3. **æ´»åŠ¨åŒ¹é…**
   - æ™ºèƒ½æ¨èæ­å­æ´»åŠ¨
   - æŒ‰å…´è¶£ç±»å‹ç­›é€‰
   - æŒ‰æ—¶é—´åœ°ç‚¹ç­›é€‰

#### æ•°æ®è¡¨è®¾è®¡
```sql
-- t_buddy_activityï¼ˆæ­å­æ´»åŠ¨è¡¨ï¼‰
CREATE TABLE `t_buddy_activity` (
    `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
    `user_id` BIGINT NOT NULL COMMENT 'å‘å¸ƒäººID',
    `category_id` BIGINT NOT NULL COMMENT 'åˆ†ç±»ID',
    `title` VARCHAR(100) NOT NULL,
    `content` VARCHAR(500),
    `activity_time` DATETIME NOT NULL COMMENT 'æ´»åŠ¨æ—¶é—´',
    `location` VARCHAR(100) COMMENT 'æ´»åŠ¨åœ°ç‚¹',
    `longitude` DECIMAL(10,6),
    `latitude` DECIMAL(10,6),
    `max_participants` INT DEFAULT 2 COMMENT 'æœ€å¤šå‚ä¸äººæ•°',
    `current_participants` INT DEFAULT 1 COMMENT 'å½“å‰å‚ä¸äººæ•°',
    `cost_type` TINYINT DEFAULT 1 COMMENT 'è´¹ç”¨ç±»å‹ 1AA 2å…è´¹ 3è¯·å®¢',
    `cost_amount` DECIMAL(10,2) COMMENT 'è´¹ç”¨é‡‘é¢',
    `gender_limit` TINYINT DEFAULT 0 COMMENT 'æ€§åˆ«é™åˆ¶ 0ä¸é™ 1ç”· 2å¥³',
    `need_approval` TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦éœ€è¦å®¡æ ¸ 0å¦ 1æ˜¯',
    `status` TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€ 1æ‹›å‹Ÿä¸­ 2å·²æ»¡ 3å·²ç»“æŸ 4å·²å–æ¶ˆ',
    `view_count` INT DEFAULT 0,
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP,
    `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    KEY `idx_user_id` (`user_id`),
    KEY `idx_category_id` (`category_id`),
    KEY `idx_activity_time` (`activity_time`),
    KEY `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ­å­æ´»åŠ¨è¡¨';

-- t_buddy_categoryï¼ˆæ´»åŠ¨åˆ†ç±»è¡¨ï¼‰
CREATE TABLE `t_buddy_category` (
    `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
    `category_name` VARCHAR(20) NOT NULL,
    `icon` VARCHAR(100),
    `sort_order` INT DEFAULT 0,
    `status` TINYINT DEFAULT 1,
    UNIQUE KEY `uk_category_name` (`category_name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ´»åŠ¨åˆ†ç±»è¡¨';

-- åˆå§‹åŒ–åˆ†ç±»æ•°æ®
INSERT INTO `t_buddy_category` (category_name, icon, sort_order) VALUES
('é¥­æ­', 'meal.png', 1),
('è¿åŠ¨', 'sport.png', 2),
('æ—…æ¸¸', 'travel.png', 3),
('å­¦ä¹ ', 'study.png', 4),
('å¨±ä¹', 'entertainment.png', 5),
('ç”µå½±', 'movie.png', 6),
('æ¸¸æˆ', 'game.png', 7),
('å…¶ä»–', 'other.png', 99);

-- t_buddy_enrollmentï¼ˆæŠ¥åè¡¨ï¼‰
CREATE TABLE `t_buddy_enrollment` (
    `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
    `activity_id` BIGINT NOT NULL,
    `user_id` BIGINT NOT NULL,
    `apply_message` VARCHAR(200) COMMENT 'æŠ¥åç•™è¨€',
    `status` TINYINT DEFAULT 0 COMMENT 'çŠ¶æ€ 0å¾…å®¡æ ¸ 1å·²é€šè¿‡ 2å·²æ‹’ç»',
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP,
    KEY `idx_activity_id` (`activity_id`),
    KEY `idx_user_id` (`user_id`),
    UNIQUE KEY `uk_activity_user` (`activity_id`, `user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æŠ¥åè¡¨';

-- t_buddy_participantï¼ˆå‚ä¸è€…è¡¨ï¼‰
CREATE TABLE `t_buddy_participant` (
    `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
    `activity_id` BIGINT NOT NULL,
    `user_id` BIGINT NOT NULL,
    `is_creator` TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦å‘èµ·äºº',
    `joined_at` DATETIME DEFAULT CURRENT_TIMESTAMP,
    KEY `idx_activity_id` (`activity_id`),
    KEY `idx_user_id` (`user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='å‚ä¸è€…è¡¨';

-- t_buddy_reviewï¼ˆè¯„ä»·è¡¨ï¼‰
CREATE TABLE `t_buddy_review` (
    `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
    `activity_id` BIGINT NOT NULL,
    `from_user_id` BIGINT NOT NULL COMMENT 'è¯„ä»·äºº',
    `to_user_id` BIGINT NOT NULL COMMENT 'è¢«è¯„ä»·äºº',
    `rating` TINYINT NOT NULL COMMENT 'è¯„åˆ† 1-5',
    `content` VARCHAR(200),
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP,
    KEY `idx_activity_id` (`activity_id`),
    KEY `idx_to_user_id` (`to_user_id`),
    UNIQUE KEY `uk_from_to_activity` (`activity_id`, `from_user_id`, `to_user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='è¯„ä»·è¡¨';
```

#### å¾…å¼€å‘æ¥å£
```
GET    /api/buddy/list                - æ­å­æ´»åŠ¨åˆ—è¡¨
GET    /api/buddy/{activityId}        - æ´»åŠ¨è¯¦æƒ…
POST   /api/buddy/publish             - å‘å¸ƒæ´»åŠ¨
PUT    /api/buddy/{activityId}        - ä¿®æ”¹æ´»åŠ¨
DELETE /api/buddy/{activityId}        - å–æ¶ˆæ´»åŠ¨
POST   /api/buddy/enroll              - æŠ¥åæ´»åŠ¨
GET    /api/buddy/my-activities       - æˆ‘çš„æ´»åŠ¨ï¼ˆå‘å¸ƒçš„ï¼‰
GET    /api/buddy/my-enrollments      - æˆ‘çš„æŠ¥å
POST   /api/buddy/approve             - å®¡æ ¸æŠ¥å
POST   /api/buddy/review              - è¯„ä»·
GET    /api/buddy/categories          - æ´»åŠ¨åˆ†ç±»
```

---

### 3.6 çº¿ä¸‹æ´»åŠ¨æ¨¡å—ï¼ˆå¾…å¼€å‘ï¼‰

#### åŠŸèƒ½æè¿°
å®˜æ–¹ç»„ç»‡çš„çº¿ä¸‹äº¤å‹æ´»åŠ¨ï¼ˆéœ€è¦åå°ç®¡ç†ï¼‰ã€‚

#### æ ¸å¿ƒåŠŸèƒ½ç‚¹
1. **æ´»åŠ¨å±•ç¤º**
   - æ´»åŠ¨åˆ—è¡¨
   - æ´»åŠ¨è¯¦æƒ…
   - æ´»åŠ¨ç±»å‹ï¼ˆå•èº«æ´¾å¯¹ã€å…´è¶£èšä¼šã€æˆ·å¤–æ´»åŠ¨ç­‰ï¼‰

2. **æ´»åŠ¨æŠ¥å**
   - åœ¨çº¿æŠ¥å
   - æ”¯ä»˜æ´»åŠ¨è´¹
   - æŠ¥åå®¡æ ¸

3. **æ´»åŠ¨ç®¡ç†**ï¼ˆåå°ï¼‰
   - æ´»åŠ¨åˆ›å»º
   - æŠ¥åç®¡ç†
   - ç­¾åˆ°ç®¡ç†

#### æ•°æ®è¡¨è®¾è®¡
```sql
-- t_official_activityï¼ˆå®˜æ–¹æ´»åŠ¨è¡¨ï¼‰
CREATE TABLE `t_official_activity` (
    `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
    `title` VARCHAR(100) NOT NULL,
    `cover_image` VARCHAR(255),
    `description` TEXT,
    `activity_type` VARCHAR(50) COMMENT 'æ´»åŠ¨ç±»å‹',
    `activity_time` DATETIME NOT NULL,
    `address` VARCHAR(200) NOT NULL,
    `longitude` DECIMAL(10,6),
    `latitude` DECIMAL(10,6),
    `max_participants` INT NOT NULL COMMENT 'æœ€å¤šäººæ•°',
    `current_participants` INT DEFAULT 0,
    `price` DECIMAL(10,2) DEFAULT 0 COMMENT 'æ´»åŠ¨è´¹ç”¨',
    `gender_ratio` VARCHAR(20) COMMENT 'ç”·å¥³æ¯”ä¾‹è¦æ±‚ï¼ˆå¦‚1:1ï¼‰',
    `status` TINYINT DEFAULT 1 COMMENT '1æŠ¥åä¸­ 2å·²æ»¡ 3è¿›è¡Œä¸­ 4å·²ç»“æŸ',
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP,
    `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    KEY `idx_activity_time` (`activity_time`),
    KEY `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='å®˜æ–¹æ´»åŠ¨è¡¨';

-- t_activity_enrollmentï¼ˆæ´»åŠ¨æŠ¥åè¡¨ï¼‰
CREATE TABLE `t_activity_enrollment` (
    `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
    `activity_id` BIGINT NOT NULL,
    `user_id` BIGINT NOT NULL,
    `real_name` VARCHAR(50) NOT NULL COMMENT 'çœŸå®å§“å',
    `phone` VARCHAR(20) NOT NULL,
    `gender` TINYINT NOT NULL,
    `age` INT NOT NULL,
    `apply_reason` VARCHAR(200),
    `status` TINYINT DEFAULT 0 COMMENT '0å¾…å®¡æ ¸ 1å·²é€šè¿‡ 2å·²æ‹’ç» 3å·²æ”¯ä»˜',
    `payment_status` TINYINT DEFAULT 0 COMMENT '0æœªæ”¯ä»˜ 1å·²æ”¯ä»˜',
    `payment_amount` DECIMAL(10,2),
    `order_no` VARCHAR(50) COMMENT 'è®¢å•å·',
    `checkin_status` TINYINT DEFAULT 0 COMMENT '0æœªç­¾åˆ° 1å·²ç­¾åˆ°',
    `checkin_time` DATETIME,
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP,
    KEY `idx_activity_id` (`activity_id`),
    KEY `idx_user_id` (`user_id`),
    KEY `idx_order_no` (`order_no`),
    UNIQUE KEY `uk_activity_user` (`activity_id`, `user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ´»åŠ¨æŠ¥åè¡¨';
```

#### å¾…å¼€å‘æ¥å£
```
GET    /api/activity/official/list    - å®˜æ–¹æ´»åŠ¨åˆ—è¡¨
GET    /api/activity/official/{id}    - æ´»åŠ¨è¯¦æƒ…
POST   /api/activity/enroll           - æŠ¥åæ´»åŠ¨
POST   /api/activity/pay              - æ”¯ä»˜æ´»åŠ¨è´¹
GET    /api/activity/my-enrollments   - æˆ‘çš„æŠ¥å
POST   /api/activity/checkin          - ç­¾åˆ°ï¼ˆæ‰«ç ï¼‰
```

---

### 3.7 ä¼šå‘˜ä½“ç³»æ¨¡å—ï¼ˆå¾…å¼€å‘ï¼‰

#### åŠŸèƒ½æè¿°
åŸºäºå·²æœ‰çš„ `vip_level` å’Œ `vip_expire_time` å­—æ®µï¼Œæ‰©å±•ä¼šå‘˜è´­ä¹°å’Œç‰¹æƒç³»ç»Ÿã€‚

#### æ ¸å¿ƒåŠŸèƒ½ç‚¹
1. **ä¼šå‘˜å¥—é¤**
   - æœˆåº¦ä¼šå‘˜ï¼ˆ30å¤©ï¼‰
   - å­£åº¦ä¼šå‘˜ï¼ˆ90å¤©ï¼‰
   - å¹´åº¦ä¼šå‘˜ï¼ˆ365å¤©ï¼‰

2. **ä¼šå‘˜ç‰¹æƒ**
   - æ— é™æ¬¡å–œæ¬¢ï¼ˆæ™®é€šç”¨æˆ·æ¯å¤©30æ¬¡ï¼‰
   - æŸ¥çœ‹è°å–œæ¬¢æˆ‘
   - è¶…çº§æ›å…‰ï¼ˆæ¨èæƒé‡æå‡ï¼‰
   - ä¼˜å…ˆæ¨è
   - ä¸“å±æ ‡è¯†
   - æ— é™æ’¤å›æ¶ˆæ¯

3. **æ”¯ä»˜ç®¡ç†**
   - å¾®ä¿¡æ”¯ä»˜
   - è®¢å•ç®¡ç†

#### æ•°æ®è¡¨è®¾è®¡
```sql
-- t_vip_packageï¼ˆä¼šå‘˜å¥—é¤è¡¨ï¼‰
CREATE TABLE `t_vip_package` (
    `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
    `package_name` VARCHAR(50) NOT NULL,
    `vip_level` TINYINT NOT NULL COMMENT 'ä¼šå‘˜ç­‰çº§ 1VIP 2SVIP',
    `duration_days` INT NOT NULL COMMENT 'æ—¶é•¿ï¼ˆå¤©ï¼‰',
    `original_price` DECIMAL(10,2) NOT NULL COMMENT 'åŸä»·',
    `current_price` DECIMAL(10,2) NOT NULL COMMENT 'ç°ä»·',
    `discount` DECIMAL(3,2) COMMENT 'æŠ˜æ‰£',
    `sort_order` INT DEFAULT 0,
    `status` TINYINT DEFAULT 1,
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ä¼šå‘˜å¥—é¤è¡¨';

-- åˆå§‹åŒ–å¥—é¤æ•°æ®
INSERT INTO `t_vip_package` (package_name, vip_level, duration_days, original_price, current_price, discount, sort_order) VALUES
('æœˆåº¦VIP', 1, 30, 68.00, 58.00, 0.85, 1),
('å­£åº¦VIP', 1, 90, 198.00, 148.00, 0.75, 2),
('å¹´åº¦VIP', 1, 365, 688.00, 488.00, 0.71, 3);

-- t_vip_orderï¼ˆä¼šå‘˜è®¢å•è¡¨ï¼‰
CREATE TABLE `t_vip_order` (
    `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
    `order_no` VARCHAR(50) NOT NULL COMMENT 'è®¢å•å·',
    `user_id` BIGINT NOT NULL,
    `package_id` BIGINT NOT NULL,
    `vip_level` TINYINT NOT NULL,
    `duration_days` INT NOT NULL,
    `amount` DECIMAL(10,2) NOT NULL,
    `payment_type` TINYINT DEFAULT 1 COMMENT 'æ”¯ä»˜æ–¹å¼ 1å¾®ä¿¡',
    `payment_status` TINYINT DEFAULT 0 COMMENT '0å¾…æ”¯ä»˜ 1å·²æ”¯ä»˜ 2å·²å–æ¶ˆ 3å·²é€€æ¬¾',
    `transaction_id` VARCHAR(100) COMMENT 'ç¬¬ä¸‰æ–¹äº¤æ˜“å·',
    `paid_at` DATETIME COMMENT 'æ”¯ä»˜æ—¶é—´',
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP,
    `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    UNIQUE KEY `uk_order_no` (`order_no`),
    KEY `idx_user_id` (`user_id`),
    KEY `idx_transaction_id` (`transaction_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ä¼šå‘˜è®¢å•è¡¨';

-- t_payment_recordï¼ˆæ”¯ä»˜è®°å½•è¡¨ï¼‰
CREATE TABLE `t_payment_record` (
    `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
    `order_no` VARCHAR(50) NOT NULL,
    `user_id` BIGINT NOT NULL,
    `amount` DECIMAL(10,2) NOT NULL,
    `payment_type` TINYINT NOT NULL COMMENT '1å¾®ä¿¡æ”¯ä»˜',
    `status` TINYINT DEFAULT 0 COMMENT '0å¾…æ”¯ä»˜ 1æˆåŠŸ 2å¤±è´¥',
    `transaction_id` VARCHAR(100) COMMENT 'ç¬¬ä¸‰æ–¹äº¤æ˜“å·',
    `callback_data` TEXT COMMENT 'å›è°ƒæ•°æ®',
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP,
    `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    KEY `idx_order_no` (`order_no`),
    KEY `idx_user_id` (`user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ”¯ä»˜è®°å½•è¡¨';
```

#### å¾…å¼€å‘æ¥å£
```
GET    /api/vip/packages              - è·å–ä¼šå‘˜å¥—é¤
POST   /api/vip/order/create          - åˆ›å»ºè®¢å•
POST   /api/vip/pay                   - å‘èµ·æ”¯ä»˜
POST   /api/vip/pay/callback          - æ”¯ä»˜å›è°ƒï¼ˆå¾®ä¿¡ï¼‰
GET    /api/vip/my-orders             - æˆ‘çš„è®¢å•
GET    /api/vip/privileges            - ä¼šå‘˜ç‰¹æƒè¯´æ˜
```

#### å…³é”®æŠ€æœ¯ç‚¹
```java
/**
 * ä¼šå‘˜åˆ°æœŸæ£€æŸ¥ï¼ˆå®šæ—¶ä»»åŠ¡ï¼‰
 */
@Scheduled(cron = "0 0 1 * * ?") // æ¯å¤©å‡Œæ™¨1ç‚¹æ‰§è¡Œ
public void checkVipExpire() {
    // æŸ¥è¯¢ä»Šå¤©è¿‡æœŸçš„ä¼šå‘˜
    List<WxUser> expiredUsers = wxUserMapper.selectList(
        new LambdaQueryWrapper<WxUser>()
            .gt(WxUser::getVipLevel, 0)
            .le(WxUser::getVipExpireTime, new Date())
    );
    
    // å°†ä¼šå‘˜ç­‰çº§é™ä¸º0
    for (WxUser user : expiredUsers) {
        user.setVipLevel(0);
        user.setVipExpireTime(null);
        wxUserMapper.updateById(user);
        
        // å‘é€ä¼šå‘˜è¿‡æœŸé€šçŸ¥
        sendVipExpireNotification(user.getId());
    }
}
```

---

### 3.8 é€šçŸ¥ç³»ç»Ÿæ¨¡å—ï¼ˆå¾…å¼€å‘ï¼‰

#### åŠŸèƒ½æè¿°
ç³»ç»Ÿæ¶ˆæ¯ã€æ¨é€é€šçŸ¥ã€‚

#### æ ¸å¿ƒåŠŸèƒ½ç‚¹
1. **é€šçŸ¥ç±»å‹**
   - åŒ¹é…æˆåŠŸé€šçŸ¥
   - æ–°æ¶ˆæ¯é€šçŸ¥
   - ç‚¹èµ/è¯„è®ºé€šçŸ¥
   - æ´»åŠ¨æé†’
   - ç³»ç»Ÿå…¬å‘Š

2. **æ¨é€æ¸ é“**
   - å°ç¨‹åºå†…æ¶ˆæ¯ï¼ˆæ•°å­—è§’æ ‡ï¼‰
   - å¾®ä¿¡è®¢é˜…æ¶ˆæ¯ï¼ˆéœ€ç”¨æˆ·æˆæƒï¼‰

#### æ•°æ®è¡¨è®¾è®¡
```sql
-- t_notificationï¼ˆé€šçŸ¥è¡¨ï¼‰
CREATE TABLE `t_notification` (
    `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
    `user_id` BIGINT NOT NULL,
    `type` TINYINT NOT NULL COMMENT 'ç±»å‹ 1åŒ¹é… 2æ¶ˆæ¯ 3ç‚¹èµ 4è¯„è®º 5æ´»åŠ¨ 6ç³»ç»Ÿ',
    `title` VARCHAR(100) NOT NULL,
    `content` VARCHAR(500),
    `related_id` BIGINT COMMENT 'å…³è”IDï¼ˆå¦‚åŠ¨æ€IDã€æ´»åŠ¨IDï¼‰',
    `related_type` VARCHAR(20) COMMENT 'å…³è”ç±»å‹',
    `is_read` TINYINT DEFAULT 0,
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP,
    KEY `idx_user_id` (`user_id`),
    KEY `idx_is_read` (`is_read`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='é€šçŸ¥è¡¨';

-- t_notification_settingï¼ˆé€šçŸ¥è®¾ç½®è¡¨ï¼‰
CREATE TABLE `t_notification_setting` (
    `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
    `user_id` BIGINT NOT NULL,
    `match_notify` TINYINT DEFAULT 1 COMMENT 'åŒ¹é…é€šçŸ¥',
    `message_notify` TINYINT DEFAULT 1 COMMENT 'æ¶ˆæ¯é€šçŸ¥',
    `like_notify` TINYINT DEFAULT 1 COMMENT 'ç‚¹èµé€šçŸ¥',
    `comment_notify` TINYINT DEFAULT 1 COMMENT 'è¯„è®ºé€šçŸ¥',
    `activity_notify` TINYINT DEFAULT 1 COMMENT 'æ´»åŠ¨é€šçŸ¥',
    `system_notify` TINYINT DEFAULT 1 COMMENT 'ç³»ç»Ÿé€šçŸ¥',
    `quiet_start_time` TIME COMMENT 'å…æ‰“æ‰°å¼€å§‹æ—¶é—´',
    `quiet_end_time` TIME COMMENT 'å…æ‰“æ‰°ç»“æŸæ—¶é—´',
    `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    UNIQUE KEY `uk_user_id` (`user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='é€šçŸ¥è®¾ç½®è¡¨';
```

#### å¾…å¼€å‘æ¥å£
```
GET    /api/notification/list         - é€šçŸ¥åˆ—è¡¨
PUT    /api/notification/read         - æ ‡è®°å·²è¯»
GET    /api/notification/unread-count - æœªè¯»æ•°é‡
POST   /api/notification/setting      - é€šçŸ¥è®¾ç½®
GET    /api/notification/setting      - è·å–é€šçŸ¥è®¾ç½®
```

---

### 3.9 å†…å®¹å®¡æ ¸æ¨¡å—ï¼ˆå¾…å¼€å‘ï¼‰

#### åŠŸèƒ½æè¿°
ç”¨æˆ·ç”Ÿæˆå†…å®¹çš„å®¡æ ¸ï¼ˆå›¾ç‰‡ã€æ–‡æœ¬ï¼‰ã€‚

#### æŠ€æœ¯é€‰å‹
- **é˜¿é‡Œäº‘å†…å®¹å®‰å…¨API**ï¼ˆæ¨èï¼‰
- è…¾è®¯äº‘å¤©å¾¡API

#### æ ¸å¿ƒåŠŸèƒ½ç‚¹
1. **è‡ªåŠ¨å®¡æ ¸**
   - å›¾ç‰‡é‰´é»„é‰´æš´
   - æ–‡æœ¬æ•æ„Ÿè¯è¿‡æ»¤
   
2. **äººå·¥å®¡æ ¸**ï¼ˆåå°åŠŸèƒ½ï¼‰
   - å¾…å®¡æ ¸é˜Ÿåˆ—
   - å®¡æ ¸å·¥ä½œå°

#### æ•°æ®è¡¨è®¾è®¡
```sql
-- t_content_auditï¼ˆå®¡æ ¸è®°å½•è¡¨ï¼‰
CREATE TABLE `t_content_audit` (
    `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
    `content_type` VARCHAR(20) NOT NULL COMMENT 'å†…å®¹ç±»å‹ AVATAR/ALBUM/MOMENT/COMMENT',
    `content_id` BIGINT NOT NULL,
    `user_id` BIGINT NOT NULL,
    `audit_scene` VARCHAR(50) COMMENT 'å®¡æ ¸åœºæ™¯',
    `audit_result` TINYINT DEFAULT 0 COMMENT 'ç»“æœ 0å¾…å®¡æ ¸ 1é€šè¿‡ 2ç–‘ä¼¼ 3è¿è§„',
    `audit_detail` TEXT COMMENT 'è¯¦ç»†ç»“æœï¼ˆJSONï¼‰',
    `manual_audit` TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦éœ€è¦äººå·¥å®¡æ ¸',
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP,
    KEY `idx_content` (`content_type`, `content_id`),
    KEY `idx_user_id` (`user_id`),
    KEY `idx_audit_result` (`audit_result`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='å®¡æ ¸è®°å½•è¡¨';

-- t_user_violationï¼ˆè¿è§„è®°å½•è¡¨ï¼‰
CREATE TABLE `t_user_violation` (
    `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
    `user_id` BIGINT NOT NULL,
    `violation_type` TINYINT NOT NULL COMMENT 'è¿è§„ç±»å‹ 1è‰²æƒ… 2æš´åŠ› 3è¯ˆéª— 4å¹¿å‘Š',
    `content_type` VARCHAR(20),
    `content_id` BIGINT,
    `description` VARCHAR(500),
    `penalty` TINYINT COMMENT 'å¤„ç½š 1è­¦å‘Š 2å°ç¦3å¤© 3å°ç¦7å¤© 4æ°¸ä¹…å°ç¦',
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP,
    KEY `idx_user_id` (`user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='è¿è§„è®°å½•è¡¨';

-- t_ban_recordï¼ˆå°ç¦è®°å½•è¡¨ï¼‰
CREATE TABLE `t_ban_record` (
    `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
    `user_id` BIGINT NOT NULL,
    `reason` VARCHAR(200) NOT NULL,
    `ban_type` TINYINT NOT NULL COMMENT 'å°ç¦ç±»å‹ 1ä¸´æ—¶ 2æ°¸ä¹…',
    `ban_days` INT COMMENT 'å°ç¦å¤©æ•°',
    `ban_start_time` DATETIME NOT NULL,
    `ban_end_time` DATETIME,
    `status` TINYINT DEFAULT 1 COMMENT '1ç”Ÿæ•ˆä¸­ 2å·²è§£å°',
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP,
    KEY `idx_user_id` (`user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='å°ç¦è®°å½•è¡¨';
```

---

### 3.10 æ–‡ä»¶ä¸Šä¼ æ¨¡å—ï¼ˆå¾…å¼€å‘ï¼‰

#### åŠŸèƒ½æè¿°
ç»Ÿä¸€çš„æ–‡ä»¶ä¸Šä¼ æœåŠ¡ï¼ˆå¤´åƒã€ç…§ç‰‡ã€è¯­éŸ³ã€å›¾ç‰‡ç­‰ï¼‰ã€‚

#### æŠ€æœ¯é€‰å‹
- **é˜¿é‡Œäº‘OSS**ï¼ˆæ¨èï¼‰
- è…¾è®¯äº‘COS

#### æ ¸å¿ƒåŠŸèƒ½ç‚¹
1. **å›¾ç‰‡ä¸Šä¼ **
   - æœ¬åœ°å‹ç¼©ï¼ˆå°ç¨‹åºç«¯ï¼‰
   - ä¸Šä¼ OSS
   - è¿”å›CDNåœ°å€

2. **æ–‡ä»¶ç±»å‹**
   - å¤´åƒï¼ˆ1å¼ ï¼Œæœ€å¤§2MBï¼‰
   - ç›¸å†Œç…§ç‰‡ï¼ˆæœ€å¤š9å¼ ï¼Œæœ€å¤§5MBï¼‰
   - åŠ¨æ€å›¾ç‰‡ï¼ˆæœ€å¤š9å¼ ï¼Œæœ€å¤§5MBï¼‰
   - è¯­éŸ³æ–‡ä»¶ï¼ˆæœ€å¤§2MBï¼‰

#### å¾…å¼€å‘æ¥å£
```
POST   /api/upload/image              - ä¸Šä¼ å›¾ç‰‡
POST   /api/upload/voice              - ä¸Šä¼ è¯­éŸ³
GET    /api/upload/oss-signature      - è·å–OSSç­¾åï¼ˆå‰ç«¯ç›´ä¼ ï¼‰
```

#### å…³é”®æŠ€æœ¯ç‚¹
```java
/**
 * è·å–OSSä¸Šä¼ å‡­è¯ï¼ˆå‰ç«¯ç›´ä¼ ï¼‰
 */
@Service
public class OssService {
    
    @Value("${aliyun.oss.endpoint}")
    private String endpoint;
    
    @Value("${aliyun.oss.accessKeyId}")
    private String accessKeyId;
    
    @Value("${aliyun.oss.accessKeySecret}")
    private String accessKeySecret;
    
    @Value("${aliyun.oss.bucket}")
    private String bucket;
    
    public OssSignatureDTO getSignature(String dir) {
        // ç”Ÿæˆç­¾åç­–ç•¥
        long expireTime = System.currentTimeMillis() + 60 * 1000; // 60ç§’æœ‰æ•ˆæœŸ
        String policy = generatePolicy(expireTime);
        String signature = generateSignature(policy);
        
        OssSignatureDTO dto = new OssSignatureDTO();
        dto.setAccessKeyId(accessKeyId);
        dto.setPolicy(policy);
        dto.setSignature(signature);
        dto.setExpire(expireTime);
        dto.setHost("https://" + bucket + "." + endpoint);
        dto.setDir(dir);
        
        return dto;
    }
}
```

---

## ğŸ›ï¸ å››ã€æŠ€æœ¯æ¶æ„è®¾è®¡

### 4.1 ç³»ç»Ÿæ¶æ„å›¾ï¼ˆå•ä½“åˆ†å±‚æ¶æ„ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å¾®ä¿¡å°ç¨‹åºç«¯                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ HTTPS
                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Nginx / äº‘è´Ÿè½½å‡è¡¡                     â”‚
â”‚            - HTTPS  - é™æ€èµ„æº  - åå‘ä»£ç†                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Spring Boot Application                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚            Controller Layer                      â”‚   â”‚
â”‚  â”‚  WxAuthController, UserController, MatchController  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                       â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚            Service Layer                         â”‚   â”‚
â”‚  â”‚  WxAuthService, UserService, MatchService        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                       â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚            Mapper Layer (MyBatis-Plus)           â”‚   â”‚
â”‚  â”‚  WxUserMapper, UserProfileMapper                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“              â†“              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    MySQL     â”‚ â”‚    Redis     â”‚ â”‚  é˜¿é‡Œäº‘OSS   â”‚
â”‚ (ä¸»ä»å¤åˆ¶)    â”‚ â”‚  (ç¼“å­˜å±‚)     â”‚ â”‚  (æ–‡ä»¶å­˜å‚¨)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 åˆ†å±‚æ¶æ„è¯´æ˜

#### Controllerå±‚
- æ¥æ”¶HTTPè¯·æ±‚
- å‚æ•°æ ¡éªŒï¼ˆ@Validatedï¼‰
- è°ƒç”¨Serviceå±‚
- è¿”å›ç»Ÿä¸€å“åº”ï¼ˆResultï¼‰

#### Serviceå±‚
- ä¸šåŠ¡é€»è¾‘å¤„ç†
- äº‹åŠ¡ç®¡ç†ï¼ˆ@Transactionalï¼‰
- è°ƒç”¨Mapperå±‚
- è°ƒç”¨ç¬¬ä¸‰æ–¹æœåŠ¡

#### Mapperå±‚
- æ•°æ®åº“è®¿é—®ï¼ˆMyBatis-Plusï¼‰
- SQLæ˜ å°„

#### Commonå±‚
- ç»Ÿä¸€å“åº”æ ¼å¼ï¼ˆResultï¼‰
- å…¨å±€å¼‚å¸¸å¤„ç†
- å·¥å…·ç±»ï¼ˆJwtUtilã€WxUtilç­‰ï¼‰

### 4.3 æ ¸å¿ƒæŠ€æœ¯ç»„ä»¶

#### å·²ä½¿ç”¨ç»„ä»¶ âœ…
```xml
<!-- Spring Boot 2.7.18 -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-web</artifactId>
</dependency>

<!-- MyBatis-Plus 3.5.3.1 -->
<dependency>
    <groupId>com.baomidou</groupId>
    <artifactId>mybatis-plus-boot-starter</artifactId>
    <version>3.5.3.1</version>
</dependency>

<!-- Redis -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-redis</artifactId>
</dependency>

<!-- JWT -->
<dependency>
    <groupId>io.jsonwebtoken</groupId>
    <artifactId>jjwt-api</artifactId>
    <version>0.11.5</version>
</dependency>

<!-- Hutool -->
<dependency>
    <groupId>cn.hutool</groupId>
    <artifactId>hutool-all</artifactId>
    <version>5.8.20</version>
</dependency>

<!-- Swagger -->
<dependency>
    <groupId>io.springfox</groupId>
    <artifactId>springfox-boot-starter</artifactId>
    <version>3.0.0</version>
</dependency>
```

#### å¾…å¼•å…¥ç»„ä»¶
```xml
<!-- é˜¿é‡Œäº‘OSS -->
<dependency>
    <groupId>com.aliyun.oss</groupId>
    <artifactId>aliyun-sdk-oss</artifactId>
    <version>3.17.1</version>
</dependency>

<!-- é˜¿é‡Œäº‘å†…å®¹å®‰å…¨ -->
<dependency>
    <groupId>com.aliyun</groupId>
    <artifactId>green20220302</artifactId>
    <version>2.1.6</version>
</dependency>

<!-- XXL-Jobï¼ˆä»»åŠ¡è°ƒåº¦ï¼‰ -->
<dependency>
    <groupId>com.xuxueli</groupId>
    <artifactId>xxl-job-core</artifactId>
    <version>2.4.0</version>
</dependency>

<!-- è…¾è®¯äº‘IM SDK -->
<dependency>
    <groupId>com.tencentyun</groupId>
    <artifactId>tls-sig-api-v2</artifactId>
    <version>2.0</version>
</dependency>
```

---

## ğŸ” äº”ã€å®‰å…¨è®¾è®¡

### 5.1 æ¥å£å®‰å…¨

#### å·²å®ç° âœ…
1. **HTTPSåŠ å¯†**ï¼šå…¨ç«™HTTPS
2. **JWTè®¤è¯**ï¼šTokenè®¤è¯ âœ…
3. **æ‹¦æˆªå™¨**ï¼šJwtAuthInterceptor âœ…

#### å¾…è¡¥å……
1. **æ¥å£ç­¾å**ï¼šå…³é”®æ¥å£ç­¾åæ ¡éªŒ
2. **æ¥å£é™æµ**ï¼šé˜²åˆ·é™æµï¼ˆåŸºäºRedis + Luaï¼‰
3. **å‚æ•°æ ¡éªŒ**ï¼š@Validated + è‡ªå®šä¹‰æ ¡éªŒå™¨

### 5.2 æ•°æ®å®‰å…¨

1. **æ•æ„Ÿä¿¡æ¯åŠ å¯†**
   - æ‰‹æœºå·AESåŠ å¯†å­˜å‚¨ âœ…ï¼ˆå·²æœ‰è„±æ•ï¼‰
   - èº«ä»½è¯å·åŠ å¯†

2. **æ•°æ®è„±æ•** âœ…
   ```java
   // å·²å®ç°æ‰‹æœºå·è„±æ•
   userDTO.setPhone(user.getPhone()
       .replaceAll("(\\d{3})\\d{4}(\\d{4})", "$1****$2"));
   ```

3. **SQLæ³¨å…¥é˜²æŠ¤**
   - MyBatis-Plusé¢„ç¼–è¯‘ âœ…

### 5.3 ä¸šåŠ¡å®‰å…¨

1. **å®åè®¤è¯**ï¼ˆå¾…å¼€å‘ï¼‰
2. **å†…å®¹å®¡æ ¸**ï¼ˆå¾…æ¥å…¥é˜¿é‡Œäº‘APIï¼‰
3. **åä½œå¼Š**
   - é˜²åˆ·èµï¼ˆé™æµï¼‰
   - é˜²åˆ·åŒ¹é…ï¼ˆæ¯æ—¥é™é¢ï¼‰

---

## ğŸ“¡ å…­ã€ç¬¬ä¸‰æ–¹é›†æˆ

### 6.1 å¾®ä¿¡ç”Ÿæ€ âœ…

```java
// å·²å®ç°å¾®ä¿¡ç™»å½•
@Value("${wx.appid}")
private String appid;

@Value("${wx.secret}")
private String secret;

public WxSessionInfo code2Session(String code) {
    String url = String.format(
        "https://api.weixin.qq.com/sns/jscode2session?appid=%s&secret=%s&js_code=%s&grant_type=authorization_code",
        appid, secret, code
    );
    // ... è°ƒç”¨å¾®ä¿¡æ¥å£
}
```

### 6.2 äº‘æœåŠ¡ï¼ˆå¾…æ¥å…¥ï¼‰

#### é˜¿é‡Œäº‘
- OSSï¼ˆå¯¹è±¡å­˜å‚¨ï¼‰
- å†…å®¹å®‰å…¨API
- çŸ­ä¿¡æœåŠ¡

#### è…¾è®¯äº‘
- IM SDKï¼ˆå³æ—¶é€šè®¯ï¼‰

### 6.3 åœ°å›¾æœåŠ¡ï¼ˆå¾…æ¥å…¥ï¼‰
- é«˜å¾·åœ°å›¾APIï¼ˆè·ç¦»è®¡ç®—ï¼‰

---

## ğŸ“Š ä¸ƒã€æ•°æ®åº“è®¾è®¡æ€»è§ˆ

### 7.1 æ ¸å¿ƒè¡¨æ±‡æ€»

| æ¨¡å— | è¡¨å | çŠ¶æ€ | é¢„ä¼°æ•°æ®é‡ |
|------|------|------|-----------|
| ç”¨æˆ·æ¨¡å— | t_user | âœ…å·²åˆ›å»º | 100ä¸‡+ |
| ç”¨æˆ·æ¨¡å— | t_user_profile | å¾…åˆ›å»º | 100ä¸‡+ |
| ç”¨æˆ·æ¨¡å— | t_user_album | å¾…åˆ›å»º | 500ä¸‡+ |
| ç”¨æˆ·æ¨¡å— | t_tag_library | å¾…åˆ›å»º | 1000+ |
| ç”¨æˆ·æ¨¡å— | t_user_tag | å¾…åˆ›å»º | 500ä¸‡+ |
| åŒ¹é…æ¨¡å— | t_user_match | å¾…åˆ›å»º | 1000ä¸‡+ |
| åŒ¹é…æ¨¡å— | t_user_like | å¾…åˆ›å»º | 5000ä¸‡+ |
| åŒ¹é…æ¨¡å— | t_user_swipe_record | å¾…åˆ›å»º | 1äº¿+ |
| èŠå¤©æ¨¡å— | t_chat_conversation | å¾…åˆ›å»º | 500ä¸‡+ |
| åŠ¨æ€æ¨¡å— | t_moment | å¾…åˆ›å»º | 500ä¸‡+ |
| åŠ¨æ€æ¨¡å— | t_moment_like | å¾…åˆ›å»º | 5000ä¸‡+ |
| åŠ¨æ€æ¨¡å— | t_moment_comment | å¾…åˆ›å»º | 1000ä¸‡+ |
| æ´»åŠ¨æ¨¡å— | t_buddy_activity | å¾…åˆ›å»º | 10ä¸‡+ |
| æ´»åŠ¨æ¨¡å— | t_official_activity | å¾…åˆ›å»º | 1ä¸‡+ |
| è®¢å•æ¨¡å— | t_vip_order | å¾…åˆ›å»º | 50ä¸‡+ |

### 7.2 åˆ†è¡¨ç­–ç•¥ï¼ˆæœªæ¥ä¼˜åŒ–ï¼‰

#### éœ€è¦åˆ†è¡¨çš„è¡¨
1. **t_user_swipe_record**ï¼šæŒ‰user_idå“ˆå¸Œåˆ†256è¡¨
2. **t_moment_like**ï¼šæŒ‰moment_idåˆ†è¡¨
3. **èŠå¤©æ¶ˆæ¯**ï¼šä½¿ç”¨ç¬¬ä¸‰æ–¹IMï¼ˆä¸éœ€è¦è‡ªå·±åˆ†è¡¨ï¼‰

### 7.3 ç´¢å¼•ç­–ç•¥

```sql
-- å·²æœ‰ç´¢å¼•ï¼ˆt_userè¡¨ï¼‰âœ…
UNIQUE KEY `uk_openid` (`openid`)
KEY `idx_unionid` (`unionid`)
KEY `idx_phone` (`phone`)
KEY `idx_status` (`status`)
KEY `idx_vip_level` (`vip_level`)

-- å¾…æ·»åŠ ç´¢å¼•
-- 1. å¤åˆç´¢å¼•ï¼ˆåŒ¹é…æŸ¥è¯¢ï¼‰
ALTER TABLE t_user_location ADD INDEX idx_city_gender (city, gender);

-- 2. æ—¶é—´ç´¢å¼•ï¼ˆæ—¶é—´èŒƒå›´æŸ¥è¯¢ï¼‰
ALTER TABLE t_moment ADD INDEX idx_created_audit (created_at, audit_status);

-- 3. è¦†ç›–ç´¢å¼•ï¼ˆé¿å…å›è¡¨ï¼‰
ALTER TABLE t_user_like ADD INDEX idx_to_user_created (to_user_id, created_at, like_type);
```

---

## ğŸ“ˆ å…«ã€æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ

### 8.1 ç¼“å­˜ç­–ç•¥

#### Redisç¼“å­˜ï¼ˆå·²ä½¿ç”¨ âœ…ï¼‰
```java
// å·²å®ç°Tokenç¼“å­˜
redisTemplate.opsForValue().set(
    TOKEN_PREFIX + userId, 
    token, 
    7, 
    TimeUnit.DAYS
);
```

#### å¾…è¡¥å……ç¼“å­˜
```java
// 1. ç”¨æˆ·ä¿¡æ¯ç¼“å­˜ï¼ˆ30åˆ†é’Ÿï¼‰
String cacheKey = "user:info:" + userId;
UserDTO userDTO = redisTemplate.opsForValue().get(cacheKey);
if (userDTO == null) {
    userDTO = loadFromDB(userId);
    redisTemplate.opsForValue().set(cacheKey, userDTO, 30, TimeUnit.MINUTES);
}

// 2. æ¨èåˆ—è¡¨ç¼“å­˜ï¼ˆ10åˆ†é’Ÿï¼‰
String recommendKey = "recommend:" + userId;
List<Long> userIds = redisTemplate.opsForList().range(recommendKey, 0, -1);

// 3. çƒ­é—¨åŠ¨æ€ç¼“å­˜ï¼ˆ5åˆ†é’Ÿï¼‰
String hotMomentsKey = "moments:hot";
```

### 8.2 æ•°æ®åº“ä¼˜åŒ–

#### å·²ä½¿ç”¨ âœ…
1. **MyBatis-Plus**ï¼šç®€åŒ–CRUD
2. **é€»è¾‘åˆ é™¤**ï¼š`deleted`å­—æ®µ âœ…
3. **è‡ªåŠ¨å¡«å……**ï¼š`created_at`, `updated_at` âœ…

#### å¾…ä¼˜åŒ–
1. **è¯»å†™åˆ†ç¦»**ï¼šä¸»ä»å¤åˆ¶
2. **æ…¢æŸ¥è¯¢ç›‘æ§**ï¼šå®šæœŸä¼˜åŒ–
3. **è¿æ¥æ± ä¼˜åŒ–**ï¼šHikariCPé…ç½®

### 8.3 æ¥å£ä¼˜åŒ–

1. **å¼‚æ­¥å¤„ç†**
```java
@Async
public void sendNotification(Long userId, String message) {
    // å¼‚æ­¥å‘é€é€šçŸ¥ï¼Œä¸é˜»å¡ä¸»æµç¨‹
}
```

2. **æ‰¹é‡æ“ä½œ**
```java
// æ‰¹é‡æ’å…¥
wxUserMapper.insertBatch(userList);
```

---

## ğŸš€ ä¹ã€å¼€å‘æ’æœŸï¼ˆåŸºäºç°æœ‰é¡¹ç›®ï¼‰

### âœ… å·²å®Œæˆï¼ˆçº¦1ä¸ªæœˆå·¥ä½œé‡ï¼‰
- é¡¹ç›®æ­å»º
- å¾®ä¿¡ç™»å½•
- JWTè®¤è¯
- ç”¨æˆ·åŸºç¡€ä¿¡æ¯
- Swaggeræ–‡æ¡£
- å¤šç¯å¢ƒé…ç½®

### ç¬¬ä¸€é˜¶æ®µï¼ˆ2ä¸ªæœˆï¼‰ï¼šæ ¸å¿ƒåŠŸèƒ½
- [ ] ç”¨æˆ·èµ„æ–™å®Œå–„ï¼ˆ1å‘¨ï¼‰
- [ ] ç…§ç‰‡ä¸Šä¼ OSSï¼ˆ1å‘¨ï¼‰
- [ ] æ™ºèƒ½åŒ¹é…ç®—æ³•ï¼ˆ2å‘¨ï¼‰
- [ ] åŒ¹é…åå¥½è®¾ç½®ï¼ˆ1å‘¨ï¼‰
- [ ] æ¥å…¥è…¾è®¯äº‘IMï¼ˆ2å‘¨ï¼‰
- [ ] èŠå¤©åˆ—è¡¨ï¼ˆ1å‘¨ï¼‰

### ç¬¬äºŒé˜¶æ®µï¼ˆ2ä¸ªæœˆï¼‰ï¼šç¤¾äº¤åŠŸèƒ½
- [ ] åŠ¨æ€å‘å¸ƒ/æµè§ˆï¼ˆ2å‘¨ï¼‰
- [ ] ç‚¹èµ/è¯„è®ºï¼ˆ1å‘¨ï¼‰
- [ ] å†…å®¹å®¡æ ¸æ¥å…¥ï¼ˆ1å‘¨ï¼‰
- [ ] ä¼šå‘˜ä½“ç³»ï¼ˆ2å‘¨ï¼‰
- [ ] å¾®ä¿¡æ”¯ä»˜ï¼ˆ2å‘¨ï¼‰

### ç¬¬ä¸‰é˜¶æ®µï¼ˆ1.5ä¸ªæœˆï¼‰ï¼šæ´»åŠ¨åŠŸèƒ½
- [ ] æ­å­å¹³å°ï¼ˆ3å‘¨ï¼‰
- [ ] çº¿ä¸‹æ´»åŠ¨ï¼ˆ2å‘¨ï¼‰
- [ ] é€šçŸ¥ç³»ç»Ÿï¼ˆ1å‘¨ï¼‰

### ç¬¬å››é˜¶æ®µï¼ˆ1ä¸ªæœˆï¼‰ï¼šä¼˜åŒ–ä¸æµ‹è¯•
- [ ] æ€§èƒ½ä¼˜åŒ–ï¼ˆ1å‘¨ï¼‰
- [ ] å®‰å…¨åŠ å›ºï¼ˆ1å‘¨ï¼‰
- [ ] å…¨é‡æµ‹è¯•ï¼ˆ1å‘¨ï¼‰
- [ ] ä¸Šçº¿å‡†å¤‡ï¼ˆ1å‘¨ï¼‰

**æ€»å¼€å‘å‘¨æœŸ**ï¼šçº¦7.5ä¸ªæœˆï¼ˆå«å·²å®Œæˆçš„1ä¸ªæœˆï¼‰

---

## ğŸ’° åã€æˆæœ¬ä¼°ç®—

### 10.1 æœåŠ¡å™¨æˆæœ¬ï¼ˆæŒ‰æœˆï¼‰
- äº‘æœåŠ¡å™¨ï¼ˆ4æ ¸8Gï¼‰Ã—2ï¼šçº¦1,500å…ƒ/æœˆ
- MySQL RDSï¼ˆä¸»ä»ï¼‰ï¼šçº¦1,000å…ƒ/æœˆ
- Redisï¼šçº¦500å…ƒ/æœˆ
- å¸¦å®½ï¼ˆ100Mbpsï¼‰ï¼šçº¦2,000å…ƒ/æœˆ
- **å°è®¡**ï¼šçº¦5,000å…ƒ/æœˆ

### 10.2 ç¬¬ä¸‰æ–¹æœåŠ¡æˆæœ¬ï¼ˆæŒ‰æœˆï¼‰
- è…¾è®¯äº‘IMï¼šçº¦1,000å…ƒ/æœˆ
- é˜¿é‡Œäº‘OSSï¼šçº¦500å…ƒ/æœˆ
- å†…å®¹å®¡æ ¸ï¼šçº¦500å…ƒ/æœˆ
- çŸ­ä¿¡æœåŠ¡ï¼šçº¦200å…ƒ/æœˆ
- **å°è®¡**ï¼šçº¦2,200å…ƒ/æœˆ

### 10.3 äººåŠ›æˆæœ¬ï¼ˆå¼€å‘é˜¶æ®µï¼‰
- åç«¯å¼€å‘ï¼š1äºº Ã— 6.5ä¸ªæœˆ
- å‰ç«¯å¼€å‘ï¼š1äºº Ã— 6ä¸ªæœˆ
- æµ‹è¯•ï¼š0.5äºº Ã— 4ä¸ªæœˆ
- UIè®¾è®¡ï¼š0.5äºº Ã— 3ä¸ªæœˆ

---

## âš ï¸ åä¸€ã€é£é™©è¯„ä¼°ä¸å»ºè®®

### 11.1 æŠ€æœ¯é£é™©

#### å•ä½“æ¶æ„é™åˆ¶
**é£é™©**ï¼šå½“ç”¨æˆ·é‡å¢é•¿åˆ°100ä¸‡+æ—¶ï¼Œå•ä½“æ¶æ„å¯èƒ½æˆä¸ºç“¶é¢ˆã€‚

**å»ºè®®**ï¼š
1. **çŸ­æœŸ**ï¼šé€šè¿‡ä¼˜åŒ–ï¼ˆç¼“å­˜ã€è¯»å†™åˆ†ç¦»ã€CDNï¼‰æ”¯æ’‘åˆ°50ä¸‡ç”¨æˆ·
2. **ä¸­æœŸ**ï¼šå‚ç›´æ‹†åˆ†ï¼ˆå°†IMã€æ”¯ä»˜ç­‰ç‹¬ç«‹å‡ºæ¥ï¼‰
3. **é•¿æœŸ**ï¼šè€ƒè™‘å¾®æœåŠ¡æ”¹é€ ï¼ˆSpring Cloud Alibabaï¼‰

#### IMç¨³å®šæ€§
**å»ºè®®**ï¼šä½¿ç”¨è…¾è®¯äº‘IMï¼ˆæˆç†Ÿã€ç¨³å®šã€å…è¿ç»´ï¼‰

### 11.2 ä¸šåŠ¡é£é™©

#### å†…å®¹é£é™©
**å»ºè®®**ï¼š
1. æ¥å…¥é˜¿é‡Œäº‘å†…å®¹å®‰å…¨APIï¼ˆè‡ªåŠ¨å®¡æ ¸ï¼‰
2. å»ºç«‹äººå·¥å®¡æ ¸æµç¨‹
3. å®Œå–„ä¸¾æŠ¥æœºåˆ¶

#### ç”¨æˆ·éšç§
**å»ºè®®**ï¼š
1. ä¸¥æ ¼éµå®ˆã€Šä¸ªäººä¿¡æ¯ä¿æŠ¤æ³•ã€‹
2. è·å–ç”¨æˆ·æˆæƒï¼ˆæ‰‹æœºå·ã€ä½ç½®ç­‰ï¼‰
3. æ•°æ®åŠ å¯†å­˜å‚¨

### 11.3 æ€§èƒ½é£é™©

#### æ¨èç®—æ³•æ€§èƒ½
**å»ºè®®**ï¼š
1. å®šæ—¶ä»»åŠ¡é¢„è®¡ç®—æ¨èæ± 
2. Redisç¼“å­˜æ¨èç»“æœ
3. ä½¿ç”¨Elasticsearchä¼˜åŒ–æœç´¢

---

## ğŸ“š åäºŒã€ç°æœ‰é¡¹ç›®ç»“æ„

### 12.1 åŒ…ç»“æ„
```
com.example.demo
â”œâ”€â”€ DemoApplication.java           # å¯åŠ¨ç±»
â”œâ”€â”€ common/                        # å…¬å…±ç±»
â”‚   â”œâ”€â”€ Result.java               # ç»Ÿä¸€å“åº” âœ…
â”‚   â””â”€â”€ TraceIdUtils.java         # TraceIdå·¥å…· âœ…
â”œâ”€â”€ config/                        # é…ç½®ç±»
â”‚   â”œâ”€â”€ AppProperties.java        # åº”ç”¨é…ç½® âœ…
â”‚   â”œâ”€â”€ JwtConfig.java            # JWTé…ç½® âœ…
â”‚   â”œâ”€â”€ MybatisPlusConfig.java    # MPé…ç½® âœ…
â”‚   â”œâ”€â”€ SwaggerConfig.java        # Swagger âœ…
â”‚   â””â”€â”€ WebConfig.java            # Webé…ç½® âœ…
â”œâ”€â”€ controller/                    # æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ WxAuthController.java     # å¾®ä¿¡è®¤è¯ âœ…
â”‚   â”œâ”€â”€ UserController.java       # ç”¨æˆ·ç®¡ç† âœ…
â”‚   â””â”€â”€ HelloController.java      # æµ‹è¯•æ¥å£ âœ…
â”œâ”€â”€ dto/                           # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â”œâ”€â”€ WxLoginRequest.java       # ç™»å½•è¯·æ±‚ âœ…
â”‚   â”œâ”€â”€ WxLoginResponse.java      # ç™»å½•å“åº” âœ…
â”‚   â””â”€â”€ UserDTO.java              # ç”¨æˆ·DTO âœ…
â”œâ”€â”€ entity/                        # å®ä½“ç±»
â”‚   â”œâ”€â”€ WxUser.java               # å¾®ä¿¡ç”¨æˆ· âœ…
â”‚   â””â”€â”€ User.java                 # ç”¨æˆ·ï¼ˆæµ‹è¯•ï¼‰âœ…
â”œâ”€â”€ interceptor/                   # æ‹¦æˆªå™¨
â”‚   â”œâ”€â”€ JwtAuthInterceptor.java   # JWTè®¤è¯ âœ…
â”‚   â””â”€â”€ TraceIdInterceptor.java   # TraceId âœ…
â”œâ”€â”€ mapper/                        # Mapperæ¥å£
â”‚   â”œâ”€â”€ WxUserMapper.java         âœ…
â”‚   â””â”€â”€ UserMapper.java           âœ…
â”œâ”€â”€ service/                       # æœåŠ¡æ¥å£
â”‚   â”œâ”€â”€ WxAuthService.java        âœ…
â”‚   â”œâ”€â”€ UserService.java          âœ…
â”‚   â””â”€â”€ impl/                     # æœåŠ¡å®ç°
â”‚       â”œâ”€â”€ WxAuthServiceImpl.java âœ…
â”‚       â””â”€â”€ UserServiceImpl.java   âœ…
â””â”€â”€ util/                          # å·¥å…·ç±»
    â”œâ”€â”€ JwtUtil.java              # JWTå·¥å…· âœ…
    â”œâ”€â”€ WxUtil.java               # å¾®ä¿¡å·¥å…· âœ…
    â””â”€â”€ JwtSecretGenerator.java   # å¯†é’¥ç”Ÿæˆ âœ…
```

### 12.2 é…ç½®æ–‡ä»¶
```
resources/
â”œâ”€â”€ application.properties         # ä¸»é…ç½® âœ…
â”œâ”€â”€ application-dev.properties     # å¼€å‘ç¯å¢ƒ âœ…
â”œâ”€â”€ application-uat.properties     # æµ‹è¯•ç¯å¢ƒ âœ…
â”œâ”€â”€ logback-spring.xml             # æ—¥å¿—é…ç½® âœ…
â”œâ”€â”€ db/                            # SQLè„šæœ¬
â”‚   â”œâ”€â”€ init.sql                  # åˆå§‹åŒ– âœ…
â”‚   â””â”€â”€ init_wx_login.sql         # å¾®ä¿¡ç”¨æˆ·è¡¨ âœ…
â””â”€â”€ mapper/                        # MyBatisæ˜ å°„
    â””â”€â”€ UserMapper.xml            âœ…
```

---

## ğŸ“– åä¸‰ã€APIæ¥å£æ±‡æ€»

### å·²å®ç°æ¥å£ âœ…
```
POST   /api/auth/wx/login          - å¾®ä¿¡ç™»å½•
GET    /api/auth/user/info         - è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
POST   /api/auth/token/refresh     - åˆ·æ–°Token
POST   /api/auth/logout            - ç™»å‡º
```

### å¾…å¼€å‘æ¥å£ï¼ˆåˆ†é˜¶æ®µï¼‰

#### ç¬¬ä¸€é˜¶æ®µï¼šç”¨æˆ·ä¸åŒ¹é…
```
# ç”¨æˆ·èµ„æ–™
POST   /api/user/profile           - å®Œå–„èµ„æ–™
PUT    /api/user/profile           - æ›´æ–°èµ„æ–™
GET    /api/user/profile/{userId}  - æŸ¥çœ‹ä»–äººèµ„æ–™
POST   /api/user/album/upload      - ä¸Šä¼ ç…§ç‰‡
DELETE /api/user/album/{photoId}   - åˆ é™¤ç…§ç‰‡

# æ™ºèƒ½åŒ¹é…
GET    /api/match/recommend        - è·å–æ¨èåˆ—è¡¨
POST   /api/match/swipe            - æ»‘åŠ¨æ“ä½œ
GET    /api/match/matches          - åŒ¹é…åˆ—è¡¨
GET    /api/match/liked-me         - è°å–œæ¬¢æˆ‘ï¼ˆVIPï¼‰

# èŠå¤©ï¼ˆç»“åˆIM SDKï¼‰
GET    /api/chat/conversations     - ä¼šè¯åˆ—è¡¨
GET    /api/chat/im-signature      - è·å–IMç­¾å
```

#### ç¬¬äºŒé˜¶æ®µï¼šåŠ¨æ€ä¸ä¼šå‘˜
```
# åŠ¨æ€ç¤¾åŒº
GET    /api/moment/feed            - åŠ¨æ€æµ
POST   /api/moment/publish         - å‘å¸ƒåŠ¨æ€
POST   /api/moment/like            - ç‚¹èµ
POST   /api/moment/comment         - è¯„è®º

# ä¼šå‘˜ä½“ç³»
GET    /api/vip/packages           - ä¼šå‘˜å¥—é¤
POST   /api/vip/order/create       - åˆ›å»ºè®¢å•
POST   /api/vip/pay                - å‘èµ·æ”¯ä»˜
POST   /api/vip/pay/callback       - æ”¯ä»˜å›è°ƒ
```

#### ç¬¬ä¸‰é˜¶æ®µï¼šæ´»åŠ¨
```
# æ­å­å¹³å°
GET    /api/buddy/list             - æ´»åŠ¨åˆ—è¡¨
POST   /api/buddy/publish          - å‘å¸ƒæ´»åŠ¨
POST   /api/buddy/enroll           - æŠ¥åæ´»åŠ¨

# çº¿ä¸‹æ´»åŠ¨
GET    /api/activity/official/list - å®˜æ–¹æ´»åŠ¨åˆ—è¡¨
POST   /api/activity/enroll        - æŠ¥åæ´»åŠ¨
POST   /api/activity/pay           - æ”¯ä»˜æ´»åŠ¨è´¹
```

---

## ğŸ“ åå››ã€æ€»ç»“ä¸ä¸‹ä¸€æ­¥

### å·²å®Œæˆå·¥ä½œ âœ…
1. âœ… Spring Booté¡¹ç›®æ­å»º
2. âœ… å¾®ä¿¡å°ç¨‹åºç™»å½•ï¼ˆå®Œæ•´æµç¨‹ï¼‰
3. âœ… JWT Tokenè®¤è¯ä½“ç³»
4. âœ… ç”¨æˆ·åŸºç¡€ä¿¡æ¯ç®¡ç†
5. âœ… Redisç¼“å­˜Token
6. âœ… Swagger APIæ–‡æ¡£
7. âœ… å¤šç¯å¢ƒé…ç½®
8. âœ… é“¾è·¯è¿½è¸ª
9. âœ… ç»Ÿä¸€å“åº”æ ¼å¼

### ä¼˜å…ˆå¼€å‘åŠŸèƒ½ï¼ˆMVPï¼‰
1. **ç”¨æˆ·èµ„æ–™å®Œå–„**ï¼ˆå¿…é¡»ï¼‰
   - ç…§ç‰‡ä¸Šä¼ 
   - æ ‡ç­¾é€‰æ‹©
   - åŸºç¡€ä¿¡æ¯

2. **æ™ºèƒ½åŒ¹é…**ï¼ˆæ ¸å¿ƒï¼‰
   - æ¨èç®—æ³•
   - å·¦æ»‘å³æ»‘
   - åŒ¹é…æˆåŠŸ

3. **å³æ—¶é€šè®¯**ï¼ˆæ ¸å¿ƒï¼‰
   - æ¥å…¥è…¾è®¯äº‘IM
   - èŠå¤©åˆ—è¡¨

4. **ä¼šå‘˜ä½“ç³»**ï¼ˆå˜ç°ï¼‰
   - ä¼šå‘˜å¥—é¤
   - å¾®ä¿¡æ”¯ä»˜

### æŠ€æœ¯äº®ç‚¹
1. âœ… å•ä½“åˆ†å±‚æ¶æ„ï¼Œé€‚åˆå¿«é€Ÿè¿­ä»£
2. âœ… MyBatis-Plusæå‡å¼€å‘æ•ˆç‡
3. âœ… JWT + Rediså®ç°å®‰å…¨è®¤è¯
4. âœ… Hutoolå·¥å…·åº“ç®€åŒ–ä»£ç 
5. âœ… Swaggerè‡ªåŠ¨ç”ŸæˆAPIæ–‡æ¡£
6. ğŸ“‹ ç¬¬ä¸‰æ–¹IMé™ä½å¼€å‘æˆæœ¬
7. ğŸ“‹ é˜¿é‡Œäº‘æœåŠ¡ä¿éšœç¨³å®šæ€§

### å¼€å‘å»ºè®®
1. **ç¬¬ä¸€æœŸ**ï¼šå®ŒæˆMVPï¼ˆåŒ¹é…+èŠå¤©+ä¼šå‘˜ï¼‰ï¼Œå¿«é€Ÿä¸Šçº¿éªŒè¯
2. **ç¬¬äºŒæœŸ**ï¼šä¸°å¯Œç¤¾äº¤åœºæ™¯ï¼ˆåŠ¨æ€ã€æ­å­ï¼‰ï¼Œæå‡æ´»è·ƒåº¦
3. **ç¬¬ä¸‰æœŸ**ï¼šä¼˜åŒ–ç®—æ³•ï¼Œæå‡ç•™å­˜å’Œè½¬åŒ–ç‡

---

**æ–‡æ¡£ç¼–å†™**ï¼šåŸºäº wxmini-friends é¡¹ç›®å®é™…ä»£ç   
**ç‰ˆæœ¬å†å²**ï¼š
- v1.0ï¼šåˆå§‹ç‰ˆæœ¬ï¼ˆç†æƒ³åŒ–è®¾è®¡ï¼‰
- v2.0ï¼šåŸºäºç°æœ‰é¡¹ç›®è°ƒæ•´ï¼ˆå½“å‰ç‰ˆæœ¬ï¼‰âœ…

**é¡¹ç›®åœ°å€**ï¼š`/Users/tang/work/wxmini-friends`  
**æ•°æ®åº“**ï¼šMySQL 8.0  
**Spring Bootç‰ˆæœ¬**ï¼š2.7.18  
**æ¶æ„æ¨¡å¼**ï¼šå•ä½“åˆ†å±‚æ¶æ„

